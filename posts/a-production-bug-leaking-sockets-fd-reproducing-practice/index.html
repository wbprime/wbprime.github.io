<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>Blog by WangBo - ä¸€æ¬¡ç”±äºç½‘ç»œå¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å¯¼è‡´çº¿ä¸ŠæœåŠ¡äº‹æ•…åŸå› çš„æ’æŸ¥ç»å†</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">WB Prime</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;github.wangbo.im">
                            Github
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.wangbo.im">WB Prime</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;github.wangbo.im">
                                    Github
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    



<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;a-production-bug-leaking-sockets-fd-reproducing-practice&#x2F;">ä¸€æ¬¡ç”±äºç½‘ç»œå¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å¯¼è‡´çº¿ä¸ŠæœåŠ¡äº‹æ•…åŸå› çš„æ’æŸ¥ç»å†</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2020-02-23</span>
            
        </div>
    </header>

    <div class="post-content">
      <p>æœ€è¿‘ï¼Œçº¿ä¸ŠæœåŠ¡é­é‡äº†ä¸€æ¬¡äº‹æ•…ã€‚è¯¥æœåŠ¡ï¼ˆè®°ä¸º A æœåŠ¡ï¼‰æ˜¯ä¸€ä¸ª Java çš„ç½‘ç»œæœåŠ¡ï¼Œé—´æ¥ä½¿ç”¨äº† <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> ä½œä¸ºå†…å­˜æ•°
æ®åº“å’Œ RPC åŸºç¡€ä»¶ï¼›æœåŠ¡å¯¹ <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> çš„è®¿é—®æ“ä½œé€šè¿‡å…¬å¸å¦å¤–éƒ¨é—¨ç»´æŠ¤çš„ä¸€ä¸ªäºŒæ¬¡å°è£…æ¥å£ï¼ˆå…¬å…± JAR åŒ…å½¢å¼ï¼‰è¿›è¡Œã€‚</p>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿ç»´æŒ‰è®¡åˆ’ä¸‹çº¿ <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> æœåŠ¡ä¹‹åï¼ŒA æœåŠ¡çš„æ­£å¸¸ä¸šåŠ¡æµç¨‹æœªå—åˆ°å½±å“ï¼›æŒ‰è®¡åˆ’ç»§ç»­ä¸‹çº¿
<a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> æœåŠ¡æ‰€åœ¨çš„æœåŠ¡å™¨ä¹‹åï¼ŒA æœåŠ¡å¾ˆå¿«å¼€å§‹æŠ¥ <code>java.net.SocketException: Too many open files</code> é”™è¯¯ï¼Œå¯¼è‡´ A æœåŠ¡å¾ˆå¿«ä¸å¯ç”¨ã€‚</p>
<p>æˆ‘åœ¨æµ‹è¯•ç¯å¢ƒéƒ¨ç½²æ¨¡æ‹Ÿå¤ç°äº†è¯¥ç°è±¡ï¼Œå¹¶æ’æŸ¥åˆ°æ­¤æ¬¡äº‹æ•…æ˜¯ç”± <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> çš„ä¸€ä¸ª <a href="https://github.com/apache/ignite/commit/6c3a486f0d7f0dd55c377af233d7c525d86f600a" title="Fixed socket leak in TcpDiscoverySpi">BUG</a> å¯¼
è‡´çš„ã€‚äº‹å®ä¸Šï¼Œè¯¥ <a href="https://github.com/apache/ignite/commit/6c3a486f0d7f0dd55c377af233d7c525d86f600a" title="Fixed socket leak in TcpDiscoverySpi">BUG</a> å·²ç»åœ¨ <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> çš„ä¸»çº¿ç‰ˆæœ¬ä¸­è¢«ä¿®å¤ï¼Œä½†ç”±äºéš”å£éƒ¨é—¨è‡ªå·± FORK äº† <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> çš„è¾ƒä½ç‰ˆæœ¬å¹¶ä¸”æ²¡æœ‰åŠæ—¶åœ°åŒæ­¥ä¸»çº¿æ›´æ–°ï¼Œä½¿å¾— A æœåŠ¡åœ¨ç”Ÿäº§ç¯å¢ƒå‡ºç°äº†è¯¥äº‹æ•…ã€‚</p>
<p>ç°è®°å½•ä¸‹äº‹æ•…åŸå› æ’æŸ¥çš„ç»å†ï¼Œä»¥é‰´åäº‹ã€‚</p>
<p id="zola-continue-reading"><a name="continue-reading"></a></p>
<h1 id="background"><a class="zola-anchor" href="#background" aria-label="Anchor link for: background">ğŸ”—</a>Background</h1>
<p><a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> æ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„ç½‘ç»œä¸­é—´ä»¶ï¼Œå¯ä»¥æä¾›åˆ†å¸ƒå¼çš„å†…å­˜ç¼“å­˜ã€å†…å­˜æ•°æ®ç½‘æ ¼ï¼ˆK-Vï¼‰ã€å†…å­˜æ•°æ®åº“ï¼ˆSQLï¼‰ã€ç½‘æ ¼è®¡ç®—ã€RPC åŸºç¡€æ”¯æŒå’Œæ¶ˆæ¯ä¸­é—´ä»¶ç­‰åŠŸèƒ½ã€‚</p>
<p><a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> æä¾›åµŒå…¥å¼çš„å¼€å‘åŒ…ï¼Œå°†æ¯ä¸€ä¸ªåŒ…å«äº†å¼€å‘åŒ…çš„æœåŠ¡è¿›ç¨‹æ‰©å±•ä¸ºä¸€ä¸ª <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> èŠ‚ç‚¹ï¼›åŒä¸€ä¸ªæœåŠ¡çš„ä¸åŒå®
ä¾‹æˆ–ä¸åŒæœåŠ¡çš„ä¸åŒå®ä¾‹ï¼Œåªè¦åŒ…å«ç›¸åŒçš„ <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> é›†ç¾¤é…ç½®ï¼Œå°±ä¼šç›¸äº’å‘ç°æˆä¸ºåŒä¸€ä¸ªé›†ç¾¤çš„å­èŠ‚ç‚¹ï¼›è¿™æ ·å°±ä¸éœ€è¦é¢å¤–éƒ¨ç½² <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> æœåŠ¡å®ä¾‹ï¼Œåªéœ€è¦éƒ¨ç½²æœåŠ¡å®ä¾‹ã€‚</p>
<p>A æœåŠ¡é€šè¿‡åŒ…å«éš”å£éƒ¨é—¨äºŒæ¬¡å°è£…çš„ <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> å¼€å‘åŒ…è®¿é—® <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> é›†ç¾¤ï¼Œä¸»è¦æ˜¯æœåŠ¡ Bã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">-------------     -------------
| Service A | ==&gt; | Service B |
-------------     -------------
</span></pre>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒæœåŠ¡ A å’ŒæœåŠ¡ B ä¸æ˜¯éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šã€‚</p>
<h1 id="crash-report"><a class="zola-anchor" href="#crash-report" aria-label="Anchor link for: crash-report">ğŸ”—</a>Crash Report</h1>
<p>çº¿ä¸Šè¿ç»´ä¸€å…±è¿›è¡Œäº†ä¸¤æ¬¡æ“ä½œï¼š</p>
<ol>
<li>å°†æœåŠ¡ B å®ä¾‹å…³åœã€‚</li>
<li>å°†æœåŠ¡ B å®ä¾‹æ‰€åœ¨çš„æœåŠ¡å™¨ä¸‹çº¿ã€‚</li>
</ol>
<p><a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> é›†ç¾¤çš„å„èŠ‚ç‚¹ä¹‹é—´ä¼šä¿æŒå¿ƒè·³è¿æ¥ä»¥å®ç°é›†ç¾¤æ‹“æ‰‘çš„åŠ¨æ€å˜åŒ–ã€‚</p>
<p>å½“æœåŠ¡ B å®ä¾‹è¢«å…³åœä¹‹åï¼ŒæœåŠ¡ A ä¸­ <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> ç›¸å…³çš„çº¿ç¨‹ä¼šä¸åœåœ°é‡è¯•è¿æ¥æœåŠ¡ B çš„ç›‘å¬ç«¯å£ï¼Œä½†ä¸å‡ºæ„å¤–åœ°ä¼šå¤±è´¥ï¼›æœåŠ¡ A ä¸­çš„å…¶ä»–ä¸šåŠ¡é€»è¾‘ç†è®ºä¸Šä¸ä¼šå—åˆ°å½±å“ã€‚äº‹å®ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ­¤æ—¶æœåŠ¡ A çš„è¿è¡Œæ­£å¸¸ã€‚</p>
<p>å½“æœåŠ¡ B å®ä¾‹çš„æœåŠ¡å™¨è¢«ä¸‹çº¿ä¹‹åï¼Œç†è®ºä¸Šå¯¹æœåŠ¡ A çš„å½±å“åŒæœåŠ¡ B è¢«å…³åœã€‚ä½†æ˜¯ï¼Œåœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼ˆ5åˆ†
é’Ÿçº§åˆ«ï¼‰ï¼ŒæœåŠ¡ A å¼€å§‹å‡ºç° <code>java.net.SocketException: Too many open files</code> å¼‚å¸¸ã€‚
ä»å¼‚å¸¸è¯´æ˜å¯ä»¥çŒœæµ‹ï¼šæ­¤æ—¶æœåŠ¡ A ä¸­å­˜åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªä¸åœåœ°åˆ›å»º Socket ä½†ä¸é‡Šæ”¾çš„çº¿ç¨‹ï¼Œå¯¼è‡´ç½‘ç»œå¥—æ¥å­—æ–‡ä»¶
æè¿°ç¬¦è¢«è€—å°½ã€‚ä¸€ä¸ªåˆç†çš„çŒœæµ‹æ˜¯æœ¬æ¬¡çš„ç½‘ç»œå¥—æ¥å­—æ³„éœ²æ˜¯ç”±äº <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> çš„å¿ƒè·³çº¿ç¨‹å¯¼è‡´çš„ï¼šåœ¨ä¸æŸ¥çœ‹å…·ä½“ä»£ç çš„é€»è¾‘ä¸‹ï¼Œå¯ä»¥çŒœæµ‹å‡ºè¯¥çº¿ç¨‹çš„ä¸»ä½“é€»è¾‘æ˜¯ä¸€ä¸ª <code>while</code> æ— é™å¾ªç¯ï¼Œå¾ªç¯ä½“ä¸­å°è¯•è¿æ¥ç›®æ ‡èŠ‚ç‚¹å¹¶å‘é€å¿ƒè·³æ¶ˆæ¯ï¼Œå¦‚æœæ£€æµ‹å¿ƒè·³æˆåŠŸï¼Œåˆ™ä¼‘çœ ç»™å®šæ—¶é—´é—´éš”ä»¥ç­‰å¾…ä¸‹ä¸€æ¬¡å¿ƒè·³æ£€æµ‹ï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™ç«‹å³é‡è¯•ç»™å®šæ¬¡æ•°ä»¥ç¡®å®šç›®æ ‡èŠ‚ç‚¹æ˜¯å¦å·²ä¸‹çº¿ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹åŸºæœ¬ä¸Šæ˜¯è½®è¯¢çš„å¥—è·¯ï¼Œ<strong>æˆ‘æœ€å¼€å§‹è®¤ä¸º</strong> åŸºæœ¬ä¸Šä¸ä¼šå‡ºç°ç½‘ç»œå¥—æ¥å­—æ³„éœ²çš„é—®é¢˜ï¼ˆ<a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> å¯æ˜¯é«˜å¤§ä¸Šçš„å¤§å‚äº§å“ <strong>^-^</strong>ï¼‰ï¼Œè€Œä¸”å¿ƒè·³é‡è¯•è¿‡ç¨‹å¦‚æœæœ‰é—®é¢˜çš„è¯ï¼ŒæœåŠ¡è¢«å…³åœå’ŒæœåŠ¡å™¨è¢«ä¸‹çº¿æ—¶çš„è¡¨ç°ä¸ä¼šä¸ä¸€æ ·ï¼ˆ<strong>^-^</strong>ï¼‰ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¼€å§‹å°è¯•ä»åº•å±‚å®šä½é—®é¢˜ã€‚</p>
<h1 id="steps"><a class="zola-anchor" href="#steps" aria-label="Anchor link for: steps">ğŸ”—</a>Steps</h1>
<h2 id="reproduce-bug"><a class="zola-anchor" href="#reproduce-bug" aria-label="Anchor link for: reproduce-bug">ğŸ”—</a>Reproduce BUG</h2>
<p>é¦–å…ˆå°è¯•åœ¨æµ‹è¯•ç¯å¢ƒå¤ç°è¯¥ BUG ã€‚ä¿®æ”¹é…ç½®æ–‡ä»¶ä¹‹åå†é‡å¯å³å¯ã€‚</p>
<p>æ­¤æ—¶å¯ä»¥é€šè¿‡ <code>jps -lmv</code> å‘½ä»¤æŸ¥çœ‹åˆ°æœåŠ¡è¿è¡Œå®ä¾‹çš„è¿›ç¨‹å·ã€‚</p>
<p>ç„¶åç®€å•åœ°æŸ¥çœ‹ CPU/Memory/IO çš„çŠ¶æ€ï¼ŒåŸºæœ¬ä¸æ­£å¸¸æƒ…å†µæ²¡æœ‰å·®åˆ«ã€‚</p>
<p>ç„¶åæŸ¥çœ‹è¿›ç¨‹ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦çš„æƒ…å†µï¼Œè¿è¡Œ <code>lsof -p $pid</code> ã€‚<a href="https://linux.die.net/man/8/lsof">lsof</a> æ˜¯
Linux ä¸‹æŸ¥çœ‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„å·¥å…·ï¼Œ<code>-p</code> é€‰é¡¹æŒ‡å®šåªåˆ—å‡ºç»™å®šè¿›ç¨‹å·çš„è¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p>
<p>åœ¨ç­‰å¾…å¤§çº¦ 5 åˆ†é’Ÿä¹‹åï¼Œå¼€å§‹å‡ºç°ä¸‹è¿°è¾“å‡ºï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">$ lsof -p 16404
...omit...
java    16404 fo_dev 1885u     sock                0,7       0t0  18695292 protocol: TCPv6
java    16404 fo_dev 1886u     sock                0,7       0t0  18695293 protocol: TCPv6
java    16404 fo_dev 1887u     sock                0,7       0t0  18695294 protocol: TCPv6
java    16404 fo_dev 1888u     sock                0,7       0t0  18695295 protocol: TCPv6
java    16404 fo_dev 1889u     sock                0,7       0t0  18695298 protocol: TCPv6
...omit...
</span></pre>
<p>å¯ä»¥çœ‹åˆ°æœåŠ¡ A çš„å®ä¾‹åœ¨ä¸æ–­åœ°åˆ›å»º <code>TCPv6</code> ç±»å‹çš„å¥—æ¥å­—ã€‚è¯¥ç±»å‹å¥—æ¥å­—çš„ä¸ªæ•°åœ¨å‡ åˆ†é’Ÿä¹‹å†…è¾¾åˆ° 1000 ä»¥ä¸Šã€‚</p>
<p>æŸ¥çœ‹ <code>ulimit</code> çš„è¾“å‡ºï¼Œæ²¡æœ‰å¼‚å¸¸ã€‚</p>
<p>è¿™ä¸ª <code>TCPv6</code> çœ‹çš„æˆ‘ä¸€å¤´é›¾æ°´ï¼Œæ€ä¹ˆå¥½åƒè·Ÿ IPv6 è¿˜æœ‰å…³ç³»ï¼Ÿ</p>
<p>ä½¿ç”¨å…³é”®å­—ä¸Šç½‘æœå¯»ï¼Œåªæ‰¾åˆ°è¿™ä¸€ç¯‡ <a href="https://blog.csdn.net/define_us/article/details/84950934">TomcatæœåŠ¡æ•…éšœæ’æŸ¥ï¼šæ‰“å¼€æ–‡ä»¶è¿‡å¤š</a> æœ‰ç‚¹ç›¸å…³ï¼Œä½†æ˜¯å…¶ä¹Ÿæ²¡æœ‰æåˆ°åŸå› å’Œè§£å†³åŠæ³•ã€‚</p>
<h2 id="disable-jdk-ipv6-stack"><a class="zola-anchor" href="#disable-jdk-ipv6-stack" aria-label="Anchor link for: disable-jdk-ipv6-stack">ğŸ”—</a>Disable JDK IPv6 Stack</h2>
<p>ç”±äºå½“å‰çš„ç°è±¡æ˜¯æœåŠ¡ä¸æ–­åˆ›å»º <code>TCPv6</code> ç±»å‹çš„å¥—æ¥å­—ï¼Œæ‰€ä»¥å¼€å§‹æ€€ç–‘æ˜¯ IPv6 ç›¸å…³çš„é—®é¢˜ã€‚</p>
<p>å‚è€ƒ <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/net/ipv6_guide/index.html">Networking IPv6 User Guide for JDK/JRE</a> çš„è¯´æ˜ï¼Œä¿®æ”¹æœåŠ¡å¯åŠ¨å‚æ•°ï¼Œæ·»åŠ  <code>-Djava.net.preferIPv4Stack=true</code> é€‰é¡¹ç¦ç”¨ IPv6ã€‚</p>
<p>é‡æ–°è¿è¡Œ <code>lsof</code> å¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼ˆç±»ä¼¼ï¼‰ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">$ lsof -p 16404
...omit...
java    16404 fo_dev 1885u     sock                0,7       0t0  18695292 protocol: TCP
java    16404 fo_dev 1886u     sock                0,7       0t0  18695293 protocol: TCP
java    16404 fo_dev 1887u     sock                0,7       0t0  18695294 protocol: TCP
java    16404 fo_dev 1888u     sock                0,7       0t0  18695295 protocol: TCP
java    16404 fo_dev 1889u     sock                0,7       0t0  18695298 protocol: TCP
...omit...
</span></pre>
<p>è¿™è¯´æ˜æœåŠ¡å¥—æ¥å­—æ³„éœ²çš„é—®é¢˜ä¸ IPv6 æ— å…³ã€‚</p>
<h2 id="lsof-per-thread"><a class="zola-anchor" href="#lsof-per-thread" aria-label="Anchor link for: lsof-per-thread">ğŸ”—</a><code>lsof</code> Per Thread</h2>
<p>å›è¿‡å¤´å»çœ‹çœ‹ <code>lsof</code> çš„æ‰‹å†Œï¼Œå‘ç°æœ‰ä¸€ä¸ªé€‰é¡¹ <code>-K</code>ï¼š</p>
<blockquote>
<p><strong>-K</strong>       selects the listing of tasks (threads) of processes, on dialects  where  task  (thread) reporting  is supported.  (If help output - i.e., the output of the -h or -?  options - shows this option, then task (thread) reporting is supported by the dialect.)
When -K and -a are both specified on Linux,  and  the  tasks  of  a  main  process  are selected  by  other  options,  the main process will also be listed as though it were a task, but without a task ID.  (See the description of the TID column in the OUTPUT secâ€
tion.)</p>
</blockquote>
<blockquote>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">           Where the FreeBSD version supports threads, all threads will be listed with their IDs.
</span><span style="color:#fdf4c1aa;">           In  general  threads  and tasks inherit the files of the caller, but may close some and open others, so lsof always reports all the open files of threads and tasks.
</span></pre></blockquote>
<p>è¿™ä¸ªé€‰é¡¹çš„æ„æ€æ˜¯åœ¨è¾“å‡ºçš„ç»“æœä¸­æ˜¾ç¤ºæ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„çº¿ç¨‹å·ï¼Œæ£’æäº†ã€‚</p>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">$ lsof -p 16404 -K
...omit...
java      16404 17818    fo_dev 1314u     sock                0,7        0t0  18703132 protocol: TCPv6
java      16404 17818    fo_dev 1315u     sock                0,7        0t0  18703133 protocol: TCPv6
java      16404 17818    fo_dev 1316u     sock                0,7        0t0  18703134 protocol: TCPv6
java      16404 17818    fo_dev 1317u     sock                0,7        0t0  18703135 protocol: TCPv6
java      16404 17818    fo_dev 1318u     sock                0,7        0t0  18703138 protocol: TCPv6
...omit...
</span></pre>
<p>ç»“æœè¾“å‡ºå¾ˆé•¿ï¼Œä¸»è¦è¡¨ç°ä¸ºåŒä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦åœ¨æ‰€æœ‰çš„çº¿ç¨‹ä¸Šéƒ½æœ‰æ˜¾ç¤ºã€‚å¾ˆæ˜æ˜¾ï¼ŒLinux (Red Hat Enterprise Linux Server x86_64 7.4) ä¸‹é¢ä¸æ”¯æŒè¿™ä¸ªé€‰é¡¹ï¼Œæ‰€ä»¥ <code>all threads will be listed with their IDs</code>ã€‚</p>
<h2 id="strace"><a class="zola-anchor" href="#strace" aria-label="Anchor link for: strace">ğŸ”—</a><code>strace</code></h2>
<p>å¥—æ¥å­—æ³„éœ²ç¡®å®åœ¨å‘ç”Ÿï¼Œä½†æ˜¯å´æ²¡æœ‰åŠæ³•èƒ½æ˜ç¡®å®šä½åˆ°é—®é¢˜åœ¨å“ªé‡Œã€‚å¦‚æœèƒ½ç›´æ¥çœ‹åˆ°è¿›ç¨‹è°ƒç”¨ <code>socket</code> å’Œ <code>close</code> ç³»ç»Ÿè°ƒç”¨çš„è®°å½•ï¼Œå°±å¯ä»¥çŸ¥é“åœ¨å“ªé‡Œå‘ç”Ÿäº†å¥—æ¥å­—æ³„éœ²ã€‚</p>
<p>äºæ˜¯æ‰¾åˆ°äº† <a href="https://linux.die.net/man/1/strace">strace</a> å·¥å…·ï¼Œè¯¥å·¥å…·å¯ä»¥è·Ÿè¸ªè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨è®°å½•ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">$ strace -t -T -f -p 23345 -e trace=network,close -o strace.out
...omit...
904   16:52:35 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2379 &lt;0.000105&gt;
904   16:52:35 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2380 &lt;0.000061&gt;
904   16:52:35 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2381 &lt;0.000070&gt;
904   16:52:35 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2382 &lt;0.000062&gt;
904   16:52:37 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2383 &lt;0.000170&gt;
904   16:52:37 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2384 &lt;0.000188&gt;
904   16:52:37 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2385 &lt;0.000161&gt;
904   16:52:37 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2386 &lt;0.000075&gt;
904   16:52:39 close(2387)              = 0 &lt;0.000190&gt;
904   16:52:39 socket(AF_INET, SOCK_DGRAM|SOCK_NONBLOCK, IPPROTO_IP) = 2387 &lt;0.000106&gt;
904   16:52:39 close(2387)              = 0 &lt;0.000059&gt;
904   16:52:39 socket(AF_INET, SOCK_DGRAM|SOCK_NONBLOCK, IPPROTO_IP) = 2387 &lt;0.000104&gt;
904   16:52:39 close(2387)              = 0 &lt;0.000053&gt;
904   16:52:39 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2387 &lt;0.000111&gt;
...omit...
32663 16:52:40 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2391 &lt;0.000115&gt;
32663 16:52:41 close(2391)              = 0 &lt;0.000045&gt;
32663 16:52:51 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2415 &lt;0.000113&gt;
32663 16:52:52 close(2415)              = 0 &lt;0.000061&gt;
32663 16:53:02 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2435 &lt;0.000124&gt;
32663 16:53:03 close(2435)              = 0 &lt;0.000050&gt;
32663 16:53:13 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2459 &lt;0.000210&gt;
32663 16:53:14 close(2459)              = 0 &lt;0.000061&gt;
32663 16:53:24 socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 2479 &lt;0.000111&gt;
32663 16:53:25 close(2479)              = 0 &lt;0.000053&gt;
...omit...
</span></pre>
<p>é€‰é¡¹ <code>-t</code> è¡¨æ˜åœ¨è¾“å‡ºç»“æœä¸­åŠ ä¸Šæ—¶é—´æˆ³ä¿¡æ¯ï¼Œ<code>-T</code> è¡¨ç¤ºåœ¨è¾“å‡ºç»“æœä¸­åŠ ä¸Šç³»ç»Ÿè°ƒç”¨çš„è€—æ—¶ä¿¡æ¯ï¼Œ<code>-f</code> è¡¨ç¤ºåœ¨è¾“å‡ºç»“æœä¸­åŠ ä¸Šå…³è”çš„çº¿ç¨‹å·ä¿¡æ¯ (Trace child processes as they are created by currently traced processes as a result of the <code>fork(2)</code>, <code>vfork(2)</code> and <code>clone(2)</code> system calls.  Note that <code>-p</code> PID <code>-f</code> will attach all threads of process PID if it is multi-threaded, not only thread with thread_id = PID.)ï¼Œ<code>-p</code> è¾“å‡ºæŒ‡å®šè¿›ç¨‹çš„ç»“æœï¼Œ<code>-e</code> è¡¨ç¤ºåªè¾“å‡ºç½‘ç»œç›¸å…³å’Œ <code>close()</code> ç³»ç»Ÿè°ƒç”¨çš„æ—¥å¿—ï¼Œ<code>-o</code> è¡¨ç¤ºå°†è¾“å‡ºç»“æœå­˜å‚¨åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ã€‚</p>
<p>è¯´æ˜ï¼Œä¸Šè¿°è¾“å‡ºç»è¿‡äº†æ•´ç†ï¼Œè¿‡æ»¤äº†æ— å…³çš„è¾“å‡ºå¹¶æŒ‰ç…§çº¿ç¨‹åˆ†ç»„æŒ‰æ—¶é—´æ’åºã€‚</p>
<p>å¯ä»¥ç›´æ¥ä»è¾“å‡ºç»“æœä¸­å‘ç°æœªæˆå¯¹çš„ <code>socket()/close()</code> è°ƒç”¨ï¼Œè¿™è¡¨æ˜å‡ºç°äº†å¥—æ¥å­—æ³„éœ²ã€‚åŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°å‘ç”Ÿæ³„éœ²çš„çº¿ç¨‹å· (904)ã€‚</p>
<h2 id="jstack"><a class="zola-anchor" href="#jstack" aria-label="Anchor link for: jstack">ğŸ”—</a><code>jstack</code></h2>
<p>é€šè¿‡ <code>jstack</code> å¯ä»¥å¾—åˆ°æŒ‡å®š Jvm è¿›ç¨‹çš„çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼ˆåŒ…å«çº¿ç¨‹å·ï¼‰ã€‚</p>
<p>ä½†æ˜¯ <code>jstack</code> è¾“å‡ºçš„çº¿ç¨‹å·æ˜¯ 16 è¿›åˆ¶çš„ç»“æœï¼Œå¯ä»¥é€šè¿‡ <code>printf</code> æ¥è¿›è¡Œ 10/16 è¿›åˆ¶çš„çº¿ç¨‹å·ä¹‹é—´çš„è½¬æ¢ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">$ printf %x 904
388
$ printf %d 0x388
904
</span></pre>
<p>ç°åœ¨å°±å®šä½åˆ°äº†æœ‰é—®é¢˜çš„çº¿ç¨‹çš„å †æ ˆäº†ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">&quot;tcp-client-disco-msg-worker-#7%XXXXXXX%&quot; #182 prio=5 os_prio=0 tid=0x00007f4e1c42b000 nid=0x388 waiting on condition [0x00007f4e14dcf000]
   java.lang.Thread.State: TIMED_WAITING (sleeping)
        at java.lang.Thread.sleep(Native Method)
        at org.apache.ignite.spi.discovery.tcp.ClientImpl.joinTopology(ClientImpl.java:575)
        at org.apache.ignite.spi.discovery.tcp.ClientImpl.access$900(ClientImpl.java:124)
        at org.apache.ignite.spi.discovery.tcp.ClientImpl$MessageWorker.tryJoin(ClientImpl.java:1825)
        at org.apache.ignite.spi.discovery.tcp.ClientImpl$MessageWorker.body(ClientImpl.java:1541)
        at org.apache.ignite.spi.IgniteSpiThread.run(IgniteSpiThread.java:62)
</span></pre>
<p>è¯´æ˜ï¼Œä¸Šè¿°è¾“å‡ºç»è¿‡äº†æ•´ç†ï¼Œä¿®æ”¹äº†çº¿ç¨‹åä¸­ä¸å½±å“ç»“è®ºçš„éƒ¨åˆ†ã€‚</p>
<p>è¿™æ ·å°±å®šä½åˆ°äº†æœ‰é—®é¢˜çš„çº¿ç¨‹ã€‚</p>
<p>ç°åœ¨å¿…é¡»è¦å»æŸ¥çœ‹ <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> çš„å®é™…ä»£ç äº†ã€‚</p>
<h2 id="review-ignite-code"><a class="zola-anchor" href="#review-ignite-code" aria-label="Anchor link for: review-ignite-code">ğŸ”—</a>Review Ignite Code</h2>
<p>æŒ‰ç…§å †æ ˆæç¤ºå®šä½åˆ°é—®é¢˜ä»£ç ï¼Œå…·ä½“è¿‡ç¨‹ä¸èµ˜è¿°äº†ã€‚</p>
<p>ä»£ç ç‰‡æ®µæ‘˜æŠ„å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="font-style:italic;color:#928374;">// [[[3]]]
</span><span style="color:#fa5c4b;">protected </span><span style="color:#8ec07c;">Socket </span><span style="color:#fdf4c1;">openSocket(</span><span style="color:#8ec07c;">InetSocketAddress</span><span style="color:#fdf4c1;"> sockAddr, </span><span style="color:#8ec07c;">IgniteSpiOperationTimeoutHelper</span><span style="color:#fdf4c1;"> timeoutHelper)</span><span style="color:#fdf4c1aa;"> throws </span><span style="color:#8ec07c;">IOException</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">IgniteSpiOperationTimeoutException </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">return </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">openSocket(this.createSocket(), sockAddr, timeoutHelper)</span><span style="color:#fdf4c1aa;">;
}

</span><span style="font-style:italic;color:#928374;">// [[[5]]]
</span><span style="color:#fa5c4b;">protected </span><span style="color:#8ec07c;">Socket </span><span style="color:#fdf4c1;">openSocket(</span><span style="color:#8ec07c;">Socket</span><span style="color:#fdf4c1;"> sock, </span><span style="color:#8ec07c;">InetSocketAddress</span><span style="color:#fdf4c1;"> remAddr, </span><span style="color:#8ec07c;">IgniteSpiOperationTimeoutHelper</span><span style="color:#fdf4c1;"> timeoutHelper)</span><span style="color:#fdf4c1aa;"> throws </span><span style="color:#8ec07c;">IOException</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">IgniteSpiOperationTimeoutException </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">assert</span><span style="color:#fdf4c1aa;"> remAddr </span><span style="color:#fe8019;">!= </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;

    </span><span style="font-style:italic;color:#928374;">// [[[6]]]
    </span><span style="color:#8ec07c;">InetSocketAddress</span><span style="color:#fdf4c1aa;"> resolved </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> remAddr.</span><span style="color:#fdf4c1;">isUnresolved() </span><span style="color:#fe8019;">? </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">InetSocketAddress</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">InetAddress</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">getByName(remAddr.getHostName())</span><span style="color:#fdf4c1aa;">, remAddr.</span><span style="color:#fdf4c1;">getPort()</span><span style="color:#fdf4c1aa;">) </span><span style="color:#fe8019;">:</span><span style="color:#fdf4c1aa;"> remAddr;
    </span><span style="color:#8ec07c;">InetAddress</span><span style="color:#fdf4c1aa;"> addr </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> resolved.</span><span style="color:#fdf4c1;">getAddress()</span><span style="color:#fdf4c1aa;">;

    </span><span style="color:#fa5c4b;">assert</span><span style="color:#fdf4c1aa;"> addr </span><span style="color:#fe8019;">!= </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;

    sock.</span><span style="color:#fdf4c1;">connect(resolved, (</span><span style="color:#fa5c4b;">int</span><span style="color:#fdf4c1;">)timeoutHelper.nextTimeoutChunk(this.sockTimeout))</span><span style="color:#fdf4c1aa;">;
    </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">writeToSocket(sock, (</span><span style="color:#8ec07c;">TcpDiscoveryAbstractMessage</span><span style="color:#fdf4c1;">)</span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1;">, (</span><span style="color:#fa5c4b;">byte[]</span><span style="color:#fdf4c1;">)</span><span style="color:#8ec07c;">U</span><span style="color:#fdf4c1;">.IGNITE_HEADER, timeoutHelper.nextTimeoutChunk(this.sockTimeout))</span><span style="color:#fdf4c1aa;">;
    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> sock;
}

</span><span style="font-style:italic;color:#928374;">// [[[4]]]
</span><span style="color:#8ec07c;">Socket </span><span style="color:#fdf4c1;">createSocket()</span><span style="color:#fdf4c1aa;"> throws </span><span style="color:#8ec07c;">IOException </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#8ec07c;">Socket</span><span style="color:#fdf4c1aa;"> sock;
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">isSslEnabled()</span><span style="color:#fdf4c1aa;">) {
        sock </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.sslSockFactory.</span><span style="color:#fdf4c1;">createSocket()</span><span style="color:#fdf4c1aa;">;
    } </span><span style="color:#fa5c4b;">else </span><span style="color:#fdf4c1aa;">{
        sock </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">Socket</span><span style="color:#fdf4c1aa;">();
    }

    sock.</span><span style="color:#fdf4c1;">bind(</span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">InetSocketAddress</span><span style="color:#fdf4c1;">(this.locHost, </span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1;">))</span><span style="color:#fdf4c1aa;">;
    sock.</span><span style="color:#fdf4c1;">setTcpNoDelay(</span><span style="color:#d3869b;">true</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> sock;
}

</span><span style="font-style:italic;color:#928374;">// [[[0]]]
// ...omit...
</span><span style="color:#8ec07c;">Socket</span><span style="color:#fdf4c1aa;"> sock </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
    </span><span style="font-style:italic;color:#928374;">// ...omit...
</span><span style="color:#fdf4c1aa;">    sock </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">openSocket(addr, timeoutHelper)</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// [[[1]]]
    // ...omit...
</span><span style="color:#fdf4c1aa;">} </span><span style="color:#fdf4c1;">catch (</span><span style="color:#8ec07c;">IgniteCheckedException </span><span style="color:#fe8019;">| </span><span style="color:#8ec07c;">IOException</span><span style="color:#fdf4c1;"> e) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#8ec07c;">U</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">closeQuiet(sock)</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// close socket // [[[2]]]
    // ...omit...
</span><span style="color:#fdf4c1aa;">}
</span><span style="font-style:italic;color:#928374;">// ...omit...
</span></pre>
<p><a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> å†…éƒ¨ä¼šé‡è¯•è¿æ¥èŠ‚ç‚¹ï¼Œè¿æ¥èŠ‚ç‚¹çš„é€»è¾‘ç®€ç•¥å¦‚ <code>[[[0]]]</code> å¤„çš„ä»£ç æ‰€ç¤ºï¼šåœ¨ <code>try</code> å—ä¸­åˆ›å»ºè¿æ¥å¤„ç†å¥—æ¥å­— (<code>[[[1]]]</code> å¤„)ï¼Œåœ¨ <code>catch</code> å—ä¸­å…³é—­å¥—æ¥å­— (<code>[[[2]]]</code> å¤„)ã€‚</p>
<p>åˆ›å»ºå¹¶è¿æ¥å¥—æ¥å­—çš„æ“ä½œåœ¨ <code>[[[3]]]</code> ä¸­ï¼šé¦–å…ˆåˆ›å»ºå¥—æ¥å­— (<code>[[[4]]]</code> å¤„)ï¼Œç„¶åè¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨åœ°å€ (<code>[[[5]]]</code> å¤„)ï¼Œæœ€åè¿”å›åˆ›å»ºçš„å¥—æ¥å­—ã€‚</p>
<p>é—®é¢˜åœ¨äºè¿æ¥ç›®æ ‡æœåŠ¡å™¨åœ°å€çš„è¿‡ç¨‹ä¸­æœ‰å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ (<code>[[[6]]]</code> å¤„)ï¼Œå¯¼è‡´å·²åˆ›å»ºçš„å¥—æ¥å­—å¹¶ä¸èƒ½è¢«è¿”å›åˆ°æœ€å¤–å±‚ä»¥å…³é—­ã€‚è¿æ¥ç›®æ ‡æœåŠ¡å™¨ä¹‹å‰éœ€è¦è·å–ç›®æ ‡æœåŠ¡å™¨çš„åœ°å€ (<code>[[[6]]]</code> å¤„)ï¼Œæ­¤å¤„è°ƒç”¨äº† <code>InetAddress.getByName()</code> æ–¹æ³•è¯•å›¾å°†ä¸€ä¸ªä¸»æœºåè§£æä¸ºåˆæ³•çš„IP åœ°å€ï¼Œå¦‚æœæ— æ³•è§£æåˆ™ä¼šæŠ›å‡º <code>java.net.UnknownHostException</code> å¼‚å¸¸ï¼Œå¯¼è‡´ <code>[[[5]]]</code> æ–¹æ³•åŠé€”é€€å‡ºï¼Œä»è€Œå¯¼è‡´å¥—æ¥å­—æ³„éœ²ã€‚</p>
<h2 id="verify-using-plain-ip"><a class="zola-anchor" href="#verify-using-plain-ip" aria-label="Anchor link for: verify-using-plain-ip">ğŸ”—</a>Verify using Plain IP</h2>
<p><a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a> åœ¨è§£æä¸»æœºåæ—¶æŠ›å‡ºå¼‚å¸¸å¯¼è‡´å¥—æ¥å­—æ³„éœ²ï¼Œå¯ä»¥é€šè¿‡é…ç½®ç›®æ ‡åœ°å€ä¸ºæ˜¾å¼ IP åœ°å€æ¥éªŒè¯ï¼Œè€Œä¹‹å‰é…ç½®çš„æœåŠ¡ B çš„åœ°å€æ˜¯ä¸»æœºåï¼ˆé€šè¿‡å†…ç½‘ DNS è§£æå®šä½åˆ°æœåŠ¡å™¨åœ°å€ï¼‰ã€‚</p>
<p>ä¿®æ”¹é…ç½®ä¹‹åé‡å¯æœåŠ¡å¹¶è§‚å¯Ÿ <code>lsof</code> çš„è¾“å‡ºï¼Œå‘ç°ä¸å­˜åœ¨å¥—æ¥å­—æ³„éœ²ç°è±¡ã€‚</p>
<p>æœç„¶ï¼</p>
<h2 id="ignite-on-github"><a class="zola-anchor" href="#ignite-on-github" aria-label="Anchor link for: ignite-on-github">ğŸ”—</a>Ignite on Github</h2>
<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä½œä¸ºè¿™ä¹ˆç‰›çš„å¼€æºé¡¹ç›®ï¼Œåº”è¯¥ä¸èƒ½å­˜åœ¨è¿™ä¹ˆä½çº§çš„ BUG å§ã€‚</p>
<p>ä¸Š <a href="https://github.com/apache/ignite">Github</a> çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°è¿™ä¸ª BUG å·²ç»è¢« <a href="https://github.com/apache/ignite/commit/6c3a486f0d7f0dd55c377af233d7c525d86f600a" title="Fixed socket leak in TcpDiscoverySpi">å‘ç°å¹¶ FIX</a> äº†ï¼Œæ—¶é—´æ˜¯ <strong>2018-09-21</strong>ï¼Œå‘ƒã€‚</p>
<p>çœ‹æ ·å­æ˜¯éš”å£éƒ¨é—¨çš„é”…ï¼Œå…¶ç»´æŠ¤äº†ä¸€ä¸ªè¾ƒä½ç‰ˆæœ¬çš„ <a href="https://ignite.apache.org/" title="Apache Ignite: In-Memory Computing Platform">Ignite</a>ï¼Œæ²¡æœ‰åŠæ—¶è·Ÿè¸ªå®˜æ–¹çš„ä¸»çº¿ä¿®å¤ã€‚</p>
<h1 id="conclusion"><a class="zola-anchor" href="#conclusion" aria-label="Anchor link for: conclusion">ğŸ”—</a>Conclusion</h1>
<p>åœ¨ç½‘ç»œæœåŠ¡å‡ºç° <code>Too many open files</code> ç±»ä¼¼çš„å¼‚å¸¸ä¹‹åï¼Œå¯ä»¥è€ƒè™‘æ’æŸ¥æœåŠ¡æ˜¯å¦å­˜åœ¨ç½‘ç»œå¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦æ³„éœ²
çš„ BUGã€‚</p>
<ol>
<li>é¦–å…ˆä½¿ç”¨ <code>jps</code> å·¥å…·è·å–åˆ°ç›®æ ‡æœåŠ¡çš„è¿›ç¨‹å·</li>
<li>ä½¿ç”¨ <code>lsof</code> å·¥å…·æŸ¥çœ‹ç›®æ ‡è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„ç±»å‹å’Œç‰¹å¾</li>
<li>ä½¿ç”¨ <code>jstack</code> å·¥å…·æŸ¥çœ‹ç›®æ ‡è¿›ç¨‹çš„çº¿ç¨‹å †æ ˆæ˜¯å¦æœ‰å¼‚å¸¸</li>
<li>ä½¿ç”¨ <code>strace</code> å·¥å…·æŸ¥çœ‹ç›®æ ‡è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè€ƒè™‘æ·»åŠ  <code>-f</code> å‚æ•°æ˜¾ç¤ºå¯¹åº”çš„çº¿ç¨‹å·</li>
<li>ä½¿ç”¨ <code>jstack</code> å·¥å…·æ‰¾åˆ°ç›®æ ‡è¿›ç¨‹ä¸­å¯¹åº”çº¿ç¨‹å·çš„å †æ ˆä¿¡æ¯</li>
<li>æŸ¥çœ‹å¯¹åº”ä»£ç ï¼Œæœ€ç»ˆå®šä½é—®é¢˜</li>
</ol>
<hr />
<p>ä»¥ä¸Šã€‚</p>

    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;ignite&#x2F;">#ignite</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;lsof&#x2F;">#lsof</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;strace&#x2F;">#strace</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;jstack&#x2F;">#jstack</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;tcpv6&#x2F;">#TCPv6</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;fd-leaking&#x2F;">#fd leaking</a>
                    
                </div>
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;dependency-injection-practise-guice-vs-dagger2&#x2F;">â€¹ Dependency Injection - Guice VS Dagger 2</a>
                    
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;even.js" ></script>
      
    </body>

</html>
