

<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>Wbprime</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;wbprime.github.io&#x2F;site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Wbprime</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https://wbprime.github.io">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://wbprime.github.io&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://wbprime.github.io&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://wbprime.github.io&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;wbprime.github.io">Wbprime</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https://wbprime.github.io">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://wbprime.github.io&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://wbprime.github.io&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://wbprime.github.io&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://wbprime.github.io/posts/2016-04-07-learning-java-concurrency-reentrantlock-condition/#reentrantlock-s-api" class="toc-link">ReentrantLock&#x27;s API</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://wbprime.github.io/posts/2016-04-07-learning-java-concurrency-reentrantlock-condition/#gong-ping-suo-yu-fei-gong-ping-suo" class="toc-link">å…¬å¹³é”ä¸éå…¬å¹³é”</a>
                        </li>
                        
                        <li>
                            <a href="https://wbprime.github.io/posts/2016-04-07-learning-java-concurrency-reentrantlock-condition/#lock" class="toc-link">lock</a>
                        </li>
                        
                        <li>
                            <a href="https://wbprime.github.io/posts/2016-04-07-learning-java-concurrency-reentrantlock-condition/#trylock" class="toc-link">tryLock</a>
                        </li>
                        
                        <li>
                            <a href="https://wbprime.github.io/posts/2016-04-07-learning-java-concurrency-reentrantlock-condition/#unlock" class="toc-link">unlock</a>
                        </li>
                        
                        <li>
                            <a href="https://wbprime.github.io/posts/2016-04-07-learning-java-concurrency-reentrantlock-condition/#newcondition" class="toc-link">newCondition</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://wbprime.github.io/posts/2016-04-07-learning-java-concurrency-reentrantlock-condition/#condition-s-api" class="toc-link">Condition&#x27;s API</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://wbprime.github.io/posts/2016-04-07-learning-java-concurrency-reentrantlock-condition/#await" class="toc-link">await</a>
                        </li>
                        
                        <li>
                            <a href="https://wbprime.github.io/posts/2016-04-07-learning-java-concurrency-reentrantlock-condition/#signal" class="toc-link">signal</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://wbprime.github.io/posts/2016-04-07-learning-java-concurrency-reentrantlock-condition/#dai-ma-xia-zai" class="toc-link">ä»£ç ä¸‹è½½</a>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;wbprime.github.io&#x2F;posts&#x2F;2016-04-07-learning-java-concurrency-reentrantlock-condition&#x2F;">Learning Java Concurrency - ReentrantLock &amp; Condition</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-04-07</span>
            
        </div>
    </header>

    <div class="post-content">
      <p><code>ReentrantLock</code>æ˜¯<code>synchronized</code>çš„é«˜é˜¶ç‰ˆæœ¬ï¼Œç”¨æ¥æ§åˆ¶å¤šçº¿ç¨‹åŒæ­¥ã€‚<code>ReentrantLock</code>æ˜¯ä¸€ç§ç‹¬å é”ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ä¸€æŠŠé”ï¼Œå…¶ä»–è¯·æ±‚åŠ é”çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ã€‚é™¤äº†æ§åˆ¶å¤šçº¿ç¨‹åŒæ­¥ä¹‹å¤–ï¼Œ<code>ReentrantLock</code>è¿˜æä¾›äº†<code>Condition</code>ç”¨æ¥è¿›è¡Œå¤šçº¿ç¨‹é€šè®¯ã€‚<code>Condition</code>æ˜¯<code>Object</code>ç±»çš„æ–¹æ³•<code>wait &amp; notify</code>çš„æ›¿ä»£ç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨ç­‰å¾…/é€šçŸ¥æ¨¡å¼æ¥æœ‰æ•ˆæ§åˆ¶å¤šçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚</p>
<p>ä»¿<a href="https://wbprime.github.io/posts/learning-java-concurrency-synchronized/"><code>synchronized</code></a>ï¼Œç”¨<code>ReentrantLock</code>å®ç°å•ä¾‹æ¨¡å¼çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">private static class </span><span style="color:#ebcb8b;">Singleton </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static volatile </span><span style="color:#ebcb8b;">Singleton </span><span style="color:#eff1f5;">INSTANCE;
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static </span><span style="color:#ebcb8b;">ReentrantLock </span><span style="color:#eff1f5;">lock </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ReentrantLock</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#8fa1b3;">Singleton</span><span style="color:#eff1f5;">() {}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static </span><span style="color:#ebcb8b;">Singleton </span><span style="color:#8fa1b3;">instance</span><span style="color:#eff1f5;">() {
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">Singleton </span><span style="color:#b48ead;">var </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">INSTANCE</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;"> var) {
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">lock.</span><span style="color:#bf616a;">lock</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">            </span><span style="color:#b48ead;">try </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">                </span><span style="color:#b48ead;">var </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">INSTANCE</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">                </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;"> var) {
</span><span style="color:#eff1f5;">                    </span><span style="color:#d08770;">INSTANCE </span><span style="color:#c0c5ce;">=</span><span style="color:#eff1f5;"> var </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Singleton</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">                </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">} </span><span style="color:#b48ead;">finally </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">                </span><span style="color:#eff1f5;">lock.</span><span style="color:#bf616a;">unlock</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return var</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre>
<p>ä»¿<a href="https://wbprime.github.io/posts/2016-04-06-learning-java-concurrency-wait-notify/"><code>wait &amp; notify</code></a>ï¼Œç”¨<code>Condition</code>æ¥å®ç°çˆ¶å­é€šçŸ¥æ±‡æ¬¾çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">private static class </span><span style="color:#ebcb8b;">DepositAccount </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private int </span><span style="color:#eff1f5;">money;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private final </span><span style="color:#ebcb8b;">ReentrantLock </span><span style="color:#eff1f5;">lock </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ReentrantLock</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private final </span><span style="color:#ebcb8b;">Condition </span><span style="color:#eff1f5;">cond </span><span style="color:#c0c5ce;">=</span><span style="color:#eff1f5;"> lock.</span><span style="color:#bf616a;">newCondition</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public </span><span style="color:#8fa1b3;">DepositAccount</span><span style="color:#eff1f5;">() {
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.money </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public void </span><span style="color:#8fa1b3;">withdraw</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">final int </span><span style="color:#bf616a;">val</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">lock.</span><span style="color:#bf616a;">lock</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">try </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">            </span><span style="color:#b48ead;">while </span><span style="color:#eff1f5;">(money </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#eff1f5;"> val) {
</span><span style="color:#eff1f5;">                </span><span style="color:#b48ead;">try </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">                    </span><span style="color:#eff1f5;">cond.</span><span style="color:#bf616a;">await</span><span style="color:#eff1f5;">(); </span><span style="color:#65737e;">// é’±ä¸å¤Ÿï¼Œç­‰ä¸€ä¼šå„¿
</span><span style="color:#eff1f5;">                </span><span style="color:#eff1f5;">} </span><span style="color:#b48ead;">catch </span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">InterruptedException </span><span style="color:#bf616a;">e</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">                    </span><span style="color:#65737e;">// do nothing here
</span><span style="color:#eff1f5;">                </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">money </span><span style="color:#c0c5ce;">-=</span><span style="color:#eff1f5;"> val;
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">} </span><span style="color:#b48ead;">finally </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">lock.</span><span style="color:#bf616a;">unlock</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public void </span><span style="color:#8fa1b3;">deposite</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">final int </span><span style="color:#bf616a;">val</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">lock.</span><span style="color:#bf616a;">lock</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">try </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">money </span><span style="color:#c0c5ce;">+=</span><span style="color:#eff1f5;"> val;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">cond.</span><span style="color:#bf616a;">signalAll</span><span style="color:#eff1f5;">(); </span><span style="color:#65737e;">// å­˜å®Œé’±å‘¨çŸ¥ä¸€ä¸‹
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">} </span><span style="color:#b48ead;">finally </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">lock.</span><span style="color:#bf616a;">unlock</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre><p><a name="continue-reading"></a></p>
<h1 id="reentrantlock-s-api"><a class="zola-anchor" href="#reentrantlock-s-api" aria-label="Anchor link for: reentrantlock-s-api">ğŸ”—</a>
ReentrantLock's API</h1>
<ol>
<li>ReentrantLock() &amp; ReentrantLock(boolean fair)</li>
<li>void lock()</li>
<li>void lockInterruptibly() throws InterruptedException</li>
<li>boolean tryLock()</li>
<li>boolean tryLock(long timeout, TimeUnit unit)</li>
<li>void unlock()</li>
<li>boolean isHelpByCurrentThread()</li>
<li>boolean isLocked()</li>
<li>boolean isFair()</li>
<li>Condition newCondition()</li>
<li>boolean hasWaiters(Condition cond)</li>
</ol>
<p><code>ReentrantLock</code>çš„å®ç°æ˜¯å§”æ‰˜ç»™å†…éƒ¨é™æ€ç±»<code>FairSync</code>å’Œ<code>NonfairSync</code>ï¼Œè¿™ä¸¤ä¸ªç±»åˆç»§æ‰¿è‡ª<code>AbstractQueuedSynchronizer</code>ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">abstract static class </span><span style="color:#ebcb8b;">Sync </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">AbstractQueuedSynchronizer </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">...
</span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#b48ead;">static final class </span><span style="color:#ebcb8b;">NonfairSync </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">Sync </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">...
</span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#b48ead;">static final class </span><span style="color:#ebcb8b;">FairSync </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">Sync </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">...
</span><span style="color:#eff1f5;">}
</span></pre><h2 id="gong-ping-suo-yu-fei-gong-ping-suo"><a class="zola-anchor" href="#gong-ping-suo-yu-fei-gong-ping-suo" aria-label="Anchor link for: gong-ping-suo-yu-fei-gong-ping-suo">ğŸ”—</a>
å…¬å¹³é”ä¸éå…¬å¹³é”</h2>
<p><code>FairSync</code>å’Œ<code>NonfairSync</code>å³æ‰€è°“çš„å…¬å¹³é”å’Œéå…¬å¹³é”ã€‚å¯¹æ¯”ä¸€ä¸‹ä¸¤ä¸ªé”ç‰ˆæœ¬å¯¹äº<code>lock</code>æ–¹æ³•çš„å®ç°ï¼Œå°±èƒ½æ˜ç™½å…¬å¹³å’Œéå…¬å¹³çš„åŒºåˆ«åœ¨å“ªé‡Œäº†ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">final</span><span style="color:#c0c5ce;"> void </span><span style="color:#bf616a;">lock</span><span style="color:#c0c5ce;">() { </span><span style="color:#65737e;">// NonfairSync
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">compareAndSetState</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">))
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">setExclusiveOwnerThread</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">Thread</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">currentThread</span><span style="color:#c0c5ce;">());
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">else
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">acquire</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">final</span><span style="color:#c0c5ce;"> void </span><span style="color:#bf616a;">lock</span><span style="color:#c0c5ce;">() { </span><span style="color:#65737e;">// FairSync
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">acquire</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">}
</span></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¬å¹³é”ç›´æ¥è®©å½“å‰çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ï¼›è€Œéå…¬å¹³é”é¦–å…ˆè¯•å›¾å»è·å–é”ï¼Œå¦‚æœå½“å‰æœ‰çº¿ç¨‹æ°å¥½é‡Šæ”¾äº†é”ï¼Œå°±å¯ä»¥æ’é˜Ÿè·å–åˆ°é”ï¼Œå¦‚æœè·å–å¤±è´¥ï¼Œè¿˜æ˜¯ä¼šåŠ å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéå…¬å¹³é”ä¼šåœ¨è°ƒç”¨lockçš„æ—¶å€™å»å°è¯•è·å–é”ã€‚å¦‚æœè¿™æ—¶å€™èƒ½å¤Ÿè·å–é”ï¼Œå°±ç›´æ¥è·å–åˆ°é”ï¼Œè¿™æ ·å¯ä»¥å‡å°‘çº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤çš„æ€§èƒ½å¼€é”€ï¼›ç¼ºç‚¹å°±æ˜¯æœ‰å¯èƒ½åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹æœ‰å¯èƒ½æ°¸è¿œæ‹¿ä¸åˆ°é”ã€‚</p>
<p><code>ReentrantLock</code>åœ¨æ„é€ å™¨ä¸­å¯ä»¥æŒ‡å®šä½¿ç”¨å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ç­–ç•¥ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ã€‚</p>
<h2 id="lock"><a class="zola-anchor" href="#lock" aria-label="Anchor link for: lock">ğŸ”—</a>
<code>lock</code></h2>
<p><code>lock()</code>å’Œ<code>lockInterruptibly()</code>ç”¨äºè·å–é”ã€‚è°ƒç”¨çº¿ç¨‹è¯•å›¾å»è·å–ä¸€ä¸ªé”ï¼Œå¦‚æœé”å·²ç»è¢«å½“å‰çº¿ç¨‹å ç”¨ï¼Œåˆ™é”çš„è®¡æ•°å™¨åŠ 1ï¼›å¦‚æœé”è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œåˆ™å½“å‰çº¿ç¨‹è¢«é˜»å¡ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ç­‰å¾…é”è¢«é‡Šæ”¾ã€‚</p>
<p>ä¸¤è€…çš„åŒºåˆ«åœ¨äºç­‰å¾…çº¿ç¨‹åœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­æ˜¯å¦å¯ä»¥è¢«ä¸­æ–­ã€‚</p>
<h2 id="trylock"><a class="zola-anchor" href="#trylock" aria-label="Anchor link for: trylock">ğŸ”—</a>
<code>tryLock</code></h2>
<p>å¦‚æœè°ƒç”¨çº¿ç¨‹ä¸æƒ³è¢«é˜»å¡ï¼Œå¯ä»¥ä½¿ç”¨<code>lock</code>çš„å¼‚æ­¥ç‰ˆæœ¬<code>tryLock</code>ã€‚<code>tryLock</code>ä¼šè¯•å›¾å»è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸäº†ï¼Œå°±è¿”å›æˆåŠŸï¼›å¦‚æœå¤±è´¥äº†ï¼Œå°±ä¼šè¿”å›å¤±è´¥ã€‚è·å–å¤±è´¥ï¼Œå¯ä»¥è®¾å®šä¸€ä¸ªç­‰å¾…æ—¶é—´ï¼Œè‡ªæ—‹ç­‰å¾…ã€‚</p>
<h2 id="unlock"><a class="zola-anchor" href="#unlock" aria-label="Anchor link for: unlock">ğŸ”—</a>
<code>unlock</code></h2>
<p>å¦‚æœè°ƒç”¨çº¿ç¨‹æŒæœ‰äº†ç›®æ ‡é”ï¼Œå½“å‰çº¿ç¨‹è°ƒç”¨<code>unlock</code>ä¼šè¯•å›¾é‡Šæ”¾é”å®šã€‚å‡†ç¡®çš„è¯´æ˜¯è®©ç›®æ ‡é”çš„è®¡æ•°å™¨å‡1,å¦‚æœç›®æ ‡é”çš„è®¡æ•°å™¨ä¸º0,åˆ™é”è¢«é‡Šæ”¾ã€‚</p>
<p>å¦‚æœè°ƒç”¨çº¿ç¨‹æ²¡æœ‰æŒæœ‰ç›®æ ‡é”ï¼Œä¼šå¯¼è‡´<code>IllegalMonitorStateException</code>å¼‚å¸¸ã€‚</p>
<h2 id="newcondition"><a class="zola-anchor" href="#newcondition" aria-label="Anchor link for: newcondition">ğŸ”—</a>
<code>newCondition</code></h2>
<p>åˆ›å»ºä¸€ä¸ªä¸ç›®æ ‡é”ç›¸å…³è”çš„<code>Condition</code>å¯¹è±¡ã€‚</p>
<h1 id="condition-s-api"><a class="zola-anchor" href="#condition-s-api" aria-label="Anchor link for: condition-s-api">ğŸ”—</a>
Condition's API</h1>
<ol>
<li>void await() throws InterruptedException</li>
<li>void awaitUninterruptibly()</li>
<li>long awaitNanos(long nanos) throws InterruptedException</li>
<li>boolean await(long timeout, TimeUnit unit) throws InterruptedException</li>
<li>boolean awaitUnit(Date dt) throws InterruptedException</li>
<li>void signal()</li>
<li>void signalAll()</li>
</ol>
<p><code>Condition</code>çš„ä½œç”¨å’Œç”¨æ³•å¯ä»¥å‚è€ƒ<code>Object</code>ç±»çš„<code>wait &amp; notify</code>æ—ã€‚</p>
<p><code>ReentrantLock</code>è¿”å›çš„<code>Condition</code>å¯¹è±¡ä¸ä¸€ä¸ªäº’æ–¥é”ç›¸å…³è”ã€‚<code>Condition</code>å¯¹è±¡æœ¬èº«ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œ<code>await</code>ä¼šå°†è°ƒç”¨çº¿ç¨‹æ”¾åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼›<code>signal</code>ä¼šå°†ç­‰å¾…çº¿ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹æ”¾åˆ°å…³è”çš„<code>ReentrantLock</code>å¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚è¿™æ ·çº¿ç¨‹çš„æŒ‚èµ·å’Œå”¤é†’å·¥ä½œå°±ç”±<code>ReentrantLock</code>å¯¹è±¡å®Œæˆã€‚</p>
<h2 id="await"><a class="zola-anchor" href="#await" aria-label="Anchor link for: await">ğŸ”—</a>
<code>await</code></h2>
<p>åŒ<code>Object</code>çš„<code>wait</code>æ—ï¼Œä¼°è®¡å°±æ˜¯å› ä¸ºå·²ç»æœ‰äº†<code>wait</code>ï¼Œæ‰€ä»¥æ–°çš„APIæ‰è¢«å‘½åä¸º<code>await</code>ã€‚</p>
<p>è°ƒç”¨çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œä¸€ç›´ç­‰åˆ°æ¡ä»¶æ»¡è¶³è¢«å…¶ä»–çº¿ç¨‹ç”¨<code>signal</code>æ¥å”¤é†’ã€‚</p>
<p>ç­‰å¾…å¯ä»¥è®¾ç½®å…ä¸å…è®¸ä¸­æ–­ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ç­‰å¾…æ—¶é—´é—´éš”ã€‚</p>
<p>è°ƒç”¨çº¿ç¨‹è¢«æŒ‚èµ·ä¹‹åä¼šé‡Šæ”¾æŒæœ‰çš„é”ï¼ŒåŠ å…¥åˆ°<code>Condition</code>å¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ—ä¸­å»ã€‚</p>
<h2 id="signal"><a class="zola-anchor" href="#signal" aria-label="Anchor link for: signal">ğŸ”—</a>
<code>signal</code></h2>
<p>åŒ<code>Object</code>çš„<code>notify</code>æ—ã€‚</p>
<p><code>signal</code>å”¤é†’çº¿ç¨‹çš„é¡ºåºæ˜¯æœªå®šä¹‰çš„ï¼Œä¸åŒçš„JVMå®ç°ä¼šæœ‰ä¸åŒçš„ç­–ç•¥ï¼Œå¯ä»¥æ˜¯ç­‰å¾…æ—¶é—´æœ€é•¿çš„æœ€å…ˆè¢«å”¤é†’ã€‚</p>
<p><code>signal</code>ä¼šå°†éœ€è¦å”¤é†’çš„çº¿ç¨‹ä»<code>Condition</code>è‡ªå·±çš„ç­‰å¾…é˜Ÿåˆ—ç§»åŠ¨åˆ°ç»‘å®šçš„<code>ReentrantLock</code>å¯¹è±¡çš„ç­‰å¾…åºåˆ—ï¼ŒæŒ‰ç…§<code>ReentrantLock</code>çš„è§„åˆ™å»è·å–é”ã€‚</p>
<h1 id="dai-ma-xia-zai"><a class="zola-anchor" href="#dai-ma-xia-zai" aria-label="Anchor link for: dai-ma-xia-zai">ğŸ”—</a>
ä»£ç ä¸‹è½½</h1>
<p><a href="https://wbprime.github.io/posts/2016-04-07-learning-java-concurrency-reentrantlock-condition/ConditionCase.java">ConditionCase.java</a>
<a href="https://wbprime.github.io/posts/2016-04-07-learning-java-concurrency-reentrantlock-condition/ReentrantLockCase.java">ReentrantLockCase.java</a></p>

    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https:&#x2F;&#x2F;wbprime.github.io&#x2F;tags&#x2F;java&#x2F;">#java</a>
                    
                        <a href="https:&#x2F;&#x2F;wbprime.github.io&#x2F;tags&#x2F;concurrency&#x2F;">#concurrency</a>
                    
                </div>
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;wbprime.github.io&#x2F;posts&#x2F;2016-04-06-learning-java-concurrency-wait-notify&#x2F;">â€¹ Learning Java Concurrency - wait &amp; notify</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;wbprime.github.io&#x2F;posts&#x2F;2016-04-07-learning-java-concurrency-reentrantreadwritelock&#x2F;">Learning Java Concurrency - ReentrantReadWriteLock â€º</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;wbprime.github.io&#x2F;even.js" ></script>
      
    </body>

</html>
