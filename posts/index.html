<!DOCTYPE html>
<html lang="en">
    <head><title>wangbo’s blog</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="wangbo’s home &amp; blog"/>

    <meta property="og:title" content="
    wangbo’s blog -&nbsp;wangbo’s home &amp; blog" />
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;"/>
    <meta property="og:description" content="wangbo’s home &amp; blog"/>
    <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;style.css">
    <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;color&#x2F;blue.css">
<link rel="shortcut icon" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;favicon.ico" type="image/x-icon" /></head>
    <body>
        <div class="container full">
<header class="header">
    <div class="header__inner">
        <div class="header__logo">
            <a href="&#x2F;">
    <div class="logo">
        WB Prime
    </div>
</a>
        </div>
        <div class="menu-trigger">menu</div>
    </div>
    
    <nav class="menu">
        <ul class="menu__inner menu__inner--desktop">
            
            
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">About</a>
                    </li>
                
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">Categories</a>
                    </li>
                
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">Tags</a>
                    </li>
                
            </ul>

        <ul class="menu__inner menu__inner--mobile">
            
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">About</a>
        </li>
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">Categories</a>
        </li>
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">Tags</a>
        </li>
        </ul>
    </nav>

    </header>
<div class="content">
<div class="posts"><div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-08-31-slow-mysql-query-on-too-many-cas-updating-failure&#x2F;">一次由于线上 MySQL 并发抢占更新冲突引发的 BUG</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.08.31
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;practise&#x2F;">Practise</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;mysql&#x2F;">mysql</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;cas&#x2F;">cas</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;lock&#x2F;">lock</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            前几天在处理线上问题的时候，发现了一个由于多客户端并发使用 CAS 去更新相同记录而导致的锁冲突，引发了数据库管理系统的慢查询累积报警。慢查询导致连接数增加，并引起插入和更新操作被堵塞，引起少量的业务堆积。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-08-31-slow-mysql-query-on-too-many-cas-updating-failure&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-08-28-intro-to-spring-cloud-gateway-slide&#x2F;">Intro to Spring Cloud Gateway</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.08.28
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;spring&#x2F;">Spring</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;gateway&#x2F;">gateway</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;spring-cloud&#x2F;">spring cloud</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;route&#x2F;">route</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            本文基于在部门内的一次分享修改而成，主要介绍 Spring Cloud Gateway 的请求处理流程和装配流程。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-08-28-intro-to-spring-cloud-gateway-slide&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-21-ffmpeg-vsync-explained&#x2F;">Ffmpeg -vsync 使用场景辨析</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.07.21
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;streaming&#x2F;">Streaming</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;ffmpeg&#x2F;">ffmpeg</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;vsync&#x2F;">vsync</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;fps&#x2F;">fps</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            在使用 Ffmpeg 进行视频抽帧时，发现 &#96;-vsync&#96; 参数的意思理解的不是很清楚。本文通过不同的场景使用结果对比来辨析 &#96;-vsync&#96; 选项的枚举参数值的区别。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-21-ffmpeg-vsync-explained&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-21-ffmpeg-snapshot-kuaizhao-thumbnail-concluded&#x2F;">Ffmpeg snapshot&#x2F;thumbnail 快照套路总结</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.07.21
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;streaming&#x2F;">Streaming</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;ffmpeg&#x2F;">ffmpeg</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;snapshoting&#x2F;">snapshoting</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;gif&#x2F;">gif</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;webp&#x2F;">webp</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;select&#x2F;">select</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            使用 Ffmpeg 对视频进行抽帧操作，即把视频中感兴趣的帧输出为图片；该操作也经常被称之为视频快照、视频截图等。视频抽帧按照输出文件的格式不同，可以输出为 &#96;jpg&#96;、&#96;png&#96;、&#96;gif&#96;、&#96;webp&#96; 等格式文件。视频抽帧按照选取视频帧的条件不同，可以分为按类型、按时间、按场景变化等不同的套路。本文从以上两个方面汇总使用 Ffmpeg 抽帧的套路。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-21-ffmpeg-snapshot-kuaizhao-thumbnail-concluded&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-08-general-video-bitrate-recommendation&#x2F;">[Note] General Video Bitrate Recommendation</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.07.08
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;streaming&#x2F;">Streaming</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;bitrate&#x2F;">bitrate</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;youtube&#x2F;">youtube</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;apple&#x2F;">apple</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            在视频转码的过程中，比较关键的是需要确定目标码率（或最大码率）。在网上找了一下大型互联网公司的推荐标准，聊为参考。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-08-general-video-bitrate-recommendation&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-06-generating-hls-m3u8-using-ffmpeg&#x2F;">Generating HLS&#x2F;M3U8 Using FFmpeg</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.07.06
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;streaming&#x2F;">Streaming</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;ffmpeg&#x2F;">ffmpeg</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;hls&#x2F;">hls</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;m3u8&#x2F;">m3u8</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            最近的项目中需要提供音视频多码率转码支持，集中调研了 FFmpeg 对 Apple HTTP Live Streaming (HLS) 的支持，总结一下，遂成本文。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-06-generating-hls-m3u8-using-ffmpeg&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-06-understanding-rate-control-modes-x264-x265-vpx&#x2F;">[译] Understanding Rate Control Modes (x264, x265, vpx)</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.07.06
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;streaming&#x2F;">Streaming</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;ffmpeg&#x2F;">ffmpeg</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;h264&#x2F;">h264</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;rate-control&#x2F;">rate control</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;crf&#x2F;">crf</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;cbr&#x2F;">cbr</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;vbr&#x2F;">vbr</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;abr&#x2F;">abr</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;vbv&#x2F;">vbv</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            翻译自 Understanding Rate Control Modes (x264, x265, vpx)
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-06-understanding-rate-control-modes-x264-x265-vpx&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-04-19-communication-bridge-between-webrtc-and-wechat-rtmp&#x2F;">WebRTC 与微信小程序的音视频互通</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.04.19
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;streaming&#x2F;">Streaming</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;webrtc&#x2F;">WebRTC</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;rtmp&#x2F;">RTMP</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;wechat&#x2F;">wechat</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;live-pusher&#x2F;">live-pusher</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;live-player&#x2F;">live-player</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            本文主要介绍我们打通 WebRTC 端和微信小程序端的音视频互通方案，实现在尽量不需要改动 WebRTC 端代码的情况下，添加对主叫和被叫微信小程序端的支持。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-04-19-communication-bridge-between-webrtc-and-wechat-rtmp&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-04-12-java-catch-all-and-assertionerror&#x2F;">Java try-catch and AssertionError</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.04.12
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;practise&#x2F;">Practise</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;java&#x2F;">Java</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;try-catch&#x2F;">try-catch</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;assertionerror&#x2F;">AssertionError</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            Java 的异常处理机制是 try-catch-finally 。被调用的方法或代码块可以抛出异常（Throwable，含 Exception 和 Error）；被调用的方法或代码块被包含在 try 块中；catch 块中会根据具体的异常类型来实现相关的逻辑；finally 块中实现无论是否发生异常都需要的逻辑。异常处理机制很简单；但是怎么设计异常处理方式是有一些坑的。有一个线上服务在更新逻辑上线时，触发了一个错误处理异常的 BUG，现简单记录之。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-04-12-java-catch-all-and-assertionerror&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-31-a-bug-introduced-by-optionallong-abuse&#x2F;">一次由于滥用 OptionalLong.orElse 引发的 BUG</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.03.31
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;practise&#x2F;">Practise</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;bug&#x2F;">bug</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;optionallong&#x2F;">OptionalLong</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;optional&#x2F;">Optional</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            JDK 8 引入了 Optional 的概念，以解决 &#96;null&#96; 可能引发的可能的 BUG。新的类型 &#96;java.util.Optional&lt;T&gt;&#96;, &#96;java.util.OptionalDouble&#96;, &#96;java.util.OptionalDouble&#96; 和 &#96;java.util.OptionalDouble&#96; 能够有效避免 &#96;null&#96; 值的使用，强制使用者去处理 &#96;absent &amp; present&#96; 的不同情况。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-31-a-bug-introduced-by-optionallong-abuse&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-12-combine-vertx-and-guice-dependency-injection&#x2F;">在 Vert.x 项目中集成使用 Guice 依赖注入</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.03.31
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;vertx&#x2F;">Vertx</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;vert-x&#x2F;">vert.x</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;guice&#x2F;">guice</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;jsr303&#x2F;">jsr303</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            本文介绍了项目中在基于 Eclipse Vert.x 的 Verticle 中使用 Google Guice 进行依赖注入的实践，主要的思路是在 &#96;io.vertx.core.Verticle#start&#96; 方法中主动创建 &#96;com.google.inject.Injector&#96; 注入器实例并实行注入操作，在注入操作成功结束之后再进行后续的操作。在开发结束后的某一天，通过万能的搜索发现已经有人提供了基于 Google Guice 的 Eclipse Vert.x 扩展: Vert.x Guice Extension。Vert.x Guice Extension 扩展了 Vert.x 内置的 &#96;io.vertx.core.spi.VerticleFactory&#96; 机制，能够使用 SPI 的方式加载需要的 Guice 依赖。本文总结一下自己的实现思路，然后分析 Vert.x Guice Extension 的实现细节，希望能提高自己的代码水平。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-12-combine-vertx-and-guice-dependency-injection&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-21-a-product-env-bug-misused-hashmap-nullability&#x2F;">一次由于误用 HashMap 值的 null 特性的 BUG</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.03.21
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;practise&#x2F;">Practise</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;bug&#x2F;">bug</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;hashmap&#x2F;">HashMap</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;null&#x2F;">null</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;nullability&#x2F;">nullability</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            最近又经历了一次线上服务的 BUG，原因是服务内部的代码逻辑问题，比较简单。在此记录下来是为了提醒不要再犯。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-21-a-product-env-bug-misused-hashmap-nullability&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-12-multiple-jwt-auth-handler-in-vertx&#x2F;">Multiple JWT Auth Handlers in Vert.x</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.03.12
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;vertx&#x2F;">Vertx</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;vert-x&#x2F;">vert.x</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;jwt&#x2F;">jwt</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;auth&#x2F;">auth</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            在实际的项目中，遇到了一个支持多用户提供方的需求：项目的用户是从多个其他项目导入的；项目的逻辑比较简单，不想维护自己的用户信息数据和外部映射。比如，项目需要支持主站用户、视频网站等入口登录访问。正常情况下，只需要项目维护一套内部用户表、一个外部项目表以及内部用户和外部用户的映射表；在用户导入或用户绑定请求时，建立外部项目 ID 和外部项目用户 ID 与内部用户 ID 的对应关系；在登录请求时，根据外部项目 ID 和外部项目用户 ID 调用用户认证回调，通过后再寻找到内部用户的 ID 即可。实际在项目的设计和实现过程中，采用了一个比较好玩的方法：在内部用户表的基础上，对用户使用 JWT 的认证模型；用户登录时，根据外部项目 ID 和外部项目用户 ID 调用用户认证回调，发放 JWT token，在 token 中限定用户的访问权限。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-12-multiple-jwt-auth-handler-in-vertx&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-11-graphviz-note&#x2F;">Graphviz Dot Note</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.03.11
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;notes&#x2F;">Notes</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;graphviz&#x2F;">graphviz</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;dot&#x2F;">dot</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            Graphviz Note 之 设置输出图片的大小。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-11-graphviz-note&#x2F;">More →</a>
        </div>
        </div>
    <div class="post on-list">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-11-a-online-issue-caused-by-dns-unavailability&#x2F;">一次由 DNS 解析服务失效引发的线上 DB 连接打满的事故经历</a>
        </h1>
        
        
        
    <div class="post-meta">
        <span class="post-date">2019.03.11
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;practise&#x2F;">Practise</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;dns&#x2F;">dns</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;mysql&#x2F;">mysql</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;tomcat-dbcp&#x2F;">tomcat dbcp</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;connection-leak&#x2F;">connection leak</a>
        
    
            
        
    </div>

        
        
        
        

        <div class="post-content">
            最近经历了一次由于线上 DNS 解析大范围失效引发的问题排查，并且由于应对不当导致的 MySQL 连接数打满。由于问题发上在周末，网络访问和内部沟通都不方便，整个问题的处理大概花费了 14 个小时（上午 10：00 左右到晚上 03：00）。事故的起因是由于网络 DNS 解析失效，导致服务里面的一段发送 UDP 消息的代码超时，导致接口访问时长增加，导致后续请求在任务队列中排队并超时。排查发现问题之后紧急上线，导致所有服务节点重启之后连接 MySQL 出现域名解析问题，在处理请求的过程中不断创建连接，在域名解析恢复之后把 MySQL 的服务器的连接打满导致部分请求超时。连接打满之后再创建新连接就会失败，触发了一个连接池的 BUG，导致连接池会不断地创建连接，重启也不能解决问题。
            
            </div>
        <div>
            <a class="read-more button" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-11-a-online-issue-caused-by-dns-unavailability&#x2F;">More →</a>
        </div>
        </div>
    
</div>
</div>
            
    <div class="pagination">
        <div class="pagination__buttons">
            
                <span class="button next">
                    <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;page&#x2F;2&#x2F;">
                        <span class="button__text">older</span>
                        <span class="button__icon">→</span>
                    </a>
                </span>
            </div>
    </div>
<footer class="footer">
                    <div class="footer__inner"><div class="copyright copyright--user"><span>© 2019 <a href="https://www.wangbo.im">wangbo&apos; blog</a> :: <a href="https://github.wangbo.im">Github</a> :: Powered by <a href="https://www.getzola.org/">Zola</a></span></div>
    <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;assets&#x2F;js&#x2F;main.js"></script>
</div>
                    

                </footer></div>
    </body>
</html>
