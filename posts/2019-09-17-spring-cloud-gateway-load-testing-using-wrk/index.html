<!DOCTYPE html>
<html lang="en">
    <head>
    <title>Spring Cloud Gateway Load Testing using Wrk - Elvis Wang</title>
    
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="wangboâ€™s home &amp; blog"/>

    <meta property="og:title" content="
    wangboâ€™s blog -&nbsp;Spring Cloud Gateway Load Testing using Wrk" />
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-09-17-spring-cloud-gateway-load-testing-using-wrk&#x2F;"/>
    <meta property="og:description" content="&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;spring.io&#x2F;projects&#x2F;spring-cloud-gateway&quot; title=&quot;Spring Cloud Gateway&quot;&gt;Spring Cloud Gateway&lt;&#x2F;a&gt; æ˜¯ &lt;a href=&quot;httâ€¦"/>
    <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;style.css">
    <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;color&#x2F;red.css">
<link rel="shortcut icon" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;favicon.ico" type="image/x-icon" /></head>
    <body>
        <div class="container full">
<header class="header">
    <div class="header__inner">
        <div class="header__logo">
            <a href="&#x2F;">
    <div class="logo">
        WB Prime
    </div>
</a>
        </div>
        <div class="menu-trigger">menu</div>
    </div>
    
    <nav class="menu">
        <ul class="menu__inner menu__inner--desktop">
            
            
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">About</a>
                    </li>
                
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">Categories</a>
                    </li>
                
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">Tags</a>
                    </li>
                
            </ul>

        <ul class="menu__inner menu__inner--mobile">
            
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">About</a>
        </li>
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">Categories</a>
        </li>
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">Tags</a>
        </li>
        </ul>
    </nav>

    </header>
<div class="content"><div class="post">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-09-17-spring-cloud-gateway-load-testing-using-wrk&#x2F;">Spring Cloud Gateway Load Testing using Wrk</a>
        </h1>
        
    <div class="post-meta">
        <span class="post-date">2019.09.17
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;spring&#x2F;">Spring</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;spring-cloud-gateway&#x2F;">spring-cloud-gateway</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;gateway&#x2F;">gateway</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;testing&#x2F;">testing</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;load-test&#x2F;">load-test</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;wrk&#x2F;">wrk</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;wrk2&#x2F;">wrk2</a>
        
    
            
        
    </div>



        

        <div class="post-content">
            <p><a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Cloud Gateway</a> æ˜¯ <a href="https://spring.io/" title="Spring">Spring</a> å®˜æ–¹ä¸ºäº†å®Œå–„ <a href="https://spring.io/projects/spring-cloud" title="Spring Cloud">Spring Cloud</a> çš„ç‰ˆå›¾
è€Œæ¨å‡ºçš„ç½‘å…³æœåŠ¡ç»„ä»¶ï¼Œä½¿ç”¨äº†éé˜»å¡å¼ç½‘ç»œæ¨¡å¼å’Œç›®å‰æµè¡Œçš„å“åº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œå¸å¼•äº†å¾ˆå¤šå…¬å¸å’Œå¼€å‘è€…çš„æ³¨æ„
åŠ›ã€‚</p>
<p>ç½‘ç»œä¸Šæœ‰ä¸€äº›ç°æˆçš„å¯¹ <a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Cloud Gateway</a> çš„æ€§èƒ½æµ‹è¯•çš„æ¡ˆä¾‹ï¼Œæ¯”å¦‚ <a href="https://www.jianshu.com/p/a19e24a6a747">çº é”™å¸–ï¼šZuul &amp; Spring Cloud Gateway &amp; Linkerdæ€§èƒ½å¯¹æ¯”</a>ã€‚æ ¹æ® <a href="https://github.com/spencergibb/spring-cloud-gateway-bench">Simple benchmark comparing zuul and spring cloud gateway </a> çš„æ•°æ®ï¼Œ<a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Cloud Gateway</a> çš„æ€§èƒ½æµ‹è¯•ç»“æœå‚è€ƒå¦‚ä¸‹ï¼š</p>
<table><thead><tr><th> Proxy    </th><th> Avg Latency </th><th> Avg Req/Sec/Thread </th></tr></thead><tbody>
<tr><td> gateway  </td><td> 6.61ms      </td><td> 3.24k              </td></tr>
<tr><td> linkered </td><td> 7.62ms      </td><td> 2.82k              </td></tr>
<tr><td> zuul     </td><td> 12.56ms     </td><td> 2.09k              </td></tr>
<tr><td> none     </td><td> 2.09ms      </td><td> 11.77k             </td></tr>
</tbody></table>
<p>ä½†æ˜¯ï¼Œç”±äºï¼š</p>
<ol>
<li>ä¸Šè¿°æµ‹è¯•åªæ˜¯ç®€å•çš„å¯¹åç«¯åå‘ä»£ç†æµ‹è¯•ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ <a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Cloud Gateway</a> å¯¹äºè·¯ç”±çš„åŒ¹é…æ˜¯é¡ºåºçš„ï¼ŒåŒ¹é…é“¾åé¢çš„è·¯ç”±çš„æ€§èƒ½å¹¶æ²¡æœ‰è¢«å…³æ³¨åˆ°ã€‚</li>
<li>æµ‹è¯•æ•°æ®è¢«è¿›è¡Œäº†ç®€åŒ–ï¼Œæµ‹è¯•çš„ç»†èŠ‚è¢«ï¼ˆæœ‰æ„åœ°ï¼‰å¿½ç•¥äº†ã€‚</li>
</ol>
<p>æ‰€ä»¥ï¼Œåœ¨æ ¹æ® <a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Cloud Gateway</a> æ”¹é€ å‡ºäº†åˆç‰ˆçš„å…¬å¸ç½‘å…³ç³»ç»Ÿä¹‹åï¼Œæˆ‘ä½¿ç”¨ <a href="https://github.com/wg/wrk" title="Modern HTTP benchmarking tool">wrk</a> å’Œ <a href="https://github.com/giltene/wrk2" title="A constant throughput, correct latency recording variant of wrk">wrk2</a> å¯¹ç½‘å…³è¿›è¡Œäº†å¤šè½®çš„å‹æµ‹ï¼Œæµ‹è¯•ç»“æœæ±‡æ€»ä¸ºæœ¬æ–‡ã€‚</p>
<p><a name="continue-reading"></a></p>
<h1 id="overview"><a class="zola-anchor" href="#overview" aria-label="Anchor link for: overview">ğŸ”—</a>
Overview</h1>
<p>ä¸ºæµ‹è¯•é€‰æ‹© 3 ä¸ªå¯¹ç…§ç»„ï¼š</p>
<ul>
<li>
<p><code>direct</code> ç»„ï¼Œç›´æ¥è®¿é—®åç«¯æœåŠ¡ã€‚</p>
</li>
<li>
<p><code>api0</code> ç»„ï¼Œé€šè¿‡ç½‘å…³è®¿é—®åç«¯æœåŠ¡ï¼Œè·¯ç”±åœ¨åŒ¹é…é“¾çš„ç¬¬ 1 ä¸ªè¢«åŒ¹é…åˆ°ã€‚</p>
</li>
<li>
<p><code>api800</code> ç»„ï¼Œç›´æ¥è®¿é—®åç«¯æœåŠ¡ï¼Œè·¯ç”±åœ¨åŒ¹é…é“¾çš„ç¬¬ 800 ä¸ªè¢«åŒ¹é…åˆ°ã€‚</p>
</li>
</ul>
<ol>
<li>Round0: ä½¿ç”¨ <a href="https://github.com/wg/wrk" title="Modern HTTP benchmarking tool">wrk</a> é’ˆå¯¹å¤šä¸ªä¸åŒçš„å¹¶å‘åº¦ï¼ˆ<code>-c</code> é€‰é¡¹ï¼‰è¿›è¡Œå‹æµ‹ï¼Œæ‰¾åˆ°èƒ½æ­£ç¡®è¿”å›çš„æœ€å¤§å¹¶å‘åº¦å’Œå…¶
æ—¶çš„ QPSã€‚</li>
<li>Round1: ä½¿ç”¨ <a href="https://github.com/giltene/wrk2" title="A constant throughput, correct latency recording variant of wrk">wrk2</a> é’ˆå¯¹ä¸Šä¸€æ­¥å¾—åˆ°çš„å¹¶å‘åº¦ï¼ŒæŒ‰ä¸€å®šæ­¥é•¿ä½¿ç”¨å¤šä¸ªè´Ÿè½½ï¼ˆ<code>-R</code> é€‰é¡¹ï¼‰æµ‹è¯•å¾—åˆ°è¯·æ±‚
å»¶æ—¶ï¼Œä¸ºäº†å¿«é€Ÿå®šä½åˆ°åˆé€‚çš„è´Ÿè½½ï¼Œè®¾ç½®æ­¥é•¿ä¸º 5000ã€‚</li>
<li>Round2: åŒ Round1ï¼Œä½†æ­¤æ—¶åªå¯¹ <code>api800</code> ç»„åšæµ‹è¯•ä¸”å¯ä»¥æ ¹æ® Round1 çš„ç»“æœé€‰æ‹©è¾ƒå°çš„æ­¥é•¿ 200ã€‚</li>
<li>Round3: åŒ Round1ï¼Œä½†æ­¤æ—¶åªå¯¹ <code>api0</code> ç»„åšæµ‹è¯•ä¸”å¯ä»¥æ ¹æ® Round1 çš„ç»“æœé€‰æ‹©è¾ƒå°çš„æ­¥é•¿ 200ã€‚</li>
<li>Round4: æ ¹æ® Round1 å¾—åˆ°çš„å¹¶å‘åº¦å’Œ Round3 å¾—åˆ°çš„ QPSï¼Œå¯¹ <code>api0</code> ç»„é‡å¤åš 3 ç»„æµ‹è¯•ã€‚</li>
<li>Round5: æ ¹æ® Round1 å¾—åˆ°çš„å¹¶å‘åº¦å’Œ Round2 å¾—åˆ°çš„ QPSï¼Œå¯¹ <code>api800</code> ç»„é‡å¤åš 3 ç»„æµ‹è¯•ã€‚</li>
</ol>
<p>æµ‹è¯•ä½¿ç”¨çš„åç«¯æœåŠ¡æ˜¯ä¸€ä¸ªåŸºäº <a href="https://vertx.io/docs/vertx-web/java/">Vert.x Web</a> çš„éå¸¸ç®€å•çš„ HTTP æœåŠ¡ï¼Œéƒ¨ç½²äºå…¬å¸çš„ç§æœ‰äº‘å¹³å°ä¸Šï¼Œé…ç½®ä¸º 4æ ¸ 4G å†…å­˜ï¼Œè®¿é—®ç«¯å£ä¸º 10.144.69.53:8080ï¼›ç½‘å…³æœåŠ¡å™¨åŸºäº <a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Cloud Gateway</a> Greenwich.SR2 ç‰ˆæœ¬ï¼Œ<a href="https://spring.io/projects/spring-boot" title="Spring Boot">Spring Boot</a> çš„ç‰ˆæœ¬ä¸º 2.1.6.RELEASEï¼ŒåŒæ ·éƒ¨ç½²äºå…¬å¸çš„ç§æœ‰äº‘å¹³å°ï¼Œé…ç½®ä¸º 8æ ¸ 5G å†…å­˜ï¼Œè®¿é—®ç«¯å£ä¸º 10.145.67.20:8080ï¼›å‹æµ‹çš„å®¢æˆ·ç«¯ç¨‹åºè¿è¡Œäºä¸€å°ç‰©ç†æœºæœåŠ¡å™¨ä¸Šï¼Œé…ç½®ä¸º 32æ ¸ 62G å†…å­˜ã€‚</p>
<h1 id="round0"><a class="zola-anchor" href="#round0" aria-label="Anchor link for: round0">ğŸ”—</a>
Round0</h1>
<p>ä½¿ç”¨ <a href="https://github.com/wg/wrk" title="Modern HTTP benchmarking tool">wrk</a> è®¾ç½®é€‰é¡¹ <code>-c</code> å€¼åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>100</li>
<li>300</li>
<li>500</li>
<li>700</li>
<li>900</li>
<li>1100</li>
<li>1300</li>
<li>1500</li>
<li>1700</li>
<li>1900</li>
<li>2100</li>
<li>2300</li>
<li>2500</li>
<li>2700</li>
<li>2900</li>
</ul>
<p>å¯¹æ‰€æœ‰ç»„è¿›è¡Œå‹æµ‹ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1;">wrk -t 16 -d 60s --latency -c ${each_c} ${endpoint}
</span></pre>
<p>å¾—åˆ°ç»“è®ºï¼š</p>
<ul>
<li><code>direct</code> ç»„æœ€å¤šèƒ½åˆ° 500 å¹¶å‘è¿æ¥</li>
<li><code>api0</code> ç»„æœ€å¤šèƒ½åˆ° 300 å¹¶å‘è¿æ¥</li>
<li><code>api800</code> ç»„æœ€å¤šèƒ½åˆ° 100 å¹¶å‘è¿æ¥</li>
</ul>
<p>æµ‹è¯•è„šæœ¬åŠæ•°æ®<a href="https://www.wangbo.im/posts/2019-09-17-spring-cloud-gateway-load-testing-using-wrk/#download">å¯ä¾›ä¸‹è½½</a>ã€‚</p>
<h1 id="round1"><a class="zola-anchor" href="#round1" aria-label="Anchor link for: round1">ğŸ”—</a>
Round1</h1>
<p>ä½¿ç”¨ <a href="https://github.com/giltene/wrk2" title="A constant throughput, correct latency recording variant of wrk">wrk2</a> è®¾ç½®é€‰é¡¹ <code>-c</code> å€¼åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>100</li>
<li>200</li>
<li>300</li>
</ul>
<p>è®¾ç½®é€‰é¡¹ <code>-R</code> å€¼åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>100</li>
<li>1000</li>
<li>5000</li>
<li>10000</li>
<li>15000</li>
<li>20000</li>
<li>25000</li>
<li>30000</li>
</ul>
<p>å¯¹æ‰€æœ‰ç»„è¿›è¡Œå‹æµ‹ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1;">wrk -t 16 -d 60s --latency -c ${each_c} -R ${each_r} ${endpoint}
</span></pre>
<p>å¾—åˆ°ç»“è®ºï¼š</p>
<ul>
<li><code>direct</code> ç»„æœ€å¤šèƒ½åˆ° 30000 ä»¥ä¸Šçš„ QPS</li>
<li><code>api0</code> ç»„æœ€å¤šèƒ½åˆ° 10000 ä»¥ä¸Š 15000 ä»¥ä¸‹çš„ QPS</li>
<li><code>api800</code> ç»„æœ€å¤šèƒ½åˆ° 1000 ä»¥ä¸Š 5000 ä»¥ä¸‹çš„ QPS</li>
</ul>
<h1 id="round2"><a class="zola-anchor" href="#round2" aria-label="Anchor link for: round2">ğŸ”—</a>
Round2</h1>
<p>ä½¿ç”¨ <a href="https://github.com/giltene/wrk2" title="A constant throughput, correct latency recording variant of wrk">wrk2</a> è®¾ç½®é€‰é¡¹ <code>-c</code> å€¼åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>100</li>
<li>200</li>
<li>300</li>
</ul>
<p>è®¾ç½®é€‰é¡¹ <code>-R</code> å€¼åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>1000</li>
<li>1200</li>
<li>1400</li>
<li>1600</li>
<li>1800</li>
<li>2000</li>
<li>2200</li>
<li>2400</li>
<li>2600</li>
</ul>
<p>å¯¹ <code>api800</code> ç»„è¿›è¡Œå‹æµ‹ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1;">wrk -t 16 -d 60s --latency -c ${each_c} -R ${each_r} ${endpoint}
</span></pre>
<p>å¾—åˆ°ç»“è®ºï¼š</p>
<ul>
<li><code>api800</code> ç»„æœ€å¤šèƒ½åˆ° 2000 ä»¥ä¸Š 2200 ä»¥ä¸‹çš„ QPS</li>
</ul>
<h1 id="round3"><a class="zola-anchor" href="#round3" aria-label="Anchor link for: round3">ğŸ”—</a>
Round3</h1>
<p>ä½¿ç”¨ <a href="https://github.com/giltene/wrk2" title="A constant throughput, correct latency recording variant of wrk">wrk2</a> è®¾ç½®é€‰é¡¹ <code>-c</code> å€¼åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>100</li>
<li>200</li>
<li>300</li>
</ul>
<p>è®¾ç½®é€‰é¡¹ <code>-R</code> å€¼åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>10000</li>
<li>10200</li>
<li>10400</li>
<li>10600</li>
<li>10800</li>
<li>11000</li>
<li>11200</li>
<li>11400</li>
<li>11600</li>
<li>11800</li>
<li>12000</li>
<li>12200</li>
<li>12400</li>
<li>12600</li>
<li>12800</li>
<li>13000</li>
</ul>
<p>å¯¹ <code>api0</code> ç»„è¿›è¡Œå‹æµ‹ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1;">wrk -t 16 -d 60s --latency -c ${each_c} -R ${each_r} ${endpoint}
</span></pre>
<p>å¾—åˆ°ç»“è®ºï¼š</p>
<ul>
<li><code>api0</code> ç»„æœ€å¤šèƒ½åˆ° 11000 ä»¥ä¸Š 11200 ä»¥ä¸‹çš„ QPS</li>
</ul>
<h1 id="round4"><a class="zola-anchor" href="#round4" aria-label="Anchor link for: round4">ğŸ”—</a>
Round4</h1>
<p>ä½¿ç”¨ <a href="https://github.com/giltene/wrk2" title="A constant throughput, correct latency recording variant of wrk">wrk2</a> è®¾ç½®é€‰é¡¹ <code>-R</code> å€¼åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>10900</li>
<li>11000</li>
<li>11100</li>
</ul>
<p>å¯¹ <code>api0</code> ç»„è¿›è¡Œé‡å¤çš„ 3 æ¬¡å‹æµ‹ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1;">wrk -t 16 -d 60s --latency -c 300 -R ${each_r} ${endpoint}
</span></pre>
<p>å¾—åˆ°è¯·æ±‚å»¶æ—¶ç»“æœå¦‚ä¸‹ï¼š</p>
<table><thead><tr><th> KEY       </th><th> QPS      </th><th> TP90    </th><th> TP99     </th><th> TP999    </th><th> MEAN    </th><th> STDEV   </th></tr></thead><tbody>
<tr><td> 10900.r_0 </td><td> 10878.76 </td><td> 35.29ms </td><td> 83.65ms  </td><td> 232.57ms </td><td> 14.79ms </td><td> 20.57ms </td></tr>
<tr><td> 10900.r_1 </td><td> 10894.40 </td><td> 37.98ms </td><td> 95.04ms  </td><td> 300.80ms </td><td> 16.62ms </td><td> 23.66ms </td></tr>
<tr><td> 10900.r_2 </td><td> 10893.97 </td><td> 37.92ms </td><td> 86.27ms  </td><td> 253.44ms </td><td> 16.47ms </td><td> 21.83ms </td></tr>
<tr><td> 11000.r_0 </td><td> 10992.26 </td><td> 38.46ms </td><td> 68.22ms  </td><td> 108.86ms </td><td> 16.37ms </td><td> 16.47ms </td></tr>
<tr><td> 11000.r_1 </td><td> 10988.97 </td><td> 39.39ms </td><td> 66.37ms  </td><td> 94.53ms  </td><td> 16.95ms </td><td> 16.33ms </td></tr>
<tr><td> 11000.r_2 </td><td> 10988.14 </td><td> 40.00ms </td><td> 73.54ms  </td><td> 140.93ms </td><td> 17.48ms </td><td> 18.04ms </td></tr>
<tr><td> 11100.r_0 </td><td> 11081.16 </td><td> 46.46ms </td><td> 121.47ms </td><td> 395.52ms </td><td> 22.75ms </td><td> 30.49ms </td></tr>
<tr><td> 11100.r_1 </td><td> 11089.59 </td><td> 48.74ms </td><td> 115.14ms </td><td> 349.70ms </td><td> 23.86ms </td><td> 28.25ms </td></tr>
<tr><td> 11100.r_2 </td><td> 11090.92 </td><td> 52.26ms </td><td> 245.50ms </td><td> 811.52ms </td><td> 28.82ms </td><td> 55.56ms </td></tr>
</tbody></table>
<h1 id="round5"><a class="zola-anchor" href="#round5" aria-label="Anchor link for: round5">ğŸ”—</a>
Round5</h1>
<p>ä½¿ç”¨ <a href="https://github.com/giltene/wrk2" title="A constant throughput, correct latency recording variant of wrk">wrk2</a> è®¾ç½®é€‰é¡¹ <code>-R</code> å€¼åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>1900</li>
<li>2000</li>
<li>2100</li>
</ul>
<p>å¯¹ <code>api800</code> ç»„è¿›è¡Œé‡å¤çš„ 3 æ¬¡å‹æµ‹ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1;">wrk -t 16 -d 60s --latency -c 300 -R ${each_r} ${endpoint}
</span></pre>
<p>å¾—åˆ°è¯·æ±‚å»¶æ—¶ç»“æœå¦‚ä¸‹ï¼š</p>
<table><thead><tr><th> KEY      </th><th> QPS     </th><th> TP90    </th><th> TP99    </th><th> TP999    </th><th> MEAN     </th><th> STDEV    </th></tr></thead><tbody>
<tr><td> 1900.r_0 </td><td> 1898.16 </td><td> 40.00ms </td><td> 68.61ms </td><td> 90.05ms  </td><td> 14.36ms  </td><td> 16.23ms  </td></tr>
<tr><td> 1900.r_1 </td><td> 1899.93 </td><td> 39.55ms </td><td> 69.50ms </td><td> 98.50ms  </td><td> 14.60ms  </td><td> 15.97ms  </td></tr>
<tr><td> 1900.r_2 </td><td> 1899.61 </td><td> 42.33ms </td><td> 77.69ms </td><td> 106.37ms </td><td> 15.94ms  </td><td> 17.42ms  </td></tr>
<tr><td> 2000.r_0 </td><td> 1999.98 </td><td> 43.46ms </td><td> 70.08ms </td><td> 91.97ms  </td><td> 15.92ms  </td><td> 17.25ms  </td></tr>
<tr><td> 2000.r_1 </td><td> 2000.46 </td><td> 52.58ms </td><td> 93.69ms </td><td> 174.21ms </td><td> 20.32ms  </td><td> 22.93ms  </td></tr>
<tr><td> 2000.r_2 </td><td> 1999.99 </td><td> 50.08ms </td><td> 83.20ms </td><td> 113.92ms </td><td> 18.90ms  </td><td> 20.27ms  </td></tr>
<tr><td> 2100.r_0 </td><td> 2059.21 </td><td> 1.79s   </td><td> 5.75s   </td><td> 7.88s    </td><td> 716.84ms </td><td> 1.09s    </td></tr>
<tr><td> 2100.r_1 </td><td> 2068.65 </td><td> 1.34s   </td><td> 4.48s   </td><td> 6.99s    </td><td> 535.81ms </td><td> 829.71ms </td></tr>
<tr><td> 2100.r_2 </td><td> 2060.51 </td><td> 1.49s   </td><td> 4.81s   </td><td> 7.57s    </td><td> 602.15ms </td><td> 925.10ms </td></tr>
</tbody></table>
<h1 id="round-x"><a class="zola-anchor" href="#round-x" aria-label="Anchor link for: round-x">ğŸ”—</a>
Round X</h1>
<p>ä½œä¸ºå¯¹ç…§ï¼Œä½¿ç”¨ <a href="https://github.com/giltene/wrk2" title="A constant throughput, correct latency recording variant of wrk">wrk2</a> è®¾ç½®é€‰é¡¹ <code>-R</code> å€¼åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>100</li>
<li>1000</li>
<li>10000</li>
</ul>
<p>å¯¹æ‰€æœ‰ç»„è¿›è¡Œå‹æµ‹ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1;">wrk -t 16 -d 60s --latency -c 100 -R ${each_r} ${endpoint}
</span></pre><table><thead><tr><th> KEY          </th><th> QPS     </th><th> TP90    </th><th> TP99    </th><th> TP999   </th><th> MEAN   </th><th> STDEV    </th></tr></thead><tbody>
<tr><td> 100.direct   </td><td> 100.64  </td><td> 1.54ms  </td><td> 1.91ms  </td><td> 2.17ms  </td><td> 0.97ms </td><td> 410.39us </td></tr>
<tr><td> 100.api0     </td><td> 100.74  </td><td> 2.32ms  </td><td> 31.85ms </td><td> 51.97ms </td><td> 2.20ms </td><td> 4.35ms   </td></tr>
<tr><td> 100.api800   </td><td> 100.74  </td><td> 18.48ms </td><td> 34.88ms </td><td> 42.24ms </td><td> 7.77ms </td><td> 6.99ms   </td></tr>
<tr><td> 1000.direct  </td><td> 1000.23 </td><td> 1.49ms  </td><td> 1.95ms  </td><td> 2.20ms  </td><td> 0.86ms </td><td> 458.60us </td></tr>
<tr><td> 1000.api0    </td><td> 1000.23 </td><td> 2.33ms  </td><td> 3.02ms  </td><td> 21.26ms </td><td> 1.81ms </td><td> 1.19ms   </td></tr>
<tr><td> 1000.api800  </td><td> 998.72  </td><td> 13.99ms </td><td> 34.24ms </td><td> 43.33ms </td><td> 7.13ms </td><td> 6.39ms   </td></tr>
<tr><td> 10000.direct </td><td> 9998.38 </td><td> 1.50ms  </td><td> 2.06ms  </td><td> 6.43ms  </td><td> 0.96ms </td><td> 682.08us </td></tr>
<tr><td> 10000.api0   </td><td> 9998.22 </td><td> 2.76ms  </td><td> 22.40ms </td><td> 45.50ms </td><td> 2.57ms </td><td> 3.94ms   </td></tr>
<tr><td> 10000.api800 </td><td> 2040.38 </td><td> 43.78s  </td><td> 47.38s  </td><td> 48.23s  </td><td> 27.86s </td><td> 11.48s   </td></tr>
</tbody></table>
<h1 id="conclusion"><a class="zola-anchor" href="#conclusion" aria-label="Anchor link for: conclusion">ğŸ”—</a>
Conclusion</h1>
<p><a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Cloud Gateway</a> åœ¨åŒ¹é…åˆ°å‰å‡ ä½çš„è·¯ç”±æ—¶æ€§èƒ½è¿˜å¯ä»¥æ¥å—ï¼Œå½“éœ€è¦ç»è¿‡è¾ƒå¤šæ¬¡çš„è·¯ç”±åŒ¹é…æ—¶ï¼Œæ€§èƒ½ä¸‹é™æ˜æ˜¾ã€‚</p>
<p>å¯èƒ½çš„ä¼˜åŒ–ç‚¹åº”è¯¥æ˜¯é’ˆå¯¹ä¸åŒçš„åŒ¹é…ç±»å‹ä½¿ç”¨å‰ç¼€æ ‘ç­‰æ¥æé«˜åŒ¹é…é€Ÿåº¦ï¼Œè€Œä¸èƒ½ä½¿ç”¨é“¾å¼çš„åŒ¹é…æ¨¡å‹ã€‚</p>
<h1 id="download"><a class="zola-anchor" href="#download" aria-label="Anchor link for: download">ğŸ”—</a>
Download</h1>
<p>æ‰€æœ‰çš„æµ‹è¯•ç›¸å…³çš„è„šæœ¬å’Œæ•°æ®å¯ä¾›ä¸‹è½½ã€‚</p>
<ul>
<li><a href="https://www.wangbo.im/posts/2019-09-17-spring-cloud-gateway-load-testing-using-wrk/round0.tar.xz">Round 0</a></li>
<li><a href="https://www.wangbo.im/posts/2019-09-17-spring-cloud-gateway-load-testing-using-wrk/round1.tar.xz">Round 1</a></li>
<li><a href="https://www.wangbo.im/posts/2019-09-17-spring-cloud-gateway-load-testing-using-wrk/round2.tar.xz">Round 2</a></li>
<li><a href="https://www.wangbo.im/posts/2019-09-17-spring-cloud-gateway-load-testing-using-wrk/round3.tar.xz">Round 3</a></li>
<li><a href="https://www.wangbo.im/posts/2019-09-17-spring-cloud-gateway-load-testing-using-wrk/round4.tar.xz">Round 4</a></li>
<li><a href="https://www.wangbo.im/posts/2019-09-17-spring-cloud-gateway-load-testing-using-wrk/round5.tar.xz">Round 5</a></li>
<li><a href="https://www.wangbo.im/posts/2019-09-17-spring-cloud-gateway-load-testing-using-wrk/round6.tar.xz">Round X</a></li>
</ul>
<hr />
<p>ä»¥ä¸Šã€‚</p>

        </div>
        
    
</div></div>
            
    <div class="pagination">
        <div class="pagination__buttons">
            </div>
    </div>
<footer class="footer">
                    <div class="footer__inner"><div class="copyright copyright--user"><span>Â© 2019 <a href="https://www.wangbo.im">wangbo&apos; blog</a> :: <a href="https://github.wangbo.im">Github</a> :: Powered by <a href="https://www.getzola.org/">Zola</a></span></div>
    <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;assets&#x2F;js&#x2F;main.js"></script>
</div>
                    

                </footer></div>
    </body>
</html>
