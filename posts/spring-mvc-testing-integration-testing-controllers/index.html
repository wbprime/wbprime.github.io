<!DOCTYPE html>
<html lang="en">
    <head>
    <title>Spring MVC Integration Testing - Controllers - Elvis Wang</title>
    
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="wangbo’s home &amp; blog"/>

    <meta property="og:title" content="
    wangbo’s home &amp; blog -&nbsp;Spring MVC Integration Testing - Controllers" />
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-integration-testing-controllers&#x2F;"/>
    <meta property="og:description" content="&lt;p&gt;本文是&lt;a href=&quot;https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-content&#x2F;&quot;&gt;Spring MVC Testing&lt;&#x2F;a&gt; 集成测试系列的第2篇，原文链接：&lt;a href=&quot;http:&#x2F;&#x…"/>
    <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;style.css">
    <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;color&#x2F;blue.css">
<link rel="shortcut icon" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;favicon.ico" type="image/x-icon" /></head>
    <body>
        <div class="container full">
<header class="header">
    <div class="header__inner">
        <div class="header__logo">
            <a href="&#x2F;">
    <div class="logo">
        WB Prime
    </div>
</a>
        </div>
        <div class="menu-trigger">menu</div>
    </div>
    
    <nav class="menu">
        <ul class="menu__inner menu__inner--desktop">
            
            
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">About</a>
                    </li>
                
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">Categories</a>
                    </li>
                
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">Tags</a>
                    </li>
                
            </ul>

        <ul class="menu__inner menu__inner--mobile">
            
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">About</a>
        </li>
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">Categories</a>
        </li>
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">Tags</a>
        </li>
        </ul>
    </nav>

    </header>
<div class="content"><div class="post">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-integration-testing-controllers&#x2F;">Spring MVC Integration Testing - Controllers</a>
        </h1>
        
    <div class="post-meta">
        <span class="post-date">2016.04.09
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;spring-mvc-testing&#x2F;">Spring MVC Testing</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;spring-mvc&#x2F;">Spring MVC</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;testing&#x2F;">testing</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;java&#x2F;">java</a>
        
    
            
        
    </div>



        

        <div class="post-content">
            <p>本文是<a href="https://www.wangbo.im/posts/spring-mvc-testing-content/">Spring MVC Testing</a> 集成测试系列的第2篇，原文链接：<a href="http://www.petrikainulainen.net/programming/spring-framework/integration-testing-of-spring-mvc-applications-controllers/">Integration Testing of Spring MVC Applications: Controllers</a>。</p>
<p>本文主要介绍如何为“标准”Controller编写集成测试。在这里“标准”的含义延续前一个序列 <a href="https://www.wangbo.im/posts/spring-mvc-testing-content/">Spring MVC Testing</a> 中的含义，表示不使用Ajax的请求或者处理Form结果的请求。</p>
<p>同样地，本文还是一步一步地为我们的TodoApplication编写集成测试。该程序提供Todo项的增删改查（CRUD）接口，本文主要关注其中的3个接口：获取Todo项列表；查看单个Todo项的详情；以及删除某个Todo项。</p>
<p><a name="continue-reading"></a></p>
<h1 id="tong-guo-mavenhuo-qu-yi-lai"><a class="zola-anchor" href="#tong-guo-mavenhuo-qu-yi-lai" aria-label="Anchor link for: tong-guo-mavenhuo-qu-yi-lai">🔗</a>
通过Maven获取依赖</h1>
<p>本文用到的依赖如下：</p>
<ul>
<li>Hamcrest 1.3</li>
<li>JUnit 4.10</li>
<li>Spring Test 3.2.3.RELEASE</li>
<li>Spring Test DBUnit 1.0.0</li>
<li>DBUnit 2.4.8</li>
</ul>
<p>生成的pom.xml文件的片段如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#808080;">&lt;</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">org.hamcrest</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">hamcrest-all</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">1.3</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">test</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;
</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">junit</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">junit</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">4.10</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">test</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">exclusions</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">        </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">exclusion</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">            </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">hamcrest-core</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">            </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">org.hamcrest</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">        </span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">exclusion</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">exclusions</span><span style="color:#808080;">&gt;
</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">org.springframework</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">spring-test</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">3.1.2.RELEASE</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">test</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;
</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">org.springframework</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">spring-test</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">3.2.3.RELEASE</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">test</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;
</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">com.github.springtestdbunit</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">spring-test-dbunit</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">1.0.0</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">test</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;
</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">org.dbunit</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">dbunit</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">2.4.8</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">test</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;            
</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span></pre><h1 id="spring-test-dbunit-kuai-su-ru-men"><a class="zola-anchor" href="#spring-test-dbunit-kuai-su-ru-men" aria-label="Anchor link for: spring-test-dbunit-kuai-su-ru-men">🔗</a>
Spring Test DBUnit 快速入门</h1>
<p>我们在集成测试中使用了 <a href="http://springtestdbunit.github.com/spring-test-dbunit/">Spring Test DBUnit</a> 库和 <a href="http://www.dbunit.org/">DBUnit</a> 库。我们快速地熟悉一下如何使用它们。</p>
<h2 id="pei-zhi"><a class="zola-anchor" href="#pei-zhi" aria-label="Anchor link for: pei-zhi">🔗</a>
配置</h2>
<h3 id="chuang-jian-springshang-xia-wen-pei-zhi"><a class="zola-anchor" href="#chuang-jian-springshang-xia-wen-pei-zhi" aria-label="Anchor link for: chuang-jian-springshang-xia-wen-pei-zhi">🔗</a>
创建Spring上下文配置</h3>
<p>首先需要创建Spring上下文配置，让Spring来管理依赖。</p>
<ol>
<li>创建一个Java类，并用<code>@Configuration</code>注解</li>
<li>新建<code>application.properties</code>属性文件，并使用<code>@PropertySource</code>注解导入类配置上下文中</li>
<li>添加一个<code>Environment</code>类型的成员用于获取属性文件中的配置信息</li>
<li>使用<code>@Bean</code>注解创建一个<code>DataSource</code>类型的Bean</li>
</ol>
<p>最终的结果如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.jolbox.bonecp.BoneCPDataSource;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.context.annotation.Bean;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.context.annotation.Configuration;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.context.annotation.PropertySource;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.core.env.Environment;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">javax.annotation.Resource;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">javax.sql.DataSource;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">@Configuration
</span><span style="color:#dcdcdc;">@PropertySource(</span><span style="color:#d69d85;">&quot;classpath:application.properties&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">ExampleApplicationContext {
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Resource
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">Environment environment;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Bean
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public </span><span style="color:#dcdcdc;">DataSource dataSource() {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">BoneCPDataSource dataSource = </span><span style="color:#569cd6;">new </span><span style="color:#dcdcdc;">BoneCPDataSource();
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">dataSource.setDriverClass(environment.getRequiredProperty(</span><span style="color:#d69d85;">&quot;db.driver&quot;</span><span style="color:#dcdcdc;">));
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">dataSource.setJdbcUrl(environment.getRequiredProperty(</span><span style="color:#d69d85;">&quot;db.url&quot;</span><span style="color:#dcdcdc;">));
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">dataSource.setUsername(environment.getRequiredProperty(</span><span style="color:#d69d85;">&quot;db.username&quot;</span><span style="color:#dcdcdc;">));
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">dataSource.setPassword(environment.getRequiredProperty(</span><span style="color:#d69d85;">&quot;db.password&quot;</span><span style="color:#dcdcdc;">));
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">return</span><span style="color:#dcdcdc;"> dataSource;
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre><h3 id="pei-zhi-ce-shi-yong-li-lei"><a class="zola-anchor" href="#pei-zhi-ce-shi-yong-li-lei" aria-label="Anchor link for: pei-zhi-ce-shi-yong-li-lei">🔗</a>
配置测试用例类</h3>
<p>我们可以通过如下步骤在测试用例类中使用DBUnit：</p>
<ol>
<li>对测试用例类使用<code>@RunWith(SpringJUnit4ClassRunner.class)</code>注解</li>
<li>对测试用例类使用<code>@ContextConfiguratiON</code>注解并引入上一步创建的<code>ExampleApplicationContext</code>类作为Spring配置上下文</li>
<li>对测试用例类使用<code>@TestExecutionListeners</code>注解并使用<code>DbUnitTestExecutionListener</code>来处理DBUnit的相关注解</li>
</ol>
<p>最终代码如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.DbUnitTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.runner.RunWith;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.ContextConfiguration;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.TestExecutionListeners;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DependencyInjectionTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DirtiesContextTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.transaction.TransactionalTestExecutionListener;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">javax.annotation.Resource;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">@RunWith(SpringJUnit4ClassRunner.class)
</span><span style="color:#dcdcdc;">@ContextConfiguration(classes = {ExampleApplicationContext.class})
</span><span style="color:#dcdcdc;">@TestExecutionListeners({ DependencyInjectionTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DirtiesContextTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">TransactionalTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DbUnitTestExecutionListener.class })
</span><span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">Test {
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Add test methods here
</span><span style="color:#dcdcdc;">}
</span></pre><h2 id="shi-yong"><a class="zola-anchor" href="#shi-yong" aria-label="Anchor link for: shi-yong">🔗</a>
使用</h2>
<p>使用DBUnit，我们可以用注解来初始化数据库、初始化数据表以及在测试结束后验证数据库的状态。详细使用请参见 <a href="http://springtestdbunit.github.com/spring-test-dbunit/">Spring Test DBUnit</a>。本文将会使用如下两个注解：</p>
<ul>
<li>@DatabaseSetup 用于在测试开始之前将数据库初始化到指定状态</li>
<li>@ExpectedDatabase 用于在测试结束之后验证数据库状态</li>
</ul>
<h1 id="spring-mvc-test-kuai-su-ru-men"><a class="zola-anchor" href="#spring-mvc-test-kuai-su-ru-men" aria-label="Anchor link for: spring-mvc-test-kuai-su-ru-men">🔗</a>
Spring MVC Test 快速入门</h1>
<h2 id="chuang-jian-bing-zhi-xing-qing-qiu"><a class="zola-anchor" href="#chuang-jian-bing-zhi-xing-qing-qiu" aria-label="Anchor link for: chuang-jian-bing-zhi-xing-qing-qiu">🔗</a>
创建并执行请求</h2>
<p><code>MockMvc</code>类的<code>perform(RequestBuilder requestBuilder)</code>方法可以用来模拟执行HTTP请求。<code>MockMvcRequestBuilders</code>类提供了几个静态方法用来模拟HTTP请求实体，具体是：</p>
<ul>
<li><code>get()</code> 用于创建一个模拟的HTTP GET请求实体</li>
<li><code>delete()</code> 用于创建一个模拟的HTTP DELETE请求实体</li>
<li><code>fileUpload()</code> 用于创建一个模拟的HTTP文件上传请求实体（multipart request）</li>
<li><code>post()</code> 用于创建一个模拟的HTTP POST请求实体</li>
<li><code>put()</code> 用于创建一个模拟的HTTP PUT请求实体</li>
</ul>
<p>详情可以查看<code>MockHttpServletRequestBuilder</code>类的说明文档。</p>
<h2 id="yan-zheng-qing-qiu-fan-hui-jie-guo"><a class="zola-anchor" href="#yan-zheng-qing-qiu-fan-hui-jie-guo" aria-label="Anchor link for: yan-zheng-qing-qiu-fan-hui-jie-guo">🔗</a>
验证请求返回结果</h2>
<p><code>ResultActions</code>类提供了3个方法来提供对模拟的HTTP请求返回结果的处理：</p>
<ul>
<li><code>void andExpect(ResultMatcher matcher)</code> 用于对返回结果作断言验证</li>
<li><code>void andDo(ResultHandler handler)</code> 用于对返回结果进行二次操作</li>
<li><code>MvcResult andReturn()</code> 用于直接返回结果</li>
</ul>
<p>为了提高代码效率，<code>MockMvcResultMatchers</code>类和<code>MockMvcResultHandlers</code>类提供了许多静态方法：</p>
<ul>
<li><code>MockMvcResultMatchers</code>类提供了很多包装好的<code>Matcher</code>实例</li>
<li><code>MockMvcResultHandlers</code>类目前只提供了<code>print()</code>方法返回一个<code>Handler</code>实例可以输出返回结果到控制台</li>
</ul>
<h1 id="shi-li-webying-yong-jie-gou"><a class="zola-anchor" href="#shi-li-webying-yong-jie-gou" aria-label="Anchor link for: shi-li-webying-yong-jie-gou">🔗</a>
示例web应用结构</h1>
<h2 id="domain-ceng"><a class="zola-anchor" href="#domain-ceng" aria-label="Anchor link for: domain-ceng">🔗</a>
Domain 层</h2>
<p>Domain层提供了<code>Todo</code>实体类，表示一个一个的Todo项。</p>
<p><code>Todo</code>类代码如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.hibernate.annotations.Type;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.joda.time.DateTime;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">javax.persistence.</span><span style="color:#569cd6;">*</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">@Entity
</span><span style="color:#dcdcdc;">@Table(name=</span><span style="color:#d69d85;">&quot;todos&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">Todo {
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Id
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@GeneratedValue(strategy = GenerationType.</span><span style="color:#b4cea8;">AUTO</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">Long id;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Column(name = </span><span style="color:#d69d85;">&quot;creation_time&quot;</span><span style="color:#dcdcdc;">, nullable = </span><span style="color:#569cd6;">false</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Type(type=</span><span style="color:#d69d85;">&quot;org.jadira.usertype.dateandtime.joda.PersistentDateTime&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">DateTime creationTime;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Column(name = </span><span style="color:#d69d85;">&quot;description&quot;</span><span style="color:#dcdcdc;">, nullable = </span><span style="color:#569cd6;">true</span><span style="color:#dcdcdc;">, length = </span><span style="color:#b5cea8;">500</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">String description;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Column(name = </span><span style="color:#d69d85;">&quot;modification_time&quot;</span><span style="color:#dcdcdc;">, nullable = </span><span style="color:#569cd6;">false</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Type(type=</span><span style="color:#d69d85;">&quot;org.jadira.usertype.dateandtime.joda.PersistentDateTime&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">DateTime modificationTime;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Column(name = </span><span style="color:#d69d85;">&quot;title&quot;</span><span style="color:#dcdcdc;">, nullable = </span><span style="color:#569cd6;">false</span><span style="color:#dcdcdc;">, length = </span><span style="color:#b5cea8;">100</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">String title;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Version
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private long </span><span style="color:#dcdcdc;">version;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public </span><span style="color:#dcdcdc;">Todo() {
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Getters and other methods
</span><span style="color:#dcdcdc;">}
</span></pre><h2 id="service-ceng"><a class="zola-anchor" href="#service-ceng" aria-label="Anchor link for: service-ceng">🔗</a>
Service 层</h2>
<p>Service层提供了<code>TodoService</code>接口，用来连接Controller层和Domain层的通信。该接口提供了3个方法：</p>
<ul>
<li><code>Todo deleteById(Long id)</code> 删除指定id的Todo项；如果不存在该Todo项，则抛出<code>TodoNotFoundException</code>异常</li>
<li><code>List&lt;Todo&gt; findAll()</code> 返回所有Todo项的列表；如果没有Todo项，则返回空列表</li>
<li><code>Todo findById(Long id)</code> 返回指定id的Todo项；如果不存在该Todo项，则抛出<code>TodoNotFoundException</code>异常</li>
</ul>
<p><code>TodoService</code>接口代码如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#569cd6;">public interface </span><span style="color:#dcdcdc;">TodoService {
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public </span><span style="color:#dcdcdc;">Todo deleteById(Long id) </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">TodoNotFoundException;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public </span><span style="color:#dcdcdc;">List&lt;Todo&gt; findAll();
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public </span><span style="color:#dcdcdc;">Todo findById(Long id) </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">TodoNotFoundException;
</span><span style="color:#dcdcdc;">}
</span></pre><h2 id="controller-ceng"><a class="zola-anchor" href="#controller-ceng" aria-label="Anchor link for: controller-ceng">🔗</a>
Controller 层</h2>
<p>Controller层提供了<code>TodoController</code>类，用于创建视图、处理请求。</p>
<p><code>TodoController</code>类代码如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.context.MessageSource;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.context.i18n.LocaleContextHolder;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.stereotype.Controller;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.ui.Model;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.web.bind.annotation.</span><span style="color:#569cd6;">*</span><span style="color:#dcdcdc;">;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.web.servlet.mvc.support.RedirectAttributes;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">javax.annotation.Resource;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">javax.validation.Valid;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">@Controller
</span><span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">TodoController {
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Resource
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">TodoService service;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Resource
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">MessageSource messageSource;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@RequestMapping(value = </span><span style="color:#d69d85;">&quot;/todo/delete/{id}&quot;</span><span style="color:#dcdcdc;">, method = RequestMethod.</span><span style="color:#b4cea8;">GET</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public </span><span style="color:#dcdcdc;">String deleteById(@PathVariable(</span><span style="color:#d69d85;">&quot;id&quot;</span><span style="color:#dcdcdc;">) Long id, RedirectAttributes attributes) </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">TodoNotFoundException {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">Todo deleted = service.deleteById(id);
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">addFeedbackMessage(attributes, </span><span style="color:#d69d85;">&quot;feedback.message.todo.deleted&quot;</span><span style="color:#dcdcdc;">, deleted.getTitle());
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">return </span><span style="color:#dcdcdc;">createRedirectViewPath(</span><span style="color:#d69d85;">&quot;/&quot;</span><span style="color:#dcdcdc;">);
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@RequestMapping(value = </span><span style="color:#d69d85;">&quot;/&quot;</span><span style="color:#dcdcdc;">, method = RequestMethod.</span><span style="color:#b4cea8;">GET</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public </span><span style="color:#dcdcdc;">String findAll(Model model) {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">List&lt;Todo&gt; models = service.findAll();
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">model.addAttribute(</span><span style="color:#d69d85;">&quot;todos&quot;</span><span style="color:#dcdcdc;">, models);
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">return </span><span style="color:#d69d85;">&quot;todo/list&quot;</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@RequestMapping(value = </span><span style="color:#d69d85;">&quot;/todo/{id}&quot;</span><span style="color:#dcdcdc;">, method = RequestMethod.</span><span style="color:#b4cea8;">GET</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public </span><span style="color:#dcdcdc;">String findById(@PathVariable(</span><span style="color:#d69d85;">&quot;id&quot;</span><span style="color:#dcdcdc;">) Long id, Model model) </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">TodoNotFoundException {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">Todo found = service.findById(id);
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">model.addAttribute(</span><span style="color:#d69d85;">&quot;todo&quot;</span><span style="color:#dcdcdc;">, found);
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">return </span><span style="color:#d69d85;">&quot;todo/view&quot;</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private void </span><span style="color:#dcdcdc;">addFeedbackMessage(RedirectAttributes attributes, String messageCode, Object</span><span style="color:#569cd6;">... </span><span style="color:#dcdcdc;">messageParameters) {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">String localizedFeedbackMessage = getMessage(messageCode, messageParameters);
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">attributes.addFlashAttribute(</span><span style="color:#d69d85;">&quot;feedbackMessage&quot;</span><span style="color:#dcdcdc;">, localizedFeedbackMessage);
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">String getMessage(String messageCode, Object</span><span style="color:#569cd6;">... </span><span style="color:#dcdcdc;">messageParameters) {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">Locale current = LocaleContextHolder.getLocale();
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">return</span><span style="color:#dcdcdc;"> messageSource.getMessage(messageCode, messageParameters, current);
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">String createRedirectViewPath(String requestMapping) {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">StringBuilder redirectViewPath = </span><span style="color:#569cd6;">new </span><span style="color:#dcdcdc;">StringBuilder();
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">redirectViewPath.append(</span><span style="color:#d69d85;">&quot;redirect:&quot;</span><span style="color:#dcdcdc;">);
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">redirectViewPath.append(requestMapping);
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">return</span><span style="color:#dcdcdc;"> redirectViewPath.toString();
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre><h1 id="ce-shi-yong-li"><a class="zola-anchor" href="#ce-shi-yong-li" aria-label="Anchor link for: ce-shi-yong-li">🔗</a>
测试用例</h1>
<h2 id="chuang-jian-ce-shi-yong-li-lei-kuang-jia"><a class="zola-anchor" href="#chuang-jian-ce-shi-yong-li-lei-kuang-jia" aria-label="Anchor link for: chuang-jian-ce-shi-yong-li-lei-kuang-jia">🔗</a>
创建测试用例类框架</h2>
<p>要搭建起测试框架，需要以下步骤：</p>
<ol>
<li>搭建Spring MVC Test环境</li>
<li>搭建DbUnit环境</li>
<li>配置DBUnit，设定测试开始和结束时的状态</li>
</ol>
<p>没有添加任何测试方法前的框架代码如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.DbUnitTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.annotation.DatabaseSetup;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.Before;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.runner.RunWith;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.ContextConfiguration;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.TestExecutionListeners;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DependencyInjectionTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DirtiesContextTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.transaction.TransactionalTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.MockMvc;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.samples.context.WebContextLoader;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.setup.MockMvcBuilders;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.web.context.WebApplicationContext;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">javax.annotation.Resource;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">@RunWith(SpringJUnit4ClassRunner.class)
</span><span style="color:#dcdcdc;">@ContextConfiguration(loader = WebContextLoader.class, classes = {ExampleApplicationContext.class})
</span><span style="color:#dcdcdc;">@TestExecutionListeners({ DependencyInjectionTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DirtiesContextTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">TransactionalTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DbUnitTestExecutionListener.class })
</span><span style="color:#dcdcdc;">@DatabaseSetup(</span><span style="color:#d69d85;">&quot;toDoData.xml&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">ITTodoControllerTest {
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Resource
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">WebApplicationContext webApplicationContext;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">MockMvc mockMvc;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Before
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public void </span><span style="color:#dcdcdc;">setUp() {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">mockMvc = MockMvcBuilders.webApplicationContextSetup(webApplicationContext)
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.build();
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">     </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Add tests here
</span><span style="color:#dcdcdc;">}
</span></pre>
<p>注意代码中的<code>@DatabaseSetup(&quot;toDoData.xml&quot;)</code>注解，该注解的作用在于使用<code>todoData.xml</code>文件中的数据去初始化数据库表，该注解由<code>DbUnitTestExecutionListener</code>进行解析。</p>
<p><code>todoData.xml</code>文件内容如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#808080;">&lt;</span><span style="color:#569cd6;">dataset</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">todos </span><span style="color:#92caf4;">id</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;1&quot; </span><span style="color:#92caf4;">creation_time</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;2012-10-21 11:13:28&quot; </span><span style="color:#92caf4;">description</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;Lorem ipsum&quot; </span><span style="color:#92caf4;">modification_time</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;2012-10-21 11:13:28&quot; </span><span style="color:#92caf4;">title</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;Foo&quot; </span><span style="color:#92caf4;">version</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;0&quot;</span><span style="color:#808080;">/&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">todos </span><span style="color:#92caf4;">id</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;2&quot; </span><span style="color:#92caf4;">creation_time</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;2012-10-21 11:13:28&quot; </span><span style="color:#92caf4;">description</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;Lorem ipsum&quot; </span><span style="color:#92caf4;">modification_time</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;2012-10-21 11:13:28&quot; </span><span style="color:#92caf4;">title</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;Bar&quot; </span><span style="color:#92caf4;">version</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;0&quot;</span><span style="color:#808080;">/&gt;
</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">dataset</span><span style="color:#808080;">&gt;
</span></pre><h2 id="bian-xie-ji-cheng-ce-shi-yong-li"><a class="zola-anchor" href="#bian-xie-ji-cheng-ce-shi-yong-li" aria-label="Anchor link for: bian-xie-ji-cheng-ce-shi-yong-li">🔗</a>
编写集成测试用例</h2>
<h3 id="huo-qu-todoxiang-lie-biao-jie-kou-de-ce-shi-yong-li"><a class="zola-anchor" href="#huo-qu-todoxiang-lie-biao-jie-kou-de-ce-shi-yong-li" aria-label="Anchor link for: huo-qu-todoxiang-lie-biao-jie-kou-de-ce-shi-yong-li">🔗</a>
获取Todo项列表接口的测试用例</h3>
<p>编写该测试用例的思路如下：</p>
<ol>
<li>使用<code>@ExpectedDatabase</code>注解来验证接口没有对数据库表状态产生变化</li>
<li>模拟执行&quot;/&quot;的GET请求，并取得返回的响应结果</li>
<li>对返回的响应结果作断言：HTTP状态码为200</li>
<li>对返回的响应结果作断言：view的名字是'todo/list'</li>
<li>对返回的响应结果作断言：view的路径为&quot;/WEB-INF/jsp/todo/list.jsp&quot;</li>
<li>对返回的响应结果作断言：model中Todo项的个数是2</li>
<li>对返回的响应结果作断言：model中的Todo项符合预期</li>
</ol>
<p>最终的代码如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.DbUnitTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.annotation.DatabaseSetup;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.annotation.ExpectedDatabase;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.Test;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.runner.RunWith;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.ContextConfiguration;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.TestExecutionListeners;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DependencyInjectionTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DirtiesContextTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.transaction.TransactionalTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.MockMvc;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.samples.context.WebContextLoader;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.hamcrest.Matchers.</span><span style="color:#569cd6;">*</span><span style="color:#dcdcdc;">;
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.springframework.test.web.server.request.MockMvcRequestBuilders.get;
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.springframework.test.web.server.result.MockMvcResultMatchers.</span><span style="color:#569cd6;">*</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">@RunWith(SpringJUnit4ClassRunner.class)
</span><span style="color:#dcdcdc;">@ContextConfiguration(loader = WebContextLoader.class, classes = {ExampleApplicationContext.class})
</span><span style="color:#dcdcdc;">@TestExecutionListeners({ DependencyInjectionTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DirtiesContextTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">TransactionalTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DbUnitTestExecutionListener.class })
</span><span style="color:#dcdcdc;">@DatabaseSetup(</span><span style="color:#d69d85;">&quot;toDoData.xml&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">ITTodoControllerTest {
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Add web application context here
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">MockMvc mockMvc;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Add setUp() method here
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Test
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@ExpectedDatabase(</span><span style="color:#d69d85;">&quot;toDoData.xml&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public void </span><span style="color:#dcdcdc;">findAll() </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">Exception {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">mockMvc.perform(get(</span><span style="color:#d69d85;">&quot;/&quot;</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(status().isOk())
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(view().name(</span><span style="color:#d69d85;">&quot;todo/list&quot;</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(forwardedUrl(</span><span style="color:#d69d85;">&quot;/WEB-INF/jsp/todo/list.jsp&quot;</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(model().attribute(</span><span style="color:#d69d85;">&quot;todos&quot;</span><span style="color:#dcdcdc;">, hasSize(</span><span style="color:#b5cea8;">2</span><span style="color:#dcdcdc;">)))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(model().attribute(</span><span style="color:#d69d85;">&quot;todos&quot;</span><span style="color:#dcdcdc;">, hasItem(
</span><span style="color:#dcdcdc;">                        </span><span style="color:#dcdcdc;">allOf(
</span><span style="color:#dcdcdc;">                                </span><span style="color:#dcdcdc;">hasProperty(</span><span style="color:#d69d85;">&quot;id&quot;</span><span style="color:#dcdcdc;">, is(</span><span style="color:#b5cea8;">1</span><span style="color:#569cd6;">L</span><span style="color:#dcdcdc;">)),
</span><span style="color:#dcdcdc;">                                </span><span style="color:#dcdcdc;">hasProperty(</span><span style="color:#d69d85;">&quot;description&quot;</span><span style="color:#dcdcdc;">, is(</span><span style="color:#d69d85;">&quot;Lorem ipsum&quot;</span><span style="color:#dcdcdc;">)),
</span><span style="color:#dcdcdc;">                                </span><span style="color:#dcdcdc;">hasProperty(</span><span style="color:#d69d85;">&quot;title&quot;</span><span style="color:#dcdcdc;">, is(</span><span style="color:#d69d85;">&quot;Foo&quot;</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                        </span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">)))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(model().attribute(</span><span style="color:#d69d85;">&quot;todos&quot;</span><span style="color:#dcdcdc;">, hasItem(
</span><span style="color:#dcdcdc;">                        </span><span style="color:#dcdcdc;">allOf(
</span><span style="color:#dcdcdc;">                                </span><span style="color:#dcdcdc;">hasProperty(</span><span style="color:#d69d85;">&quot;id&quot;</span><span style="color:#dcdcdc;">, is(</span><span style="color:#b5cea8;">2</span><span style="color:#569cd6;">L</span><span style="color:#dcdcdc;">)),
</span><span style="color:#dcdcdc;">                                </span><span style="color:#dcdcdc;">hasProperty(</span><span style="color:#d69d85;">&quot;description&quot;</span><span style="color:#dcdcdc;">, is(</span><span style="color:#d69d85;">&quot;Lorem ipsum&quot;</span><span style="color:#dcdcdc;">)),
</span><span style="color:#dcdcdc;">                                </span><span style="color:#dcdcdc;">hasProperty(</span><span style="color:#d69d85;">&quot;title&quot;</span><span style="color:#dcdcdc;">, is(</span><span style="color:#d69d85;">&quot;Bar&quot;</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                        </span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">)));
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre><h3 id="huo-qu-dan-ge-todoxiang-xiang-qing-jie-kou-de-ce-shi-yong-li"><a class="zola-anchor" href="#huo-qu-dan-ge-todoxiang-xiang-qing-jie-kou-de-ce-shi-yong-li" aria-label="Anchor link for: huo-qu-dan-ge-todoxiang-xiang-qing-jie-kou-de-ce-shi-yong-li">🔗</a>
获取单个Todo项详情接口的测试用例</h3>
<p>根据参数的不同，获取单个Todo项详情接口会有两种不同的返回结果：</p>
<ul>
<li>如果指定id的Todo项存在，返回单个Todo项的详情页</li>
<li>如果指定id的Todo项不存在，返回404页</li>
</ul>
<p>对于指定Todo项存在的情况，我们可以按照以下步骤来编写测试用例：</p>
<ol>
<li>使用<code>@ExpectedDatabase</code>注解来验证接口没有对数据库表状态产生变化</li>
<li>模拟执行&quot;/todo/1&quot;的GET请求，并取得返回的响应结果</li>
<li>对返回的响应结果作断言：HTTP状态码为200</li>
<li>对返回的响应结果作断言：view的名字是'todo/view'</li>
<li>对返回的响应结果作断言：view的路径为&quot;/WEB-INF/jsp/todo/view.jsp&quot;</li>
<li>对返回的响应结果作断言：model中的Todo项符合预期</li>
</ol>
<p>最终的代码如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.DbUnitTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.annotation.DatabaseSetup;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.annotation.ExpectedDatabase;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.Test;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.runner.RunWith;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.ContextConfiguration;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.TestExecutionListeners;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DependencyInjectionTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DirtiesContextTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.transaction.TransactionalTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.MockMvc;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.samples.context.WebContextLoader;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.hamcrest.Matchers.</span><span style="color:#569cd6;">*</span><span style="color:#dcdcdc;">;
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.springframework.test.web.server.request.MockMvcRequestBuilders.get;
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.springframework.test.web.server.result.MockMvcResultMatchers.</span><span style="color:#569cd6;">*</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">@RunWith(SpringJUnit4ClassRunner.class)
</span><span style="color:#dcdcdc;">@ContextConfiguration(loader = WebContextLoader.class, classes = {ExampleApplicationContext.class})
</span><span style="color:#dcdcdc;">@TestExecutionListeners({ DependencyInjectionTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DirtiesContextTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">TransactionalTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DbUnitTestExecutionListener.class })
</span><span style="color:#dcdcdc;">@DatabaseSetup(</span><span style="color:#d69d85;">&quot;toDoData.xml&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">ITTodoControllerTest {
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Add web application context here
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">MockMvc mockMvc;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Add setUp() method here
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Test
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@ExpectedDatabase(</span><span style="color:#d69d85;">&quot;toDoData.xml&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public void </span><span style="color:#dcdcdc;">findById() </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">Exception {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">mockMvc.perform(get(</span><span style="color:#d69d85;">&quot;/todo/{id}&quot;</span><span style="color:#dcdcdc;">, </span><span style="color:#b5cea8;">1</span><span style="color:#569cd6;">L</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(status().isOk())
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(view().name(</span><span style="color:#d69d85;">&quot;todo/view&quot;</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(forwardedUrl(</span><span style="color:#d69d85;">&quot;/WEB-INF/jsp/todo/view.jsp&quot;</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(model().attribute(</span><span style="color:#d69d85;">&quot;todo&quot;</span><span style="color:#dcdcdc;">, hasProperty(</span><span style="color:#d69d85;">&quot;id&quot;</span><span style="color:#dcdcdc;">, is(</span><span style="color:#b5cea8;">1</span><span style="color:#569cd6;">L</span><span style="color:#dcdcdc;">))))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(model().attribute(</span><span style="color:#d69d85;">&quot;todo&quot;</span><span style="color:#dcdcdc;">, hasProperty(</span><span style="color:#d69d85;">&quot;description&quot;</span><span style="color:#dcdcdc;">, is(</span><span style="color:#d69d85;">&quot;Lorem ipsum&quot;</span><span style="color:#dcdcdc;">))))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(model().attribute(</span><span style="color:#d69d85;">&quot;todo&quot;</span><span style="color:#dcdcdc;">, hasProperty(</span><span style="color:#d69d85;">&quot;title&quot;</span><span style="color:#dcdcdc;">, is(</span><span style="color:#d69d85;">&quot;Foo&quot;</span><span style="color:#dcdcdc;">))));
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre>
<p>对于指定Todo项不存在的情况，我们可以按照以下步骤来编写测试用例：</p>
<ol>
<li>使用<code>@ExpectedDatabase</code>注解来验证接口没有对数据库表状态产生变化</li>
<li>模拟执行&quot;/todo/3&quot;的GET请求，并取得返回的响应结果</li>
<li>对返回的响应结果作断言：HTTP状态码为404</li>
<li>对返回的响应结果作断言：view的名字是'error/404'</li>
<li>对返回的响应结果作断言：view的路径为&quot;/WEB-INF/jsp/error/404.jsp&quot;</li>
</ol>
<p>最终的代码如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.DbUnitTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.annotation.DatabaseSetup;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.annotation.ExpectedDatabase;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.Test;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.runner.RunWith;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.ContextConfiguration;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.TestExecutionListeners;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DependencyInjectionTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DirtiesContextTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.transaction.TransactionalTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.MockMvc;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.samples.context.WebContextLoader;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.springframework.test.web.server.request.MockMvcRequestBuilders.get;
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.springframework.test.web.server.result.MockMvcResultMatchers.</span><span style="color:#569cd6;">*</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">@RunWith(SpringJUnit4ClassRunner.class)
</span><span style="color:#dcdcdc;">@ContextConfiguration(loader = WebContextLoader.class, classes = {ExampleApplicationContext.class})
</span><span style="color:#dcdcdc;">@TestExecutionListeners({ DependencyInjectionTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DirtiesContextTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">TransactionalTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DbUnitTestExecutionListener.class })
</span><span style="color:#dcdcdc;">@DatabaseSetup(</span><span style="color:#d69d85;">&quot;toDoData.xml&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">ITTodoControllerTest {
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Add web application context here
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">MockMvc mockMvc;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Add setUp() method here
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Test
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@ExpectedDatabase(</span><span style="color:#d69d85;">&quot;toDoData.xml&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public void </span><span style="color:#dcdcdc;">findByIdWhenTodoIsNotFound() </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">Exception {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">mockMvc.perform(get(</span><span style="color:#d69d85;">&quot;/todo/{id}&quot;</span><span style="color:#dcdcdc;">, </span><span style="color:#b5cea8;">3</span><span style="color:#569cd6;">L</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(status().isNotFound())
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(view().name(</span><span style="color:#d69d85;">&quot;error/404&quot;</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(forwardedUrl(</span><span style="color:#d69d85;">&quot;/WEB-INF/jsp/error/404.jsp&quot;</span><span style="color:#dcdcdc;">));
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre><h3 id="shan-chu-zhi-ding-todoxiang-jie-kou-de-ce-shi-yong-li"><a class="zola-anchor" href="#shan-chu-zhi-ding-todoxiang-jie-kou-de-ce-shi-yong-li" aria-label="Anchor link for: shan-chu-zhi-ding-todoxiang-jie-kou-de-ce-shi-yong-li">🔗</a>
删除指定Todo项接口的测试用例</h3>
<p>根据参数的不同，删除指定Todo项接口会有两种不同的返回结果：</p>
<ul>
<li>如果指定id的Todo项存在，数据库中的Todo会被删除</li>
<li>如果指定id的Todo项不存在，返回404页</li>
</ul>
<p>对于指定Todo项存在的情况，我们可以按照以下步骤来编写测试用例：</p>
<ol>
<li>使用<code>@ExpectedDatabase</code>注解来验证接口对数据库的操作符合预期</li>
<li>模拟执行&quot;/todo/delete/1&quot;的GET请求，并取得返回的响应结果</li>
<li>对返回的响应结果作断言：HTTP状态码为200</li>
<li>对返回的响应结果作断言：view的名字是'redirect:/'</li>
<li>对返回的响应结果作断言：view的路径为&quot;/WEB-INF/jsp/todo/view.jsp&quot;</li>
<li>对返回的响应结果作断言：flash中返回了预期的提示信息</li>
</ol>
<p>最终的代码如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.DbUnitTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.annotation.DatabaseSetup;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.annotation.ExpectedDatabase;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.Test;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.runner.RunWith;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.ContextConfiguration;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.TestExecutionListeners;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DependencyInjectionTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DirtiesContextTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.transaction.TransactionalTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.MockMvc;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.samples.context.WebContextLoader;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.hamcrest.Matchers.is;
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.springframework.test.web.server.request.MockMvcRequestBuilders.get;
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.springframework.test.web.server.result.MockMvcResultMatchers.</span><span style="color:#569cd6;">*</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">@RunWith(SpringJUnit4ClassRunner.class)
</span><span style="color:#dcdcdc;">@ContextConfiguration(loader = WebContextLoader.class, classes = {ExampleApplicationContext.class})
</span><span style="color:#dcdcdc;">@TestExecutionListeners({ DependencyInjectionTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DirtiesContextTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">TransactionalTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DbUnitTestExecutionListener.class })
</span><span style="color:#dcdcdc;">@DatabaseSetup(</span><span style="color:#d69d85;">&quot;toDoData.xml&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">ITTodoControllerTest {
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Add web application context here
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">MockMvc mockMvc;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Add setUp() method here
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Test
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@ExpectedDatabase(</span><span style="color:#d69d85;">&quot;todoData-delete-expected.xml&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public void </span><span style="color:#dcdcdc;">deleteById() </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">Exception {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">mockMvc.perform(get(</span><span style="color:#d69d85;">&quot;/todo/delete/{id}&quot;</span><span style="color:#dcdcdc;">, </span><span style="color:#b5cea8;">1</span><span style="color:#569cd6;">L</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(status().isOk())
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(view().name(</span><span style="color:#d69d85;">&quot;redirect:/&quot;</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(flash().attribute(</span><span style="color:#d69d85;">&quot;feedbackMessage&quot;</span><span style="color:#dcdcdc;">, is(</span><span style="color:#d69d85;">&quot;Todo entry: Foo was deleted.&quot;</span><span style="color:#dcdcdc;">)));
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre>
<p>作为对照，<code>todoData-delete-expected.xml</code>文件包含了预期的数据库表结果，内容如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#808080;">&lt;</span><span style="color:#569cd6;">dataset</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">todos </span><span style="color:#92caf4;">id</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;2&quot; </span><span style="color:#92caf4;">creation_time</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;2012-10-21 11:13:28&quot; </span><span style="color:#92caf4;">description</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;Lorem ipsum&quot; </span><span style="color:#92caf4;">modification_time</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;2012-10-21 11:13:28&quot; </span><span style="color:#92caf4;">title</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;Bar&quot; </span><span style="color:#92caf4;">version</span><span style="color:#808080;">=</span><span style="color:#c8c8c8;">&quot;0&quot;</span><span style="color:#808080;">/&gt;
</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">dataset</span><span style="color:#808080;">&gt;
</span></pre>
<p>对于指定Todo项不存在的情况，我们可以按照以下步骤来编写测试用例：</p>
<ol>
<li>使用<code>@ExpectedDatabase</code>注解来验证接口没有对数据库表状态产生变化</li>
<li>模拟执行&quot;/todo/delete/3&quot;的GET请求，并取得返回的响应结果</li>
<li>对返回的响应结果作断言：HTTP状态码为404</li>
<li>对返回的响应结果作断言：view的名字是'error/404'</li>
<li>对返回的响应结果作断言：view的路径为&quot;/WEB-INF/jsp/error/404.jsp&quot;</li>
</ol>
<p>最终的代码如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.DbUnitTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.annotation.DatabaseSetup;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">com.github.springtestdbunit.annotation.ExpectedDatabase;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.Test;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.junit.runner.RunWith;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.ContextConfiguration;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.TestExecutionListeners;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DependencyInjectionTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.support.DirtiesContextTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.context.transaction.TransactionalTestExecutionListener;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.MockMvc;
</span><span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">org.springframework.test.web.server.samples.context.WebContextLoader;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.springframework.test.web.server.request.MockMvcRequestBuilders.get;
</span><span style="color:#9b9b9b;">import static </span><span style="color:#dcdcdc;">org.springframework.test.web.server.result.MockMvcResultMatchers.</span><span style="color:#569cd6;">*</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">@RunWith(SpringJUnit4ClassRunner.class)
</span><span style="color:#dcdcdc;">@ContextConfiguration(loader = WebContextLoader.class, classes = {ExampleApplicationContext.class})
</span><span style="color:#dcdcdc;">@TestExecutionListeners({ DependencyInjectionTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DirtiesContextTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">TransactionalTestExecutionListener.class,
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">DbUnitTestExecutionListener.class })
</span><span style="color:#dcdcdc;">@DatabaseSetup(</span><span style="color:#d69d85;">&quot;toDoData.xml&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">ITTodoControllerTest {
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Add web application context here
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">MockMvc mockMvc;
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">//Add setUp() method here
</span><span style="color:#dcdcdc;"> </span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Test
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@ExpectedDatabase(</span><span style="color:#d69d85;">&quot;toDoData.xml&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public void </span><span style="color:#dcdcdc;">deleteByIdWhenTodoIsNotFound() </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">Exception {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">mockMvc.perform(get(</span><span style="color:#d69d85;">&quot;/todo/delete/{id}&quot;</span><span style="color:#dcdcdc;">, </span><span style="color:#b5cea8;">3</span><span style="color:#569cd6;">L</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(status().isNotFound())
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(view().name(</span><span style="color:#d69d85;">&quot;error/404&quot;</span><span style="color:#dcdcdc;">))
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">.andExpect(forwardedUrl(</span><span style="color:#d69d85;">&quot;/WEB-INF/jsp/error/404.jsp&quot;</span><span style="color:#dcdcdc;">));
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre><h1 id="zong-jie"><a class="zola-anchor" href="#zong-jie" aria-label="Anchor link for: zong-jie">🔗</a>
总结</h1>
<p>到此为止，我们就写完了所有的测试用例代码。总结一下，本文主要内容如下：</p>
<ul>
<li>如何生成并执行模拟的HTTP请求，以及如何对响应结果作断言</li>
<li>使用Spring MVC Test编写的集成测试用例可读性非常好，可以作为接口文档的补充</li>
<li>Spring MVC Test没法验证view是否正确绘制，但可以验证是否使用了预期的view模板</li>
</ul>
<p>下一篇是 <a href="https://www.wangbo.im/posts/spring-mvc-testing-integration-testing-forms/">Spring MVC Integration Testing - Forms</a>。</p>

        </div>
        
    
</div></div>
            
    <div class="pagination">
        <div class="pagination__buttons">
            </div>
    </div>
<footer class="footer">
                    <div class="footer__inner"><div class="copyright">
            <span>© 2019 <a href="https://github.com/ejmg/zerm">zerm</a> :: Powered by <a href="https://www.getzola.org/">Zola</a></span>
            <span>:: Theme made by <a href="https://github.com/ejmg">ejmg</a></span>
        </div>
    <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;assets&#x2F;js&#x2F;main.js"></script>
</div>
                    

                </footer></div>
    </body>
</html>
