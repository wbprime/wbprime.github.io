

<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>wangboâ€™s home &amp; blog</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">WB Prime</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.wangbo.im">WB Prime</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https://www.wangbo.im">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    



<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;libevent-notes&#x2F;">Libevent Note</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2018-02-05</span>
            
        </div>
    </header>

    <div class="post-content">
      <h1 id="event-context"><a class="zola-anchor" href="#event-context" aria-label="Anchor link for: event-context">ğŸ”—</a>
Event Context</h1>
<h2 id="structure"><a class="zola-anchor" href="#structure" aria-label="Anchor link for: structure">ğŸ”—</a>
Structure</h2>
<p><code>event_base</code></p>
<h2 id="setup-a-default-context"><a class="zola-anchor" href="#setup-a-default-context" aria-label="Anchor link for: setup-a-default-context">ğŸ”—</a>
Setup a Default Context</h2>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">#include &lt;event2/event.h&gt;
</span><span style="color:#c0c5ce;">struct event_base *event_base_new(void);
</span></pre><h2 id="setup-a-custom-context"><a class="zola-anchor" href="#setup-a-custom-context" aria-label="Anchor link for: setup-a-custom-context">ğŸ”—</a>
Setup a Custom Context</h2>
<p>å¯ä»¥ç”¨ <code>event_config</code> æ¥è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">struct event_config *event_config_new(void);
</span><span style="color:#c0c5ce;">struct event_base *event_base_new_with_config(const struct event_config *cfg);
</span><span style="color:#c0c5ce;">void event_config_free(struct event_config *cfg);
</span></pre>
<p><code>event_config</code> çš„è‡ªå®šä¹‰æ–¹æ³•ï¼š</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">#include &lt;event2/event.h&gt;
</span><span style="color:#c0c5ce;">int event_config_avoid_method(struct event_config *cfg, const char *method);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">enum event_method_feature {
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">EV_FEATURE_ET = 0x01,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">EV_FEATURE_O1 = 0x02,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">EV_FEATURE_FDS = 0x04,
</span><span style="color:#c0c5ce;">};
</span><span style="color:#c0c5ce;">int event_config_require_features(struct event_config *cfg,
</span><span style="color:#c0c5ce;">                                  </span><span style="color:#c0c5ce;">enum event_method_feature feature);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">enum event_base_config_flag {
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">EVENT_BASE_FLAG_NOLOCK = 0x01,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">EVENT_BASE_FLAG_IGNORE_ENV = 0x02,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">EVENT_BASE_FLAG_STARTUP_IOCP = 0x04,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">EVENT_BASE_FLAG_NO_CACHE_TIME = 0x08,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">EVENT_BASE_FLAG_EPOLL_USE_CHANGELIST = 0x10,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">EVENT_BASE_FLAG_PRECISE_TIMER = 0x20
</span><span style="color:#c0c5ce;">};
</span><span style="color:#c0c5ce;">int event_config_set_flag(struct event_config *cfg,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">enum event_base_config_flag flag);
</span></pre>
<p><code>event_config_avoid_method()</code> æŒ‡å®šä¸ä½¿ç”¨çš„åç«¯å</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">`const char **event_get_supported_methods(void);` å¯ä»¥ç”¨äºè·å–å¯ç”¨çš„åç«¯ååˆ—è¡¨
</span></pre><h2 id="deallocate-a-context"><a class="zola-anchor" href="#deallocate-a-context" aria-label="Anchor link for: deallocate-a-context">ğŸ”—</a>
Deallocate a Context</h2>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">#include &lt;event2/event.h&gt;
</span><span style="color:#c0c5ce;">void event_base_free(struct event_base *base);
</span></pre><h2 id="reinit-a-context"><a class="zola-anchor" href="#reinit-a-context" aria-label="Anchor link for: reinit-a-context">ğŸ”—</a>
Reinit a Context</h2>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">#include &lt;event2/event.h&gt;
</span><span style="color:#c0c5ce;">int event_reinit(struct event_base *base);
</span></pre>
<p>ä¸€èˆ¬åœ¨<code>fork</code>ä¹‹åéœ€è¦è°ƒç”¨å¾…æ–¹æ³•ã€‚</p>
<h1 id="iterate-all-active-pending-events"><a class="zola-anchor" href="#iterate-all-active-pending-events" aria-label="Anchor link for: iterate-all-active-pending-events">ğŸ”—</a>
Iterate All Active/Pending Events</h1>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">typedef int (*event_base_foreach_event_cb)(
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">const struct event_base *,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">const struct event *, void *);
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">int event_base_foreach_event(
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">struct event_base *base,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">event_base_foreach_event_cb fn,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">void *arg);
</span></pre>
<p><code>event_base_foreach_event()</code> ä¼šä»¥éšæœºçš„é¡ºåºéå†å½“å‰æ‰€æœ‰å¯ç”¨çš„eventï¼Œæ¯ä¸€ä¸ªeventæ‰§è¡Œä¸€æ¬¡å‚æ•°fnçš„å‡½æ•°ï¼Œå‚æ•°argä¼šè¢«ä¼ å…¥å‚æ•°fnä¸­ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ã€‚</p>
<p>å‚æ•°fnçš„è¿”å›å€¼å¦‚æœä¸æ˜¯0,åˆ™é€€å‡ºè¿­ä»£è¿‡ç¨‹ã€‚</p>
<p><code>event_base_foreach_event()</code>çš„è¿”å›å€¼æ˜¯å‚æ•°fnçš„æœ€åä¸€æ¬¡è¿”å›å€¼ã€‚</p>
<h1 id="event-loop"><a class="zola-anchor" href="#event-loop" aria-label="Anchor link for: event-loop">ğŸ”—</a>
Event Loop</h1>
<h2 id="run-event-loop"><a class="zola-anchor" href="#run-event-loop" aria-label="Anchor link for: run-event-loop">ğŸ”—</a>
Run Event Loop</h2>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">#define </span><span style="color:#c0c5ce;">EVLOOP_ONCE             </span><span style="color:#d08770;">0x01
</span><span style="color:#b48ead;">#define </span><span style="color:#c0c5ce;">EVLOOP_NONBLOCK         </span><span style="color:#d08770;">0x02
</span><span style="color:#b48ead;">#define </span><span style="color:#c0c5ce;">EVLOOP_NO_EXIT_ON_EMPTY </span><span style="color:#d08770;">0x04
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">event_base_loop</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;"> event_base *</span><span style="color:#bf616a;">base</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">flags</span><span style="color:#c0c5ce;">);
</span></pre>
<p>flags:</p>
<ul>
<li><code>EVLOOP_ONCE</code> the loop wait active events</li>
<li><code>EVLOOP_NONBLOCK</code> the loop checks available active events</li>
<li><code>EVLOOP_NO_EXIT_ON_EMPTY</code> the loop will not exit even when no active events</li>
</ul>
<p>As a convinience, <code>libevent</code> provides another method.</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">event_base_dispatch</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;"> event_base *</span><span style="color:#bf616a;">base</span><span style="color:#c0c5ce;">);
</span></pre>
<p>Thus the loop keeps running until there are no more registered events or until
event_base_loopbreak() or event_base_loopexit() is called.</p>
<h2 id="stop-event-loop"><a class="zola-anchor" href="#stop-event-loop" aria-label="Anchor link for: stop-event-loop">ğŸ”—</a>
Stop Event Loop</h2>
<ul>
<li>
<p><code>int event_base_loopexit(struct event_base *base, const struct timeval *tv);</code></p>
<p>è®¾å®šbaseåœ¨æŒ‡å®šæ—¶é—´é—´éš”åé€€å‡ºå¾ªç¯ï¼›å¦‚æœå‚æ•°tvä¸ºnullï¼Œåˆ™ç«‹å³é€€å‡ºï¼›å¦‚æœè¦é€€å‡ºæ—¶
ï¼Œè¿˜æœ‰callbackæ²¡æœ‰è¿è¡Œï¼Œåˆ™è¿è¡Œå®Œäº†å†é€€å‡º</p>
</li>
<li>
<p><code>int event_base_loopbreak(struct event_base *base);</code></p>
<p>è®¾å®šbaseé©¬ä¸Šé€€å‡ºå¾ªç¯</p>
</li>
</ul>
<p><code>event_base_loopbreak()</code> VS <code>event_base_loopexit(base, NULL)</code></p>
<p>äºŒè€…çš„åŒºåˆ«åœ¨äºå‰è€…ç­‰å¾…æ­£åœ¨è¿è¡Œçš„callbackæ‰§è¡Œç»“æŸç«‹å³é€€å‡ºï¼›åè€…ç­‰æ‰€æœ‰çš„å°±ç»ªçš„
callbackæ‰§è¡Œç»“æŸæ‰é€€å‡ºã€‚å¦å¤–ï¼Œå¦‚æœå½“å‰æ²¡æœ‰å¾ªç¯ï¼Œloopexitä¼šæ˜¯çš„ä¸‹ä¸€æ¬¡è¿è¡Œçš„loopé€€
å‡ºï¼›è€Œloopbreakä¸ä¼šå½±å“åˆ°åç»­çš„loopã€‚</p>
<h2 id="get-the-exit-reason"><a class="zola-anchor" href="#get-the-exit-reason" aria-label="Anchor link for: get-the-exit-reason">ğŸ”—</a>
Get the Exit Reason</h2>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">int event_base_got_exit(struct event_base *base);
</span><span style="color:#c0c5ce;">int event_base_got_break(struct event_base *base);
</span></pre>
<p>åˆ¤æ–­eventå¾ªç¯é€€å‡ºçš„åŸå› ï¼ˆæ–¹å¼ï¼‰ï¼Œåˆ†åˆ«å¯¹åº”ä¸loopexitå’Œloopbreakï¼Œå¦‚æœæ˜¯åˆ™è¿”å›é0å€¼ã€‚</p>
<h2 id="skip-to-next-loop"><a class="zola-anchor" href="#skip-to-next-loop" aria-label="Anchor link for: skip-to-next-loop">ğŸ”—</a>
Skip to Next Loop</h2>
<p><code>int event_base_loopcontinue(struct event_base *);</code></p>
<p>é€€å‡ºæœ¬æ¬¡å¾ªç¯ï¼Œè¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯</p>
<h1 id="events"><a class="zola-anchor" href="#events" aria-label="Anchor link for: events">ğŸ”—</a>
Events</h1>
<h2 id="overview"><a class="zola-anchor" href="#overview" aria-label="Anchor link for: overview">ğŸ”—</a>
Overview</h2>
<p><code>event</code> å°è£…äº†ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>è¯»å†™å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰</li>
<li>å®šæ—¶å™¨è¶…æ—¶</li>
<li>å‘ç”Ÿäº†ä¿¡å·çš„ä¿¡æ¯</li>
<li>ç”¨æˆ·è‡ªå®šä¹‰çš„äº‹ä»¶</li>
</ul>
<h2 id="lifecycle-of-event"><a class="zola-anchor" href="#lifecycle-of-event" aria-label="Anchor link for: lifecycle-of-event">ğŸ”—</a>
Lifecycle of Event</h2>
<ul>
<li>initialized
eventæ–°å»ºå¹¶æ·»åŠ åˆ°ä¸Šä¸‹æ–‡ï¼ˆevent_baseï¼‰ä¹‹å</li>
<li>pending
pendingå¯ä»¥é€šè¿‡deletingæ¥å˜æˆnon-pendingï¼›åä¹‹å¯ä»¥é€šè¿‡addingå°†non-pendingå˜ä¸ºpending
eventå˜ä¸ºactiveçŠ¶æ€ä¹‹åï¼Œä¼šåœ¨å°†è¦è°ƒç”¨callbakcä¹‹å‰å˜ä¸ºnon-pendingçš„çŠ¶æ€</li>
<li>active
ä¸åŒç±»å‹çš„eventè¢«è§¦å‘ï¼ˆæ–‡ä»¶æè¿°ç¬¦å¯è¯»å¯å†™ï¼Œå®šæ—¶å™¨è¶…æ—¶ï¼‰ï¼Œå…³è”çš„callbackå›è°ƒä¼šè¢«æ‰§è¡Œ</li>
<li>persistent
eventå¯ä»¥è®¾ç½®ä¸ºpersistentï¼ševentå¯ä»¥åœ¨æ‰§è¡Œäº†callbackä¹‹åè¿˜ä¿æŒpendingçŠ¶æ€</li>
</ul>
<h2 id="event-de-chuang-jian-yu-xiao-hui"><a class="zola-anchor" href="#event-de-chuang-jian-yu-xiao-hui" aria-label="Anchor link for: event-de-chuang-jian-yu-xiao-hui">ğŸ”—</a>
Event çš„åˆ›å»ºä¸é”€æ¯</h2>
<h3 id="tong-yong-fang-fa"><a class="zola-anchor" href="#tong-yong-fang-fa" aria-label="Anchor link for: tong-yong-fang-fa">ğŸ”—</a>
é€šç”¨æ–¹æ³•</h3>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">#include &lt;event2/event.h&gt;
</span><span style="color:#c0c5ce;">#define EV_TIMEOUT      0x01
</span><span style="color:#c0c5ce;">#define EV_READ         0x02
</span><span style="color:#c0c5ce;">#define EV_WRITE        0x04
</span><span style="color:#c0c5ce;">#define EV_SIGNAL       0x08
</span><span style="color:#c0c5ce;">#define EV_PERSIST      0x10
</span><span style="color:#c0c5ce;">#define EV_ET           0x20
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">typedef void (*event_callback_fn)(evutil_socket_t, short, void *);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">struct event *event_new(struct event_base *base, evutil_socket_t fd,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">short what, event_callback_fn cb,
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">void *arg);
</span><span style="color:#c0c5ce;">int event_base_once(struct event_base *, evutil_socket_t, short,
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">void (*)(evutil_socket_t, short, void *), void *, const struct timeval *);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">void event_free(struct event *event);
</span></pre>
<p><code>event_new</code>
ä¸­çš„å‚æ•°cbæ˜¯ç›®æ ‡callbackï¼Œåœ¨å¯¹åº”çš„eventè¢«è§¦å‘ä½¿ä¼šè¢«è°ƒç”¨ï¼Œå‚æ•°fdï¼Œè¢«è§¦å‘çš„äº‹ä»¶ç±»å‹å’Œargä¼šè¢«ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p>
<p>è°ƒç”¨ <code>event_new()</code> ä¹‹åçš„eventæ˜¯initializedå’Œnon-pendingçš„ã€‚</p>
<p>å¦‚æœæƒ³å°†è¦åˆ›å»ºçš„eventä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥callbackä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>void *event_self_cbarg();</code> çš„trickï¼š<code>event_new(base, -1, EV_PERSIST, cb_func, event_self_cbarg());</code>ã€‚</p>
<h3 id="ding-shi-shi-jian"><a class="zola-anchor" href="#ding-shi-shi-jian" aria-label="Anchor link for: ding-shi-shi-jian">ğŸ”—</a>
å®šæ—¶äº‹ä»¶</h3>
<p>libeventæä¾›äº†ä¸€ç³»åˆ—çš„è¾…åŠ©å‡½æ•°ç®€åŒ–å®šæ—¶äº‹ä»¶çš„åˆ›å»ºã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">#define evtimer_new(base, callback, arg) \
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">event_new((base), -1, 0, (callback), (arg))
</span><span style="color:#c0c5ce;">#define evtimer_add(ev, tv) \
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">event_add((ev),(tv))
</span><span style="color:#c0c5ce;">#define evtimer_del(ev) \
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">event_del(ev)
</span><span style="color:#c0c5ce;">#define evtimer_pending(ev, tv_out) \
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">event_pending((ev), EV_TIMEOUT, (tv_out))
</span></pre><h3 id="xin-hao-chu-li-shi-jian"><a class="zola-anchor" href="#xin-hao-chu-li-shi-jian" aria-label="Anchor link for: xin-hao-chu-li-shi-jian">ğŸ”—</a>
ä¿¡å·å¤„ç†äº‹ä»¶</h3>
<p>libeventæä¾›äº†ä¸€ç³»åˆ—çš„è¾…åŠ©å‡½æ•°ç®€åŒ–ä¿¡å·äº‹ä»¶çš„åˆ›å»ºã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">#define </span><span style="color:#8fa1b3;">evsignal_new</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">base</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">signum</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">cb</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">arg</span><span style="color:#c0c5ce;">) \
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">event_new</span><span style="color:#c0c5ce;">(base, signum, EV_SIGNAL|EV_PERSIST, cb, arg)
</span><span style="color:#b48ead;">#define </span><span style="color:#8fa1b3;">evsignal_add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">ev</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">tv</span><span style="color:#c0c5ce;">) \
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">event_add</span><span style="color:#c0c5ce;">((ev),(tv))
</span><span style="color:#b48ead;">#define </span><span style="color:#8fa1b3;">evsignal_del</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">ev</span><span style="color:#c0c5ce;">) \
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">event_del</span><span style="color:#c0c5ce;">(ev)
</span><span style="color:#b48ead;">#define </span><span style="color:#8fa1b3;">evsignal_pending</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">ev</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">what</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">tv_out</span><span style="color:#c0c5ce;">) \
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">event_pending</span><span style="color:#c0c5ce;">((ev), (what), (tv_out))
</span></pre>
<p>ä¸¾ä¾‹ï¼š</p>
<pre style="background-color:#2b303b;">
<span style="color:#bf616a;">evsignal_new</span><span style="color:#c0c5ce;">(base, SIGHUP, sighup_function, </span><span style="color:#d08770;">NULL</span><span style="color:#c0c5ce;">);
</span></pre><h2 id="pending-non-pending"><a class="zola-anchor" href="#pending-non-pending" aria-label="Anchor link for: pending-non-pending">ğŸ”—</a>
Pending & Non-Pending</h2>
<p>pending -&gt; non-pending</p>
<p><code>int event_add(struct event *ev, const struct timeval *tv);</code></p>
<p>å¦‚æœå½“å‰eventå·²ç»æ˜¯pendingäº†ï¼Œä¼šå°è¯•ä¿®æ”¹è¿‡æœŸæ—¶é—´ã€‚</p>
<p>non-pending -&gt; pending</p>
<p><code>int event_del(struct event *ev);</code></p>
<p>å¦‚æœåªæƒ³ä¿®æ”¹eventçš„è¿‡æœŸæ—¶é—´è€Œä¸æ”¹å˜pendingçŠ¶æ€ï¼Œä½¿ç”¨<code>int event_remove_timer(struct event *ev);</code></p>
<h2 id="priority"><a class="zola-anchor" href="#priority" aria-label="Anchor link for: priority">ğŸ”—</a>
Priority</h2>
<p><code>int event_priority_set(struct event *event, int priority);</code></p>
<h2 id="get-event-info"><a class="zola-anchor" href="#get-event-info" aria-label="Anchor link for: get-event-info">ğŸ”—</a>
Get Event Info</h2>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">event_pending</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const struct</span><span style="color:#c0c5ce;"> event *</span><span style="color:#bf616a;">ev</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">short </span><span style="color:#bf616a;">what</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;"> timeval *</span><span style="color:#bf616a;">tv_out</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">#define </span><span style="color:#8fa1b3;">event_get_signal</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">ev</span><span style="color:#c0c5ce;">) </span><span style="color:#65737e;">/* ... */
</span><span style="color:#c0c5ce;">evutil_socket_t </span><span style="color:#8fa1b3;">event_get_fd</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const struct</span><span style="color:#c0c5ce;"> event *</span><span style="color:#bf616a;">ev</span><span style="color:#c0c5ce;">);
</span><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;"> event_base *</span><span style="color:#8fa1b3;">event_get_base</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const struct</span><span style="color:#c0c5ce;"> event *</span><span style="color:#bf616a;">ev</span><span style="color:#c0c5ce;">);
</span><span style="color:#b48ead;">short </span><span style="color:#8fa1b3;">event_get_events</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const struct</span><span style="color:#c0c5ce;"> event *</span><span style="color:#bf616a;">ev</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">event_callback_fn </span><span style="color:#8fa1b3;">event_get_callback</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const struct</span><span style="color:#c0c5ce;"> event *</span><span style="color:#bf616a;">ev</span><span style="color:#c0c5ce;">);
</span><span style="color:#b48ead;">void </span><span style="color:#c0c5ce;">*</span><span style="color:#8fa1b3;">event_get_callback_arg</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const struct</span><span style="color:#c0c5ce;"> event *</span><span style="color:#bf616a;">ev</span><span style="color:#c0c5ce;">);
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">event_get_priority</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const struct</span><span style="color:#c0c5ce;"> event *</span><span style="color:#bf616a;">ev</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">event_get_assignment</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const struct</span><span style="color:#c0c5ce;"> event *</span><span style="color:#bf616a;">event</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;"> event_base **</span><span style="color:#bf616a;">base_out</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">evutil_socket_t *</span><span style="color:#bf616a;">fd_out</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">short </span><span style="color:#c0c5ce;">*</span><span style="color:#bf616a;">events_out</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">event_callback_fn *</span><span style="color:#bf616a;">callback_out</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">void </span><span style="color:#c0c5ce;">**</span><span style="color:#bf616a;">arg_out</span><span style="color:#c0c5ce;">);
</span></pre><h2 id="manually-trigger-a-event"><a class="zola-anchor" href="#manually-trigger-a-event" aria-label="Anchor link for: manually-trigger-a-event">ğŸ”—</a>
Manually Trigger a Event</h2>
<p><code>void event_active(struct event *ev, int what, short ncalls);</code></p>

    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;libevent&#x2F;">#libevent</a>
                    
                </div>
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2018-02-05-jvm-memory-model&#x2F;">â€¹ Jvm Memory Model</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;acl-note&#x2F;">Access Control List â€º</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;even.js" ></script>
      
    </body>

</html>
