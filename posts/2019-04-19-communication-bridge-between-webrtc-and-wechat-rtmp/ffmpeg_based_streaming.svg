<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="439px" preserveAspectRatio="none" style="width:669px;height:439px;" version="1.1" viewBox="0 0 669 439" width="669px" zoomAndPan="magnify"><defs><filter height="300%" id="f1aedunu7g5pzp" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="57" x2="57" y1="40.19" y2="396.998"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="182" x2="182" y1="40.19" y2="396.998"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="325" x2="325" y1="40.19" y2="396.998"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="447" x2="447" y1="40.19" y2="396.998"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="579" x2="579" y1="40.19" y2="396.998"/><rect fill="#FEFECE" filter="url(#f1aedunu7g5pzp)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="15" y="24.3421">WeChat Peer</text><rect fill="#FEFECE" filter="url(#f1aedunu7g5pzp)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="8" y="395.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="15" y="417.3401">WeChat Peer</text><rect fill="#FEFECE" filter="url(#f1aedunu7g5pzp)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="117" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="124" y="24.3421">WebRTC Gateway</text><rect fill="#FEFECE" filter="url(#f1aedunu7g5pzp)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="117" y="395.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="124" y="417.3401">WebRTC Gateway</text><rect fill="#FEFECE" filter="url(#f1aedunu7g5pzp)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="122" x="262" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="269" y="24.3421">Streaming Server</text><rect fill="#FEFECE" filter="url(#f1aedunu7g5pzp)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="122" x="262" y="395.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="269" y="417.3401">Streaming Server</text><rect fill="#FEFECE" filter="url(#f1aedunu7g5pzp)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="398" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="405" y="24.3421">Room Server</text><rect fill="#FEFECE" filter="url(#f1aedunu7g5pzp)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="398" y="395.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="405" y="417.3401">Room Server</text><rect fill="#FEFECE" filter="url(#f1aedunu7g5pzp)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="141" x="507" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="127" x="514" y="24.3421">Transcoding Module</text><rect fill="#FEFECE" filter="url(#f1aedunu7g5pzp)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="141" x="507" y="395.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="127" x="514" y="417.3401">Transcoding Module</text><rect fill="#EEEEEE" filter="url(#f1aedunu7g5pzp)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="654" x="3" y="71.6304"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="657" y1="71.6304" y2="71.6304"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="657" y1="74.6304" y2="74.6304"/><rect fill="#EEEEEE" filter="url(#f1aedunu7g5pzp)" height="24.8808" style="stroke: #000000; stroke-width: 2.0;" width="141" x="259.5" y="60.19"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="265.5" y="77.4999">RTP&amp;RTCP to RTMP</text><polygon fill="#FF0000" points="313,113.0708,323,117.0708,313,121.0708,317,117.0708" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="182" x2="319" y1="117.0708" y2="117.0708"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="189" y="112.3807">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="201" y="112.3807">rtp &amp; rtcp forward</text><polygon fill="#FF0000" points="567.5,143.9516,577.5,147.9516,567.5,151.9516,571.5,147.9516" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="325" x2="573.5" y1="147.9516" y2="147.9516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="332" y="143.2615">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="344" y="143.2615">media demux as RTP</text><polygon fill="#FF0000" points="336,174.8324,326,178.8324,336,182.8324,332,178.8324" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="330" x2="578.5" y1="178.8324" y2="178.8324"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="342" y="174.1423">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="354" y="174.1423">media mux as RTMP</text><polygon fill="#FF0000" points="68.5,205.7132,58.5,209.7132,68.5,213.7132,64.5,209.7132" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="62.5" x2="324" y1="209.7132" y2="209.7132"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="74.5" y="205.0231">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="86.5" y="205.0231">forward out</text><rect fill="#EEEEEE" filter="url(#f1aedunu7g5pzp)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="654" x="3" y="240.0344"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="657" y1="240.0344" y2="240.0344"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="657" y1="243.0344" y2="243.0344"/><rect fill="#EEEEEE" filter="url(#f1aedunu7g5pzp)" height="24.8808" style="stroke: #000000; stroke-width: 2.0;" width="141" x="259.5" y="228.594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="265.5" y="245.9039">RTMP to RTP&amp;RTCP</text><polygon fill="#008000" points="313,281.4748,323,285.4748,313,289.4748,317,285.4748" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="57.5" x2="319" y1="285.4748" y2="285.4748"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="64.5" y="280.7847">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="76.5" y="280.7847">rtmp forward</text><polygon fill="#008000" points="567.5,312.3556,577.5,316.3556,567.5,320.3556,571.5,316.3556" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="325" x2="573.5" y1="316.3556" y2="316.3556"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="332" y="311.6655">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="344" y="311.6655">media demux as RTMP</text><polygon fill="#008000" points="336,343.2364,326,347.2364,336,351.2364,332,347.2364" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="330" x2="578.5" y1="347.2364" y2="347.2364"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="342" y="342.5462">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="354" y="342.5462">media mux as RTP &amp; RTCP</text><polygon fill="#008000" points="193,374.1172,183,378.1172,193,382.1172,189,378.1172" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="187" x2="324" y1="378.1172" y2="378.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="199" y="373.427">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="211" y="373.427">forward out</text><!--
@startuml


participant wechat_peer as "WeChat Peer"
participant webrtc_gateway as "WebRTC Gateway"
participant stream_server as "Streaming Server"
participant room_server as "Room Server"
participant ffmpeg as "Transcoding Module"

== RTP&RTCP to RTMP ==

autonumber
webrtc_gateway -[#red]> stream_server: rtp & rtcp forward
stream_server -[#red]> ffmpeg: media demux as RTP
ffmpeg -[#red]> stream_server: media mux as RTMP
stream_server -[#red]> wechat_peer: forward out

== RTMP to RTP&RTCP ==

autonumber
wechat_peer -[#green]> stream_server: rtmp forward
stream_server -[#green]> ffmpeg: media demux as RTMP
ffmpeg -[#green]> stream_server: media mux as RTP & RTCP
stream_server -[#green]> webrtc_gateway: forward out

@enduml

PlantUML version 1.2018.00(Fri Jan 05 03:42:56 CST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit GraalVM EE 19.2.0
Java Version: 1.8.0_221-b11
Operating System: Linux
OS Version: 5.2.11-arch1-1-ARCH
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>