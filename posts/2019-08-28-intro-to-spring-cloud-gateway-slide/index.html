

<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>wangboâ€™s home &amp; blog - Intro to Spring Cloud Gateway</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">WB Prime</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;about">
                            About
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;github.wangbo.im">
                            Github
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.wangbo.im">WB Prime</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https://www.wangbo.im">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;github.wangbo.im">
                                    Github
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    



<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-08-28-intro-to-spring-cloud-gateway-slide&#x2F;">Intro to Spring Cloud Gateway</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-08-28</span>
            
        </div>
    </header>

    <div class="post-content">
      <p>æœ¬æ–‡åŸºäºåœ¨éƒ¨é—¨å†…çš„ä¸€æ¬¡åˆ†äº«ä¿®æ”¹è€Œæˆï¼Œä¸»è¦ä»‹ç» <a href="https://spring.io/projects/spring-cloud-gateway">Spring Cloud Gateway</a> çš„è¯·æ±‚å¤„ç†æµç¨‹å’Œè£…é…æµç¨‹ã€‚</p>
<p>æ¼”ç¤ºæ–‡æ¡£æ˜¯ä» markdown æ ¼å¼æ–‡æœ¬é€šè¿‡æ ¼å¼è½¬æ¢å·¥å…· <a href="https://pandoc.org/">Pandoc</a> å¼•ç”¨
<a href="https://revealjs.com">Reveal.js</a> è½¬æ¢å¾—åˆ°ï¼Œå¯ä¾›ä¸‹è½½ã€‚</p>
<p>| Downloads            |
| ---                  |
| <a href="https://www.wangbo.im/posts/2019-08-28-intro-to-spring-cloud-gateway-slide/slide.md">Markdown</a> |
| <a href="https://www.wangbo.im/posts/2019-08-28-intro-to-spring-cloud-gateway-slide/slide.html">Slide</a>  |</p>
<p><a name="continue-reading"></a></p>
<h1 id="intro"><a class="zola-anchor" href="#intro" aria-label="Anchor link for: intro">ğŸ”—</a>
Intro</h1>
<h2 id="spring-cloud-gateway"><a class="zola-anchor" href="#spring-cloud-gateway" aria-label="Anchor link for: spring-cloud-gateway">ğŸ”—</a>
Spring Cloud Gateway</h2>
<blockquote>
<p><strong>Spring Cloud Gateway</strong> aims to provide a simple, yet effective way to route to APIs and provide cross cutting concerns to them such as: security, monitoring/metrics, and resiliency.</p>
</blockquote>
<p>ç®€è€Œè¨€ä¹‹ï¼Œ<a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Cloud Gateway</a> æ˜¯ä¸€ä¸ªåŸºäº Java çš„ Api ç½‘å…³ç³»ç»Ÿï¼Œå¼€ç®±å³ç”¨ï¼›å¦‚æœéœ€è¦è‡ªå®šä¹‰ä¹Ÿæ˜¯å¯ä»¥å¿«é€Ÿæå®šã€‚</p>
<p>æ–‡æ¡£åœ°å€ï¼š<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/">Documentation 2.1.0 Current GA</a></p>
<h2 id="pom"><a class="zola-anchor" href="#pom" aria-label="Anchor link for: pom">ğŸ”—</a>
pom</h2>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">dependencies</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">dependency</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">      </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">groupId</span><span style="color:#c0c5ce;">&gt;org.springframework.cloud&lt;/</span><span style="color:#bf616a;">groupId</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">      </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">artifactId</span><span style="color:#c0c5ce;">&gt;spring-cloud-starter-gateway&lt;/</span><span style="color:#bf616a;">artifactId</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">&lt;/</span><span style="color:#bf616a;">dependency</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">&lt;/</span><span style="color:#bf616a;">dependencies</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">dependencyManagement</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">dependencies</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">      </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">dependency</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">groupId</span><span style="color:#c0c5ce;">&gt;org.springframework.boot&lt;/</span><span style="color:#bf616a;">groupId</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">artifactId</span><span style="color:#c0c5ce;">&gt;spring-boot-dependencies&lt;/</span><span style="color:#bf616a;">artifactId</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">version</span><span style="color:#c0c5ce;">&gt;${spring-boot.version}&lt;/</span><span style="color:#bf616a;">version</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">&gt;pom&lt;/</span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">scope</span><span style="color:#c0c5ce;">&gt;import&lt;/</span><span style="color:#bf616a;">scope</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">      </span><span style="color:#c0c5ce;">&lt;/</span><span style="color:#bf616a;">dependency</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">      </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">dependency</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">groupId</span><span style="color:#c0c5ce;">&gt;org.springframework.cloud&lt;/</span><span style="color:#bf616a;">groupId</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">artifactId</span><span style="color:#c0c5ce;">&gt;spring-cloud-dependencies&lt;/</span><span style="color:#bf616a;">artifactId</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">version</span><span style="color:#c0c5ce;">&gt;${spring-cloud.version}&lt;/</span><span style="color:#bf616a;">version</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">&gt;pom&lt;/</span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">scope</span><span style="color:#c0c5ce;">&gt;import&lt;/</span><span style="color:#bf616a;">scope</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">      </span><span style="color:#c0c5ce;">&lt;/</span><span style="color:#bf616a;">dependency</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">&lt;/</span><span style="color:#bf616a;">dependencies</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">&lt;/</span><span style="color:#bf616a;">dependencyManagement</span><span style="color:#c0c5ce;">&gt;
</span></pre><h2 id="spring-reactor"><a class="zola-anchor" href="#spring-reactor" aria-label="Anchor link for: spring-reactor">ğŸ”—</a>
Spring Reactor</h2>
<p><a href="https://projectreactor.io/">Project Reactor</a> æ˜¯ <a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Gateway</a> çš„åº•å±‚æŠ€æœ¯ã€‚å…¶å·ç§°æ˜¯ä¸€ä¸ª
å¼‚æ­¥ååº”å¼çš„ç¼–ç¨‹æ¨¡å¼ï¼Œç«äº‰è€…æ˜¯å¤§åé¼é¼çš„ <a href="https://github.com/ReactiveX/RxJava">RxJava</a>ã€‚</p>
<blockquote>
<p>Reactor is a fourth-generation Reactive library for building non-blocking applications on the JVM based on the Reactive Streams Specification.</p>
</blockquote>
<ul>
<li><code>Mono&lt;T&gt;</code> ç±»ä¼¼äº <code>CompletableFuture&lt;T&gt;</code>ï¼Œæ”¯æŒå¼‚æ­¥ 0/1 ä¸ªç»“æœæˆ–å¼‚å¸¸çš„è¯­ä¹‰</li>
<li><code>Flux&lt;T&gt;</code> ç±»ä¼¼äº <code>Stream&lt;T&gt;</code>ï¼Œæ”¯æŒå¼‚æ­¥ N ä¸ªç»“æœæˆ–å¼‚å¸¸çš„è¯­ä¹‰</li>
</ul>
<h3 id="mono"><a class="zola-anchor" href="#mono" aria-label="Anchor link for: mono">ğŸ”—</a>
Mono</h3>
<p><em>First</em> æ„å»º</p>
<pre style="background-color:#2b303b;">
<span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Void</span><span style="color:#c0c5ce;">&gt; mono = </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">fromRunnable</span><span style="color:#c0c5ce;">(() </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> dao.</span><span style="color:#bf616a;">update</span><span style="color:#c0c5ce;">(user));
</span></pre>
<p>or</p>
<pre style="background-color:#2b303b;">
<span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">User</span><span style="color:#c0c5ce;">&gt; mono = </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">fromCallable</span><span style="color:#c0c5ce;">(() </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> dao.</span><span style="color:#bf616a;">findById</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1000</span><span style="color:#b48ead;">L</span><span style="color:#c0c5ce;">)</span><span style="background-color:#bf616a;color:#2b303b;">;</span><span style="color:#c0c5ce;">
</span></pre>
<p><em>Then</em> æ‹¼æ¥ä¸è½¬æ¢</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">mono.</span><span style="color:#bf616a;">map</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">user </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> user.</span><span style="color:#bf616a;">getId</span><span style="color:#c0c5ce;">());
</span></pre>
<p>or</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">mono.</span><span style="color:#bf616a;">flatMap</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">user </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> userDao.</span><span style="color:#bf616a;">deleteById</span><span style="color:#c0c5ce;">(user.</span><span style="color:#bf616a;">getId</span><span style="color:#c0c5ce;">())</span><span style="background-color:#bf616a;color:#2b303b;">;</span><span style="color:#c0c5ce;">
</span></pre>
<p><em>Finally</em> å¼‚æ­¥å¤„ç†ç»“æœ</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">mono.</span><span style="color:#bf616a;">subscribe</span><span style="color:#c0c5ce;">(
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">value </span><span style="color:#b48ead;">-&gt; </span><span style="color:#ebcb8b;">System</span><span style="color:#c0c5ce;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#c0c5ce;">(value),
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">ex </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> ex.</span><span style="color:#bf616a;">printStackTrace</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">() </span><span style="color:#b48ead;">-&gt; </span><span style="color:#ebcb8b;">System</span><span style="color:#c0c5ce;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">No data</span><span style="color:#c0c5ce;">&quot;)
</span><span style="color:#c0c5ce;">);
</span></pre><h3 id="flux"><a class="zola-anchor" href="#flux" aria-label="Anchor link for: flux">ğŸ”—</a>
Flux</h3>
<p><em>First</em> æ„å»º</p>
<pre style="background-color:#2b303b;">
<span style="color:#ebcb8b;">Flux</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">User</span><span style="color:#c0c5ce;">&gt; flux = </span><span style="color:#ebcb8b;">Flux</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">create</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">sink </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">final </span><span style="color:#ebcb8b;">User</span><span style="color:#b48ead;">[]</span><span style="color:#c0c5ce;"> users = userDao.</span><span style="color:#bf616a;">findByName</span><span style="color:#c0c5ce;">(name);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(users != </span><span style="color:#d08770;">null</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">User</span><span style="color:#c0c5ce;"> user : users) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">sink.</span><span style="color:#bf616a;">next</span><span style="color:#c0c5ce;">(user);
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">sink.</span><span style="color:#bf616a;">complete</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">} </span><span style="color:#b48ead;">else </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">sink.</span><span style="color:#bf616a;">error</span><span style="color:#c0c5ce;">(
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">IllegalStateException</span><span style="color:#c0c5ce;">(
</span><span style="color:#c0c5ce;">                </span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">Invalid name: </span><span style="color:#c0c5ce;">&quot; + name));
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">});
</span></pre>
<p>or</p>
<pre style="background-color:#2b303b;">
<span style="color:#ebcb8b;">Flux</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">String</span><span style="color:#c0c5ce;">&gt; flux = </span><span style="color:#ebcb8b;">Flux</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">just</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">123</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">456</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">789</span><span style="color:#c0c5ce;">&quot;);
</span></pre>
<p><em>Then</em> æ‹¼æ¥ä¸è½¬æ¢</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">flux.</span><span style="color:#bf616a;">map</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">str </span><span style="color:#b48ead;">-&gt; </span><span style="color:#ebcb8b;">Longs</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">tryParse</span><span style="color:#c0c5ce;">(str));
</span></pre>
<p>or</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">flux.</span><span style="color:#bf616a;">flatMap</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">user </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> userDao.</span><span style="color:#bf616a;">deleteById</span><span style="color:#c0c5ce;">(user.</span><span style="color:#bf616a;">getId</span><span style="color:#c0c5ce;">()));
</span></pre>
<p><em>Finally</em> å¼‚æ­¥å¤„ç†ç»“æœ</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">mono.</span><span style="color:#bf616a;">subscribe</span><span style="color:#c0c5ce;">(
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">value </span><span style="color:#b48ead;">-&gt; </span><span style="color:#ebcb8b;">System</span><span style="color:#c0c5ce;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#c0c5ce;">(value),
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">ex </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> ex.</span><span style="color:#bf616a;">printStackTrace</span><span style="color:#c0c5ce;">(),
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">() </span><span style="color:#b48ead;">-&gt; </span><span style="color:#ebcb8b;">System</span><span style="color:#c0c5ce;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">No data</span><span style="color:#c0c5ce;">&quot;)
</span><span style="color:#c0c5ce;">);
</span></pre><h2 id="webflux"><a class="zola-anchor" href="#webflux" aria-label="Anchor link for: webflux">ğŸ”—</a>
WebFlux</h2>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html" title="WebFlux - Web on Reactive Stack">Spring WebFlux - Web on Reactive Stack</a> æ˜¯ <a href="https://spring.io/">Spring</a> æ¨å‡ºçš„åŸºäº <a href="https://projectreactor.io/">Project Reactor</a> çš„ HTTP ç½‘ç»œå¼€å‘æ¡†æ¶ï¼Œç›¸ä¼¼è€…æ˜¯ <a href="https://vertx.io/docs/vertx-web/java/">Vert.x-Web</a>ã€‚</p>
<blockquote>
<p>fully non-blocking, supports Reactive Streams back pressure, and runs on such servers as Netty, Undertow, and Servlet 3.1+ containers.</p>
<ul>
<li>the Spring WebFlux framework</li>
<li>the reactive WebClient</li>
<li>support for testing</li>
<li>and reactive libraries.</li>
</ul>
</blockquote>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html" title="WebFlux - Web on Reactive Stack">WebFlux</a> è¢«è®¾è®¡æ¥å–ä»£æˆ–è€…è¯´è¡¥å……åŸæœ‰çš„åŸºäº Servlet çš„ç½‘ç»œæ¡†æ¶ï¼š<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#spring-web">Spring Web MVC - Web on Servlet Stack</a>ã€‚</p>
<p><img src="https://www.wangbo.im/posts/2019-08-28-intro-to-spring-cloud-gateway-slide/spring-mvc-context-hierarchy.png" alt="spring-mvc-dispatcherservlet" /></p>
<p>äºŒè€…çš„å…³ç³»ï¼š</p>
<p><img src="https://www.wangbo.im/posts/2019-08-28-intro-to-spring-cloud-gateway-slide/spring-mvc-vs-webflux.png" alt="spring-webflux-vs-webmvc" /></p>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html" title="WebFlux - Web on Reactive Stack">WebFlux</a> çš„å…¸å‹ä»£ç ï¼š</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">RequestMapping</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/root</span><span style="color:#c0c5ce;">&quot;)
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">RestController
</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">WebFluxTestController </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">GetMapping</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">/user/{id}</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">)
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">Mono</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">UserDto</span><span style="color:#eff1f5;">&gt; </span><span style="color:#8fa1b3;">getUser</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">final </span><span style="color:#ebcb8b;">String </span><span style="color:#bf616a;">id</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Mono</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">just</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Foobar</span><span style="color:#eff1f5;">());
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre><h1 id="gateway"><a class="zola-anchor" href="#gateway" aria-label="Anchor link for: gateway">ğŸ”—</a>
Gateway</h1>
<h2 id="workflow"><a class="zola-anchor" href="#workflow" aria-label="Anchor link for: workflow">ğŸ”—</a>
Workflow</h2>
<p>å®˜æ–¹çš„è¯·æ±‚å¤„ç†æµç¨‹å›¾ï¼š</p>
<p><img src="https://www.wangbo.im/posts/2019-08-28-intro-to-spring-cloud-gateway-slide/spring_cloud_gateway_diagram.png" alt="spring-gateway-architecture" /></p>
<p>ä¸‹é¢æ¥ä»å¯¹è±¡è£…é…(Assembly) å’Œè¯·æ±‚åŒ¹é…(Runtime) çš„è§’åº¦æ¥æ·±å…¥ä¸€ä¸‹ <a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Gateway</a> çš„å†…éƒ¨ä»£ç ã€‚</p>
<h2 id="assembly-httphandlerautoconfiguration"><a class="zola-anchor" href="#assembly-httphandlerautoconfiguration" aria-label="Anchor link for: assembly-httphandlerautoconfiguration">ğŸ”—</a>
Assembly - HttpHandlerAutoConfiguration</h2>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html" title="WebFlux - Web on Reactive Stack">WebFlux</a> åŸºäº Spring çš„ä¼ ç»Ÿå¯¹åº•å±‚çš„ç½‘ç»œå±‚è¿›è¡Œäº†æŠ½è±¡ï¼Œå¯ä»¥æ”¯æŒ Servlet çš„å®ç°å’Œä¸€ä¸ªå†…å»ºçš„
åŸºäº <a href="https://netty.io/">Netty</a> çš„å®ç°ã€‚<a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Gateway</a> é»˜è®¤ä½¿ç”¨åŸºäº Netty çš„å®ç°ã€‚</p>
<p>é¦–å…ˆå®šä½åˆ°ç½‘ç»œæœåŠ¡å™¨ <code>WebServer</code> æ¥å£çš„ Netty å®ç°ç±»ã€‚</p>
<ul>
<li><code>org.springframework.boot.web.embedded.netty.NettyReactiveWebServerFactory#getWebServer</code></li>
<li><code>org.springframework.boot.web.embedded.netty.NettyWebServer#start</code></li>
<li><code>org.springframework.http.server.reactive.ReactorHttpHandlerAdapter#apply</code></li>
<li><code>org.springframework.http.server.reactive.HttpHandler#handle</code></li>
</ul>
<p>å‘ç°è¯·æ±‚çš„å¤„ç†ç±»æ˜¯ <code>HttpHandler</code> ç±»ã€‚</p>
<h2 id="assembly-httphandlerautoconfiguration-1"><a class="zola-anchor" href="#assembly-httphandlerautoconfiguration-1" aria-label="Anchor link for: assembly-httphandlerautoconfiguration-1">ğŸ”—</a>
Assembly - HttpHandlerAutoConfiguration</h2>
<p>ç„¶åæ ¹æ® Spring boot å¯åŠ¨é€»è¾‘æ‰¾åˆ° <code>HttpHandler</code> çš„å®ç°ç±»ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">Configuration
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">ConditionalOnClass</span><span style="color:#c0c5ce;">({ </span><span style="color:#ebcb8b;">DispatcherHandler</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">class</span><span style="color:#c0c5ce;">, </span><span style="color:#ebcb8b;">HttpHandler</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">class </span><span style="color:#c0c5ce;">})
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">ConditionalOnWebApplication</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">type </span><span style="color:#c0c5ce;">= </span><span style="color:#ebcb8b;">ConditionalOnWebApplication</span><span style="color:#c0c5ce;">.</span><span style="color:#ebcb8b;">Type</span><span style="color:#c0c5ce;">.</span><span style="color:#d08770;">REACTIVE</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">ConditionalOnMissingBean</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">HttpHandler</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">class</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">AutoConfigureAfter</span><span style="color:#c0c5ce;">({ </span><span style="color:#ebcb8b;">WebFluxAutoConfiguration</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">class </span><span style="color:#c0c5ce;">})
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">AutoConfigureOrder</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">Ordered</span><span style="color:#c0c5ce;">.</span><span style="color:#d08770;">HIGHEST_PRECEDENCE </span><span style="color:#c0c5ce;">+ </span><span style="color:#d08770;">10</span><span style="color:#c0c5ce;">)
</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">HttpHandlerAutoConfiguration </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">Configuration
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static class </span><span style="color:#ebcb8b;">AnnotationConfig </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">private </span><span style="color:#ebcb8b;">ApplicationContext </span><span style="color:#eff1f5;">applicationContext;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">public </span><span style="color:#8fa1b3;">AnnotationConfig</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">ApplicationContext </span><span style="color:#bf616a;">applicationContext</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">            </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.applicationContext </span><span style="color:#c0c5ce;">=</span><span style="color:#eff1f5;"> applicationContext;
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">Bean
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">HttpHandler </span><span style="color:#8fa1b3;">httpHandler</span><span style="color:#eff1f5;">() {
</span><span style="color:#eff1f5;">            </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">WebHttpHandlerBuilder</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">applicationContext</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.applicationContext).</span><span style="color:#bf616a;">build</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre>
<p>å®šä½åˆ° <code>WebHttpHandlerBuilder</code> ç±»ï¼Œä¸‹ä¸€æ­¥éœ€è¦å»çœ‹çœ‹å…¶ <code>build()</code> æ–¹æ³•é‡Œé¢çš„ä»£ç ã€‚</p>
<h2 id="assembly-webhttphandlerbuilder"><a class="zola-anchor" href="#assembly-webhttphandlerbuilder" aria-label="Anchor link for: assembly-webhttphandlerbuilder">ğŸ”—</a>
Assembly - WebHttpHandlerBuilder</h2>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public static final </span><span style="color:#ebcb8b;">String </span><span style="color:#d08770;">WEB_HANDLER_BEAN_NAME </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">webHandler</span><span style="color:#c0c5ce;">&quot;;
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">private </span><span style="color:#bf616a;">WebHttpHandlerBuilder</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">WebHandler</span><span style="color:#c0c5ce;"> webHandler, @</span><span style="color:#ebcb8b;">Nullable ApplicationContext</span><span style="color:#c0c5ce;"> applicationContext) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.webHandler = webHandler; </span><span style="color:#65737e;">// HERE
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.applicationContext = applicationContext;
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">public static </span><span style="color:#ebcb8b;">WebHttpHandlerBuilder </span><span style="color:#bf616a;">applicationContext</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">ApplicationContext</span><span style="color:#c0c5ce;"> context) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">WebHttpHandlerBuilder</span><span style="color:#c0c5ce;"> builder = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">WebHttpHandlerBuilder</span><span style="color:#c0c5ce;">(
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">context.</span><span style="color:#bf616a;">getBean</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">WEB_HANDLER_BEAN_NAME</span><span style="color:#c0c5ce;">, </span><span style="color:#ebcb8b;">WebHandler</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">class</span><span style="color:#c0c5ce;">), context); </span><span style="color:#65737e;">// HERE
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// ...
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> builder;
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">HttpHandler </span><span style="color:#bf616a;">build</span><span style="color:#c0c5ce;">() {
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">WebHandler</span><span style="color:#c0c5ce;"> decorated = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">FilteringWebHandler</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.webHandler, </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.filters); </span><span style="color:#65737e;">// HERE
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">decorated = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ExceptionHandlingWebHandler</span><span style="color:#c0c5ce;">(decorated,  </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.exceptionHandlers); </span><span style="color:#65737e;">// HERE
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">HttpWebHandlerAdapter</span><span style="color:#c0c5ce;"> adapted = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">HttpWebHandlerAdapter</span><span style="color:#c0c5ce;">(decorated); </span><span style="color:#65737e;">//HERE
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// ...
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> adapted;
</span><span style="color:#c0c5ce;">}
</span></pre>
<p>æ‰¾åˆ°äº†æ¯”è¾ƒå…³é”®çš„ <code>HttpWebHandlerAdapter</code> ç±»å’Œ <code>FilteringWebHandler</code> ç±»ã€‚</p>
<h2 id="assembly-httpwebhandleradapter"><a class="zola-anchor" href="#assembly-httpwebhandleradapter" aria-label="Anchor link for: assembly-httpwebhandleradapter">ğŸ”—</a>
Assembly - HttpWebHandlerAdapter</h2>
<p>å‘ç° <code>HttpWebHandlerAdapter</code> ç±»çš„é€»è¾‘å°±æ˜¯æŠŠè¯·æ±‚è½¬ç»™äº† <code>FilteringWebHandler</code> ç±»ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Void</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">handle</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">ServerHttpRequest</span><span style="color:#c0c5ce;"> request, </span><span style="color:#ebcb8b;">ServerHttpResponse</span><span style="color:#c0c5ce;"> response) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// ...
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">getDelegate</span><span style="color:#c0c5ce;">().</span><span style="color:#bf616a;">handle</span><span style="color:#c0c5ce;">(exchange) </span><span style="color:#65737e;">// HERE
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">doOnSuccess</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">aVoid </span><span style="color:#b48ead;">-&gt; </span><span style="color:#bf616a;">logResponse</span><span style="color:#c0c5ce;">(exchange))
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">onErrorResume</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">ex </span><span style="color:#b48ead;">-&gt; </span><span style="color:#bf616a;">handleUnresolvedError</span><span style="color:#c0c5ce;">(exchange, ex))
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">then</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">defer</span><span style="color:#c0c5ce;">(response::</span><span style="color:#bf616a;">setComplete</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">}
</span></pre><h2 id="assembly-exceptionhandlingwebhandler"><a class="zola-anchor" href="#assembly-exceptionhandlingwebhandler" aria-label="Anchor link for: assembly-exceptionhandlingwebhandler">ğŸ”—</a>
Assembly - ExceptionHandlingWebHandler</h2>
<p>è¿™æ˜¯ <code>WebHttpHandlerBuilder#build()</code> é‡Œé¢å‘ç°çš„ <code>ExceptionHandlingWebHandler</code> ç±»ï¼Œå¯ä»¥ä¸ç”¨é‡ç‚¹å…³æ³¨ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">Override
</span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Void</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">handle</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">ServerWebExchange</span><span style="color:#c0c5ce;"> exchange) {
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Void</span><span style="color:#c0c5ce;">&gt; completion;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">try </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">completion = </span><span style="color:#bf616a;">super</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">handle</span><span style="color:#c0c5ce;">(exchange); </span><span style="color:#65737e;">// HERE
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">} </span><span style="color:#b48ead;">catch </span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">Throwable </span><span style="color:#bf616a;">ex</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">completion = </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">error</span><span style="color:#c0c5ce;">(ex);
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> completion;
</span><span style="color:#c0c5ce;">}
</span></pre><h2 id="assembly-filteringwebhandler"><a class="zola-anchor" href="#assembly-filteringwebhandler" aria-label="Anchor link for: assembly-filteringwebhandler">ğŸ”—</a>
Assembly - FilteringWebHandler</h2>
<p>é‡ç‚¹çœ‹ä¸€ä¸‹ <code>FilteringWebHandler</code> ç±»çš„å®ç°ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.chain = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">DefaultWebFilterChain</span><span style="color:#c0c5ce;">(handler, filters); </span><span style="color:#65737e;">// HERE
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">Override
</span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Void</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">handle</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">ServerWebExchange</span><span style="color:#c0c5ce;"> exchange) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.chain.</span><span style="color:#bf616a;">filter</span><span style="color:#c0c5ce;">(exchange);
</span><span style="color:#c0c5ce;">}
</span></pre>
<p>é‡Œé¢æŠŠè¯·æ±‚è½¬ç»™äº† <code>DefaultWebFilterChain</code> ç±»ï¼Œè¿™ä¸ªç±»ä¸€å¬å°±æ˜¯ä¸€ä¸ªç±»ä¼¼è´£ä»»é“¾çš„è®¾è®¡ã€‚</p>
<h2 id="assembly-defaultwebfilterchain"><a class="zola-anchor" href="#assembly-defaultwebfilterchain" aria-label="Anchor link for: assembly-defaultwebfilterchain">ğŸ”—</a>
Assembly - DefaultWebFilterChain</h2>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">Override
</span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Void</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">filter</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">ServerWebExchange</span><span style="color:#c0c5ce;"> exchange) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">defer</span><span style="color:#c0c5ce;">(() </span><span style="color:#b48ead;">-&gt;
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.currentFilter != </span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">&amp;&amp; </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.next != </span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">?
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.currentFilter.</span><span style="color:#bf616a;">filter</span><span style="color:#c0c5ce;">(exchange, </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.next) :
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.handler.</span><span style="color:#bf616a;">handle</span><span style="color:#c0c5ce;">(exchange));
</span><span style="color:#c0c5ce;">}
</span></pre>
<p>è¿™é‡Œé¢åˆåšäº†ä¸€å±‚å°è£…ï¼Œä¼šè°ƒç”¨åˆ° <code>DispatcherHandler</code> ç±»çš„å®ç°é€»è¾‘ã€‚</p>
<h2 id="assembly-webfluxconfigurationsupport"><a class="zola-anchor" href="#assembly-webfluxconfigurationsupport" aria-label="Anchor link for: assembly-webfluxconfigurationsupport">ğŸ”—</a>
Assembly - WebFluxConfigurationSupport</h2>
<p><code>DispatcherHandler</code> ç±»åœ¨ <code>org.springframework.web.reactive.config.WebFluxConfigurationSupport</code> ä¸­è¢«
è‡ªåŠ¨æ³¨å†Œã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">Bean
</span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">DispatcherHandler </span><span style="color:#bf616a;">webHandler</span><span style="color:#c0c5ce;">() {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return new </span><span style="color:#ebcb8b;">DispatcherHandler</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">}
</span></pre><h2 id="assembly-dispatcherhandler"><a class="zola-anchor" href="#assembly-dispatcherhandler" aria-label="Anchor link for: assembly-dispatcherhandler">ğŸ”—</a>
Assembly - DispatcherHandler</h2>
<p>è¿™ä¸ª <code>org.springframework.web.reactive.DispatcherHandler</code> åˆåšäº†ä¸€å±‚å°è£…ï¼Œåº•ä¸‹æ˜¯ä¸€ç³»åˆ—çš„
<code>HandlerMapping</code> ç±»çš„å®ç°ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">protected</span><span style="color:#c0c5ce;"> void </span><span style="color:#bf616a;">initStrategies</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">ApplicationContext</span><span style="color:#c0c5ce;"> context) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">Map</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">String</span><span style="color:#c0c5ce;">, </span><span style="color:#ebcb8b;">HandlerMapping</span><span style="color:#c0c5ce;">&gt; mappingBeans = </span><span style="color:#ebcb8b;">BeanFactoryUtils</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">beansOfTypeIncludingAncestors</span><span style="color:#c0c5ce;">(
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">context, </span><span style="color:#ebcb8b;">HandlerMapping</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">class</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">true</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">false</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">HandlerMapping</span><span style="color:#c0c5ce;">&gt; mappings = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#c0c5ce;">&lt;&gt;(mappingBeans.</span><span style="color:#bf616a;">values</span><span style="color:#c0c5ce;">());
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">AnnotationAwareOrderComparator</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">sort</span><span style="color:#c0c5ce;">(mappings);
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.handlerMappings = </span><span style="color:#ebcb8b;">Collections</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">unmodifiableList</span><span style="color:#c0c5ce;">(mappings);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">Override
</span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Void</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">handle</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">ServerWebExchange</span><span style="color:#c0c5ce;"> exchange) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.handlerMappings == </span><span style="color:#d08770;">null</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">createNotFoundError</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Flux</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">fromIterable</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.handlerMappings)
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">concatMap</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">mapping </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> mapping.</span><span style="color:#bf616a;">getHandler</span><span style="color:#c0c5ce;">(exchange))
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">next</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">switchIfEmpty</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">createNotFoundError</span><span style="color:#c0c5ce;">())
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">flatMap</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">handler </span><span style="color:#b48ead;">-&gt; </span><span style="color:#bf616a;">invokeHandler</span><span style="color:#c0c5ce;">(exchange, handler))
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">flatMap</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">result </span><span style="color:#b48ead;">-&gt; </span><span style="color:#bf616a;">handleResult</span><span style="color:#c0c5ce;">(exchange, result));
</span><span style="color:#c0c5ce;">}
</span></pre><h2 id="assembly-routepredicatehandlermapping"><a class="zola-anchor" href="#assembly-routepredicatehandlermapping" aria-label="Anchor link for: assembly-routepredicatehandlermapping">ğŸ”—</a>
Assembly - RoutePredicateHandlerMapping</h2>
<p><code>HandlerMapping</code> ä¹Ÿæ˜¯é€šè¿‡ Spring è‡ªåŠ¨ç®¡ç†çš„ï¼Œå…¶å®ç°ç±»æ˜¯ <code>org.springframework.cloud.gateway.handler.RoutePredicateHandlerMapping</code>ã€‚</p>
<p>è£…é…ä»£ç åœ¨ <code>org.springframework.cloud.gateway.config.GatewayAutoConfiguration</code> ä¸­ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">Configuration
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">ConditionalOnProperty</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">name </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">spring.cloud.gateway.enabled</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#bf616a;">matchIfMissing </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">true</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">EnableConfigurationProperties
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">AutoConfigureBefore</span><span style="color:#c0c5ce;">({ </span><span style="color:#ebcb8b;">HttpHandlerAutoConfiguration</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">class</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#ebcb8b;">WebFluxAutoConfiguration</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">class </span><span style="color:#c0c5ce;">})
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">AutoConfigureAfter</span><span style="color:#c0c5ce;">({ </span><span style="color:#ebcb8b;">GatewayLoadBalancerClientAutoConfiguration</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">class</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#ebcb8b;">GatewayClassPathWarningAutoConfiguration</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">class </span><span style="color:#c0c5ce;">})
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">ConditionalOnClass</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">DispatcherHandler</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">class</span><span style="color:#c0c5ce;">)
</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">GatewayAutoConfiguration </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">Bean
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">RoutePredicateHandlerMapping </span><span style="color:#8fa1b3;">routePredicateHandlerMapping</span><span style="color:#eff1f5;">(
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">FilteringWebHandler </span><span style="color:#bf616a;">webHandler</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">RouteLocator </span><span style="color:#bf616a;">routeLocator</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">GlobalCorsProperties </span><span style="color:#bf616a;">globalCorsProperties</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">Environment </span><span style="color:#bf616a;">environment</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return new </span><span style="color:#ebcb8b;">RoutePredicateHandlerMapping</span><span style="color:#eff1f5;">(webHandler, routeLocator,
</span><span style="color:#eff1f5;">                </span><span style="color:#eff1f5;">globalCorsProperties, environment);
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">Bean
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">Primary
</span><span style="color:#eff1f5;">    </span><span style="color:#65737e;">// TODO: property to disable composite?
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">RouteLocator </span><span style="color:#8fa1b3;">cachedCompositeRouteLocator</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">RouteLocator</span><span style="color:#eff1f5;">&gt; </span><span style="color:#bf616a;">routeLocators</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return new </span><span style="color:#ebcb8b;">CachingRouteLocator</span><span style="color:#eff1f5;">(
</span><span style="color:#eff1f5;">                </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">CompositeRouteLocator</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">Flux</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">fromIterable</span><span style="color:#eff1f5;">(routeLocators)));
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">Bean
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">FilteringWebHandler </span><span style="color:#8fa1b3;">filteringWebHandler</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">GlobalFilter</span><span style="color:#eff1f5;">&gt; </span><span style="color:#bf616a;">globalFilters</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return new </span><span style="color:#ebcb8b;">FilteringWebHandler</span><span style="color:#eff1f5;">(globalFilters);
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre>
<p><code>GatewayAutoConfiguration</code> è¿™ä¸ªè£…é…ç±»é‡Œé¢è¿˜æä¾›äº† <code>RouteLocator</code> å’Œ <code>FilteringWebHandler</code> çš„å®ç°ï¼Œè¿™
ä¸ªåé¢ä¼šç”¨åˆ°ã€‚</p>
<h2 id="runtime-routepredicatehandlermapping"><a class="zola-anchor" href="#runtime-routepredicatehandlermapping" aria-label="Anchor link for: runtime-routepredicatehandlermapping">ğŸ”—</a>
Runtime - RoutePredicateHandlerMapping</h2>
<p><code>RoutePredicateHandlerMapping</code> ä¸­é¦–å…ˆä» <code>org.springframework.cloud.gateway.route.RouteLocator</code> ä¸­å»
è·å–å½“å‰æ‰€æœ‰å¯ç”¨çš„ <code>Route</code> å®ä¾‹å¹¶æ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½åŒ¹é…å½“å‰è¯·æ±‚çš„ <code>Route</code> æ”¾åˆ°è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œç„¶åè°ƒç”¨ <code>org.springframework.cloud.gateway.handler.FilteringWebHandler</code> é‡Œé¢çš„ä»£ç ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">protected </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Route</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">lookupRoute</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">ServerWebExchange</span><span style="color:#c0c5ce;"> exchange) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.routeLocator.</span><span style="color:#bf616a;">getRoutes</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// individually filter routes so that filterWhen error delaying is not a
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// problem
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">concatMap</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">route </span><span style="color:#b48ead;">-&gt; </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">just</span><span style="color:#c0c5ce;">(route).</span><span style="color:#bf616a;">filterWhen</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">r </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">            </span><span style="color:#65737e;">// add the current route we are testing
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">exchange.</span><span style="color:#bf616a;">getAttributes</span><span style="color:#c0c5ce;">().</span><span style="color:#bf616a;">put</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">GATEWAY_PREDICATE_ROUTE_ATTR</span><span style="color:#c0c5ce;">, r.</span><span style="color:#bf616a;">getId</span><span style="color:#c0c5ce;">());
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> r.</span><span style="color:#bf616a;">getPredicate</span><span style="color:#c0c5ce;">().</span><span style="color:#bf616a;">apply</span><span style="color:#c0c5ce;">(exchange);
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">})
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// ...
</span><span style="color:#c0c5ce;">}
</span></pre>
<p><code>RouteLocator</code> çš„é€»è¾‘åé¢å†è®²ï¼Œå…ˆçœ‹çœ‹ <code>FilteringWebHandler</code> çš„é€»è¾‘ã€‚</p>
<h2 id="runtime-filteringwebhandler"><a class="zola-anchor" href="#runtime-filteringwebhandler" aria-label="Anchor link for: runtime-filteringwebhandler">ğŸ”—</a>
Runtime - FilteringWebHandler</h2>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Void</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">handle</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">ServerWebExchange</span><span style="color:#c0c5ce;"> exchange) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">Route</span><span style="color:#c0c5ce;"> route = exchange.</span><span style="color:#bf616a;">getRequiredAttribute</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">GATEWAY_ROUTE_ATTR</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">List</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">GatewayFilter</span><span style="color:#c0c5ce;">&gt; gatewayFilters = route.</span><span style="color:#bf616a;">getFilters</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">List</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">GatewayFilter</span><span style="color:#c0c5ce;">&gt; combined = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#c0c5ce;">&lt;&gt;(</span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.globalFilters);
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">combined.</span><span style="color:#bf616a;">addAll</span><span style="color:#c0c5ce;">(gatewayFilters);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">AnnotationAwareOrderComparator</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">sort</span><span style="color:#c0c5ce;">(combined);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return new </span><span style="color:#ebcb8b;">DefaultGatewayFilterChain</span><span style="color:#c0c5ce;">(combined).</span><span style="color:#bf616a;">filter</span><span style="color:#c0c5ce;">(exchange);
</span><span style="color:#c0c5ce;">}
</span></pre>
<p><code>FilteringWebHandler</code> ä¸­é¦–å…ˆä»è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¸­å–å‡ºåŒ¹é…åˆ°çš„ <code>Route</code> å®ä¾‹ï¼Œå°†å®ä¾‹é‡Œé¢çš„ <code>GatewayFilter</code>
åˆ—è¡¨å’Œå…¨å±€çš„ <code>GlobalFilter</code> åˆ—è¡¨åˆå¹¶æ’åºåæ”¾å…¥ <code>DefaultGatewayFilterChain</code> ï¼ˆåˆæ˜¯ä¸€ä¸ªè´£ä»»é“¾ï¼‰ä¸­è¿›è¡Œ
é“¾å¼å¤„ç†ã€‚</p>
<h2 id="runtime-defaultwebfilterchain"><a class="zola-anchor" href="#runtime-defaultwebfilterchain" aria-label="Anchor link for: runtime-defaultwebfilterchain">ğŸ”—</a>
Runtime - DefaultWebFilterChain</h2>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Void</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">filter</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">ServerWebExchange</span><span style="color:#c0c5ce;"> exchange) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">defer</span><span style="color:#c0c5ce;">(() </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.index &lt; filters.</span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">()) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#ebcb8b;">GatewayFilter</span><span style="color:#c0c5ce;"> filter = filters.</span><span style="color:#bf616a;">get</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.index);
</span><span style="color:#c0c5ce;">            </span><span style="color:#ebcb8b;">DefaultGatewayFilterChain</span><span style="color:#c0c5ce;"> chain = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">DefaultGatewayFilterChain</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">                    </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.index + </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> filter.</span><span style="color:#bf616a;">filter</span><span style="color:#c0c5ce;">(exchange, chain);
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">else </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Mono</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">empty</span><span style="color:#c0c5ce;">(); </span><span style="color:#65737e;">// complete
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">});
</span><span style="color:#c0c5ce;">}
</span></pre>
<p><code>DefaultGatewayFilterChain</code> é‡Œé¢ç»´æŠ¤äº†ä¸€ä¸ª <code>GatewayFilter</code> çš„é›†åˆå’Œä¸€ä¸ªæ ‡è¯†å½“å‰æ­£åœ¨å¤„ç†çš„å…ƒç´ çš„ç´¢å¼•
ï¼Œæ¯æ¬¡è°ƒç”¨åˆ°ä¸€ä¸ª <code>GatewayFilter</code> å…ƒç´ çš„å¤„ç†é€»è¾‘æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‡å‘å¾ªæˆé¢å…ƒç´ çš„é“¾ï¼Œä»¥ä¸å¯å˜æ€§ä¿è¯çº¿ç¨‹
å®‰å…¨ã€‚</p>
<h1 id="routes"><a class="zola-anchor" href="#routes" aria-label="Anchor link for: routes">ğŸ”—</a>
Routes</h1>
<p><a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Gateway</a> å‘å¤–æš´éœ²å‡ºæ¥çš„å¯¹è±¡ä¹‹ä¸€æ˜¯è·¯ç”±(Route) å¯¹è±¡ï¼Œå…¶æ ¹æ®ä¸€ä¸ªæˆ–è€…ä¸€ç³»åˆ—çš„æ¡ä»¶æ¥åˆ¤æ–­
æ¥æ”¶åˆ°çš„è¯·æ±‚æ˜¯å¦èƒ½è¢«æœ¬è·¯ç”±å¤„ç†ï¼Œå¦‚æœèƒ½å¤Ÿå¤„ç†ï¼Œåˆ™ä½¿ç”¨å†…ç½®çš„ä¸€ç³»åˆ—å±€éƒ¨è¿‡æ»¤å™¨å’Œå…¨å±€çš„è¿‡æ»¤å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚</p>
<h2 id="class-route"><a class="zola-anchor" href="#class-route" aria-label="Anchor link for: class-route">ğŸ”—</a>
Class Route</h2>
<p>Route ç±»çš„å…¨ç§°æ˜¯ <code>org.springframework.cloud.gateway.route.Route</code>ï¼Œæ˜¯ <a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Gateway</a> æš´éœ²
å‡ºæ¥çš„å¤„ç†è¯·æ±‚çš„åŸºæœ¬å•å…ƒã€‚</p>
<p>ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">Route </span><span style="color:#b48ead;">implements </span><span style="color:#a3be8c;">Ordered </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private final </span><span style="color:#ebcb8b;">String </span><span style="color:#eff1f5;">id;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private final </span><span style="color:#ebcb8b;">URI </span><span style="color:#eff1f5;">uri;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private final int </span><span style="color:#eff1f5;">order;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private final </span><span style="color:#ebcb8b;">AsyncPredicate</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">ServerWebExchange</span><span style="color:#eff1f5;">&gt; predicate;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private final </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">GatewayFilter</span><span style="color:#eff1f5;">&gt; gatewayFilters;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#65737e;">// ...
</span><span style="color:#eff1f5;">}
</span></pre>
<p>ä¸»è¦æˆå‘˜æ˜¯ä¸€ä¸ªè¯·æ±‚çš„åˆ¤å®šå™¨ <code>predicate</code>ã€å¤šä¸ªå¤„ç†å™¨ <code>gatewayFilters</code>ã€ä¸€ä¸ªåç«¯è®¿é—®åœ°å€ <code>uri</code>ï¼Œä»¥åŠä¸€
ä¸ªå”¯ä¸€æ ‡è¯†å’Œåºå·ã€‚</p>
<h2 id="interface-routelocator"><a class="zola-anchor" href="#interface-routelocator" aria-label="Anchor link for: interface-routelocator">ğŸ”—</a>
Interface RouteLocator</h2>
<p><a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Gateway</a> é€šè¿‡ <code>org.springframework.cloud.gateway.route.RouteLocator</code> æ¥è¿›è¡Œæ‰€æœ‰è·¯ç”±
å¯¹è±¡çš„åŠ è½½ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public interface </span><span style="color:#ebcb8b;">RouteLocator </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#ebcb8b;">Flux</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">Route</span><span style="color:#eff1f5;">&gt; </span><span style="color:#8fa1b3;">getRoutes</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">}
</span></pre><h2 id="routelocator-implementations"><a class="zola-anchor" href="#routelocator-implementations" aria-label="Anchor link for: routelocator-implementations">ğŸ”—</a>
RouteLocator Implementations</h2>
<p><code>RouteLocator</code> æ¥å£æœ‰ä»¥ä¸‹è‡ªå¸¦å®ç°ï¼š</p>
<ul>
<li><code>org.springframework.cloud.gateway.route.CachingRouteLocator</code></li>
<li><code>org.springframework.cloud.gateway.route.CompositeRouteLocator</code></li>
<li><code>org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator</code></li>
</ul>
<p>åœ¨ <code>GatewayAutoConfiguration</code> ä¸­å¯ä»¥äº†è§£åŠ è½½çš„å®ä¾‹ï¼šç”± <code>RouteDefinitionRouteLocator</code> ç®¡ç†çš„è·¯ç”±å’Œå¤šä¸ªç”±ç¬¬ä¸‰æ–¹è‡ªå·±å®ç°çš„ <code>RouteLocator</code> ç®¡ç†çš„è·¯ç”±è¢« <code>CompositeRouteLocator</code> ç»„åˆèµ·æ¥ä¹‹åçš„ç»“æœå†ç»è¿‡ <code>CachingRouteLocator</code> è¢«ç¼“å­˜ä½¿ç”¨ã€‚</p>
<p><strong>æ‰€æœ‰</strong> èƒ½è¢« Spring æ„ŸçŸ¥åˆ°çš„ <code>org.springframework.cloud.gateway.route.RouteLocator</code> bean å®ä¾‹éƒ½ä¼šè¢«é»˜è®¤æ”¶é›†è¢« <code>CompositeRouteLocator</code> ç®¡ç†ã€‚</p>
<h2 id="routedefinitionroutelocator"><a class="zola-anchor" href="#routedefinitionroutelocator" aria-label="Anchor link for: routedefinitionroutelocator">ğŸ”—</a>
RouteDefinitionRouteLocator</h2>
<p><code>RouteDefinitionLocator</code> ç”¨æ¥ç®¡ç†ååºåˆ—åŒ–ç”Ÿæˆçš„è·¯ç”±ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">Override
</span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">Flux</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Route</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">getRoutes</span><span style="color:#c0c5ce;">() {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">.routeDefinitionLocator.</span><span style="color:#bf616a;">getRouteDefinitions</span><span style="color:#c0c5ce;">().</span><span style="color:#bf616a;">map</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">::</span><span style="color:#bf616a;">convertToRoute</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">map</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">route </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(logger.</span><span style="color:#bf616a;">isDebugEnabled</span><span style="color:#c0c5ce;">()) {
</span><span style="color:#c0c5ce;">                    </span><span style="color:#c0c5ce;">logger.</span><span style="color:#bf616a;">debug</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">RouteDefinition matched: </span><span style="color:#c0c5ce;">&quot; + route.</span><span style="color:#bf616a;">getId</span><span style="color:#c0c5ce;">());
</span><span style="color:#c0c5ce;">                </span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> route;
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">});
</span><span style="color:#c0c5ce;">}
</span></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶ä½¿ç”¨äº† <code>RouteDefinitionLocator</code> æ¥ç®¡ç†è·¯ç”±çš„å®šä¹‰å¯¹è±¡ï¼Œå¹¶æä¾›äº†è·¯ç”±å®šä¹‰å¯¹è±¡åˆ°è·¯ç”±å¯¹è±¡çš„è½¬
æ¢ã€‚</p>
<p><code>RouteDefinitionLocator</code> çš„è®¾è®¡æ¨¡å¼ä¸ <code>RouteLocator</code> ç›¸ä¼¼ã€‚</p>
<h2 id="routedefinitionlocator-and-implementations"><a class="zola-anchor" href="#routedefinitionlocator-and-implementations" aria-label="Anchor link for: routedefinitionlocator-and-implementations">ğŸ”—</a>
RouteDefinitionLocator and Implementations</h2>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">package </span><span style="color:#c0c5ce;">org.springframework.cloud.gateway.route;
</span><span style="color:#b48ead;">public interface </span><span style="color:#ebcb8b;">RouteDefinitionLocator </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#ebcb8b;">Flux</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">RouteDefinition</span><span style="color:#eff1f5;">&gt; </span><span style="color:#8fa1b3;">getRouteDefinitions</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">}
</span></pre>
<p><code>RouteDefinitionLocator</code> çš„å®ç°ç±»æœ‰ï¼š</p>
<ul>
<li><code>org.springframework.cloud.gateway.route.CompositeRouteDefinitionLocator</code></li>
<li><code>org.springframework.cloud.gateway.config.PropertiesRouteDefinitionLocator</code></li>
<li><code>org.springframework.cloud.gateway.route.InMemoryRouteDefinitionRepository</code></li>
</ul>
<h2 id="routedefinitionlocator-loading"><a class="zola-anchor" href="#routedefinitionlocator-loading" aria-label="Anchor link for: routedefinitionlocator-loading">ğŸ”—</a>
RouteDefinitionLocator Loading</h2>
<p>ç±»ä¼¼åœ°ï¼Œåœ¨ <code>GatewayAutoConfiguration</code> ä¸­å¯ä»¥æ‰¾åˆ° <code>RouteDefinitionLocator</code> è¢«åŠ è½½ä½¿ç”¨çš„é€»è¾‘ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">Bean
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">Primary
</span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">RouteDefinitionLocator </span><span style="color:#bf616a;">routeDefinitionLocator</span><span style="color:#c0c5ce;">(
</span><span style="color:#c0c5ce;">        </span><span style="color:#ebcb8b;">List</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">RouteDefinitionLocator</span><span style="color:#c0c5ce;">&gt; routeDefinitionLocators) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return new </span><span style="color:#ebcb8b;">CompositeRouteDefinitionLocator</span><span style="color:#c0c5ce;">(
</span><span style="color:#c0c5ce;">            </span><span style="color:#ebcb8b;">Flux</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">fromIterable</span><span style="color:#c0c5ce;">(routeDefinitionLocators));
</span><span style="color:#c0c5ce;">}
</span></pre>
<p><strong>æ‰€æœ‰</strong> èƒ½è¢« Spring æ„ŸçŸ¥åˆ°çš„ <code>org.springframework.cloud.gateway.route.RouteDefinitionLocator</code> bean å®ä¾‹éƒ½ä¼šè¢«é»˜è®¤æ”¶é›†è¢« <code>CompositeRouteDefinitionLocator</code> ç®¡ç†ã€‚</p>
<h2 id="routedefinition"><a class="zola-anchor" href="#routedefinition" aria-label="Anchor link for: routedefinition">ğŸ”—</a>
RouteDefinition</h2>
<p><code>RouteDefinition</code> æ˜¯ <code>Route</code> è·¯ç”±å¯¹è±¡çš„åºåˆ—åŒ–å¯¹è±¡ï¼›ä¸€ä¸ªåˆæ³•çš„ <code>RouteDefinition</code> å¯¹è±¡å¯ä»¥è¢«æ„é€ ä¸ºä¸€ä¸ª
è·¯ç”±å¯¹è±¡ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">RouteDefinition </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">NotEmpty
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#ebcb8b;">String </span><span style="color:#eff1f5;">id </span><span style="color:#c0c5ce;">= </span><span style="color:#ebcb8b;">UUID</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">randomUUID</span><span style="color:#eff1f5;">().</span><span style="color:#bf616a;">toString</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">NotEmpty
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">Valid
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">PredicateDefinition</span><span style="color:#eff1f5;">&gt; predicates </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">&lt;&gt;();
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">Valid
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">FilterDefinition</span><span style="color:#eff1f5;">&gt; filters </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">&lt;&gt;();
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">NotNull
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#ebcb8b;">URI </span><span style="color:#eff1f5;">uri;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private int </span><span style="color:#eff1f5;">order </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#65737e;">// ...
</span><span style="color:#eff1f5;">}
</span></pre>
<p>ä¸ <code>Route</code> ç±»ä¼¼ï¼Œ<code>RouteDefinition</code> çš„ä¸»è¦æˆå‘˜æ˜¯å¤šä¸ªè¯·æ±‚çš„åˆ¤å®šå™¨å®šä¹‰å¯¹è±¡ <code>predicates</code>ã€å¤šä¸ªå¤„ç†å™¨å®šä¹‰å¯¹è±¡ <code>filters</code>ã€ä¸€ä¸ªåç«¯è®¿é—®åœ°å€ <code>uri</code>ï¼Œä»¥åŠä¸€ä¸ªå”¯ä¸€æ ‡è¯†å’Œåºå·ã€‚</p>
<h2 id="route-construction"><a class="zola-anchor" href="#route-construction" aria-label="Anchor link for: route-construction">ğŸ”—</a>
Route Construction</h2>
<p>æ‰€ä»¥ï¼Œ<a href="https://spring.io/projects/spring-cloud-gateway" title="Spring Cloud Gateway">Spring Gateway</a> å®˜æ–¹æä¾›äº†ä¸¤ç§æ–¹å¼ç”Ÿæˆä¸€ä¸ªè·¯ç”±å¯¹è±¡ã€‚</p>
<h3 id="via-routelocatorbuilder-in-java"><a class="zola-anchor" href="#via-routelocatorbuilder-in-java" aria-label="Anchor link for: via-routelocatorbuilder-in-java">ğŸ”—</a>
Via RouteLocatorBuilder in Java</h3>
<p><code>RouteLocatorBuilder</code> å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«ç”¨æ¥æ„å»ºè·¯ç”±å¯¹è±¡ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">Bean
</span><span style="color:#ebcb8b;">RouteLocator </span><span style="color:#bf616a;">constantRouteLocator</span><span style="color:#c0c5ce;">(final </span><span style="color:#ebcb8b;">RouteLocatorBuilder</span><span style="color:#c0c5ce;"> builder) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> builder.</span><span style="color:#bf616a;">routes</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">route</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">demo_lb</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#bf616a;">r </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> r.</span><span style="color:#bf616a;">header</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">XHOST</span><span style="color:#c0c5ce;">&quot;)
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">filters</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">f </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> f.</span><span style="color:#bf616a;">prefixPath</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/search</span><span style="color:#c0c5ce;">&quot;))
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">uri</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">lb://httpbin.org</span><span style="color:#c0c5ce;">&quot;))
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">build</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">}
</span></pre><h3 id="via-routedefinition-in-yaml-properties"><a class="zola-anchor" href="#via-routedefinition-in-yaml-properties" aria-label="Anchor link for: via-routedefinition-in-yaml-properties">ğŸ”—</a>
Via RouteDefinition in YAML/Properties</h3>
<p><code>RouteDefinition</code> å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«ç”¨æ¥ä»å¤–éƒ¨é…ç½®æ–‡ä»¶ (YAML/Properties) æ„å»ºè·¯ç”±å¯¹è±¡ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#bf616a;">spring</span><span style="color:#c0c5ce;">:
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">cloud</span><span style="color:#c0c5ce;">:
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">gateway</span><span style="color:#c0c5ce;">:
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">routes</span><span style="color:#c0c5ce;">:
</span><span style="color:#c0c5ce;">                </span><span style="color:#c0c5ce;">- </span><span style="color:#bf616a;">id</span><span style="color:#c0c5ce;">: </span><span style="color:#a3be8c;">r1
</span><span style="color:#c0c5ce;">                  </span><span style="color:#bf616a;">order</span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">2
</span><span style="color:#c0c5ce;">                  </span><span style="color:#bf616a;">uri</span><span style="color:#c0c5ce;">: &quot;</span><span style="color:#a3be8c;">https://a.com</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#c0c5ce;">                  </span><span style="color:#bf616a;">predicates</span><span style="color:#c0c5ce;">:
</span><span style="color:#c0c5ce;">                      </span><span style="color:#c0c5ce;">- </span><span style="color:#a3be8c;">host=a.org
</span><span style="color:#c0c5ce;">                  </span><span style="color:#bf616a;">filters</span><span style="color:#c0c5ce;">:
</span><span style="color:#c0c5ce;">                      </span><span style="color:#c0c5ce;">- </span><span style="color:#a3be8c;">AddRequestHeader=XHOST,my.a.org
</span><span style="color:#c0c5ce;">                </span><span style="color:#c0c5ce;">- </span><span style="color:#bf616a;">id</span><span style="color:#c0c5ce;">: </span><span style="color:#a3be8c;">r2
</span><span style="color:#c0c5ce;">                  </span><span style="color:#bf616a;">order</span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">1
</span><span style="color:#c0c5ce;">                  </span><span style="color:#bf616a;">uri</span><span style="color:#c0c5ce;">: &quot;</span><span style="color:#a3be8c;">https://b.com</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#c0c5ce;">                  </span><span style="color:#bf616a;">predicates</span><span style="color:#c0c5ce;">:
</span><span style="color:#c0c5ce;">                      </span><span style="color:#c0c5ce;">- </span><span style="color:#a3be8c;">Host=b.org
</span><span style="color:#c0c5ce;">                  </span><span style="color:#bf616a;">filters</span><span style="color:#c0c5ce;">:
</span><span style="color:#c0c5ce;">                      </span><span style="color:#c0c5ce;">- </span><span style="color:#a3be8c;">AddRequestHeader=XHOST,my.b.org
</span></pre><h1 id="predicate"><a class="zola-anchor" href="#predicate" aria-label="Anchor link for: predicate">ğŸ”—</a>
Predicate</h1>
<p>è°“è¯å¯¹è±¡å³è·¯ç”±å¯¹è±¡é‡Œé¢çš„åˆ¤å®šæ¡ä»¶ã€‚</p>
<h2 id="asyncpredicate"><a class="zola-anchor" href="#asyncpredicate" aria-label="Anchor link for: asyncpredicate">ğŸ”—</a>
AsyncPredicate</h2>
<p><code>Route</code> ç±»é‡Œé¢çš„è°“è¯å¯¹è±¡çš„ç±»å‹æ˜¯ <code>AsyncPredicate</code>ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">Route </span><span style="color:#b48ead;">implements </span><span style="color:#a3be8c;">Ordered </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private final </span><span style="color:#ebcb8b;">String </span><span style="color:#eff1f5;">id;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private final </span><span style="color:#ebcb8b;">URI </span><span style="color:#eff1f5;">uri;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private final int </span><span style="color:#eff1f5;">order;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private final </span><span style="color:#ebcb8b;">AsyncPredicate</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">ServerWebExchange</span><span style="color:#eff1f5;">&gt; predicate; </span><span style="color:#65737e;">// HERE
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private final </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">GatewayFilter</span><span style="color:#eff1f5;">&gt; gatewayFilters;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#65737e;">// ...
</span><span style="color:#eff1f5;">}
</span></pre><h2 id="predicatedefinition"><a class="zola-anchor" href="#predicatedefinition" aria-label="Anchor link for: predicatedefinition">ğŸ”—</a>
PredicateDefinition</h2>
<p>ç›¸æ¯” <code>AsyncPredicate</code> ç±»ï¼Œæˆ‘ä»¬æ›´å…³å¿ƒå…¶å¯¹åº”çš„å®šä¹‰ç±» <code>PredicateDefinition</code>ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">PredicateDefinition </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">NotNull
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#ebcb8b;">String </span><span style="color:#eff1f5;">name;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#ebcb8b;">Map</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">&gt; args </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">LinkedHashMap</span><span style="color:#eff1f5;">&lt;&gt;();
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#65737e;">// ...
</span><span style="color:#eff1f5;">}
</span></pre>
<p>ä¸ºäº†ä¿æŒä»£ç ç®€å•ï¼Œå…¶å®šä¹‰è¢«è®¾è®¡ä¸ºä¸€ä¸ªç±»å‹æ ‡è¯†åå’Œä¸€ä¸ª K-V çš„æ˜ å°„è¡¨ã€‚</p>
<h2 id="predicatedefinition-to-asyncpredicate"><a class="zola-anchor" href="#predicatedefinition-to-asyncpredicate" aria-label="Anchor link for: predicatedefinition-to-asyncpredicate">ğŸ”—</a>
PredicateDefinition to AsyncPredicate</h2>
<p><code>PredicateDefinition</code> åˆ° <code>AsyncPredicate</code> çš„è½¬æ¢é€»è¾‘åœ¨ <code>org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator</code> ç±»çš„ <code>lookUp</code> æ–¹æ³•é‡Œé¢ï¼Œå¤§é‡ä½¿ç”¨äº†åå°„çš„æŠ€å·§ã€‚</p>
<p>å…¶ä¸­ï¼Œä½¿ç”¨äº† <code>org.springframework.cloud.gateway.handler.predicate.RoutePredicateFactory</code> ç±»ä½œä¸ºäºŒè€…
è½¬æ¢çš„æ¡¥ã€‚</p>
<h2 id="routepredicatefactory"><a class="zola-anchor" href="#routepredicatefactory" aria-label="Anchor link for: routepredicatefactory">ğŸ”—</a>
RoutePredicateFactory</h2>
<p>è¯¥ç±»å…¨ç§° <code>org.springframework.cloud.gateway.handler.predicate.RoutePredicateFactory&lt;C&gt;</code>ï¼Œæä¾›äº†ä¸€ä¸ª
ç»Ÿä¸€çš„åŸºäº Spring é€šç”¨åå°„æ¨¡å¼çš„è°“è¯æ„é€ å·¥å‚ç±»ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public interface </span><span style="color:#ebcb8b;">RoutePredicateFactory</span><span style="color:#eff1f5;">&lt;</span><span style="color:#bf616a;">C</span><span style="color:#eff1f5;">&gt; </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">ShortcutConfigurable</span><span style="color:#c0c5ce;">, </span><span style="color:#ebcb8b;">Configurable</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">C</span><span style="color:#c0c5ce;">&gt; {
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">AsyncPredicate</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">ServerWebExchange</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">applyAsync</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">Consumer</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">C</span><span style="color:#c0c5ce;">&gt; consumer);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#ebcb8b;">Class</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">C</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">getConfigClass</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">}
</span></pre><h2 id="builtin-predicate-factories"><a class="zola-anchor" href="#builtin-predicate-factories" aria-label="Anchor link for: builtin-predicate-factories">ğŸ”—</a>
Builtin Predicate Factories</h2>
<p>å®˜æ–¹é»˜è®¤æä¾›äº†ä»¥ä¸‹è°“è¯æ„é€ å·¥å‚çš„å®ç°ç±»ï¼Œå¯ä»¥å®ç°å¤šç§ä¸åŒçš„è¯·æ±‚åŒ¹é…èƒ½åŠ›ã€‚</p>
<ul>
<li><code>org.springframework.cloud.gateway.handler.predicate.AfterRoutePredicateFactory</code></li>
<li><code>org.springframework.cloud.gateway.handler.predicate.BeforeRoutePredicateFactory</code></li>
<li><code>org.springframework.cloud.gateway.handler.predicate.BetweenRoutePredicateFactory</code></li>
<li><code>org.springframework.cloud.gateway.handler.predicate.CookieRoutePredicateFactory</code></li>
<li><code>org.springframework.cloud.gateway.handler.predicate.HeaderRoutePredicateFactory</code></li>
<li><code>org.springframework.cloud.gateway.handler.predicate.HostRoutePredicateFactory</code></li>
<li><code>org.springframework.cloud.gateway.handler.predicate.MethodRoutePredicateFactory</code></li>
<li><code>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory</code></li>
<li><code>org.springframework.cloud.gateway.handler.predicate.QueryRoutePredicateFactory</code></li>
<li><code>org.springframework.cloud.gateway.handler.predicate.RemoteAddrRoutePredicateFactory</code></li>
</ul>
<h1 id="filter"><a class="zola-anchor" href="#filter" aria-label="Anchor link for: filter">ğŸ”—</a>
Filter</h1>
<p>è¿‡æ»¤å™¨å¯¹è±¡å³è·¯ç”±å¯¹è±¡ä¸­åŒ¹é…åå¤„ç†é€»è¾‘çš„å°è£…ã€‚</p>
<h2 id="gatewayfilter"><a class="zola-anchor" href="#gatewayfilter" aria-label="Anchor link for: gatewayfilter">ğŸ”—</a>
GatewayFilter</h2>
<p><code>Route</code> ç±»é‡Œé¢çš„è¿‡æ»¤å™¨å¯¹è±¡çš„ç±»å‹æ˜¯ <code>GatewayFilter</code>ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public interface </span><span style="color:#ebcb8b;">GatewayFilter </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">ShortcutConfigurable </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#ebcb8b;">Mono</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">Void</span><span style="color:#eff1f5;">&gt; </span><span style="color:#8fa1b3;">filter</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">ServerWebExchange </span><span style="color:#bf616a;">exchange</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">GatewayFilterChain </span><span style="color:#bf616a;">chain</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">}
</span></pre>
<p>è¯¥ç±»ä¸ä¹‹å‰çš„ <code>DefaultGatewayFilterChain</code> ç±»ç»“åˆèµ·æ¥ï¼Œç»„æˆäº†ä¸€ä¸ªé“¾å¼çš„è¯·æ±‚å¤„ç†æµç¨‹ã€‚</p>
<h2 id="filterdefinition"><a class="zola-anchor" href="#filterdefinition" aria-label="Anchor link for: filterdefinition">ğŸ”—</a>
FilterDefinition</h2>
<p>ç›¸æ¯” <code>FilterDefinition</code> ç±»ï¼Œæˆ‘ä»¬æ›´å…³å¿ƒå…¶å¯¹åº”çš„å®šä¹‰ç±» <code>FilterDefinition</code>ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">FilterDefinition </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">NotNull
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#ebcb8b;">String </span><span style="color:#eff1f5;">name;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#ebcb8b;">Map</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">&gt; args </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">LinkedHashMap</span><span style="color:#eff1f5;">&lt;&gt;();
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#65737e;">// ...
</span><span style="color:#eff1f5;">}
</span></pre>
<p>ä¸ºäº†ä¿æŒä»£ç ç®€å•ï¼Œå…¶å®šä¹‰è¢«è®¾è®¡ä¸ºä¸€ä¸ªç±»å‹æ ‡è¯†åå’Œä¸€ä¸ª K-V çš„æ˜ å°„è¡¨ã€‚</p>
<h2 id="filterdefinition-to-gatewayfilter"><a class="zola-anchor" href="#filterdefinition-to-gatewayfilter" aria-label="Anchor link for: filterdefinition-to-gatewayfilter">ğŸ”—</a>
FilterDefinition to GatewayFilter</h2>
<p>ä»å®šä¹‰ç”Ÿæˆè¿‡æ»¤å™¨å¯¹è±¡çš„é€»è¾‘åœ¨ <code>org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator</code> çš„ <code>loadGatewayFilters</code> æ–¹æ³•ä¸­ã€‚å…¶ä¸­ï¼ŒåŒæ ·ä½¿ç”¨äº† <code>org.springframework.cloud.gateway.handler.predicate.GatewayFilterFactory</code> ç±»ä½œä¸ºäºŒè€…è½¬æ¢çš„æ¡¥ã€‚</p>
<h2 id="gatewayfilterfactory"><a class="zola-anchor" href="#gatewayfilterfactory" aria-label="Anchor link for: gatewayfilterfactory">ğŸ”—</a>
GatewayFilterFactory</h2>
<p><code>org.springframework.cloud.gateway.filter.factory.GatewayFilterFactory&lt;T&gt;</code> çš„è®¾è®¡æ¨¡å¼å’Œä½¿ç”¨æ–¹å¼åŒ
<code>RoutePredicateFactory</code> ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public interface </span><span style="color:#ebcb8b;">GatewayFilterFactory</span><span style="color:#eff1f5;">&lt;</span><span style="color:#bf616a;">C</span><span style="color:#eff1f5;">&gt; </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">ShortcutConfigurable</span><span style="color:#c0c5ce;">, </span><span style="color:#ebcb8b;">Configurable</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">C</span><span style="color:#c0c5ce;">&gt; {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">default </span><span style="color:#ebcb8b;">GatewayFilter </span><span style="color:#bf616a;">apply</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">Consumer</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">C</span><span style="color:#c0c5ce;">&gt; consumer) {
</span><span style="color:#c0c5ce;">        </span><span style="color:#ebcb8b;">C</span><span style="color:#c0c5ce;"> config = </span><span style="color:#bf616a;">newConfig</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">consumer.</span><span style="color:#bf616a;">accept</span><span style="color:#c0c5ce;">(config);
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">apply</span><span style="color:#c0c5ce;">(config);
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">default </span><span style="color:#ebcb8b;">Class</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">C</span><span style="color:#c0c5ce;">&gt; </span><span style="color:#bf616a;">getConfigClass</span><span style="color:#c0c5ce;">() {
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">throw new </span><span style="color:#ebcb8b;">UnsupportedOperationException</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">getConfigClass() not implemented</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">}
</span></pre><h2 id="builtin-filter-factories"><a class="zola-anchor" href="#builtin-filter-factories" aria-label="Anchor link for: builtin-filter-factories">ğŸ”—</a>
Builtin Filter Factories</h2>
<p>å®˜æ–¹é»˜è®¤æä¾›äº†ä»¥ä¸‹è¿‡æ»¤å™¨æ„é€ å·¥å‚çš„å®ç°ç±»ï¼Œå¯ä»¥å®ç°å¤šç§ä¸åŒçš„è¯·æ±‚å¤„ç†èƒ½åŠ›ã€‚</p>
<ul>
<li>AddRequestHeader GatewayFilter Factory</li>
<li>AddRequestParameter GatewayFilter Factory</li>
<li>AddResponseHeader GatewayFilter Factory</li>
<li>Hystrix GatewayFilter Factory</li>
<li>FallbackHeaders GatewayFilter Factory</li>
<li>PrefixPath GatewayFilter Factory</li>
<li>PreserveHostHeader GatewayFilter Factory</li>
<li>RequestRateLimiter GatewayFilter Factory</li>
<li>RedirectTo GatewayFilter Factory</li>
<li>RemoveNonProxyHeaders GatewayFilter Factory</li>
<li>RemoveRequestHeader GatewayFilter Factory</li>
<li>RemoveResponseHeader GatewayFilter Factory</li>
<li>RewritePath GatewayFilter Factory</li>
<li>RewriteResponseHeader GatewayFilter Factory</li>
<li>SaveSession GatewayFilter Factory</li>
<li>SecureHeaders GatewayFilter Factory</li>
<li>SetPath GatewayFilter Factory</li>
<li>SetResponseHeader GatewayFilter Factory</li>
<li>SetStatus GatewayFilter Factory</li>
<li>StripPrefix GatewayFilter Factory</li>
<li>Retry GatewayFilter Factory</li>
<li>RequestSize GatewayFilter Factory</li>
<li>Modify Request Body GatewayFilter Factory</li>
<li>Modify Response Body GatewayFilter Factory</li>
</ul>
<h1 id="global-filter"><a class="zola-anchor" href="#global-filter" aria-label="Anchor link for: global-filter">ğŸ”—</a>
Global Filter</h1>
<p>å…¨å±€è¿‡æ»¤å™¨å¯¹è±¡æ˜¯å¯¹è·¯ç”±åå‘ä»£ç†åˆ°åç«¯èƒ½åŠ›çš„å°è£…ï¼Œå…¶ä¸»è¦é€šè¿‡ URI çš„ scheme æ¥å†³å®šåº”ç”¨çš„é€»è¾‘ï¼›ä¸€èˆ¬æ¥è¯´
ï¼Œä¸åŒçš„ scheme ä¼šæœ‰ä¸åŒçš„å…¨å±€è¿‡æ»¤å™¨å¯¹è±¡æ¥å¤„ç†ã€‚</p>
<p>å½“å‰å®˜æ–¹é»˜è®¤èƒ½æ”¯æŒçš„ scheme æœ‰ï¼š</p>
<ul>
<li>http</li>
<li>https</li>
<li>lb</li>
<li>forward</li>
</ul>
<p>å…¨å±€è¿‡æ»¤å™¨çš„æ¥å£åŒæ™®é€šè¿‡æ»¤å™¨ï¼Œä½†æ²¡æœ‰æä¾›ä»å®šä¹‰ååºåˆ—åŒ–ç”Ÿæˆçš„èƒ½åŠ›ã€‚</p>

    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;gateway&#x2F;">#gateway</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;spring-cloud&#x2F;">#spring cloud</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;route&#x2F;">#route</a>
                    
                </div>
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-21-ffmpeg-vsync-explained&#x2F;">â€¹ Ffmpeg -vsync ä½¿ç”¨åœºæ™¯è¾¨æ</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-08-31-slow-mysql-query-on-too-many-cas-updating-failure&#x2F;">ä¸€æ¬¡ç”±äºçº¿ä¸Š MySQL å¹¶å‘æŠ¢å æ›´æ–°å†²çªå¼•å‘çš„ BUG â€º</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;even.js" ></script>
      
    </body>

</html>
