<!DOCTYPE html>
<html lang="en">
    <head>
    <title>Learning Java Concurrency - synchronized - Elvis Wang</title>
    
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="wangboâ€™s home &amp; blog"/>

    <meta property="og:title" content="
    wangboâ€™s home &amp; blog -&nbsp;Learning Java Concurrency - synchronized" />
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;learning-java-concurrency-synchronized&#x2F;"/>
    <meta property="og:description" content="&lt;p&gt;synchronizedï¼ŒåŒæ­¥æ§åˆ¶å™¨ï¼Œæ˜¯JavaåŸç”Ÿæä¾›çš„å¤šçº¿ç¨‹åŒæ­¥æ§åˆ¶çš„å·¥å…·ï¼Œæ˜¯Javaè¯­æ³•çš„ä¸€éƒ¨åˆ†ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;synchronizedåœ¨è¯­ä¹‰ä¸Šç­‰åŒäºä¸€ä¸ªç‹¬å é”ã€‚synchronizedå¯ä»¥ç”¨æ¥ä¿®é¥°ä¸€ä¸ªæ–¹æ³•ï¼Œæ ‡è¯†è¯¥æ–¹æ³•æ˜¯å¯åŒæ­¥çš„ï¼›ä¹Ÿå¯ä»¥ç”¨æ¥ä¿®é¥°è¯­å¥å—ï¼Œæ ‡è¯†è¯¥è¯­å¥å—æ˜¯åŒæ­¥çš„ã€‚åœ¨ä»£ç ç»è¿‡ç¼–è¯‘ä¹‹åï¼ŒJVMä¼šåœ¨æ–¹æ³•æˆ–è€…è¯­å¥å—çš„å‰åæ’å…¥&lt;coâ€¦"/>
    <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;style.css">
    <link rel="stylesheet" href=" https:&#x2F;&#x2F;www.wangbo.im&#x2F;color&#x2F;orange.css">
    
<link rel="shortcut icon" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;favicon.ico" type="image/x-icon" /></head>
    <body>
        <div class="container full">
<header class="header">
    <div class="header__inner">
        <div class="header__logo">
            <a href="&#x2F;">
    <div class="logo">
        WB Prime
    </div>
</a>
        </div>
        <div class="menu-trigger">menu</div>
    </div>
    
    <nav class="menu">
        <ul class="menu__inner menu__inner--desktop">
            
            
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">About</a>
                    </li>
                
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">Categories</a>
                    </li>
                
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">Tags</a>
                    </li>
                
            </ul>

        <ul class="menu__inner menu__inner--mobile">
            
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">About</a>
        </li>
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">Categories</a>
        </li>
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">Tags</a>
        </li>
        </ul>
    </nav>

    </header>
<div class="content"><div class="post">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;learning-java-concurrency-synchronized&#x2F;">Learning Java Concurrency - synchronized</a>
        </h1>
        
    <div class="post-meta">
        <span class="post-date">2016.04.01
                </span>

        <span class="post-author">
    ::
    Elvis Wang</span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;learning-java-concurrency&#x2F;">Learning Java Concurrency</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;java&#x2F;">java</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;concurrency&#x2F;">concurrency</a>
        
    
            
        
    </div>



        

        <div class="post-content">
            <p>synchronizedï¼ŒåŒæ­¥æ§åˆ¶å™¨ï¼Œæ˜¯JavaåŸç”Ÿæä¾›çš„å¤šçº¿ç¨‹åŒæ­¥æ§åˆ¶çš„å·¥å…·ï¼Œæ˜¯Javaè¯­æ³•çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>synchronizedåœ¨è¯­ä¹‰ä¸Šç­‰åŒäºä¸€ä¸ªç‹¬å é”ã€‚synchronizedå¯ä»¥ç”¨æ¥ä¿®é¥°ä¸€ä¸ªæ–¹æ³•ï¼Œæ ‡è¯†è¯¥æ–¹æ³•æ˜¯å¯åŒæ­¥çš„ï¼›ä¹Ÿå¯ä»¥ç”¨æ¥ä¿®é¥°è¯­å¥å—ï¼Œæ ‡è¯†è¯¥è¯­å¥å—æ˜¯åŒæ­¥çš„ã€‚åœ¨ä»£ç ç»è¿‡ç¼–è¯‘ä¹‹åï¼ŒJVMä¼šåœ¨æ–¹æ³•æˆ–è€…è¯­å¥å—çš„å‰åæ’å…¥<code>monitorenter</code>å’Œ<code>monitorexit</code>çš„è™šæ‹ŸæœºæŒ‡ä»¤ï¼Œè¿™ä¸¤æ¡æŒ‡ä»¤åˆä¼šéšå¼åœ°è°ƒç”¨<code>lock</code>åŸè¯­ã€‚</p>
<p>synchronizedå¯ä»¥ä½¿ç”¨åœ¨æ™®é€šæ–¹æ³•é‡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨é™æ€æ–¹æ³•é‡Œã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Synchronized </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public synchronized void </span><span style="color:#8fa1b3;">method1</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">final </span><span style="color:#ebcb8b;">String </span><span style="color:#bf616a;">val</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">1: Begin add </span><span style="color:#c0c5ce;">&quot; +</span><span style="color:#eff1f5;"> val);
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">1: Finish add </span><span style="color:#c0c5ce;">&quot; +</span><span style="color:#eff1f5;"> val);
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public synchronized static void </span><span style="color:#8fa1b3;">method2</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">final </span><span style="color:#ebcb8b;">String </span><span style="color:#bf616a;">val</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">2: Begin add </span><span style="color:#c0c5ce;">&quot; +</span><span style="color:#eff1f5;"> val);
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">2: Finish add </span><span style="color:#c0c5ce;">&quot; +</span><span style="color:#eff1f5;"> val);
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public void </span><span style="color:#8fa1b3;">method3</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">final </span><span style="color:#ebcb8b;">String </span><span style="color:#bf616a;">val</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">synchronized</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">3: Begin add </span><span style="color:#c0c5ce;">&quot; +</span><span style="color:#eff1f5;"> val);
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">3: Finish add </span><span style="color:#c0c5ce;">&quot; +</span><span style="color:#eff1f5;"> val);
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static void </span><span style="color:#8fa1b3;">method4</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">final </span><span style="color:#ebcb8b;">String </span><span style="color:#bf616a;">val</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">synchronized</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">Synchronized</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">class</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">4: Begin add </span><span style="color:#c0c5ce;">&quot; +</span><span style="color:#eff1f5;"> val);
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">4: Finish add </span><span style="color:#c0c5ce;">&quot; +</span><span style="color:#eff1f5;"> val);
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre><p><a name="continue-reading"></a></p>
<h1 id="dan-li-mo-shi"><a class="zola-anchor" href="#dan-li-mo-shi" aria-label="Anchor link for: dan-li-mo-shi">ğŸ”—</a>
å•ä¾‹æ¨¡å¼</h1>
<p>synchronizedçš„å­¦ä¹ æœ€å¥½ç»“åˆå•ä¾‹æ¨¡å¼æ¥è¿›è¡Œã€‚</p>
<h2 id="version-0"><a class="zola-anchor" href="#version-0" aria-label="Anchor link for: version-0">ğŸ”—</a>
Version 0</h2>
<p>æœ€ç®€å•çš„å•ä¾‹æ¨¡å¼ï¼Œå¯ä»¥è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Singleton0 </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">     </span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static </span><span style="color:#ebcb8b;">Singleton0 </span><span style="color:#eff1f5;">instance_ </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Singleton0</span><span style="color:#eff1f5;">(); </span><span style="color:#65737e;">// init while class loaded
</span><span style="color:#eff1f5;">     </span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#8fa1b3;">Singleton0</span><span style="color:#eff1f5;">(){}
</span><span style="color:#eff1f5;">     </span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static </span><span style="color:#ebcb8b;">Singleton0 </span><span style="color:#8fa1b3;">instance</span><span style="color:#eff1f5;">() {
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return</span><span style="color:#eff1f5;"> instance_;
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre>
<p>æœ¬å•ä¾‹å®ç°ä¼šåœ¨Singleton0ç±»åŠ è½½çš„æ—¶å€™å®ä¾‹åŒ–ã€‚ä½¿æ„é€ å™¨ç§æœ‰æ˜¯ä¸ºäº†ä¿è¯å®ä¾‹å•ä¸€åŒ–ï¼Œä¸å…è®¸å¤–éƒ¨æ„é€ æ–°å®ä¾‹ã€‚å¦‚æœè¦ä½¿ç”¨Javaçš„åºåˆ—åŒ–æœºåˆ¶ï¼Œå¯èƒ½éœ€è¦é¢å¤–çš„ä»£ç ä¿è¯å®ä¾‹çš„å”¯ä¸€æ€§ã€‚å¦‚æœæœ‰å¯èƒ½ç”¨ä¸Šåå°„æ„é€ å¯¹è±¡ï¼Œæœ€ç®€å•çš„åº”å¯¹æ–¹æ³•æ˜¯åœ¨æ„é€ å™¨é‡Œé¢æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<h2 id="version-1-wrong"><a class="zola-anchor" href="#version-1-wrong" aria-label="Anchor link for: version-1-wrong">ğŸ”—</a>
Version 1 (wrong)</h2>
<p>å¦‚æœæƒ³å»¶è¿Ÿåˆå§‹åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ¡ˆã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Singleton1 </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static </span><span style="color:#ebcb8b;">Singleton1 </span><span style="color:#eff1f5;">instance_;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#8fa1b3;">Singleton1</span><span style="color:#eff1f5;">() {}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static </span><span style="color:#ebcb8b;">Singleton1 </span><span style="color:#8fa1b3;">instance</span><span style="color:#eff1f5;">() { </span><span style="color:#65737e;">// lazy inited but with multi thread problem
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;"> instance_) {
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">instance_ </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Singleton1</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return</span><span style="color:#eff1f5;"> instance_;
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre>
<p>æœ¬å®ç°çš„é—®é¢˜åœ¨äºå¤šçº¿ç¨‹åŒæ­¥å¯¼è‡´çš„æ½œåœ¨çš„å¤šæ¬¡å®ä¾‹åŒ–ã€‚å¯ä»¥ä½¿ç”¨synchronizedå…³é”®å­—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºsynchronizedå¯ä»¥ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ“ä½œï¼Œå…¶ä»–çš„çº¿ç¨‹è¢«é˜»å¡ã€‚</p>
<h2 id="version-2"><a class="zola-anchor" href="#version-2" aria-label="Anchor link for: version-2">ğŸ”—</a>
Version 2</h2>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Singleton2 </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static </span><span style="color:#ebcb8b;">Singleton2 </span><span style="color:#eff1f5;">instance_;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#8fa1b3;">Singleton2</span><span style="color:#eff1f5;">() {}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public synchronized static </span><span style="color:#ebcb8b;">Singleton2 </span><span style="color:#8fa1b3;">instance</span><span style="color:#eff1f5;">() {</span><span style="color:#65737e;">// lazy inited
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;"> instance_) {
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">instance_ </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Singleton2</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return</span><span style="color:#eff1f5;"> instance_;
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre><h2 id="version-3-wrong"><a class="zola-anchor" href="#version-3-wrong" aria-label="Anchor link for: version-3-wrong">ğŸ”—</a>
Version 3 (wrong)</h2>
<p>ç„¶è€Œä¸Šé¢çš„ç‰ˆæœ¬è¿˜å¯ä»¥è¿›è¡Œæ”¹è¿›ã€‚å¯ä»¥åªåœ¨å®ä¾‹åŒ–çš„æ—¶å€™æ‰åŠ ä»¥åŒæ­¥æ§åˆ¶ï¼Œå¦‚æœå·²ç»å®ä¾‹åŒ–äº†ï¼Œå°±ä¸éœ€è¦åŒæ­¥æ§åˆ¶ä»£ç ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Singleton3 </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static </span><span style="color:#ebcb8b;">Singleton3 </span><span style="color:#eff1f5;">instance_;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#8fa1b3;">Singleton3</span><span style="color:#eff1f5;">() {}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static </span><span style="color:#ebcb8b;">Singleton3 </span><span style="color:#8fa1b3;">instance</span><span style="color:#eff1f5;">() {
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;"> instance_) {
</span><span style="color:#eff1f5;">            </span><span style="color:#b48ead;">synchronized</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">Singleton3</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">class</span><span style="color:#eff1f5;">) { </span><span style="color:#65737e;">// multi thread may conflict here
</span><span style="color:#eff1f5;">                </span><span style="color:#eff1f5;">instance_ </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Singleton3</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return</span><span style="color:#eff1f5;"> instance_;
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre>
<p>ä½†æ˜¯è¿™ç§æ–¹å¼å¯¼è‡´äº†æ–°çš„é—®é¢˜ï¼šå¦‚æœåœ¨ä¸¤ä¸ªçº¿ç¨‹éƒ½é€šè¿‡äº†ä¸ºéç©ºçš„æ¡ä»¶åˆ¤æ–­æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ï¼ˆçº¿ç¨‹Aï¼‰å·²ç»è·å–äº†åŒæ­¥å™¨å¹¶åˆ›å»ºäº†å¯¹è±¡å®ä¾‹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆçº¿ç¨‹Bï¼‰åˆ™è¢«é˜»å¡ä»¥è·å–åŒæ­¥å™¨ï¼Œåˆ™çº¿ç¨‹Bè·å–åˆ°åŒæ­¥å™¨ä¹‹åè¿˜æ˜¯ä¼šå»åˆ›å»ºå¯¹è±¡ã€‚</p>
<h2 id="version-4-wrong"><a class="zola-anchor" href="#version-4-wrong" aria-label="Anchor link for: version-4-wrong">ğŸ”—</a>
Version 4 (wrong)</h2>
<p>è¿™ä¸ªæ—¶å€™éœ€è¦ä½¿ç”¨åˆ°åŒé‡æ£€é”æœºåˆ¶ï¼šåœ¨è·å–åŒæ­¥å™¨ä¹‹å‰å’Œä¹‹åéƒ½éœ€è¦è¿›è¡Œæ¡ä»¶åˆ¤æ–­ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Singleton4 </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static </span><span style="color:#ebcb8b;">Singleton4 </span><span style="color:#eff1f5;">instance_; </span><span style="color:#65737e;">// variable visibility
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#8fa1b3;">Singleton4</span><span style="color:#eff1f5;">() {}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static </span><span style="color:#ebcb8b;">Singleton4 </span><span style="color:#8fa1b3;">instance</span><span style="color:#eff1f5;">() {
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;"> instance_) {
</span><span style="color:#eff1f5;">            </span><span style="color:#b48ead;">synchronized </span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">Singleton4</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">class</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">                </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;"> instance_) {
</span><span style="color:#eff1f5;">                    </span><span style="color:#eff1f5;">instance_ </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Singleton4</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">                </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return</span><span style="color:#eff1f5;"> instance_;
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre>
<p>è¿™æ ·çœ‹èµ·æ¥å°±å¯ä»¥äº†ã€‚ä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼šJVMæ— æ³•ä¿è¯å˜é‡instance_åœ¨å¤šä¸ªçº¿ç¨‹é—´çš„å¯è§æ€§ã€‚å…·ä½“çš„æ¥è¯´ï¼Œå°±æ˜¯çº¿ç¨‹Aå’Œçº¿ç¨‹BåŒæ—¶é€šè¿‡äº†ç¬¬ä¸€æ¬¡æ¡ä»¶åˆ¤æ–­ï¼Œç„¶åçº¿ç¨‹Aè·å–åˆ°äº†åŒæ­¥å™¨å¹¶åˆ›å»ºå®ä¾‹ç„¶åç»™instance_å˜é‡èµ‹å€¼ï¼›ç°åœ¨çº¿ç¨‹Bæ‹¿åˆ°äº†åŒæ­¥å™¨ï¼Œå¼€å§‹åšç¬¬äºŒæ¬¡æ¡ä»¶æµ‹è¯•ï¼Œæµ‹è¯•å˜é‡instance_çš„å€¼æ˜¯å¦éç©ºã€‚ä»æ—¶é—´é¡ºåºä¸Šè¯´ï¼Œçº¿ç¨‹Aç»™å˜é‡èµ‹å®Œå€¼ä¹‹åï¼Œç„¶åçº¿ç¨‹Bå†å»å–å˜é‡çš„å€¼åšåˆ¤æ–­ï¼Œæ­¤æ—¶çº¿ç¨‹Bæ‹¿åˆ°çš„è‚¯å®šæ˜¯éç©ºçš„ã€‚ç„¶è€Œï¼ŒJVMå¹¶ä¸ä¿è¯çº¿ç¨‹Bæ‹¿åˆ°çš„å˜é‡å€¼æ˜¯éç©ºçš„ã€‚</p>
<p>~~ä¼—æ‰€å‘¨çŸ¥çš„ï¼Œå¤„ç†å™¨çš„æ‰§è¡ŒæŒ‡ä»¤çš„é€Ÿåº¦é«˜å‡ºä¸»å†…å­˜è¯»å†™é€Ÿåº¦å¥½å‡ ä¸ªé‡çº§ã€‚ä¸ºäº†é˜²æ­¢å¤„ç†å™¨çš„æŒ‡ä»¤æ‰§è¡Œç»å¸¸è¢«ä¸»å†…å­˜è¯»å†™æ“ä½œæ‰€å µå¡ï¼ŒJVMä¼šå¯¹æŒ‡ä»¤è¿›è¡Œä¼˜åŒ–ï¼Œä¸æ˜¯æ‰€æœ‰çš„å¯¹å˜é‡çš„èµ‹å€¼æ“ä½œéƒ½ä¼šç«‹å³å†™å…¥åˆ°ä¸»å†…å­˜ï¼›å¾ˆåˆç†çš„å‡è®¾ï¼ŒJVMåªè¦ä¿è¯æ”¹å˜é‡åœ¨ä¸‹ä¸€ä¸ªè¯»å–ä¹‹å‰è¢«æ”¹å†™å°±å¯ä»¥äº†ï¼Œè¿™æ ·æ—¢ä¿è¯äº†ç¨‹åºçš„æ­£ç¡®ï¼Œä¹Ÿä¿è¯äº†JVMå¯ä»¥å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºä»¥ä¼˜åŒ–æ‰§è¡Œæ•ˆç‡ã€‚ä½†é—®é¢˜æ˜¯ï¼Œåœ¨æ‰§è¡Œä¹‹å‰ï¼ŒæŒ‡ä»¤çš„ä¼˜åŒ–å·²ç»åšå®Œäº†ï¼›è€Œå¤šçº¿ç¨‹æ“ä½œæ˜¯æ‰§è¡ŒæœŸé—´çš„äº‹æƒ…ï¼›ä¸‡ä¸€çº¿ç¨‹Bè·å–å˜é‡å€¼çš„æŒ‡ä»¤åœ¨çº¿ç¨‹Aèµ‹å€¼å˜é‡æŒ‡ä»¤ä¹‹å‰æ‰§è¡Œæ€ä¹ˆåŠï¼Ÿ~~ å†…å­˜çš„å¯è§æ€§å¯ä»¥ç”±åŒæ­¥å™¨æ¥ä¿è¯ï¼Œæ ¹æ®<a href="https://en.wikipedia.org/wiki/Double-checked_locking">Double-checked locking</a>çš„è¯´æ˜ï¼Œæœ¬å®ç°çš„é—®é¢˜åœ¨äºï¼šå®ä¾‹åŒ–æ‰§è¡Œæ„é€ å™¨çš„æœ‰å¯èƒ½æ˜¯è€—æ—¶æ“ä½œï¼Œçº¿ç¨‹Aæ‹¿åˆ°åŒæ­¥å™¨ç„¶åæ‰§è¡Œæ„é€ å™¨ä»£ç ï¼ŒJVMæœ‰å¯èƒ½å·²ç»å¯¹å˜é‡è¿›è¡Œäº†èµ‹å€¼ï¼›çº¿ç¨‹Båœ¨ç¬¬ä¸€æ¬¡æ¡ä»¶åˆ¤æ–­æ—¶å¯èƒ½è®¤ä¸ºå¯¹è±¡å·²ç»åˆå§‹åŒ–ï¼ˆå®é™…ä¸Šè¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆï¼Œæˆ–è€…çº¿ç¨‹Aè¢«æŒ‚èµ·ï¼‰ï¼Œå°±ä¼šç›´æ¥ä½¿ç”¨éƒ¨åˆ†åˆå§‹åŒ–çš„å¯¹è±¡ã€‚</p>
<h2 id="version-5"><a class="zola-anchor" href="#version-5" aria-label="Anchor link for: version-5">ğŸ”—</a>
Version 5</h2>
<p>åŒé‡æ£€é”çš„æ¨èå®ç°æ˜¯ä½¿ç”¨synchronizedæ¥ä¿è¯å¤šçº¿ç¨‹åŒæ­¥ï¼Œä½¿ç”¨volatileæ¥ä¿è¯å˜é‡çš„å¤šçº¿ç¨‹å¯è§æ€§ï¼š</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Singleton5 </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static volatile </span><span style="color:#ebcb8b;">Singleton5 </span><span style="color:#eff1f5;">instance_; </span><span style="color:#65737e;">// Add volatile to keep variable memory visibility
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#8fa1b3;">Singleton5</span><span style="color:#eff1f5;">() {}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static </span><span style="color:#ebcb8b;">Singleton5 </span><span style="color:#8fa1b3;">instance</span><span style="color:#eff1f5;">() {
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;"> instance_) {
</span><span style="color:#eff1f5;">            </span><span style="color:#b48ead;">synchronized </span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">Singleton5</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">class</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">                </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;"> instance_) {
</span><span style="color:#eff1f5;">                    </span><span style="color:#eff1f5;">instance_ </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Singleton5</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">                </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return</span><span style="color:#eff1f5;"> instance_;
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre><h2 id="other-versions"><a class="zola-anchor" href="#other-versions" aria-label="Anchor link for: other-versions">ğŸ”—</a>
Other versions</h2>
<p>åˆ°è¿™é‡Œï¼ŒåŸºæœ¬ä¸Šå¯ä»¥æ¢³ç†æ¸…æ¥šsynchronizedå…³é”®å­—çš„ç”¨æ³•ã€‚</p>
<p>äº‹å®ä¸Šï¼Œéšç€Javaç‰ˆæœ¬çš„æå‡ï¼Œç›®å‰å…¬è®¤çš„æ¯”è¾ƒå¥½çš„Javaå•ä¾‹æ¨¡å¼å®ç°æ˜¯ä½¿ç”¨enumã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">enum </span><span style="color:#ebcb8b;">Singleton6 </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#d08770;">INSTANCE</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#8fa1b3;">Singleton6</span><span style="color:#eff1f5;">() {}
</span><span style="color:#eff1f5;">}
</span></pre>
<p>å¦‚æœä¸æƒ³ä½¿ç”¨enumå…³é”®å­—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<a href="https://en.wikipedia.org/wiki/Initialization_on_demand_holder_idiom">Initialization-on-demand holder idiom</a>ã€‚</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Singleton7 </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static class </span><span style="color:#ebcb8b;">SingletonHolder </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">private static final </span><span style="color:#ebcb8b;">Singleton7 </span><span style="color:#eff1f5;">INSTANCE </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Singleton7</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#8fa1b3;">Singleton7</span><span style="color:#eff1f5;">() {}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static </span><span style="color:#ebcb8b;">Singleton7 </span><span style="color:#8fa1b3;">instance</span><span style="color:#eff1f5;">() {
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">SingletonHolder</span><span style="color:#eff1f5;">.</span><span style="color:#d08770;">INSTANCE</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨åŒæ£€é”ç‰ˆæœ¬ï¼Œæˆ–è€…å…¶æ”¹è¿›ç‰ˆæœ¬ï¼š</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Singleton8 </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static volatile </span><span style="color:#ebcb8b;">Singleton8 </span><span style="color:#eff1f5;">instance_;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#8fa1b3;">Singleton8</span><span style="color:#eff1f5;">() {}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">Singleton8 </span><span style="color:#8fa1b3;">instance</span><span style="color:#eff1f5;">() {
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">Singleton8 </span><span style="color:#b48ead;">var </span><span style="color:#c0c5ce;">=</span><span style="color:#eff1f5;"> instance_;
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;"> var) {
</span><span style="color:#eff1f5;">            </span><span style="color:#b48ead;">synchronized </span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">Singleton8</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">class</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">                </span><span style="color:#b48ead;">var </span><span style="color:#c0c5ce;">=</span><span style="color:#eff1f5;"> instance_;
</span><span style="color:#eff1f5;">                </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">null </span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;"> var) {
</span><span style="color:#eff1f5;">                    </span><span style="color:#eff1f5;">instance_ </span><span style="color:#c0c5ce;">=</span><span style="color:#eff1f5;"> var </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Singleton8</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">                </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">            </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">        </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">return var</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">    </span><span style="color:#eff1f5;">}
</span><span style="color:#eff1f5;">}
</span></pre>
<p>å±€éƒ¨å˜é‡<code>var</code>çš„å¼•å…¥æ˜¯ä¸ºäº†æ•ˆç‡è€ƒè™‘ï¼Œå‡å°‘å¯¹<code>volatile</code>å˜é‡çš„è¯»å–æ¬¡æ•°ã€‚æŒ‰ç…§<a href="https://en.wikipedia.org/wiki/Double-checked_locking">Double-checked locking</a>çš„è¯´æ³•ï¼Œå¯ä»¥æå‡25%çš„æ•ˆç‡ã€‚</p>
<h1 id="tong-bu-qi-de-shi-fang"><a class="zola-anchor" href="#tong-bu-qi-de-shi-fang" aria-label="Anchor link for: tong-bu-qi-de-shi-fang">ğŸ”—</a>
åŒæ­¥å™¨çš„é‡Šæ”¾</h1>
<p>åŒä¸€æ—¶é—´åŒä¸€ä¸ªå¯¹è±¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŒæœ‰åŒæ­¥å™¨ï¼Œå…¶ä»–è¯·æ±‚åŒæ­¥å™¨çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚å½“å‰çº¿ç¨‹è¶…å‡ºäº†åŒæ­¥å™¨çº¦æŸçš„ä½œç”¨åŸŸï¼ˆæ–¹æ³•ä½“æˆ–è€…ä»£ç å—ï¼‰æˆ–è€…å½“å‰çº¿ç¨‹è°ƒç”¨äº†åŒä¸€ä¸ªå¯¹è±¡çš„<code>wait()</code>æ–¹æ³•ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯ï¼š</p>
<ol>
<li>å½“å‰çº¿ç¨‹æ­£å¸¸é€€å‡ºä½œç”¨åŸŸã€‚</li>
<li>å½“å‰çº¿ç¨‹ä½œç”¨åŸŸå†…å‡ºç°äº†æœªå¤„ç†çš„Erroræˆ–è€…Exceptionã€‚</li>
<li>å½“å‰çº¿ç¨‹åœ¨ä½œç”¨åŸŸå†…æ‰§è¡Œäº†åŒæ­¥å™¨é”å®šå¯¹è±¡çš„<code>wait()</code>æ–¹æ³•ã€‚</li>
</ol>
<p>ç‰¹åˆ«çš„ï¼Œä»¥ä¸‹ä¸¤ç§æƒ…å†µå¯èƒ½ä¼šæœ‰è¿·æƒ‘æ€§ï¼Œå½“å‰æ‰§è¡Œçº¿ç¨‹æ˜¯ä¸ä¼šé‡Šæ”¾åŒæ­¥å™¨çš„ã€‚</p>
<ol>
<li>å½“å‰çº¿ç¨‹åœ¨ä½œç”¨åŸŸå†…è°ƒç”¨<code>Thread.sleep()</code>æˆ–<code>Thread.yield()</code>æš‚åœæ‰§è¡Œã€‚</li>
<li>å½“å‰çº¿ç¨‹åœ¨ä½œç”¨åŸŸå†…æ—¶ï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨äº†å½“å‰çº¿ç¨‹çš„<code>suspend()</code>æ–¹æ³•ã€‚</li>
</ol>
<h1 id="yu-reentrantlock-de-bi-jiao"><a class="zola-anchor" href="#yu-reentrantlock-de-bi-jiao" aria-label="Anchor link for: yu-reentrantlock-de-bi-jiao">ğŸ”—</a>
ä¸ ReentrantLock çš„æ¯”è¾ƒ</h1>
<p>synchronizedå’Œjava.util.concurrencyåŒ…ä¸­çš„ReentrantLockåœ¨ä½œç”¨å’Œç”¨æ³•ä¸Šå…·æœ‰å¾ˆé«˜çš„ç›¸ä¼¼æ€§ã€‚å‰è€…æ˜¯Javaè¯­æ³•å±‚é¢çš„å¤šçº¿ç¨‹åŒæ­¥å™¨ï¼Œåè€…æ˜¯APIå±‚é¢çš„äº’æ–¥é”ã€‚</p>
<p>ä»åŠŸèƒ½ä¸Šè®²ï¼ŒReentrantLockæ˜¯synchronizedçš„è¶…é›†ï¼Œå¢åŠ äº†å…¬å¹³æ€§ã€å¯ä¸­æ–­æ€§å’Œæ¡ä»¶æ§åˆ¶ã€‚</p>
<ol>
<li>
<p>å…¬å¹³æ€§æ˜¯æŒ‡å½“é”/åŒæ­¥å™¨è¢«é‡Šæ”¾æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹æ˜¯å¦éœ€è¦æŒ‰ç…§FIFOçš„é¡ºåºæ¥è·å¾—é”/åŒæ­¥å™¨ã€‚ReentrantLockåœ¨éå…¬å¹³é”ä¹‹å¤–è¿˜æä¾›äº†éå…¬å¹³é”ã€‚</p>
</li>
<li>
<p>å¯ä¸­æ–­æ€§æ˜¯æŒ‡çº¿ç¨‹åœ¨è¢«é˜»å¡çš„æ—¶å€™ï¼Œæ˜¯å¦å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œè¿›è¡Œåˆ«çš„å·¥ä½œã€‚RenentrantLockæä¾›äº†è®¾ç½®è¶…æ—¶æ—¶é—´è·å–é”çš„æ–¹æ³•æ¥æä¾›å¯ä¸­æ–­ã€‚</p>
</li>
<li>
<p>ReentrantLockæä¾›äº†è·å¾—Conditionçš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œå¤šçº¿ç¨‹é€šä¿¡ã€‚</p>
</li>
</ol>
<p>ä»æ€§èƒ½ä¸Šè®²ï¼Œsynchronizedæ˜¯Javaé”ï¼ŒReentrantLockæ˜¯ä½¿ç”¨çš„åº•å±‚ç³»ç»Ÿå®ç°ï¼Œæ‰€ä»¥ReentrantLockä¼šæ¯”synchronizedå…·æœ‰æ›´é«˜çš„æ€§èƒ½ã€‚æ ¹æ®ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ï¼ˆå‘¨å¿—æ˜ è‘—ï¼‰çš„å®éªŒï¼ŒJDK 1.6ä»¥åï¼ŒJVMå®ç°å¯¹synchronizedçš„ç¼–è¯‘è¿›è¡Œäº†å¤§å¹…åº¦çš„ä¼˜åŒ–ï¼Œä¸¤è€…çš„æ€§èƒ½å·®åˆ«ä¸å¤§ï¼›åœ¨å¯ä»¥é‡è§åˆ°çš„æœªæ¥ï¼ŒJVMçš„å®ç°å›¢é˜Ÿä»¬è‚¯å®šä¼šé€æ­¥åœ°ä¼˜åŒ–ä½œä¸ºJavaè¯­æ³•çš„synchronizedçš„ç¼–è¯‘å’Œæ‰§è¡Œï¼Œè€ŒReentrantLockä½œä¸ºJavaé™„å¸¦çš„APIåº“ï¼Œä¼˜åŒ–çš„ç©ºé—´ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥äºŒè€…çš„æ€§èƒ½å·®å¼‚ä¸åº”è¯¥æˆä¸ºè¿›è¡Œé€‰æ‹©çš„ä¸»è¦ä¾æ®ã€‚</p>
<p>synchronizedå…·æœ‰æ¯”ReentrantLockæ›´åº•å±‚çš„è¯­æ³•å’Œæ›´ç®€å•çš„ä½¿ç”¨ï¼›ReentrantLockå…·æœ‰æ¯”synchronizedæ›´ä¼˜ç§€çš„æ€§èƒ½å’Œæ›´å¤æ‚çš„åŠŸèƒ½ã€‚åœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œä¸»è¦åº”æ ¹æ®ä½¿ç”¨åœºæ™¯æ¥é€‰æ‹©ä½¿ç”¨çš„å·¥å…·ï¼›åœ¨synchronizedå¯ä»¥è§£å†³é—®é¢˜çš„åœºåˆï¼Œä¸å¿…è¦ä¸ºäº†è¿½æ±‚æ‰€è°“çš„ä¸€ç‚¹ç‚¹æ€§èƒ½å°±å»ä½¿ç”¨ReentrantLockæˆ–è€…å…¶ä»–JUCçš„APIã€‚</p>

        </div>
        
    
</div></div>
            
    <div class="pagination">
        <div class="pagination__buttons">
            </div>
    </div>
<footer class="footer">
                    <div class="footer__inner"><div class="copyright copyright--user"><a href="/">Wbprime's Blog</a> Â© 2019 &nbsp;<a href="mailto:mail@wangbo.im">Elvis Wang</a></div>
    <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;assets&#x2F;js&#x2F;main.js"></script>
</div>
                    

                </footer></div>
    </body>
</html>
