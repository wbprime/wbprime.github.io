<!DOCTYPE html>
<html lang="en">
    <head>
    <title>Spring MVC Integration Testing - Configuration - Elvis Wang</title>
    
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="wangbo’s home &amp; blog"/>

    <meta property="og:title" content="
    wangbo’s home &amp; blog -&nbsp;Spring MVC Integration Testing - Configuration" />
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-integration-testing-configuration&#x2F;"/>
    <meta property="og:description" content="&lt;p&gt;本文是 &lt;a href=&quot;https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-content&#x2F;&quot;&gt;Spring MVC Testing&lt;&#x2F;a&gt; 集成测试系列的第1篇，原文链接：&lt;a href=&quot;http:&#x2F;&#…"/>
    <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;style.css">
    <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;color&#x2F;blue.css">
<link rel="shortcut icon" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;favicon.ico" type="image/x-icon" /></head>
    <body>
        <div class="container full">
<header class="header">
    <div class="header__inner">
        <div class="header__logo">
            <a href="&#x2F;">
    <div class="logo">
        WB Prime
    </div>
</a>
        </div>
        <div class="menu-trigger">menu</div>
    </div>
    
    <nav class="menu">
        <ul class="menu__inner menu__inner--desktop">
            
            
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">About</a>
                    </li>
                
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">Categories</a>
                    </li>
                
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">Tags</a>
                    </li>
                
            </ul>

        <ul class="menu__inner menu__inner--mobile">
            
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">About</a>
        </li>
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">Categories</a>
        </li>
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">Tags</a>
        </li>
        </ul>
    </nav>

    </header>
<div class="content"><div class="post">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-integration-testing-configuration&#x2F;">Spring MVC Integration Testing - Configuration</a>
        </h1>
        
    <div class="post-meta">
        <span class="post-date">2016.04.09
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;spring-mvc-testing&#x2F;">Spring MVC Testing</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;spring-mvc&#x2F;">Spring MVC</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;testing&#x2F;">testing</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;java&#x2F;">java</a>
        
    
            
        
    </div>



        

        <div class="post-content">
            <p>本文是 <a href="https://www.wangbo.im/posts/spring-mvc-testing-content/">Spring MVC Testing</a> 集成测试系列的第1篇，原文链接：<a href="http://www.petrikainulainen.net/programming/spring-framework/integration-testing-of-spring-mvc-applications-configuration/">Integration Testing of Spring MVC Applications: Configuration</a>。</p>
<p>没有人会否认集成测试的重要性，它是验证我们开发的组件能够正常协同工作的重要手段。不幸的是，对使用Spring MVC开发的web应用程序作集成测试有一点麻烦。</p>
<p>过去我们一直用 <a href="http://docs.seleniumhq.org">Selenium</a> 和 <a href="https://jwebunit.github.io/jwebunit/">JWebUnit</a> 来对web应用接口作集成测试，然后效果不是很好。这种方法有以下三个缺点：</p>
<ul>
<li>对于开发中的web接口，编写和维护测试的工作量比较大</li>
<li>对于使用Javascript，尤其是Ajax的web应用，可用性不高</li>
<li>必须在web容器中启动运行，导致速度慢而且很没有效率</li>
</ul>
<p>经常就是开发者在后续开发过程中觉得维护之前的集成测试用例太过耗时而且效果不大，所以废弃了这种形式的集成测试。幸运的是，我们找到了一种新型的集成测试框架Spring MVC Test可以用来简化测试工作。</p>
<p>本文主要介绍如何配置Spring MVC Test框架来进行web应用的测试。本系列使用的工具包括：</p>
<ul>
<li>Spring Framework 3.2</li>
<li>JUnit 4.10</li>
<li>Maven 3.0.3</li>
</ul>
<p>我们一起来开始进入Spring MVC Test的世界吧！</p>
<p><a name="continue-reading"></a></p>
<h1 id="tong-guo-mavenhuo-qu-yi-lai"><a class="zola-anchor" href="#tong-guo-mavenhuo-qu-yi-lai" aria-label="Anchor link for: tong-guo-mavenhuo-qu-yi-lai">🔗</a>
通过Maven获取依赖</h1>
<p>译者注：原文写作的时候是基于Spring Framework 3.1.2，当时Spring-test-mvc还是作为一个独立的项目进行开发和发布。在Spring Framework 3.2以后，该项目被合并到Spring Framework中去了。现在Spring Framework已经发布了4.X系列，很少有人在使用3.2以下的版本，为了减少混淆，直接将原文的pom文件加以修改。特此说明。</p>
<p>生成的pom.xml文件如下：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#808080;">&lt;</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">org.springframework</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">spring-test</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">3.2</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">test</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">scope</span><span style="color:#808080;">&gt;
</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span></pre><h1 id="mockmvc-pei-zhi"><a class="zola-anchor" href="#mockmvc-pei-zhi" aria-label="Anchor link for: mockmvc-pei-zhi">🔗</a>
MockMvc 配置</h1>
<p>Spring MVC Test框架提供了<code>MockMvc</code>类体系来辅助编写基于Spring MVC开发的web应用的测试代码。我们需要做的就是使用<code>MockMvcBuilder</code>接口的实际实现来生成<code>MockMvc</code>实例。<code>MockMvcBuilders</code>工厂类提供了两个工厂方法创建<code>MockMvcBuilder</code>实例：</p>
<ul>
<li><code>StandaloneMockMvcBuilder standaloneSetup(Object… controllers)</code> 主要用来对单个Controller进行测试，需要手动地配置各种Bean</li>
<li><code>DefaultMockMvcBuilder webAppContextSetup(WebApplicationContext context)</code> 主要使用配置好的Spring上下文来配置Bean</li>
</ul>
<p>下面来详细看一下这两种方式分别如何使用。</p>
<h2 id="standalonesetup"><a class="zola-anchor" href="#standalonesetup" aria-label="Anchor link for: standalonesetup">🔗</a>
standaloneSetup</h2>
<p>如果要测试的类是<code>HomeController</code>，我们可以用如下的方式创建一个<code>MockMvc</code>实例：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">MockMvc mockMvc = MockMvcBuilders.standaloneSetup(</span><span style="color:#569cd6;">new </span><span style="color:#dcdcdc;">HomeController()).build();
</span></pre><h2 id="webappcontextsetup"><a class="zola-anchor" href="#webappcontextsetup" aria-label="Anchor link for: webappcontextsetup">🔗</a>
webAppContextSetup</h2>
<p>这种方式我们要先初始化一个配置好的<code>WebApplicationContext</code>实例，然后通过如下代码创建一个<code>MockMvc</code>实例：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">WebApplicationContext wac ;
</span><span style="color:#dcdcdc;">MockMvc mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();
</span></pre><h1 id="ce-shi-yong-li-lei-de-pei-zhi"><a class="zola-anchor" href="#ce-shi-yong-li-lei-de-pei-zhi" aria-label="Anchor link for: ce-shi-yong-li-lei-de-pei-zhi">🔗</a>
测试用例类的配置</h1>
<p>在集成测试中我们应该使用webAppContextSetup方式的<code>MockMvc</code>配置方式，这样可以最大化地共用Spring配置代码。</p>
<p>我们可以按照如下的步骤来配置集成测试用例类：</p>
<ol>
<li>对测试用例类加上<code>@RunWith(SpringJUnit4ClassRunner.class)</code>注解</li>
<li>对测试用例类加上<code>@ContextConfiguration</code>注解，并指定Spring配置文件（XML）或者配置类（Java）</li>
<li>对测试用例类加上<code>@WebAppConfiguration</code>注解，表明这是一个web应用的测试用例</li>
<li>测试用例类中添加一个<code>MockMvc</code>类型的成员</li>
<li>测试用例类中添加一个<code>setUp()</code>方法并用<code>@Before</code>注解，调用<code>MockMvcBuilders</code>的静态方法<code>webAppContextSetup()</code>创建并配置好<code>MockMvc</code>类型的成员</li>
</ol>
<p>完成后的测试用例类大概长成这个样子：</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">@RunWith(SpringJUnit4ClassRunner.class)
</span><span style="color:#dcdcdc;">@ContextConfiguration(locations = {</span><span style="color:#d69d85;">&quot;classpath:testContext.xml&quot;</span><span style="color:#dcdcdc;">, </span><span style="color:#d69d85;">&quot;classpath:webMvcContext.xml&quot;</span><span style="color:#dcdcdc;">})
</span><span style="color:#608b4e;">//@ContextConfiguration(classes = {TestContext.class, WebMvcContext.class})
</span><span style="color:#dcdcdc;">@WebAppConfiguration
</span><span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">TodoControllerTest_WebAppContext {
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">MockMvc mockMvc;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Autowired
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">WebApplicationContext webApplicationContext;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Before
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public void </span><span style="color:#dcdcdc;">setUp() </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">Exception {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">Mockito.reset(mockedTodoService);
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext).build();
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#608b4e;">// Add tests here
</span><span style="color:#dcdcdc;">}
</span></pre>
<p>本文使用的代码被放在了 <a href="https://github.com/pkainulainen/spring-mvc-test-examples/tree/master/configuration">Github</a> 上。使用Maven进行集成测试的方法可以参见我的另外一篇文章 <a href="http://www.petrikainulainen.net/programming/maven/integration-testing-with-maven/">Integration Testing with Maven</a>。</p>
<h1 id="zong-jie"><a class="zola-anchor" href="#zong-jie" aria-label="Anchor link for: zong-jie">🔗</a>
总结</h1>
<p>本文主要介绍了如何来配置基于Spring MVC Test的集成测试，主要内容有：</p>
<ul>
<li>如何使用不同的Spring配置方式（XML/Java）来配置测试用例</li>
<li>应该使用<code>webAppContextSetup</code>的方式而不是<code>standaloneSetup</code>方式</li>
<li>如何使用<code>WebApplicationContext</code>注入来完成Spring配置的加载</li>
</ul>
<p>下一篇是 <a href="https://www.wangbo.im/posts/spring-mvc-testing-integration-testing-controllers/">Spring MVC Integration Testing - Controllers</a>。</p>

        </div>
        
    
</div></div>
            
    <div class="pagination">
        <div class="pagination__buttons">
            </div>
    </div>
<footer class="footer">
                    <div class="footer__inner"><div class="copyright">
            <span>© 2019 <a href="https://github.com/ejmg/zerm">zerm</a> :: Powered by <a href="https://www.getzola.org/">Zola</a></span>
            <span>:: Theme made by <a href="https://github.com/ejmg">ejmg</a></span>
        </div>
    <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;assets&#x2F;js&#x2F;main.js"></script>
</div>
                    

                </footer></div>
    </body>
</html>
