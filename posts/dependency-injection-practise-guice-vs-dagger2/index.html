<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>wangboâ€™s blog - Dependency Injection - Guice VS Dagger 2</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">WB Prime</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;github.wangbo.im">
                            Github
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.wangbo.im">WB Prime</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;github.wangbo.im">
                                    Github
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    



<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;dependency-injection-practise-guice-vs-dagger2&#x2F;">Dependency Injection - Guice VS Dagger 2</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-10-30</span>
            
        </div>
    </header>

    <div class="post-content">
      <p>åš Java åå°å¼€å‘çš„åŒå­¦ï¼ŒåŸºæœ¬ä¸Šéƒ½ä½¿ç”¨è¿‡ <a href="http://en.wikipedia.org/wiki/Dependency_injection" title="Dependency Injection">Dependency Injection</a> ä¾èµ–æ³¨å…¥æ¡†æ¶ã€‚å¤§åé¼é¼çš„ <a href="https://spring.io/projects/spring-framework" title="Spring Framework">Spring
Framework</a> å°±æ˜¯ä»ä¾èµ–æ³¨å…¥èµ·å®¶çš„ï¼Œç„¶åä¸€è·¯å¥”å‘äº†å…¨å®¶æ¡¶çš„ä¸å½’è·¯ï¼›<a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> æ˜¯
Google å…¬å¸çš„ä¾èµ–æ³¨å…¥è§£å†³æ–¹æ¡ˆï¼Œé‡è§†ç±»å‹å®‰å…¨èƒœè¿‡äºä½¿ç”¨ä¾¿åˆ©æ€§ï¼Œç›¸æ¯” <a href="https://spring.io/projects/spring-framework" title="Spring Framework">Spring Framework</a> èƒ½æä¾›
æ›´ç²¾å‡†çš„æ§åˆ¶å’Œæ›´ç¿”å®çš„æ³¨å…¥å¤±è´¥é”™è¯¯ä¿¡æ¯ï¼›è€Œç”± Google æ¥ç›˜ <a href="http://square.github.io/">Square</a> çš„
<a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> åˆ™æ¯” <a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> æ›´è¿›ä¸€æ­¥ï¼Œé€šè¿‡åœ¨ç¼–è¯‘æ—¶æ„å»ºä¾èµ–æ³¨å…¥å…³ç³»ï¼Œä½¿å¾—ä¾èµ–é”™è¯¯åœ¨ç¼–è¯‘é˜¶
æ®µå°½é‡æš´éœ²å‡ºæ¥ï¼ŒåŒæ—¶ï¼ŒåŸç”Ÿç±»å‹å®‰å…¨çš„ Java ä»£ç ç›¸è¾ƒåŸºäºåå°„çš„æ³¨å…¥ä»£ç ä¹Ÿæœ‰æˆ–å¤šæˆ–å°‘çš„æ€§èƒ½æå‡ï¼ˆå°¤å…¶æ˜¯åœ¨
Android ä¸Šï¼‰ã€‚</p>
<p>æœ¬æ–‡é€šè¿‡åŒæ—¶ä½¿ç”¨ <a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> å’Œ <a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œå¯¹æ¯”äºŒè€…åœ¨å®ç°ä¾èµ–æ³¨å…¥æ–¹æ³•ä¸Š
çš„å¼‚åŒã€‚</p>
<p id="zola-continue-reading"><a name="continue-reading"></a></p>
<h1 id="overview"><a class="zola-anchor" href="#overview" aria-label="Anchor link for: overview">ğŸ”—</a>Overview</h1>
<p>ä» <a href="https://dagger.dev/tutorial/" title="Dagger Tutorial">Dagger Tutorial</a> å¾—åˆ°çš„çµæ„Ÿï¼Œåˆ†åˆ«ä½¿ç”¨ <a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> å’Œ <a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> æ¥å®ç°ä¸€ä¸ªå®ç”¨å·¥
å…·æ¨¡æ‹Ÿç¨‹åºã€‚ç¨‹åºçš„åŠŸèƒ½å¾ˆç®€å•ï¼šå¯åŠ¨åè¯»å–è¾“å…¥å¹¶è§£æï¼Œæ‰§è¡Œèƒ½å¤Ÿè¯†åˆ«çš„å­å‘½ä»¤ï¼›æ”¯æŒçš„å­å‘½ä»¤æš‚æ—¶åŒ…æ‹¬
<code>exit</code>/<code>set</code>/<code>echo</code>/<code>sql</code>ã€‚</p>
<ul>
<li>æ¯ä¸€è¡Œçš„è¾“å…¥æŒ‰ç©ºç™½ç¬¦è§£æä¸ºä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„</li>
<li>å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å­å‘½ä»¤çš„ç±»å‹</li>
<li>å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„å…¶ä»–å…ƒç´ æ˜¯å­å‘½ä»¤çš„å‚æ•°</li>
</ul>
<p>å…¶ä¸­ï¼Œ</p>
<ul>
<li><code>exit</code> ç›´æ¥é€€å‡ºç¨‹åº</li>
<li><code>set</code> å¯ä»¥è®¾ç½®æŒ‡å®šåç§°å˜é‡çš„å€¼</li>
<li><code>echo</code> å›æ˜¾æ‰€æœ‰è¾“å…¥çš„å‚æ•°ï¼Œèƒ½å¤Ÿè§£æä»¥ <code>$</code> å¼€å¤´çš„å˜é‡è§£æ</li>
<li><code>sql</code> å¯¹å›ºå®šçš„æ•°æ®åº“å®ä¾‹æ‰§è¡Œ SQLï¼Œå®è·µä¸­ä½¿ç”¨äº† H2 æ•°æ®åº“</li>
</ul>
<h1 id="jsr-330"><a class="zola-anchor" href="#jsr-330" aria-label="Anchor link for: jsr-330">ğŸ”—</a>JSR 330</h1>
<p><a href="http://javax-inject.github.io/javax-inject/" title="JSR-330: Dependency Injection for Java (javax.inject).">JSR 330 (javax.inject)</a> æ˜¯ Java EE (æ›´åä¸º Jakarta EE) å¼€å‘çš„ä¾èµ–æ³¨å…¥è§„èŒƒï¼Œ<a href="https://spring.io/projects/spring-framework" title="Spring Framework">Spring
Framework</a>ã€<a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Google Guice</a> å’Œ <a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> éƒ½ï¼ˆéƒ¨åˆ†ï¼‰å®ç°äº† <a href="http://javax-inject.github.io/javax-inject/" title="JSR-330: Dependency Injection for Java (javax.inject).">JSR 330</a>
è§„èŒƒã€‚</p>
<p>åœ¨ <code>pom.xml</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#83a598;">&lt;</span><span style="font-weight:bold;color:#8ec07c;">dependency</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">groupId</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">javax.inject</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">groupId</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">artifactId</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">javax.inject</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">artifactId</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">version</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">1</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">version</span><span style="color:#83a598;">&gt;
&lt;/</span><span style="font-weight:bold;color:#8ec07c;">dependency</span><span style="color:#83a598;">&gt;
</span></pre>
<p><a href="http://javax-inject.github.io/javax-inject/" title="JSR-330: Dependency Injection for Java (javax.inject).">JSR 330</a> å¼•å…¥äº† 5 ä¸ªæ³¨è§£ç±»å’Œ 1 ä¸ªæ¥å£ç±»ï¼š</p>
<ol>
<li><code>@javax.inject.Inject</code> å¯ä»¥æ ‡è®°äºæ„é€ å‡½æ•°ã€å®ä¾‹æ–¹æ³•å’Œå±æ€§å­—æ®µï¼Œç”¨äºè¯´æ˜è¯¥æ„é€ å‡½æ•°ã€å®ä¾‹æ–¹æ³•å’Œå±æ€§å­—æ®µæ˜¯å¯æ³¨å…¥çš„ (injectable)ã€‚â€œå¯æ³¨å…¥çš„â€è¯´æ˜ä¾èµ–æ³¨å…¥æ¡†æ¶åœ¨å¤„ç†è¯¥æ„é€ å‡½æ•°ã€å®ä¾‹æ–¹æ³•å’Œå±æ€§å­—æ®µæ—¶éœ€è¦è‡ªåŠ¨è§£æä¾èµ–ï¼Œè¿™åŒ…å«ä¸¤å±‚æ„æ€ï¼šä¸€æ˜¯æ„é€ å‡½æ•°ã€å®ä¾‹æ–¹æ³•çš„å‚æ•°ã€å±æ€§å­—æ®µç­‰å˜é‡èµ‹å€¼æ“ä½œç”±ä¾èµ–æ³¨å…¥æ¡†æ¶æ‰§è¡Œï¼ŒäºŒæ˜¯è¿™äº›ä¾èµ–é¡¹å®ä¾‹çš„æ„é€ ã€ç»´æŠ¤å’Œç®¡ç†éƒ½åº”æœ‰ä¾èµ–æ³¨å…¥æ¡†æ¶è´Ÿè´£ã€‚â€œå¯æ³¨å…¥çš„â€æ„é€ å‡½æ•°åŒæ—¶ä¹Ÿè¡¨æ˜ï¼Œå¦‚æœè¯¥ç±»è¢«åˆ«çš„ç»„ä»¶ä¾èµ–æ—¶ï¼Œä¾èµ–æ³¨å…¥æ¡†æ¶åº”è¯¥ä»è¿™ä¸ªæ„é€ å‡½æ•°æ„é€ å’Œåˆå§‹åŒ–è¯¥ç±»çš„å®ä¾‹ï¼Œè¿™éšå«äº†ä¸€ä¸ªç±»ä¸­æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªâ€œå¯æ³¨å…¥çš„â€æ„é€ å‡½æ•°ã€‚</li>
<li><code>@javax.inject.Named</code> ç”¨æ¥ç»™ä¾èµ–é¡¹å‘½åï¼Œæ˜¯ <code>@javax.inject.Qualifier</code> æ³¨è§£ç”¨æ³•çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚å¦‚æœå‡ºç°äº†ä¸¤ä¸ªæˆ–å¤šä¸ªåŒç±»å‹çš„ä¾èµ–é¡¹ï¼Œä¾èµ–æ³¨å…¥æ¡†æ¶å¯ä»¥ä¾æ®æ­¤æ³¨è§£æ ¹æ®ä¸åŒçš„åç§°åŒºåˆ†ä¾èµ–ã€‚</li>
<li><code>@javax.inject.Qualifier</code> ç”¨æ¥åŒºåˆ†ä¸åŒçš„ä¾èµ–é¡¹ã€‚æ­¤æ³¨è§£ä¸»è¦ç”¨æ¥è®¾è®¡æ–°çš„æ³¨è§£ï¼›æ–°çš„æ³¨è§£å¯ä»¥ç”¨äºæ ‡è¯†ä¾èµ–çš„ç‰¹å¾ï¼Œä¸åŒæ–°æ³¨è§£æ ‡è®°çš„ç›¸åŒç±»çš„å®ä¾‹æ˜¯ä¸åŒçš„ä¾èµ–é¡¹ã€‚æ­¤æ³¨è§£æ´¾ç”Ÿå‡ºæ¥çš„æ–°æ³¨è§£ä¸ <code>@javax.inject.Named</code> æ³¨è§£çš„åŒºåˆ«åœ¨äºå‰è€…èƒ½æä¾›ç±»å‹å®‰å…¨çš„ä¿è¯ï¼Œåè€…åªèƒ½é€šè¿‡å­—ç¬¦ä¸²çš„ç›¸ç­‰æ€§ä¿è¯ä¾èµ–çš„ä¸€è‡´æ€§ã€‚</li>
<li><code>@javax.inject.Scope</code> ç”¨æ¥åŒºåˆ†ä¾èµ–é¡¹çš„ä¸åŒçš„ä½œç”¨åŸŸå’Œç”Ÿå‘½å‘¨æœŸèŒƒå›´ï¼Œå…¶ç”¨æ³•ä¸ <code>@javax.inject.Qualifier</code> ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨æ¥æ´¾ç”Ÿæ–°çš„æ³¨è§£ã€‚</li>
<li><code>@javax.inject.Singleton</code> ç”¨æ¥æ ‡è¯† <strong>å•ä¾‹</strong> çš„ä½œç”¨åŸŸå’Œç”Ÿå‘½å‘¨æœŸèŒƒå›´ï¼Œæ˜¯ <code>@javax.inject.Scope</code> æ³¨è§£ç”¨æ³•çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚</li>
<li><code>javax.inject.Provider&lt;T&gt;</code> æ˜¯ä¸€ä¸ª <strong>Supplier</strong> ç±»å‹çš„æ¥å£ï¼Œä¸»è¦ç”¨äºå°†ä¾èµ–é¡¹å®ä¾‹çš„è·å–å’Œç±»æ„é€ å‡½æ•°è§£è€¦ã€‚æ„é€ å‡½æ•°æ˜¯ <code>javax.inject.Provider</code> æ¥å£çš„ä¸€ç§ç‰¹æ®Šå®ç°ã€‚</li>
</ol>
<p>ä½¿ç”¨ <a href="http://javax-inject.github.io/javax-inject/" title="JSR-330: Dependency Injection for Java (javax.inject).">JSR 330</a> çš„æ³¨è§£å’Œæ¥å£å¯ä»¥å¼€å‘åº”ç”¨ç¨‹åºçš„ä¸»å¹²é€»è¾‘ï¼Œä¸åŒç»„ä»¶ä¹‹é—´é€šè¿‡ä¾èµ–é¡¹ç›¸äº’å…³è”ï¼›ä¾èµ–æ³¨å…¥æ¡†æ¶è´Ÿè´£ä¾èµ–é¡¹çš„æ„é€ ã€ä¾èµ–å›¾è°±çš„ç»´æŠ¤å’Œç®¡ç†ï¼Œä»¥åŠå‘å¤–ï¼ˆä½¿ç”¨è€…ï¼‰æä¾›è·å–æ‰€ç®¡ç†å®ä¾‹å¯¹è±¡çš„å…¥å£ã€‚</p>
<h1 id="app-structure"><a class="zola-anchor" href="#app-structure" aria-label="Anchor link for: app-structure">ğŸ”—</a>App Structure</h1>
<p>æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç»“æ„è®¾è®¡å¦‚ä¸‹ï¼š</p>
<p><img src="https://www.wangbo.im/posts/dependency-injection-practise-guice-vs-dagger2/logic_view.svg" alt="di usecase class graph" /></p>
<p><code>MainApp</code> ç±»æ˜¯åº”ç”¨ç¨‹åºçš„å…¥å£ï¼Œå…¶ä¸»è¦é€»è¾‘æ˜¯æ„é€ ä¸€ä¸ª <code>CommandProcessor</code> ç±»å‹çš„å®ä¾‹ï¼Œå¹¶ç”¨è¯¥å®ä¾‹å¤„ç†è¾“å…¥è¡Œã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">MainApp </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">public static void </span><span style="color:#8ec07c;">main</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">String</span><span style="color:#fa5c4b;">[] </span><span style="color:#fdf4c1;">args</span><span style="color:#fdf4c1aa;">) {
        </span><span style="font-style:italic;color:#928374;">// TODO construct a valid CommandProcessor instance
        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">CommandProcessor</span><span style="color:#fdf4c1aa;"> processor </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// fixme

        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">Scanner</span><span style="color:#fdf4c1aa;"> scanner </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">Scanner</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.in);
        </span><span style="color:#fa5c4b;">while </span><span style="color:#fdf4c1aa;">(scanner.</span><span style="color:#fdf4c1;">hasNextLine()</span><span style="color:#fdf4c1aa;">) {
            </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">Status</span><span style="color:#fdf4c1aa;"> status </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> processor.</span><span style="color:#fdf4c1;">process(scanner.nextLine())</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(status.</span><span style="color:#fdf4c1;">equals(</span><span style="color:#8ec07c;">Status</span><span style="color:#fdf4c1;">.QUITING)</span><span style="color:#fdf4c1aa;">) {
                </span><span style="color:#fa5c4b;">break</span><span style="color:#fdf4c1aa;">;
            }
        }
    }
}
</span></pre>
<p><code>CommandProcessor</code> ç±»è§£æä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºç©ºç™½å­—ç¬¦åˆ†éš”çš„å­ä¸²ç»„ï¼Œæ ¹æ®å­ä¸²ç»„çš„å…ƒç´ æŸ¥è¯¢åˆ°å¯¹åº”çš„ <code>Command</code> å®ä¾‹å¹¶å°†å­ä¸²ç»„ä»£ç†åˆ°è¯¥å®ä¾‹è¿›è¡Œå¤„ç†ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">CommandProcessor </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">Map</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">Command</span><span style="color:#fdf4c1aa;">&gt; map;

    @</span><span style="color:#fdf4c1;">Inject
    </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">CommandProcessor</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">Map</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">Command</span><span style="color:#fdf4c1aa;">&gt; </span><span style="color:#fdf4c1;">map</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.map </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> map;
    }

    </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Status process</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">line</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt; args </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">splitByWhiteSpace(line)</span><span style="color:#fdf4c1aa;">;

        </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(args.</span><span style="color:#fdf4c1;">isEmpty()</span><span style="color:#fdf4c1aa;">) {
            </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">Status</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">INVALID</span><span style="color:#fdf4c1aa;">;
        }

        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;"> name </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> args.</span><span style="color:#fdf4c1;">get(</span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;

        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">Command</span><span style="color:#fdf4c1aa;"> cmd </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> map.</span><span style="color:#fdf4c1;">get(name)</span><span style="color:#fdf4c1aa;">;
        </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(cmd </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">) {
            </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">Status</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">INVALID</span><span style="color:#fdf4c1aa;">;
        }

        </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> cmd.</span><span style="color:#fdf4c1;">handleInput(args.subList(</span><span style="color:#d3869b;">1</span><span style="color:#fdf4c1;">, args.size()))</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#fa5c4b;">private static </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt; </span><span style="color:#8ec07c;">splitByWhiteSpace</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">str</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">Arrays</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">asList(str.split(</span><span style="color:#b8bb26;">&quot;\\s+&quot;</span><span style="color:#fdf4c1;">))</span><span style="color:#fdf4c1aa;">;
    }
}
</span></pre>
<p><code>CommandProcessor</code> ç±»çš„æ„é€ å‡½æ•°è¢«æ ‡è®°äº† <code>@javax.inject.Inject</code> æ³¨è§£ï¼Œè¯´æ˜å…¶éœ€è¦ä¸€ä¸ª <code>java.util.Map&lt;String, Command&gt;</code> ç±»å‹çš„ä¾èµ–æ€§ï¼Œè¯¥ä¾èµ–é¡¹éœ€è¦ç”±ä¾èµ–æ³¨å…¥æ¡†æ¶æä¾›ã€‚</p>
<p><code>Command</code> æ¥å£ç±»å¾ˆç®€å•ï¼Œä¸»è¦æä¾›å¤„ç†å­ä¸²ç»„çš„é€»è¾‘å…¥å£ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public interface </span><span style="color:#8ec07c;">Command </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#8ec07c;">Status handleInput</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt; </span><span style="color:#fdf4c1;">args</span><span style="color:#fdf4c1aa;">);

    </span><span style="color:#fa5c4b;">enum </span><span style="color:#8ec07c;">Status </span><span style="color:#fdf4c1aa;">{ </span><span style="color:#8ec07c;">INVALID</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">SUCCEED</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">FAILED</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">QUITING </span><span style="color:#fdf4c1aa;">}
}
</span></pre>
<p><code>ExitCommand</code>/<code>SetCommand</code>/<code>EchoCommand</code>/<code>SqlCommand</code> ç±»éƒ½æ˜¯ <code>Command</code> æ¥å£çš„å®ç°ï¼Œåˆ†åˆ«å®ç° <code>exit</code>/<code>set</code>/<code>echo</code>/<code>sql</code> å‘½ä»¤ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">final class </span><span style="color:#8ec07c;">ExitCommand </span><span style="color:#fa5c4b;">implements </span><span style="color:#8ec07c;">Command </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Inject
    </span><span style="color:#8ec07c;">ExitCommand</span><span style="color:#fdf4c1aa;">() {}

    @</span><span style="color:#fdf4c1;">Override
    </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Status handleInput</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt; </span><span style="color:#fdf4c1;">args</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">Status</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">QUITING</span><span style="color:#fdf4c1aa;">;
    }
}
</span></pre>
<p><code>ExitCommand</code> ç±»ä¸ä½œä»»ä½•å…·ä½“å¤„ç†ï¼Œç›´æ¥è¿”å›é€€å‡ºçŠ¶æ€ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">final class </span><span style="color:#8ec07c;">SetCommand </span><span style="color:#fa5c4b;">implements </span><span style="color:#8ec07c;">Command </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">Stderr </span><span style="color:#fdf4c1aa;">stderr;
    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">GlobalContext </span><span style="color:#fdf4c1aa;">ctx;

    @</span><span style="color:#fdf4c1;">Inject
    </span><span style="color:#8ec07c;">SetCommand</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">GlobalContext </span><span style="color:#fdf4c1;">ctx</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">Stderr </span><span style="color:#fdf4c1;">stderr</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.ctx </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> ctx;

        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.stderr </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> stderr;
    }

    @</span><span style="color:#fdf4c1;">Override
    </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Status handleInput</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt; </span><span style="color:#fdf4c1;">args</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">final int</span><span style="color:#fdf4c1aa;"> n </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> args.</span><span style="color:#fdf4c1;">size()</span><span style="color:#fdf4c1aa;">;
        </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(n </span><span style="color:#fe8019;">!= </span><span style="color:#d3869b;">2</span><span style="color:#fdf4c1aa;">) {
            stderr.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;Usage: set name value&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">Status</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">FAILED</span><span style="color:#fdf4c1aa;">;
        }

        ctx.</span><span style="color:#fdf4c1;">set(args.get(</span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1;">), args.get(</span><span style="color:#d3869b;">1</span><span style="color:#fdf4c1;">))</span><span style="color:#fdf4c1aa;">;
        </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">Status</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">SUCCEED</span><span style="color:#fdf4c1aa;">;
    }
}
</span></pre>
<p><code>SetCommand</code> ç±»ä»è¾“å…¥å‚æ•°ä¸­è§£æå‡ºé”®å€¼å¯¹ï¼Œå¹¶è®¾ç½®åˆ°ä¸€ä¸ªæ³¨å…¥çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">final class </span><span style="color:#8ec07c;">EchoCommand </span><span style="color:#fa5c4b;">implements </span><span style="color:#8ec07c;">Command </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">Stdout </span><span style="color:#fdf4c1aa;">stdout;
    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">GlobalContext </span><span style="color:#fdf4c1aa;">ctx;

    @</span><span style="color:#fdf4c1;">Inject
    </span><span style="color:#8ec07c;">EchoCommand</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">GlobalContext </span><span style="color:#fdf4c1;">ctx</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">Stdout </span><span style="color:#fdf4c1;">stdout</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.ctx </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> ctx;
        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.stdout </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> stdout;
    }

    @</span><span style="color:#fdf4c1;">Override
    </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Status handleInput</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt; </span><span style="color:#fdf4c1;">args</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">final int</span><span style="color:#fdf4c1aa;"> n </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> args.</span><span style="color:#fdf4c1;">size()</span><span style="color:#fdf4c1aa;">;
        </span><span style="color:#fa5c4b;">for </span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">int</span><span style="color:#fdf4c1aa;"> i </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1aa;">; i </span><span style="color:#fe8019;">&lt;</span><span style="color:#fdf4c1aa;"> n </span><span style="color:#fe8019;">- </span><span style="color:#d3869b;">1</span><span style="color:#fdf4c1aa;">; i</span><span style="color:#fe8019;">++</span><span style="color:#fdf4c1aa;">) {
            stdout.</span><span style="color:#fdf4c1;">print(ctx.resolve(args.get(i)))</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">print(</span><span style="color:#b8bb26;">&quot; &quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
        }

        </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(n </span><span style="color:#fe8019;">&gt; </span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1aa;">) {
            stdout.</span><span style="color:#fdf4c1;">println(ctx.resolve(args.get(n </span><span style="color:#fe8019;">- </span><span style="color:#d3869b;">1</span><span style="color:#fdf4c1;">)))</span><span style="color:#fdf4c1aa;">;
        }
        </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">Status</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">SUCCEED</span><span style="color:#fdf4c1aa;">;
    }
}
</span></pre>
<p><code>EchoCommand</code> ç±»å°†è¾“å…¥å‚æ•°åŸæ ·è¾“å‡ºï¼Œå¦‚æœè¾“å…¥å‚æ•°ä¸­æœ‰ä»¥ <code>$</code> å¼€å¤´çš„åˆ™ä»æ³¨å…¥çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­å–å‡ºå¯¹åº”çš„å€¼å¹¶è¾“å‡ºã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">final class </span><span style="color:#8ec07c;">SqlCommand </span><span style="color:#fa5c4b;">implements </span><span style="color:#8ec07c;">Command </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">Stdout </span><span style="color:#fdf4c1aa;">stdout;
    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">Stderr </span><span style="color:#fdf4c1aa;">stderr;

    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">SQLDialect </span><span style="color:#fdf4c1aa;">dialect;
    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">DataSource </span><span style="color:#fdf4c1aa;">dataSource;

    @</span><span style="color:#fdf4c1;">Inject
    </span><span style="color:#8ec07c;">SqlCommand</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">DataSource </span><span style="color:#fdf4c1;">dataSource</span><span style="color:#fdf4c1aa;">,
        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">SQLDialect </span><span style="color:#fdf4c1;">dialect</span><span style="color:#fdf4c1aa;">,
        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">Stdout </span><span style="color:#fdf4c1;">stdout</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">Stderr </span><span style="color:#fdf4c1;">stderr</span><span style="color:#fdf4c1aa;">) {

        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.dataSource </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> dataSource;
        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.dialect </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> dialect;

        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.stdout </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> stdout;
        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.stderr </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> stderr;
    }

    @</span><span style="color:#fdf4c1;">Override
    </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Status handleInput</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt; </span><span style="color:#fdf4c1;">args</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">final int</span><span style="color:#fdf4c1aa;"> n </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> args.</span><span style="color:#fdf4c1;">size()</span><span style="color:#fdf4c1aa;">;
        </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(n </span><span style="color:#fe8019;">&lt;= </span><span style="color:#d3869b;">1</span><span style="color:#fdf4c1aa;">) {
            stderr.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;Usage: sql SQL-commands&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">Status</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">FAILED</span><span style="color:#fdf4c1aa;">;
        }

        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">DSLContext</span><span style="color:#fdf4c1aa;"> dsl </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">DSL</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">using(dataSource, dialect)</span><span style="color:#fdf4c1aa;">;
        </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
            </span><span style="color:#fa5c4b;">final int</span><span style="color:#fdf4c1aa;"> re </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> dsl.</span><span style="color:#fdf4c1;">execute(</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1;">.join(</span><span style="color:#b8bb26;">&quot; &quot;</span><span style="color:#fdf4c1;">, args))</span><span style="color:#fdf4c1aa;">;
            stdout.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;Return code: &quot; </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> re)</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">Status</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">SUCCEED</span><span style="color:#fdf4c1aa;">;
        } </span><span style="color:#fa5c4b;">catch </span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">DataAccessException </span><span style="color:#fdf4c1;">ex</span><span style="color:#fdf4c1aa;">) {
            stderr.</span><span style="color:#fdf4c1;">println(ex.getMessage())</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">Status</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">FAILED</span><span style="color:#fdf4c1aa;">;
        }
    }
}
</span></pre>
<p><code>SqlCommand</code> ç±»ä½¿ç”¨æ³¨å…¥çš„ <code>javax.sql.DataSource</code> å¯¹è±¡å®ä¾‹æ‰§è¡Œè¾“å…¥çš„ SQL è¯­å¥ã€‚</p>
<p>è€ƒè™‘åˆ° JDBC æ•°æ®æºçš„åˆå§‹åŒ–éœ€è¦ URL/ç”¨æˆ·å/å¯†ç  å‚æ•°ï¼Œä½¿ç”¨ <code>SqlUtils</code> ç±»æ¥å­˜æ”¾è¾…åŠ©æ³¨å…¥çš„ä»£ç ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public final class </span><span style="color:#8ec07c;">SqlUtils </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Qualifier
    </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Documented
    </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Retention</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">RetentionPolicy</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">RUNTIME</span><span style="color:#fdf4c1aa;">)
    @</span><span style="color:#fdf4c1;">Target</span><span style="color:#fdf4c1aa;">({</span><span style="color:#8ec07c;">ElementType</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">METHOD</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">ElementType</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">CONSTRUCTOR</span><span style="color:#fdf4c1aa;">,
             </span><span style="color:#8ec07c;">ElementType</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">FIELD</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">ElementType</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">PARAMETER</span><span style="color:#fdf4c1aa;">})
    </span><span style="color:#fa5c4b;">public @interface </span><span style="color:#8ec07c;">JdbcUrl </span><span style="color:#fdf4c1aa;">{}

    </span><span style="color:#fa5c4b;">public static final </span><span style="color:#8ec07c;">String NAMED_KEY_JDBC_USERNAME </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;jdbc_username&quot;</span><span style="color:#fdf4c1aa;">;
    </span><span style="color:#fa5c4b;">public static final </span><span style="color:#8ec07c;">String NAMED_KEY_JDBC_PASSWORD </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;jdbc_password&quot;</span><span style="color:#fdf4c1aa;">;
}
</span></pre>
<p>å…¶ä¸­ï¼Œ<code>@JdbcUrl</code> æ³¨è§£ä½¿ç”¨ <code>@javax.inject.Qualifier</code> æ³¨è§£æ ‡è®°ï¼Œç”¨æ¥è¾…åŠ© JDBC URL çš„æ³¨å…¥ï¼›å˜é‡ <code>NAMED_KEY_JDBC_USERNAME</code> å’Œ <code>NAMED_KEY_JDBC_PASSWORD</code> è¢«è®¾è®¡ç”¨æ¥é…åˆ <code>@javax.inject.Named</code> æ³¨è§£è¾…åŠ© JDBC ç”¨æˆ·å/å¯†ç çš„æ³¨å…¥ã€‚</p>
<p>åº”ç”¨ç¨‹åºåŠŸèƒ½æ€§æ–‡ä»¶ç»„ç»‡ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">â”œâ”€â”€ app
â”‚Â Â  â”œâ”€â”€ Command.java
â”‚Â Â  â”œâ”€â”€ CommandProcessor.java
â”‚Â Â  â”œâ”€â”€ GlobalContext.java
â”‚Â Â  â”œâ”€â”€ Stderr.java
â”‚Â Â  â””â”€â”€ Stdout.java
â”œâ”€â”€ echo
â”‚Â Â  â””â”€â”€ EchoCommand.java
â”œâ”€â”€ exit
â”‚Â Â  â””â”€â”€ ExitCommand.java
â”œâ”€â”€ set
â”‚Â Â  â””â”€â”€ SetCommand.java
â”œâ”€â”€ sql
â”‚Â Â  â”œâ”€â”€ SqlCommand.java
â”‚Â Â  â””â”€â”€ SqlUtils.java
â””â”€â”€ MainApp.java
</span></pre>
<p>å®Œæ•´çš„ç¤ºä¾‹ä»£ç å¯ä»¥å‚è§ <a href="https://github.com/wbprime/java-mods/tree/master/guice-usecases">Guice Usecases</a> å’Œ <a href="https://github.com/wbprime/java-mods/tree/master/dagger-usecases">Dagger Usecases</a>ã€‚</p>
<p>åº”ç”¨ç¨‹åºçš„åŸºæœ¬åŠŸèƒ½éƒ½å·²ç»å®ç°äº†ï¼›æ¥ä¸‹æ¥éœ€è¦å°†æ‰€æœ‰çš„ç»„ä»¶ç»„è£…èµ·æ¥å¹¶å‘ <code>MainApp</code> æä¾›ä¸€ä¸ªå®Œæ•´ä¸”å¯ç”¨çš„
<code>CommandProcessor</code> å®ä¾‹ï¼Œè€Œè¿™æ˜¯ä¾èµ–æ³¨å…¥æ¡†æ¶éœ€è¦è§£å†³ï¼Œä¸”èƒ½ä½“ç°å‡ºå„è‡ªç‰¹ç‚¹çš„éƒ¨åˆ†äº†ã€‚</p>
<h1 id="di-via-guice"><a class="zola-anchor" href="#di-via-guice" aria-label="Anchor link for: di-via-guice">ğŸ”—</a>DI via Guice</h1>
<p><a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> å®˜æ–¹ç¼–å†™äº†ä¸€ä¸ªç³Šå¼„äººçš„<a href="https://github.com/google/guice/wiki/GettingStarted">å…¥é—¨æ‰‹å†Œ</a>ï¼Œå¦‚æœå¯¹ <a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> ä¸ç†Ÿæ‚‰çš„è¯»å®Œä¹‹åè¿˜æ²¡æœ‰å…¥é—¨çš„éœ€è¦ç»§ç»­é˜…è¯» <a href="https://github.com/google/guice/wiki">WIki</a> ä¸Šçš„å…¶ä»–æ–‡æ¡£ã€‚</p>
<p>ç®€è¨€ä¹‹ï¼Œ<a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> æ”¯æŒ <a href="http://javax-inject.github.io/javax-inject/" title="JSR-330: Dependency Injection for Java (javax.inject).">JSR 330</a> ä¾èµ–æ³¨å…¥æ¨¡å‹ï¼Œä½¿ç”¨åå°„æŠ€æœ¯åœ¨è¿è¡Œæ—¶æ„å»ºä¾èµ–å…³ç³»å›¾è°±å¹¶å®æ–½ä¾èµ–æ³¨å…¥ï¼›å¯¹äºå¤æ‚ä¾èµ–é¡¹æˆ–æœªä½¿ç”¨ <code>@javax.inject.Inject</code> æ³¨è§£æ ‡è¯†çš„ä¾èµ–é¡¹å¯ä»¥ä½¿ç”¨å…¶ä»¤äººå°è±¡æ·±åˆ»çš„ Binding DSL æˆ–æ ‡è®°äº† <code>@com.google.inject.Provides</code> æ³¨è§£çš„æ–¹æ³•æ¥æ˜¾å¼æŒ‡å®šã€‚</p>
<p>æœ¬æ–‡ä¸­ä½¿ç”¨çš„ <a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> çš„ç‰ˆæœ¬ä¸º <code>4.2.2</code>ï¼Œåœ¨ <code>pom.xml</code> æ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#83a598;">&lt;</span><span style="font-weight:bold;color:#8ec07c;">dependency</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">groupId</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">com.google.inject</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">groupId</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">artifactId</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">guice</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">artifactId</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">version</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">${google_guice_version}</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">version</span><span style="color:#83a598;">&gt;
&lt;/</span><span style="font-weight:bold;color:#8ec07c;">dependency</span><span style="color:#83a598;">&gt;
&lt;</span><span style="font-weight:bold;color:#8ec07c;">dependency</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">groupId</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">com.google.inject.extensions</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">groupId</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">artifactId</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">guice-multibindings</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">artifactId</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">version</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">${google_guice_version}</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">version</span><span style="color:#83a598;">&gt;
&lt;/</span><span style="font-weight:bold;color:#8ec07c;">dependency</span><span style="color:#83a598;">&gt;
</span></pre>
<p>ä½¿ç”¨ <a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> ä¹‹åçš„é¡¹ç›®æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">â”œâ”€â”€ app
â”‚Â Â  â”œâ”€â”€ AppModule.java          # æ–°å¢åŠ 
â”‚Â Â  â”œâ”€â”€ Command.java
â”‚Â Â  â”œâ”€â”€ CommandProcessor.java
â”‚Â Â  â”œâ”€â”€ GlobalContext.java
â”‚Â Â  â”œâ”€â”€ Stderr.java
â”‚Â Â  â””â”€â”€ Stdout.java
â”œâ”€â”€ echo
â”‚Â Â  â”œâ”€â”€ EchoCommand.java
â”‚Â Â  â””â”€â”€ EchoModule.java         # æ–°å¢åŠ 
â”œâ”€â”€ exit
â”‚Â Â  â”œâ”€â”€ ExitCommand.java
â”‚Â Â  â””â”€â”€ ExitModule.java         # æ–°å¢åŠ 
â”œâ”€â”€ set
â”‚Â Â  â”œâ”€â”€ SetCommand.java
â”‚Â Â  â””â”€â”€ SetModule.java          # æ–°å¢åŠ 
â”œâ”€â”€ sql
â”‚Â Â  â”œâ”€â”€ SqlCommand.java
â”‚Â Â  â”œâ”€â”€ SqlModule.java          # æ–°å¢åŠ 
â”‚Â Â  â””â”€â”€ SqlUtils.java
â”œâ”€â”€ MainApp.java                # ä¿®æ”¹
â””â”€â”€ MainModule.java             # æ–°å¢åŠ 
</span></pre>
<p>ä¸€å…±éœ€è¦å¢åŠ å…­ä¸ªç±»æ–‡ä»¶ï¼Œå’Œä¿®æ”¹ <code>MainApp</code> ä¸­ç”Ÿæˆ <code>CommandProcessor</code> å®ä¾‹çš„ä»£ç ã€‚</p>
<p>æ–°å¢åŠ çš„ <code>AppModule</code> ç±»çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public final class </span><span style="color:#8ec07c;">AppModule </span><span style="color:#fa5c4b;">extends </span><span style="color:#8ec07c;">AbstractModule </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Provides
    </span><span style="color:#fa5c4b;">static </span><span style="color:#8ec07c;">Stdout providesStdout</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fa5c4b;">return new </span><span style="color:#8ec07c;">Stdout</span><span style="color:#fdf4c1aa;">() {
            @</span><span style="color:#fdf4c1;">Override
            </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Stdout print</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">str</span><span style="color:#fdf4c1aa;">) {
                </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.err.</span><span style="color:#fdf4c1;">print(str)</span><span style="color:#fdf4c1aa;">;
                </span><span style="color:#fa5c4b;">return </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">;
            }

            @</span><span style="color:#fdf4c1;">Override
            </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Stdout println</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">str</span><span style="color:#fdf4c1aa;">) {
                </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.err.</span><span style="color:#fdf4c1;">println(str)</span><span style="color:#fdf4c1aa;">;
                </span><span style="color:#fa5c4b;">return </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">;
            }
        };
    }

    @</span><span style="color:#fdf4c1;">Provides
    </span><span style="color:#fa5c4b;">static </span><span style="color:#8ec07c;">Stderr providesStderr</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fa5c4b;">return new </span><span style="color:#8ec07c;">Stderr</span><span style="color:#fdf4c1aa;">() {
            @</span><span style="color:#fdf4c1;">Override
            </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Stderr print</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">str</span><span style="color:#fdf4c1aa;">) {
                </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.err.</span><span style="color:#fdf4c1;">print(str)</span><span style="color:#fdf4c1aa;">;
                </span><span style="color:#fa5c4b;">return </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">;
            }

            @</span><span style="color:#fdf4c1;">Override
            </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Stderr println</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">str</span><span style="color:#fdf4c1aa;">) {
                </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.err.</span><span style="color:#fdf4c1;">println(str)</span><span style="color:#fdf4c1aa;">;
                </span><span style="color:#fa5c4b;">return </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">;
            }
        };
    }
}
</span></pre>
<p>å¯ä»¥çœ‹åˆ° <code>AppModule</code> ç±»æ˜¯ä¸€ä¸ªæ™®é€šç±»ï¼Œé‡Œé¢çš„æ–¹æ³•éƒ½æ˜¯æ ‡è®°äº† <code>@com.google.inject.Provides</code> æ³¨è§£çš„é™æ€æ–¹æ³•ï¼Œç”¨äºæŒ‡ç¤ºå¦‚ä½•åˆ›å»º <code>Stdout</code> å’Œ <code>Stderr</code> æ¥å£çš„å®ç°ç±»å®ä¾‹ï¼›å¦‚æœåˆ«çš„ç»„ä»¶ä¾èµ–äº† <code>Stdout</code> æˆ– <code>Stderr</code> æ¥å£å®ä¾‹ï¼Œå¯ä»¥ä» <code>AppModule</code> ä¸­è·å–åˆ°å¦‚ä½•ç”Ÿæˆå¯¹åº”å®ä¾‹çš„çŸ¥è¯†ã€‚</p>
<p>æŒ‰ç…§ <a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> çš„è§„å®šï¼Œæ‰€æœ‰æ ‡è®° <code>@com.google.inject.Provides</code> æ³¨è§£çš„æ–¹æ³•å¿…é¡»ä½äº <code>com.google.inject.Module</code> æ¥å£çš„å®ç°ç±»ä¸­ã€‚æ‰€ä»¥ <code>AppModule</code> ç±»éœ€è¦ç»§æ‰¿ <code>com.google.inject.AbstractModule</code> ç±»ï¼ˆç±» <code>com.google.inject.AbstractModule</code> æ˜¯ <code>com.google.inject.Module</code> æ¥å£çš„å®ç°ç±»ï¼‰ã€‚</p>
<p>æ–°å¢åŠ çš„ <code>EchoModule</code> ç±»çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public final class </span><span style="color:#8ec07c;">EchoModule </span><span style="color:#fa5c4b;">extends </span><span style="color:#8ec07c;">AbstractModule </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Override
    </span><span style="color:#fa5c4b;">protected void </span><span style="color:#8ec07c;">configure</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">MapBinder</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">Command</span><span style="color:#fdf4c1aa;">&gt; binder </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">MapBinder</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">newMapBinder(
            binder(), </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1;">.class, </span><span style="color:#8ec07c;">Command</span><span style="color:#fdf4c1;">.class
        )</span><span style="color:#fdf4c1aa;">;

        binder.</span><span style="color:#fdf4c1;">addBinding(</span><span style="color:#b8bb26;">&quot;echo&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">to(</span><span style="color:#8ec07c;">EchoCommand</span><span style="color:#fdf4c1;">.class)</span><span style="color:#fdf4c1aa;">;
    }
}
</span></pre>
<p>ç±»ä¼¼äº <code>AppModule</code> ç±»ï¼Œç±» <code>EchoModule</code> ä¹Ÿç»§æ‰¿äº† <code>com.google.inject.AbstractModule</code> ç±»ã€‚åŒæ—¶ <code>EchoModule</code> ç±»è¿˜å®ç°äº† <code>configure</code> æ–¹æ³•ï¼Œåœ¨æ–¹æ³•å®ç°ä¸­ä½¿ç”¨äº† Binding DSL æ¥åˆ›å»ºç”Ÿæˆ <code>java.util.Map&lt;String, Command&gt;</code> ä¾èµ–é¡¹çš„è§„åˆ™ã€‚<a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> çš„ Binding DSL éå¸¸çµæ´»ï¼Œè€Œä¸”å¼ºå¤§ã€‚</p>
<p>ç±»ä¼¼ <code>EchoModule</code> ç±»ï¼Œæ–°å¢åŠ çš„ <code>ExitModule</code> ç±»å’Œ <code>SetModule</code> ç±»çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public final class </span><span style="color:#8ec07c;">ExitModule </span><span style="color:#fa5c4b;">extends </span><span style="color:#8ec07c;">AbstractModule </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Override
    </span><span style="color:#fa5c4b;">protected void </span><span style="color:#8ec07c;">configure</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">MapBinder</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">Command</span><span style="color:#fdf4c1aa;">&gt; binder </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">MapBinder</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">newMapBinder(
            binder(), </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1;">.class, </span><span style="color:#8ec07c;">Command</span><span style="color:#fdf4c1;">.class
        )</span><span style="color:#fdf4c1aa;">;

        binder.</span><span style="color:#fdf4c1;">addBinding(</span><span style="color:#b8bb26;">&quot;exit&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">to(</span><span style="color:#8ec07c;">ExitCommand</span><span style="color:#fdf4c1;">.class)</span><span style="color:#fdf4c1aa;">;
    }
}

</span><span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">SetModule </span><span style="color:#fa5c4b;">extends </span><span style="color:#8ec07c;">AbstractModule </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Override
    </span><span style="color:#fa5c4b;">protected void </span><span style="color:#8ec07c;">configure</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">MapBinder</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">Command</span><span style="color:#fdf4c1aa;">&gt; binder </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">MapBinder</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">newMapBinder(
            binder(), </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1;">.class, </span><span style="color:#8ec07c;">Command</span><span style="color:#fdf4c1;">.class
        )</span><span style="color:#fdf4c1aa;">;

        binder.</span><span style="color:#fdf4c1;">addBinding(</span><span style="color:#b8bb26;">&quot;set&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">to(</span><span style="color:#8ec07c;">SetCommand</span><span style="color:#fdf4c1;">.class)</span><span style="color:#fdf4c1aa;">;
    }
}
</span></pre>
<p>æ–°å¢åŠ çš„ <code>SqlModule</code> ç±»çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public final class </span><span style="color:#8ec07c;">SqlModule </span><span style="color:#fa5c4b;">extends </span><span style="color:#8ec07c;">AbstractModule </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Override
    </span><span style="color:#fa5c4b;">protected void </span><span style="color:#8ec07c;">configure</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">MapBinder</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">Command</span><span style="color:#fdf4c1aa;">&gt; binder </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">MapBinder</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">newMapBinder(
            binder(), </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1;">.class, </span><span style="color:#8ec07c;">Command</span><span style="color:#fdf4c1;">.class
        )</span><span style="color:#fdf4c1aa;">;

        binder.</span><span style="color:#fdf4c1;">addBinding(</span><span style="color:#b8bb26;">&quot;sql&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">to(</span><span style="color:#8ec07c;">SqlCommand</span><span style="color:#fdf4c1;">.class)</span><span style="color:#fdf4c1aa;">;
    }

    @</span><span style="color:#fdf4c1;">Provides
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">SQLDialect providesSqlDialect</span><span style="color:#fdf4c1aa;">(@</span><span style="color:#fdf4c1;">JdbcUrl </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">url</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">JDBCUtils</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">dialect(url)</span><span style="color:#fdf4c1aa;">;
    }

    @</span><span style="color:#fdf4c1;">Provides
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">DataSource providesDataSource</span><span style="color:#fdf4c1aa;">(
        @</span><span style="color:#fdf4c1;">JdbcUrl </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">url</span><span style="color:#fdf4c1aa;">,
        @</span><span style="color:#fdf4c1;">Named</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">SqlUtils</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">NAMED_KEY_JDBC_USERNAME</span><span style="color:#fdf4c1aa;">) </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">username</span><span style="color:#fdf4c1aa;">,
        @</span><span style="color:#fdf4c1;">Named</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">SqlUtils</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">NAMED_KEY_JDBC_PASSWORD</span><span style="color:#fdf4c1aa;">) </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">pwd</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">HikariConfig</span><span style="color:#fdf4c1aa;"> config </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">HikariConfig</span><span style="color:#fdf4c1aa;">();
        config.</span><span style="color:#fdf4c1;">setJdbcUrl(url)</span><span style="color:#fdf4c1aa;">;
        config.</span><span style="color:#fdf4c1;">setUsername(username)</span><span style="color:#fdf4c1aa;">;
        config.</span><span style="color:#fdf4c1;">setPassword(pwd)</span><span style="color:#fdf4c1aa;">;
        config.</span><span style="color:#fdf4c1;">addDataSourceProperty(</span><span style="color:#b8bb26;">&quot;cachePrepStmts&quot;</span><span style="color:#fdf4c1;">, </span><span style="color:#b8bb26;">&quot;true&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
        config.</span><span style="color:#fdf4c1;">addDataSourceProperty(</span><span style="color:#b8bb26;">&quot;prepStmtCacheSize&quot;</span><span style="color:#fdf4c1;">, </span><span style="color:#b8bb26;">&quot;250&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
        config.</span><span style="color:#fdf4c1;">addDataSourceProperty(</span><span style="color:#b8bb26;">&quot;prepStmtCacheSqlLimit&quot;</span><span style="color:#fdf4c1;">, </span><span style="color:#b8bb26;">&quot;2048&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;

        </span><span style="color:#fa5c4b;">return new </span><span style="color:#8ec07c;">HikariDataSource</span><span style="color:#fdf4c1aa;">(config);
    }
}
</span></pre>
<p><code>SqlModule</code> ç±»ä¸­å¤šäº†ä¸¤ä¸ªæ ‡è®°äº† <code>@com.google.inject.Provides</code> æ³¨è§£çš„æ–¹æ³•ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥æœ‰é¢å¤–çš„å‚æ•°ï¼Œå‚æ•°çš„å€¼æ˜¯ç”±ä¾èµ–æ³¨å…¥æ¡†æ¶ç®¡ç†çš„ã€‚<code>@JdbcUrl</code> æ³¨è§£ç”¨äºå°†é”æ ‡è®°çš„ä¾èµ–é¡¹ä¸å…¶ä»–åŒç±»å‹(<code>java.lang.String</code>)çš„ä¾èµ–é¡¹åšåŒºåˆ†ï¼›<code>@javax.inject.Named</code> æ³¨è§£ä¹Ÿæ˜¯ç±»ä¼¼çš„ä½œç”¨ã€‚</p>
<p>æ–°å¢åŠ çš„ <code>MainModule</code> ç±»çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">final class </span><span style="color:#8ec07c;">MainModule </span><span style="color:#fa5c4b;">extends </span><span style="color:#8ec07c;">AbstractModule </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1aa;">jdbcUrl;
    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1aa;">jdbcUsername;
    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1aa;">jdbcPwd;

    </span><span style="color:#8ec07c;">MainModule</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">url</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">username</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">pwd</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.jdbcUrl </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> url;
        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.jdbcUsername </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> username;
        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.jdbcPwd </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> pwd;
    }

    @</span><span style="color:#fdf4c1;">Override
    </span><span style="color:#fa5c4b;">protected void </span><span style="color:#8ec07c;">configure</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fdf4c1;">bindConstant()</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">annotatedWith(</span><span style="color:#8ec07c;">JdbcUrl</span><span style="color:#fdf4c1;">.class)</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">to(jdbcUrl)</span><span style="color:#fdf4c1aa;">;
        </span><span style="color:#fdf4c1;">bindConstant()</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">annotatedWith(</span><span style="color:#8ec07c;">Names</span><span style="color:#fdf4c1;">.named(</span><span style="color:#8ec07c;">SqlUtils</span><span style="color:#fdf4c1;">.NAMED_KEY_JDBC_USERNAME))
            </span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">to(jdbcUsername)</span><span style="color:#fdf4c1aa;">;
        </span><span style="color:#fdf4c1;">bindConstant()</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">annotatedWith(</span><span style="color:#8ec07c;">Names</span><span style="color:#fdf4c1;">.named(</span><span style="color:#8ec07c;">SqlUtils</span><span style="color:#fdf4c1;">.NAMED_KEY_JDBC_PASSWORD))
            </span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">to(jdbcPwd)</span><span style="color:#fdf4c1aa;">;

        </span><span style="color:#fdf4c1;">install(</span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">AppModule</span><span style="color:#fdf4c1;">())</span><span style="color:#fdf4c1aa;">;
        </span><span style="color:#fdf4c1;">install(</span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">EchoModule</span><span style="color:#fdf4c1;">())</span><span style="color:#fdf4c1aa;">;
        </span><span style="color:#fdf4c1;">install(</span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">SetModule</span><span style="color:#fdf4c1;">())</span><span style="color:#fdf4c1aa;">;
        </span><span style="color:#fdf4c1;">install(</span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">ExitModule</span><span style="color:#fdf4c1;">())</span><span style="color:#fdf4c1aa;">;
        </span><span style="color:#fdf4c1;">install(</span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">SqlModule</span><span style="color:#fdf4c1;">())</span><span style="color:#fdf4c1aa;">;
    }
}
</span></pre>
<p><code>MainModule</code> ç±»ä¸­æœ‰ä¸€ä¸ªå¸¦ä¸‰å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œç”¨äºè·å– JDBC ç›¸å…³è®¾ç½®çš„å€¼ã€‚åœ¨ <code>configure</code> æ–¹æ³•ä½“ä¸­ï¼Œé¦–å…ˆå°† JDBC ç›¸å…³é…ç½®æ·»åŠ ä¸ºä¾èµ–é¡¹ï¼Œç„¶åå®‰è£…äº†(install)äº†ä»¥ä¸Šçš„ <code>AppModule</code>/<code>EchoModule</code>/<code>SetModule</code>/<code>ExitModule</code>/<code>SqlModule</code> ç±»ã€‚è¿™æ ·ä» <code>MainModule</code> ç±»å°±èƒ½è·å–æ‰€æœ‰æ‰€éœ€çš„ä¾èµ–é¡¹å’Œä¾èµ–å…³ç³»äº†ã€‚</p>
<p>åœ¨ <code>MainApp</code> ä¸­éœ€è¦ä» <code>MainModule</code> ç±»æ„å»º <code>com.google.inject.Injector</code> å®ä¾‹å¹¶ä»ä¸­è·å– <code>CommandProcessor</code> å®ä¾‹ï¼Œç›¸å…³ä»£ç ä¿®æ”¹ä¸ºï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">Injector</span><span style="color:#fdf4c1aa;"> injector </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">Guice</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">createInjector(</span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">MainModule</span><span style="color:#fdf4c1;">(
    </span><span style="color:#b8bb26;">&quot;jdbc:h2:mem:test&quot;</span><span style="color:#fdf4c1;">, </span><span style="color:#b8bb26;">&quot;h2&quot;</span><span style="color:#fdf4c1;">, </span><span style="color:#b8bb26;">&quot;user@H2&quot;
</span><span style="color:#fdf4c1;">))</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">CommandProcessor</span><span style="color:#fdf4c1aa;"> processor </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> injector.</span><span style="color:#fdf4c1;">getInstance(</span><span style="color:#8ec07c;">CommandProcessor</span><span style="color:#fdf4c1;">.class)</span><span style="color:#fdf4c1aa;">;
</span></pre>
<p>è¿™æ ·å°±å®Œæˆäº†åº”ç”¨ç¨‹åºçš„ç»„è£…ã€‚å®Œæ•´çš„ç¤ºä¾‹ä»£ç å¯ä»¥å‚è§ <a href="https://github.com/wbprime/java-mods/tree/master/guice-usecases">Guice Usecases</a> ã€‚</p>
<p>è¯´æ˜ï¼šæ–¹æ¡ˆä¸­ä¸ºäº†ä¿æŒéƒ¨åˆ†å®ç°ç±»å†…å®¹çš„åŒ…çº§åˆ«å¯ç”¨æ€§ï¼Œä½¿ç”¨äº†å¤šä¸ª Module ç±»æ–‡ä»¶ï¼›å¦‚æœä¸ä»‹æ„å®ç°ç±»çš„å¯è§æ€§ï¼Œå¯ä»¥æ•´ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨ä¸€ä¸ªå®Œæ•´çš„ Module ç±»æ–‡ä»¶ã€‚</p>
<h1 id="di-via-dagger"><a class="zola-anchor" href="#di-via-dagger" aria-label="Anchor link for: di-via-dagger">ğŸ”—</a>DI via Dagger</h1>
<p><a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> å®˜æ–¹ç¼–å†™äº†ä¸€ä¸ªéå¸¸æ£’çš„<a href="https://dagger.dev/tutorial/" title="Dagger Tutorial">å…¥é—¨æ‰‹å†Œ</a>ï¼Œå¦‚æœå¯¹ <a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> ä¸ç†Ÿæ‚‰çš„å¯ä»¥å…ˆé˜…è¯»è¯¥æ–‡æ¡£ã€‚</p>
<p>ç®€è¨€ä¹‹ï¼Œ<a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> æ”¯æŒ <a href="http://javax-inject.github.io/javax-inject/" title="JSR-330: Dependency Injection for Java (javax.inject).">JSR 330</a> ä¾èµ–æ³¨å…¥æ¨¡å‹ï¼Œä½¿ç”¨ <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/apt/" title="Annotation Processing Tool (apt)">Java æ³¨è§£å¤„ç†å™¨ (Annotation Processing Tool, APT)</a> æŠ€æœ¯åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç æ„å»ºä¾èµ–æ³¨å…¥æ¨¡å‹ï¼›å¯¹äºå¤æ‚ä¾èµ–é¡¹æˆ–æœªä½¿ç”¨ <code>@javax.inject.Inject</code> æ³¨è§£æ ‡è¯†çš„ä¾èµ–é¡¹å¯ä»¥ä½¿ç”¨ Module æ¥æ˜¾å¼æŒ‡å®šï¼›ç»„ä»¶çš„ç»„è£…å’Œå¯¹å¤–æš´éœ²éœ€è¦ä½¿ç”¨ Component æ¥è¿›è¡Œã€‚</p>
<p>Module æ˜¯å¯¹è´Ÿè´£æä¾›ä¾èµ–é¡¹çš„ä¸€ç»„ç±»çš„ç»Ÿç§°ã€‚æ ¹æ® <a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> çš„è§„èŒƒï¼Œä¸€ä¸ª Module ç±»éœ€è¦ç”± <code>@dagger.Module</code> æ³¨è§£æ ‡è®°ï¼Œç±»ä¸­åŒ…å«è¿”å›å€¼ä¸ºé <code>void</code> çš„æ–¹æ³•æ¥æŒ‡å®šä¾èµ–é¡¹çš„ç”Ÿæˆè§„åˆ™ï¼›è¿™äº›æ–¹æ³•å¯ä»¥æ˜¯å¸¸è§„çš„ã€é™æ€çš„æˆ–æŠ½è±¡çš„ï¼Œå¯ä»¥æœ‰é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼›è¿™äº›æ–¹æ³•éœ€è¦æŒ‰ä½¿ç”¨åœºæ™¯åˆ†åˆ«ç”¨ <code>@dagger.Provides</code> æ³¨è§£ã€<code>@dagger.Binds</code> æ³¨è§£æˆ–å…¶ä»–æ³¨è§£æ¥æ ‡è®°ã€‚</p>
<p>Component æ˜¯å¯¹é€šè¿‡ä¾èµ–é¡¹ç»„è£…æ„é€ æ‰€éœ€å¯¹è±¡å®ä¾‹çš„ä¸€ç»„ç±»çš„ç»Ÿç§°ã€‚æ ¹æ® <a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> çš„è§„èŒƒï¼Œä¸€ä¸ª Component ç±»éœ€è¦ç”± <code>@dagger.Component</code> æ³¨è§£æ ‡è®°ï¼Œç±»ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ³¨å…¥æ–¹æ³•ï¼›è¿™äº›æ–¹æ³•éƒ½å¿…é¡»æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œä¸”è¦ä¹ˆæ˜¯æ— å‚ä¸”è¿”å›ä¸€ä¸ªé <code>void</code> å€¼ï¼Œè¦ä¹ˆæ˜¯æ¥å—ä¸€ä¸ªå¾…æ³¨å…¥çš„å¯¹è±¡å®ä¾‹ä½œä¸ºå‚æ•°ä¸”æ— è¿”å›å€¼ã€‚Component ç±»å¿…é¡»æ˜¯æ¥å£ç±»æˆ–æŠ½è±¡ç±»ï¼Œå…¶å®ç°ç”± <a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> åœ¨ç¼–è¯‘å™¨ç”Ÿæˆã€‚</p>
<p>æœ¬æ–‡ä¸­ä½¿ç”¨çš„ <a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> çš„ç‰ˆæœ¬ä¸º <code>2.24</code>ï¼Œåœ¨ <code>pom.xml</code> æ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#83a598;">&lt;</span><span style="font-weight:bold;color:#8ec07c;">dependency</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">groupId</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">com.google.dagger</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">groupId</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">artifactId</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">dagger</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">artifactId</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">version</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">${google_dagger2_version}</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">version</span><span style="color:#83a598;">&gt;
&lt;/</span><span style="font-weight:bold;color:#8ec07c;">dependency</span><span style="color:#83a598;">&gt;

&lt;</span><span style="font-weight:bold;color:#8ec07c;">plugin</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">groupId</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">org.apache.maven.plugins</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">groupId</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">artifactId</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">maven-compiler-plugin</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">artifactId</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">version</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">${maven_plugin_compiler_version}</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">version</span><span style="color:#83a598;">&gt;
    &lt;</span><span style="font-weight:bold;color:#8ec07c;">configuration</span><span style="color:#83a598;">&gt;
        &lt;</span><span style="font-weight:bold;color:#8ec07c;">source</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">${compiler_source_version}</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">source</span><span style="color:#83a598;">&gt;
        &lt;</span><span style="font-weight:bold;color:#8ec07c;">target</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">${compiler_target_version}</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">target</span><span style="color:#83a598;">&gt;
        &lt;</span><span style="font-weight:bold;color:#8ec07c;">testSource</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">${compiler_testSource_version}</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">testSource</span><span style="color:#83a598;">&gt;
        &lt;</span><span style="font-weight:bold;color:#8ec07c;">testTarget</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">${compiler_testTarget_version}</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">testTarget</span><span style="color:#83a598;">&gt;
        &lt;</span><span style="font-weight:bold;color:#8ec07c;">encoding</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">${project_source_encoding}</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">encoding</span><span style="color:#83a598;">&gt;
        &lt;</span><span style="font-weight:bold;color:#8ec07c;">optimize</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">true</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">optimize</span><span style="color:#83a598;">&gt;
        </span><span style="font-style:italic;color:#928374;">&lt;!-- Slightly faster builds --&gt;
        &lt;!-- See https://issues.apache.org/jira/browse/MCOMPILER-209 --&gt;
        </span><span style="color:#83a598;">&lt;</span><span style="font-weight:bold;color:#8ec07c;">useIncrementalCompilation</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">false</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">useIncrementalCompilation</span><span style="color:#83a598;">&gt;
        &lt;</span><span style="font-weight:bold;color:#8ec07c;">annotationProcessorPaths</span><span style="color:#83a598;">&gt;
            &lt;</span><span style="font-weight:bold;color:#8ec07c;">path</span><span style="color:#83a598;">&gt;
                &lt;</span><span style="font-weight:bold;color:#8ec07c;">groupId</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">com.google.dagger</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">groupId</span><span style="color:#83a598;">&gt;
                &lt;</span><span style="font-weight:bold;color:#8ec07c;">artifactId</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">dagger-compiler</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">artifactId</span><span style="color:#83a598;">&gt;
                &lt;</span><span style="font-weight:bold;color:#8ec07c;">version</span><span style="color:#83a598;">&gt;</span><span style="color:#fdf4c1aa;">${google_dagger2_version}</span><span style="color:#83a598;">&lt;/</span><span style="font-weight:bold;color:#8ec07c;">version</span><span style="color:#83a598;">&gt;
            &lt;/</span><span style="font-weight:bold;color:#8ec07c;">path</span><span style="color:#83a598;">&gt;
        &lt;/</span><span style="font-weight:bold;color:#8ec07c;">annotationProcessorPaths</span><span style="color:#83a598;">&gt;
    &lt;/</span><span style="font-weight:bold;color:#8ec07c;">configuration</span><span style="color:#83a598;">&gt;
&lt;/</span><span style="font-weight:bold;color:#8ec07c;">plugin</span><span style="color:#83a598;">&gt;
</span></pre>
<p>ä½¿ç”¨ <a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> ä¹‹åçš„é¡¹ç›®æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">â”œâ”€â”€ app
â”‚Â Â  â”œâ”€â”€ AppModule.java          # æ–°å¢åŠ 
â”‚Â Â  â”œâ”€â”€ Command.java
â”‚Â Â  â”œâ”€â”€ CommandProcessor.java
â”‚Â Â  â”œâ”€â”€ GlobalContext.java
â”‚Â Â  â”œâ”€â”€ Stderr.java
â”‚Â Â  â””â”€â”€ Stdout.java
â”œâ”€â”€ echo
â”‚Â Â  â”œâ”€â”€ EchoCommand.java
â”‚Â Â  â””â”€â”€ EchoModule.java         # æ–°å¢åŠ 
â”œâ”€â”€ exit
â”‚Â Â  â”œâ”€â”€ ExitCommand.java
â”‚Â Â  â””â”€â”€ ExitModule.java         # æ–°å¢åŠ 
â”œâ”€â”€ set
â”‚Â Â  â”œâ”€â”€ SetCommand.java
â”‚Â Â  â””â”€â”€ SetModule.java          # æ–°å¢åŠ 
â”œâ”€â”€ sql
â”‚Â Â  â”œâ”€â”€ SqlCommand.java
â”‚Â Â  â”œâ”€â”€ SqlModule.java          # æ–°å¢åŠ 
â”‚Â Â  â””â”€â”€ SqlUtils.java
â”œâ”€â”€ MainApp.java                # ä¿®æ”¹
â””â”€â”€ MainComponent.java          # æ–°å¢åŠ 
</span></pre>
<p>ä¸€å…±éœ€è¦å¢åŠ äº”ä¸ª Module ç±»æ–‡ä»¶å’Œä¸€ä¸ª Component ç±»æ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹ <code>MainApp</code> ä¸­ç”Ÿæˆ <code>CommandProcessor</code> ç±»å®ä¾‹çš„ä»£ç ã€‚</p>
<p>æ–°å¢åŠ çš„ <code>AppModule</code> ç±»çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Module
</span><span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">AppModule </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Provides
    </span><span style="color:#fa5c4b;">static </span><span style="color:#8ec07c;">Stdout providesStdout</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fa5c4b;">return new </span><span style="color:#8ec07c;">Stdout</span><span style="color:#fdf4c1aa;">() {
            @</span><span style="color:#fdf4c1;">Override
            </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Stdout print</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">str</span><span style="color:#fdf4c1aa;">) {
                </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.err.</span><span style="color:#fdf4c1;">print(str)</span><span style="color:#fdf4c1aa;">;
                </span><span style="color:#fa5c4b;">return </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">;
            }

            @</span><span style="color:#fdf4c1;">Override
            </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Stdout println</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">str</span><span style="color:#fdf4c1aa;">) {
                </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.err.</span><span style="color:#fdf4c1;">println(str)</span><span style="color:#fdf4c1aa;">;
                </span><span style="color:#fa5c4b;">return </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">;
            }
        };
    }

    @</span><span style="color:#fdf4c1;">Provides
    </span><span style="color:#fa5c4b;">static </span><span style="color:#8ec07c;">Stderr providesStderr</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fa5c4b;">return new </span><span style="color:#8ec07c;">Stderr</span><span style="color:#fdf4c1aa;">() {
            @</span><span style="color:#fdf4c1;">Override
            </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Stderr print</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">str</span><span style="color:#fdf4c1aa;">) {
                </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.err.</span><span style="color:#fdf4c1;">print(str)</span><span style="color:#fdf4c1aa;">;
                </span><span style="color:#fa5c4b;">return </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">;
            }

            @</span><span style="color:#fdf4c1;">Override
            </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Stderr println</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">str</span><span style="color:#fdf4c1aa;">) {
                </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.err.</span><span style="color:#fdf4c1;">println(str)</span><span style="color:#fdf4c1aa;">;
                </span><span style="color:#fa5c4b;">return </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">;
            }
        };
    }
}
</span></pre>
<p>å¯ä»¥çœ‹åˆ° <code>AppModule</code> ç±»æ˜¯ä¸€ä¸ªæ™®é€šç±»ï¼Œé‡Œé¢çš„æ–¹æ³•éƒ½æ˜¯æ ‡è®°äº† <code>@dagger.Provides</code> æ³¨è§£çš„é™æ€æ–¹æ³•ï¼Œç”¨äºæŒ‡ç¤ºå¦‚ä½•åˆ›å»º <code>Stdout</code> å’Œ <code>Stderr</code> æ¥å£çš„å®ç°ç±»å®ä¾‹ï¼›å¦‚æœåˆ«çš„ç»„ä»¶ä¾èµ–äº† <code>Stdout</code> æˆ– <code>Stderr</code> æ¥å£å®ä¾‹ï¼Œå¯ä»¥ä» <code>AppModule</code> ä¸­è·å–åˆ°å¦‚ä½•ç”Ÿæˆå¯¹åº”å®ä¾‹çš„çŸ¥è¯†ã€‚</p>
<p>æ–°å¢åŠ çš„ <code>EchoModule</code> ç±»çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Module
</span><span style="color:#fa5c4b;">public abstract class </span><span style="color:#8ec07c;">EchoModule </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Binds
    </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">IntoMap
    </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">StringKey</span><span style="color:#fdf4c1aa;">(</span><span style="color:#b8bb26;">&quot;echo&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#fa5c4b;">abstract </span><span style="color:#8ec07c;">Command bindsCommand</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">EchoCommand </span><span style="color:#fdf4c1;">c</span><span style="color:#fdf4c1aa;">);
}
</span></pre>
<p>å¯ä»¥çœ‹åˆ° <code>EchoModule</code> ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé‡Œé¢åŒ…å«äº†ä¸€ä¸ªæ ‡è®°äº† <code>@dagger.Binds</code> æ³¨è§£çš„æŠ½è±¡æ–¹æ³•ï¼Œç”¨äºæŒ‡ç¤ºå¦‚ä½•æ‰¾åˆ°æ¥å£ç±»å¯¹åº”çš„å®ç°ç±»ï¼›è¯¥æ–¹æ³•éœ€è¦ä¸€ä¸ªå‚æ•°ä¸”æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œä¸”å‚æ•°ç±»å‹éœ€è¦æ˜¯è¿”å›å€¼ç±»å‹çš„å­ç±»å‹ã€‚<a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> ä¼šä»æ–¹æ³•æ³¨è§£å’Œç­¾åä¸Šæ”¶é›†åˆ°åˆ›å»ºæ‰€éœ€ä¾èµ–é¡¹çš„çŸ¥è¯†ã€‚æ³¨æ„è¯¥æ–¹æ³•åŒæ—¶è¿˜æœ‰ <code>@dagger.multibindings.IntoMap</code> æ³¨è§£å’Œ <code>@dagger.multibindings.StringKey</code> æ³¨è§£ï¼Œè¿™ä¸¤ä¸ªæ³¨è§£é…åˆä½¿ç”¨ä½¿å¾— <a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ª <code>java.util.Map&lt;String, Command&gt;</code> ç±»å‹çš„ä¾èµ–é¡¹ã€‚<code>EchoCommand</code> ç±»ç”±äºæœ‰ä¸€ä¸ªæ ‡è®° <code>@javax.inject.Inject</code> æ³¨è§£çš„æ„é€ å‡½æ•°ï¼Œæ‰€æœ‰ä¸éœ€è¦é€šè¿‡æä¾›æ ‡è®°äº† <code>@dagger.Provides</code> æ³¨è§£æˆ– <code>@dagger.Binds</code> æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•æ¥æŒ‡ç¤ºå¦‚ä½•åˆ›å»ºå®ä¾‹ã€‚</p>
<p>ç±»ä¼¼ <code>EchoModule</code> ç±»ï¼Œæ–°å¢åŠ çš„ <code>ExitModule</code> ç±»å’Œ <code>SetModule</code> ç±»çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Module
</span><span style="color:#fa5c4b;">public abstract class </span><span style="color:#8ec07c;">ExitModule </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Binds
    </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">IntoMap
    </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">StringKey</span><span style="color:#fdf4c1aa;">(</span><span style="color:#b8bb26;">&quot;exit&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#fa5c4b;">abstract </span><span style="color:#8ec07c;">Command bindsCommand</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">ExitCommand </span><span style="color:#fdf4c1;">c</span><span style="color:#fdf4c1aa;">);
}

@</span><span style="color:#fdf4c1;">Module
</span><span style="color:#fa5c4b;">public abstract class </span><span style="color:#8ec07c;">SetModule </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Binds
    </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">IntoMap
    </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">StringKey</span><span style="color:#fdf4c1aa;">(</span><span style="color:#b8bb26;">&quot;set&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#fa5c4b;">abstract </span><span style="color:#8ec07c;">Command bindsCommand</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">SetCommand </span><span style="color:#fdf4c1;">c</span><span style="color:#fdf4c1aa;">);
}
</span></pre>
<p>æ–°å¢çš„ <code>SqlModule</code> ç±»å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Module
</span><span style="color:#fa5c4b;">public abstract class </span><span style="color:#8ec07c;">SqlModule </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Binds
    </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">IntoMap
    </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">StringKey</span><span style="color:#fdf4c1aa;">(</span><span style="color:#b8bb26;">&quot;sql&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#fa5c4b;">abstract </span><span style="color:#8ec07c;">Command bindsCommand</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">SqlCommand </span><span style="color:#fdf4c1;">c</span><span style="color:#fdf4c1aa;">);

    @</span><span style="color:#fdf4c1;">Provides
    </span><span style="color:#fa5c4b;">static </span><span style="color:#8ec07c;">SQLDialect providesSqlDialect</span><span style="color:#fdf4c1aa;">(@</span><span style="color:#fdf4c1;">JdbcUrl </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">url</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">JDBCUtils</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">dialect(url)</span><span style="color:#fdf4c1aa;">;
    }

    @</span><span style="color:#fdf4c1;">Provides
    </span><span style="color:#fa5c4b;">static </span><span style="color:#8ec07c;">DataSource providesDataSource</span><span style="color:#fdf4c1aa;">(
        @</span><span style="color:#fdf4c1;">JdbcUrl </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">url</span><span style="color:#fdf4c1aa;">,
        @</span><span style="color:#fdf4c1;">Named</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">SqlUtils</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">NAMED_KEY_JDBC_USERNAME</span><span style="color:#fdf4c1aa;">) </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">username</span><span style="color:#fdf4c1aa;">,
        @</span><span style="color:#fdf4c1;">Named</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">SqlUtils</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">NAMED_KEY_JDBC_PASSWORD</span><span style="color:#fdf4c1aa;">) </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">pwd</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">HikariConfig</span><span style="color:#fdf4c1aa;"> config </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">HikariConfig</span><span style="color:#fdf4c1aa;">();
        config.</span><span style="color:#fdf4c1;">setJdbcUrl(url)</span><span style="color:#fdf4c1aa;">;
        config.</span><span style="color:#fdf4c1;">setUsername(username)</span><span style="color:#fdf4c1aa;">;
        config.</span><span style="color:#fdf4c1;">setPassword(pwd)</span><span style="color:#fdf4c1aa;">;
        config.</span><span style="color:#fdf4c1;">addDataSourceProperty(</span><span style="color:#b8bb26;">&quot;cachePrepStmts&quot;</span><span style="color:#fdf4c1;">, </span><span style="color:#b8bb26;">&quot;true&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
        config.</span><span style="color:#fdf4c1;">addDataSourceProperty(</span><span style="color:#b8bb26;">&quot;prepStmtCacheSize&quot;</span><span style="color:#fdf4c1;">, </span><span style="color:#b8bb26;">&quot;250&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
        config.</span><span style="color:#fdf4c1;">addDataSourceProperty(</span><span style="color:#b8bb26;">&quot;prepStmtCacheSqlLimit&quot;</span><span style="color:#fdf4c1;">, </span><span style="color:#b8bb26;">&quot;2048&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;

        </span><span style="color:#fa5c4b;">return new </span><span style="color:#8ec07c;">HikariDataSource</span><span style="color:#fdf4c1aa;">(config);
    }
}
</span></pre>
<p><code>SqlModule</code> ç±»ä¸­å¤šäº†ä¸¤ä¸ªæ ‡è®°äº† <code>@dagger.Provides</code> æ³¨è§£çš„é™æ€æ–¹æ³•ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥æœ‰é¢å¤–çš„å‚æ•°ï¼Œå‚æ•°çš„å€¼æ˜¯ç”±ä¾èµ–æ³¨å…¥æ¡†æ¶ç®¡ç†çš„ã€‚<code>@JdbcUrl</code> æ³¨è§£ç”¨äºå°†é”æ ‡è®°çš„ä¾èµ–é¡¹ä¸å…¶ä»–åŒç±»å‹(<code>java.lang.String</code>)çš„ä¾èµ–é¡¹åšåŒºåˆ†ï¼›<code>@javax.inject.Named</code> æ³¨è§£ä¹Ÿæ˜¯ç±»ä¼¼çš„ä½œç”¨ã€‚</p>
<p>æ–°å¢çš„æœ€åä¸€ä¸ªç±»æ˜¯ <code>MainComponent</code> ç±»ï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Component</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">modules </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1aa;">{ </span><span style="color:#8ec07c;">AppModule</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">class</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">ExitModule</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">class</span><span style="color:#fdf4c1aa;">,
    </span><span style="color:#8ec07c;">EchoModule</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">class</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">SetModule</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">class</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">SqlModule</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">class </span><span style="color:#fdf4c1aa;">})
@</span><span style="color:#fdf4c1;">Singleton
</span><span style="color:#fa5c4b;">interface </span><span style="color:#8ec07c;">MainComponent </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">static </span><span style="color:#8ec07c;">Builder builder</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">DaggerMainComponent</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">builder()</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">CommandProcessor commandProcessor</span><span style="color:#fdf4c1aa;">();

    @</span><span style="color:#fdf4c1;">Component</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">Builder
    </span><span style="color:#fa5c4b;">interface </span><span style="color:#8ec07c;">Builder </span><span style="color:#fdf4c1aa;">{
        </span><span style="color:#8ec07c;">Builder setJdbcUrl</span><span style="color:#fdf4c1aa;">(@</span><span style="color:#fdf4c1;">BindsInstance </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">JdbcUrl </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">url</span><span style="color:#fdf4c1aa;">);
        </span><span style="color:#8ec07c;">Builder setJdbcUsername</span><span style="color:#fdf4c1aa;">(
            @</span><span style="color:#fdf4c1;">BindsInstance </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Named</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">SqlUtils</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">NAMED_KEY_JDBC_USERNAME</span><span style="color:#fdf4c1aa;">) </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">username</span><span style="color:#fdf4c1aa;">);
        </span><span style="color:#8ec07c;">Builder setJdbcPassword</span><span style="color:#fdf4c1aa;">(
            @</span><span style="color:#fdf4c1;">BindsInstance </span><span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Named</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">SqlUtils</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">NAMED_KEY_JDBC_PASSWORD</span><span style="color:#fdf4c1aa;">) </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">pwd</span><span style="color:#fdf4c1aa;">);

        </span><span style="color:#8ec07c;">MainComponent build</span><span style="color:#fdf4c1aa;">();
    }
}
</span></pre>
<p><code>MainComponent</code> ç±»æ˜¯ä¸€ä¸ªæ¥å£ç±»ï¼Œå…¶ä¸­é™¤äº†ä¸€ä¸ªåä¸º <code>Builder</code> æ¥å£å’Œåä¸º <code>builder</code> çš„é™æ€ Builder ç±»åˆ›å»ºæ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªåä¸º <code>commandProcessor</code> çš„æ–¹æ³•ã€‚è¯¥æ–¹æ³•ç”¨æ¥æ„é€ åˆæ³•å¯ç”¨çš„ <code>CommandProcessor</code> ç±»å®ä¾‹ã€‚<a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> ä¼šåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä¸€ä¸ª <code>MainComponent</code> æ¥å£çš„å®ç°ç±» <code>DaggerMainComponent</code>ï¼Œä»¥åŠ <code>Builder</code> æ¥å£çš„å®ç°ç±» <code>DaggerMainComponent$Builder</code>ã€‚<code>DaggerMainComponent</code> ç±»ä¸­åŒ…å«äº† <code>commandProcessor</code> æ–¹æ³•çš„å®ç°ï¼Œæš´éœ²æ„é€ å¥½çš„ <code>CommandProcessor</code> å®ä¾‹ã€‚</p>
<p>åœ¨ <code>MainApp</code> ä¸­éœ€è¦æ„å»º <code>MainComponent</code> å®ä¾‹å¹¶ä»ä¸­è·å– <code>CommandProcessor</code> å®ä¾‹ï¼Œç›¸å…³ä»£ç ä¿®æ”¹ä¸ºï¼š</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">MainComponent</span><span style="color:#fdf4c1aa;"> mainComponent </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">MainComponent</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">builder()
    </span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">setJdbcUrl(</span><span style="color:#b8bb26;">&quot;jdbc:h2:mem:test&quot;</span><span style="color:#fdf4c1;">)
    </span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">setJdbcUsername(</span><span style="color:#b8bb26;">&quot;h2&quot;</span><span style="color:#fdf4c1;">)
    </span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">setJdbcPassword(</span><span style="color:#b8bb26;">&quot;user@H2&quot;</span><span style="color:#fdf4c1;">)
    </span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">build()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">CommandProcessor</span><span style="color:#fdf4c1aa;"> processor </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> mainComponent.</span><span style="color:#fdf4c1;">commandProcessor()</span><span style="color:#fdf4c1aa;">;
</span></pre>
<p>è¿™æ ·å°±å®Œæˆäº†åº”ç”¨ç¨‹åºçš„ç»„è£…ã€‚å®Œæ•´çš„ç¤ºä¾‹ä»£ç å¯ä»¥å‚è§ <a href="https://github.com/wbprime/java-mods/tree/master/dagger-usecases">Dagger Usecases</a>ã€‚</p>
<p>è¯´æ˜ï¼šæ–¹æ¡ˆä¸­ä¸ºäº†ä¿æŒéƒ¨åˆ†å®ç°ç±»å†…å®¹çš„åŒ…çº§åˆ«å¯ç”¨æ€§ï¼Œä½¿ç”¨äº†å¤šä¸ª Module ç±»æ–‡ä»¶ï¼›å¦‚æœä¸ä»‹æ„å®ç°ç±»çš„å¯è§æ€§ï¼Œå¯ä»¥æ•´ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨ä¸€ä¸ªå®Œæ•´çš„ Module ç±»æ–‡ä»¶ã€‚</p>
<h1 id="conculsion"><a class="zola-anchor" href="#conculsion" aria-label="Anchor link for: conculsion">ğŸ”—</a>Conculsion</h1>
<p>å¯¹æ¯”åˆ†åˆ«ä½¿ç”¨ <a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> å’Œ <a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a> å®ç°çš„ CASEï¼Œå¯ä»¥å‘ç°ä¾èµ–æ³¨å…¥æ¡†æ¶çš„å¼•å…¥å¯ä»¥å¸®åŠ©å®ç°åº”ç”¨ç¨‹åºæ ¸å¿ƒé€»è¾‘å’Œç»„è£…ä»£ç çš„è§£è€¦åˆï¼Œä½¿å¾—ä¸ä»…å¯¹æµ‹è¯•æ›´å‹å¥½ï¼Œè€Œä¸”å°è£…æ€§æ›´å¥½ã€‚è€Œä¸”ï¼Œåªè¦åšå¥½é€»è¾‘ä»£ç ä¸ç»„è£…ä»£ç çš„è§£è€¦åˆï¼Œå®é™…é¡¹ç›®é€‰æ‹©å°†ä¾èµ–æ³¨å…¥æ¡†æ¶ä» <a href="https://github.com/google/guice" title="Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.">Guice</a> è¿ç§»åˆ° <a href="https://dagger.dev/" title="Dagger is a fully static, compile-time dependency injection framework for both Java and Android.">Dagger 2</a>ï¼Œæˆ–è€…åè¿‡æ¥ï¼Œéƒ½æ˜¯ä¸€ç§å¾ˆç®€å•çš„äº‹æƒ…ã€‚</p>
<hr />
<p>ä»¥ä¸Šã€‚</p>
<p>å®Œæ•´çš„ç¤ºä¾‹ä»£ç å¯ä»¥å‚è§ <a href="https://github.com/wbprime/java-mods/tree/master/guice-usecases">Guice Usecases</a> å’Œ <a href="https://github.com/wbprime/java-mods/tree/master/dagger-usecases">Dagger Usecases</a>ã€‚</p>

    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;jsr330&#x2F;">#jsr330</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;inject&#x2F;">#inject</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;guice&#x2F;">#guice</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;dagger2&#x2F;">#dagger2</a>
                    
                </div>
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;jooq-usecases-transaction-management&#x2F;">â€¹ JOOQ çš„ä½¿ç”¨ - ä½¿ç”¨äº‹åŠ¡ (Transaction)</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;a-production-bug-leaking-sockets-fd-reproducing-practice&#x2F;">ä¸€æ¬¡ç”±äºç½‘ç»œå¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦æ³„éœ²å¯¼è‡´çº¿ä¸ŠæœåŠ¡äº‹æ•…åŸå› çš„æ’æŸ¥ç»å† â€º</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;even.js" ></script>
      
    </body>

</html>
