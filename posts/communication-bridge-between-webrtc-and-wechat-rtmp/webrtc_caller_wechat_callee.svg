<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="657px" preserveAspectRatio="none" style="width:611px;height:657px;" version="1.1" viewBox="0 0 611 657" width="611px" zoomAndPan="magnify"><defs><filter height="300%" id="fv1pt1yxuslqf" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="54" x2="54" y1="88.19" y2="568.5212"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="153" x2="153" y1="88.19" y2="568.5212"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="272" x2="272" y1="88.19" y2="568.5212"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="422" x2="422" y1="88.19" y2="568.5212"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="544" x2="544" y1="88.19" y2="568.5212"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="8" y="84.3421">WebRTC Peer</text><ellipse cx="54" cy="13" fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M54,21 L54,48 M41,29 L67,29 M54,48 L41,63 M54,48 L67,63 " fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="8" y="581.8633">WebRTC Peer</text><ellipse cx="54" cy="595.7112" fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M54,603.7112 L54,630.7112 M41,611.7112 L67,611.7112 M54,630.7112 L41,645.7112 M54,630.7112 L67,645.7112 " fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="110" y="84.3421">WeChat Peer</text><ellipse cx="153.5" cy="13" fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M153.5,21 L153.5,48 M140.5,29 L166.5,29 M153.5,48 L140.5,63 M153.5,48 L166.5,63 " fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="110" y="581.8633">WeChat Peer</text><ellipse cx="153.5" cy="595.7112" fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M153.5,603.7112 L153.5,630.7112 M140.5,611.7112 L166.5,611.7112 M153.5,630.7112 L140.5,645.7112 M153.5,630.7112 L166.5,645.7112 " fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="207" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="214" y="72.3421">WebRTC Gateway</text><rect fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="207" y="567.5212"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="214" y="588.8633">WebRTC Gateway</text><rect fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="122" x="359" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="366" y="72.3421">Streaming Server</text><rect fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="122" x="359" y="567.5212"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="366" y="588.8633">Streaming Server</text><rect fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="495" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="502" y="72.3421">Room Server</text><rect fill="#FEFECE" filter="url(#fv1pt1yxuslqf)" height="32.19" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="495" y="567.5212"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="502" y="588.8633">Room Server</text><rect fill="#EEEEEE" filter="url(#fv1pt1yxuslqf)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="596" x="3" y="119.6304"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="599" y1="119.6304" y2="119.6304"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="599" y1="122.6304" y2="122.6304"/><rect fill="#EEEEEE" filter="url(#fv1pt1yxuslqf)" height="24.8808" style="stroke: #000000; stroke-width: 2.0;" width="153" x="224.5" y="108.19"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="230.5" y="125.4999">signal communication</text><polygon fill="#FF0000" points="532.5,161.0708,542.5,165.0708,532.5,169.0708,536.5,165.0708" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="54" x2="538.5" y1="165.0708" y2="165.0708"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="61" y="160.3807">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="73" y="160.3807">create a new room and join as caller</text><polygon fill="#FF0000" points="532.5,191.9516,542.5,195.9516,532.5,199.9516,536.5,195.9516" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="153.5" x2="538.5" y1="195.9516" y2="195.9516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="160.5" y="191.2615">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="172.5" y="191.2615">join in the room as callee</text><polygon fill="#FF0000" points="532.5,222.8324,542.5,226.8324,532.5,230.8324,536.5,226.8324" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="54" x2="538.5" y1="226.8324" y2="226.8324"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="61" y="222.1423">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="73" y="222.1423">send offer</text><polygon fill="#FF0000" points="283,253.7132,273,257.7132,283,261.7132,279,257.7132" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="277" x2="543.5" y1="257.7132" y2="257.7132"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="289" y="253.0231">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="301" y="253.0231">offer forwarding</text><polygon fill="#FF0000" points="532.5,284.594,542.5,288.594,532.5,292.594,536.5,288.594" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="272" x2="538.5" y1="288.594" y2="288.594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="279" y="283.9039">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="291" y="283.9039">send answer</text><polygon fill="#FF0000" points="65,315.4748,55,319.4748,65,323.4748,61,319.4748" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="59" x2="543.5" y1="319.4748" y2="319.4748"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="71" y="314.7847">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="83" y="314.7847">answer forwarding</text><rect fill="#EEEEEE" filter="url(#fv1pt1yxuslqf)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="596" x="3" y="349.796"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="599" y1="349.796" y2="349.796"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="599" y1="352.796" y2="352.796"/><rect fill="#EEEEEE" filter="url(#fv1pt1yxuslqf)" height="24.8808" style="stroke: #000000; stroke-width: 2.0;" width="154" x="224" y="338.3556"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="230" y="355.6655">media communication</text><polygon fill="#0000FF" points="260,391.2364,270,395.2364,260,399.2364,264,395.2364" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="54" x2="266" y1="395.2364" y2="395.2364"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="61" y="390.5462">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="73" y="390.5462">caller media stream (RTP)</text><polygon fill="#0000FF" points="410,422.1172,420,426.1172,410,430.1172,414,426.1172" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="272" x2="416" y1="426.1172" y2="426.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="279" y="421.427">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="291" y="421.427">media forwarding</text><polygon fill="#0000FF" points="164.5,452.998,154.5,456.998,164.5,460.998,160.5,456.998" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="158.5" x2="421" y1="456.998" y2="456.998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="170.5" y="452.3078">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="182.5" y="452.3078">RTP to RTMP media</text><polygon fill="#008000" points="410,483.8788,420,487.8788,410,491.8788,414,487.8788" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="153.5" x2="416" y1="487.8788" y2="487.8788"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="160.5" y="483.1886">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="172.5" y="483.1886">callee media stream (RTMP)</text><polygon fill="#008000" points="283,514.7596,273,518.7596,283,522.7596,279,518.7596" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="277" x2="421" y1="518.7596" y2="518.7596"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="289" y="514.0694">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="301" y="514.0694">RTMP to RTP media</text><polygon fill="#008000" points="65,545.6404,55,549.6404,65,553.6404,61,549.6404" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="59" x2="271" y1="549.6404" y2="549.6404"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="71" y="544.9502">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="83" y="544.9502">callee media stream (RTP)</text><!--
@startuml

actor webrtc_peer as "WebRTC Peer"
actor wechat_peer as "WeChat Peer"
participant webrtc_gateway as "WebRTC Gateway"
participant stream_server as "Streaming Server"
participant room_server as "Room Server"

== signal communication ==

autonumber
webrtc_peer -[#red]> room_server: create a new room and join as caller
wechat_peer -[#red]> room_server: join in the room as callee
webrtc_peer -[#red]> room_server: send offer
room_server -[#red]> webrtc_gateway: offer forwarding
webrtc_gateway -[#red]> room_server: send answer
room_server -[#red]> webrtc_peer: answer forwarding

== media communication ==

autonumber
webrtc_peer -[#blue]> webrtc_gateway: caller media stream (RTP)
webrtc_gateway -[#blue]> stream_server: media forwarding
stream_server -[#blue]> wechat_peer: RTP to RTMP media

wechat_peer -[#green]> stream_server: callee media stream (RTMP)
stream_server -[#green]> webrtc_gateway: RTMP to RTP media
webrtc_gateway -[#green]> webrtc_peer: callee media stream (RTP)

@enduml

PlantUML version 1.2018.00(Fri Jan 05 03:42:56 CST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit GraalVM EE 19.2.0
Java Version: 1.8.0_221-b11
Operating System: Linux
OS Version: 5.2.11-arch1-1-ARCH
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>