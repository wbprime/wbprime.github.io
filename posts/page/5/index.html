

<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>wangbo’s blog</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">WB Prime</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;about">
                            About
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;github.wangbo.im">
                            Github
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.wangbo.im">WB Prime</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;github.wangbo.im">
                                    Github
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    
                        <div class="posts">
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-integration-testing-controllers&#x2F;">Spring MVC Integration Testing - Controllers</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-04-09</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>本文是<a href="https://www.wangbo.im/posts/spring-mvc-testing-content/">Spring MVC Testing</a> 集成测试系列的第2篇，原文链接：<a href="http://www.petrikainulainen.net/programming/spring-framework/integration-testing-of-spring-mvc-applications-controllers/">Integration Testing of Spring MVC Applications: Controllers</a>。</p>
<p>本文主要介绍如何为“标准”Controller编写集成测试。在这里“标准”的含义延续前一个序列 <a href="https://www.wangbo.im/posts/spring-mvc-testing-content/">Spring MVC Testing</a> 中的含义，表示不使用Ajax的请求或者处理Form结果的请求。</p>
<p>同样地，本文还是一步一步地为我们的TodoApplication编写集成测试。该程序提供Todo项的增删改查（CRUD）接口，本文主要关注其中的3个接口：获取Todo项列表；查看单个Todo项的详情；以及删除某个Todo项。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-integration-testing-controllers&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-integration-testing-configuration&#x2F;">Spring MVC Integration Testing - Configuration</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-04-09</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>本文是 <a href="https://www.wangbo.im/posts/spring-mvc-testing-content/">Spring MVC Testing</a> 集成测试系列的第1篇，原文链接：<a href="http://www.petrikainulainen.net/programming/spring-framework/integration-testing-of-spring-mvc-applications-configuration/">Integration Testing of Spring MVC Applications: Configuration</a>。</p>
<p>没有人会否认集成测试的重要性，它是验证我们开发的组件能够正常协同工作的重要手段。不幸的是，对使用Spring MVC开发的web应用程序作集成测试有一点麻烦。</p>
<p>过去我们一直用 <a href="http://docs.seleniumhq.org">Selenium</a> 和 <a href="https://jwebunit.github.io/jwebunit/">JWebUnit</a> 来对web应用接口作集成测试，然后效果不是很好。这种方法有以下三个缺点：</p>
<ul>
<li>对于开发中的web接口，编写和维护测试的工作量比较大</li>
<li>对于使用Javascript，尤其是Ajax的web应用，可用性不高</li>
<li>必须在web容器中启动运行，导致速度慢而且很没有效率</li>
</ul>
<p>经常就是开发者在后续开发过程中觉得维护之前的集成测试用例太过耗时而且效果不大，所以废弃了这种形式的集成测试。幸运的是，我们找到了一种新型的集成测试框架Spring MVC Test可以用来简化测试工作。</p>
<p>本文主要介绍如何配置Spring MVC Test框架来进行web应用的测试。本系列使用的工具包括：</p>
<ul>
<li>Spring Framework 3.2</li>
<li>JUnit 4.10</li>
<li>Maven 3.0.3</li>
</ul>
<p>我们一起来开始进入Spring MVC Test的世界吧！</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-integration-testing-configuration&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-unit-testing-rest-api&#x2F;">Spring MVC Unit Testing - REST API</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-04-09</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>本文是 <a href="https://www.wangbo.im/posts/spring-mvc-testing-content/">Spring MVC Testing</a> 单元测试系列的第3篇，原文链接：<a href="http://www.petrikainulainen.net/programming/spring-framework/unit-testing-of-spring-mvc-controllers-rest-api/">Unit Testing of Spring MVC Controllers: REST API</a>。</p>
<p>使用Spring MVC可以很方便第创建REST风格的接口，但是编写REST风格接口的单元测试并不是那么方便。幸运的是，Spring MVC Test极大地简化了我们为REST风格controller编写单元测试的工作。</p>
<p>本文将通过为<code>Todo</code>项的增删改查（CRUD）的REST风格接口操作编写单元测试的方式，一步一步地讲解如何使用Spring MVC Test来进行单元测试。OK，我们快点进入正文吧！</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-unit-testing-rest-api&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-unit-testing-normal-controllers&#x2F;">Spring MVC Unit Testing - Normal Controllers</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-04-09</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>本文是 <a href="https://www.wangbo.im/posts/spring-mvc-testing-content/">Spring MVC Testing</a> 单元测试系列的第2篇，原文链接：<a href="http://www.petrikainulainen.net/programming/spring-framework/unit-testing-of-spring-mvc-controllers-normal-controllers/">Unit Testing of Spring MVC Controllers: &quot;Normal&quot; Controllers</a>。</p>
<p>本系列的第1部分讲述了使用Spring MVC Test应如何进行单元测试的<a href="https://www.wangbo.im/posts/spring-mvc-testing-unit-testing-configuration/">配置</a>，现在可以开始实战一下如何对标准controller编写单元测试。</p>
<p>首先需要明确一下。</p>
<blockquote>
<p>何为标准controller？</p>
</blockquote>
<p>注意：原文标准是加了双引号的（&quot;normal&quot;）</p>
<p>我们称之为标准controller的Controller，是渲染view或者处理form提交请求的Controller。（与之相对的是Rest Controller）。</p>
<p>OK，现在我们进入正文。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-unit-testing-normal-controllers&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-unit-testing-configuration&#x2F;">Spring MVC Unit Testing - Configuration</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-04-09</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>本文是 <a href="https://www.wangbo.im/posts/spring-mvc-testing-content/">Spring MVC Testing</a> 单元测试系列的第1篇，原文链接：<a href="http://www.petrikainulainen.net/programming/spring-framework/unit-testing-of-spring-mvc-controllers-configuration/">Unit Testing of Spring MVC Controllers: Configuration</a>。</p>
<p>一直以来，为Spring MVC的Controller写单元测试的工作既简单又问题多多。简单体现在单元测试可以很简单地写个测试用例调用一下目标Controller的方法；问题在于这种单元测试完全没有用（不是HTTP的请求），比如说，这种单元测试的方法没办法测试请求映射、参数验证和异常映射等。</p>
<p>幸运的是，从Spring 3.2开始，我们可以使用<a href="http://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/htmlsingle/#new-in-3.2-spring-mvc-test">Spring MVC Test Framework</a>这一强大的工具通过DispatcherServlet来仿照HTTP请求的方式来单元测试Controller的方法。</p>
<p>本文主要介绍如何配置Spring使得可以单元测试Spring MVC Controllers。</p>
<p>下面进入正题。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-unit-testing-configuration&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-content&#x2F;">Spring MVC Testing: Content&#x2F;目录</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-04-09</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>本系列翻译自<a href="http://www.petrikainulainen.net/spring-mvc-test-tutorial/">Spring MVC Test Tutorial</a>。</p>
<p>Springframework自3.2版本以后，提供了<a href="http://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/testing.html#spring-mvc-test-framework">Spring MVC Test Framework</a>用于对Spring MVC项目进行测试。</p>
<p>本系列一共两个部分：单元测试和集成测试。</p>
<p>单元测试将一个一个的Spring MVC Controller作为一个单元，对每一个接口进行测试。Controller层对Service层的调用使用Mockito进行模拟。</p>
<p>集成测试对整个web服务进行测试，虽然测试的单位仍然是接口，但是测试结果更偏向于生产环境。为了保证测试的稳定性，使用了DBUnit来控制每一次测试的数据样本。</p>
<p>需要注意的是，虽然这个系列将Spring MVC Test Framework分为单元测试和集成测试两个部分，但是对于Spring本身来说，其内部实现都是一样的。单元测试和集成测试的区分，是从开发者的角度进行的区分。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-mvc-testing-content&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-04-07-learning-java-concurrency-reentrantreadwritelock&#x2F;">Learning Java Concurrency - ReentrantReadWriteLock</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-04-07</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p><code>ReentrantLock</code>是互斥锁，对于要保护的资源，同一时间只能有一个线程进行访问。所谓的访问，就是读和写。但是在实际中，往往是读操作对互斥性的要求远远低于写操作。</p>
<p>考虑一个共享资源，比如一个List对象，可能会有多个线程对其进行读写。</p>
<p>下面是使用<code>ReentrantLock</code>实现的一个版本。</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">private static class </span><span style="color:#8ec07c;">ExclusiveLockStack </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt; list </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">ArrayList</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt;();
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">ReentrantLock </span><span style="color:#fdf4c1aa;">lock </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">ReentrantLock</span><span style="color:#fdf4c1aa;">();
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public void </span><span style="color:#8ec07c;">push</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">val</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(</span><span style="color:#d3869b;">null </span><span style="color:#fe8019;">==</span><span style="color:#fdf4c1aa;"> val)    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">lock.</span><span style="color:#fdf4c1;">lock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">list.</span><span style="color:#fdf4c1;">add(val)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">finally </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">lock.</span><span style="color:#fdf4c1;">unlock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">String last</span><span style="color:#fdf4c1aa;">() {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">lock.</span><span style="color:#fdf4c1;">lock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;"> str </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">final int</span><span style="color:#fdf4c1aa;"> lastIdx </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> list.</span><span style="color:#fdf4c1;">size() </span><span style="color:#fe8019;">- </span><span style="color:#d3869b;">1</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(lastIdx </span><span style="color:#fe8019;">&gt;= </span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">str </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> list.</span><span style="color:#fdf4c1;">get(lastIdx)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">finally </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">lock.</span><span style="color:#fdf4c1;">unlock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> str;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">}
</span></pre>
<p>下面是使用<code>ReentrantReadWriteLock</code>实现的一个版本。</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">ReadWrittatic </span><span style="color:#fa5c4b;">class </span><span style="color:#8ec07c;">ReadWriteLockStack </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt;           list  </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">ArrayList</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt;();
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">ReentrantReadWriteLock </span><span style="color:#fdf4c1aa;">lock  </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">ReentrantReadWriteLock</span><span style="color:#fdf4c1aa;">();
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">Lock                   </span><span style="color:#fdf4c1aa;">rLock </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> lock.</span><span style="color:#fdf4c1;">readLock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">Lock                   </span><span style="color:#fdf4c1aa;">wLock </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> lock.</span><span style="color:#fdf4c1;">writeLock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public void </span><span style="color:#8ec07c;">push</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">val</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(</span><span style="color:#d3869b;">null </span><span style="color:#fe8019;">==</span><span style="color:#fdf4c1aa;"> val)    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">wLock.</span><span style="color:#fdf4c1;">lock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">list.</span><span style="color:#fdf4c1;">add(val)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">finally </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">wLock.</span><span style="color:#fdf4c1;">unlock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">String last</span><span style="color:#fdf4c1aa;">() {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">rLock.</span><span style="color:#fdf4c1;">lock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;"> str </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">final int</span><span style="color:#fdf4c1aa;"> lastIdx </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> list.</span><span style="color:#fdf4c1;">size() </span><span style="color:#fe8019;">- </span><span style="color:#d3869b;">1</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(lastIdx </span><span style="color:#fe8019;">&gt;= </span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">str </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> list.</span><span style="color:#fdf4c1;">get(lastIdx)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">finally </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">rLock.</span><span style="color:#fdf4c1;">unlock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> str;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">}
</span></pre>
                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-04-07-learning-java-concurrency-reentrantreadwritelock&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-04-07-learning-java-concurrency-reentrantlock-condition&#x2F;">Learning Java Concurrency - ReentrantLock &amp; Condition</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-04-07</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p><code>ReentrantLock</code>是<code>synchronized</code>的高阶版本，用来控制多线程同步。<code>ReentrantLock</code>是一种独占锁，同一时间只能有一个线程使用一把锁，其他请求加锁的线程都会被阻塞。除了控制多线程同步之外，<code>ReentrantLock</code>还提供了<code>Condition</code>用来进行多线程通讯。<code>Condition</code>是<code>Object</code>类的方法<code>wait &amp; notify</code>的替代版本，可以用等待/通知模式来有效控制多线程对共享资源的访问。</p>
<p>仿<a href="https://www.wangbo.im/posts/learning-java-concurrency-synchronized/"><code>synchronized</code></a>，用<code>ReentrantLock</code>实现单例模式的代码如下：</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">private static class </span><span style="color:#8ec07c;">Singleton </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private static volatile </span><span style="color:#8ec07c;">Singleton INSTANCE</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private static </span><span style="color:#8ec07c;">ReentrantLock </span><span style="color:#fdf4c1aa;">lock </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">ReentrantLock</span><span style="color:#fdf4c1aa;">();
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">Singleton</span><span style="color:#fdf4c1aa;">() {}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public static </span><span style="color:#8ec07c;">Singleton instance</span><span style="color:#fdf4c1aa;">() {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#8ec07c;">Singleton </span><span style="color:#fa5c4b;">var </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">INSTANCE</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(</span><span style="color:#d3869b;">null </span><span style="color:#fe8019;">==</span><span style="color:#fdf4c1aa;"> var) {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">lock.</span><span style="color:#fdf4c1;">lock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fa5c4b;">var </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">INSTANCE</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">(</span><span style="color:#d3869b;">null </span><span style="color:#fe8019;">==</span><span style="color:#fdf4c1aa;"> var) {
</span><span style="color:#fdf4c1aa;">                    </span><span style="color:#fdf4c1;">INSTANCE </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> var </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">Singleton</span><span style="color:#fdf4c1aa;">();
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">finally </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">lock.</span><span style="color:#fdf4c1;">unlock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">return var</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">}
</span></pre>
<p>仿<a href="https://www.wangbo.im/posts/2016-04-06-learning-java-concurrency-wait-notify/"><code>wait &amp; notify</code></a>，用<code>Condition</code>来实现父子通知汇款的代码如下：</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">private static class </span><span style="color:#8ec07c;">DepositAccount </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private int </span><span style="color:#fdf4c1aa;">money;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">ReentrantLock </span><span style="color:#fdf4c1aa;">lock </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">ReentrantLock</span><span style="color:#fdf4c1aa;">();
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">Condition </span><span style="color:#fdf4c1aa;">cond </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> lock.</span><span style="color:#fdf4c1;">newCondition()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">DepositAccount</span><span style="color:#fdf4c1aa;">() {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.money </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public void </span><span style="color:#8ec07c;">withdraw</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">val</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">lock.</span><span style="color:#fdf4c1;">lock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">while </span><span style="color:#fdf4c1aa;">(money </span><span style="color:#fe8019;">&lt;</span><span style="color:#fdf4c1aa;"> val) {
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">                    </span><span style="color:#fdf4c1aa;">cond.</span><span style="color:#fdf4c1;">await()</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// 钱不够，等一会儿
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">catch </span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">InterruptedException </span><span style="color:#fdf4c1;">e</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">                    </span><span style="font-style:italic;color:#928374;">// do nothing here
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">money </span><span style="color:#fe8019;">-=</span><span style="color:#fdf4c1aa;"> val;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">finally </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">lock.</span><span style="color:#fdf4c1;">unlock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public void </span><span style="color:#8ec07c;">deposite</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">val</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">lock.</span><span style="color:#fdf4c1;">lock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">money </span><span style="color:#fe8019;">+=</span><span style="color:#fdf4c1aa;"> val;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">cond.</span><span style="color:#fdf4c1;">signalAll()</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// 存完钱周知一下
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">finally </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">lock.</span><span style="color:#fdf4c1;">unlock()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">}
</span></pre>
                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-04-07-learning-java-concurrency-reentrantlock-condition&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-04-06-learning-java-concurrency-wait-notify&#x2F;">Learning Java Concurrency - wait &amp; notify</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-04-06</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>在synchronized关键字之外，Java提供了另外的<code>wait</code>和<code>notify</code>函数族用于支援多线程通信，使用上类似于JUC的Condition类。</p>
<p><code>wait()</code>、<code>notify()</code>和<code>notifyAll()</code>是Object类的方法，与synchronized配套使用。</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">Object </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">...
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public final native void </span><span style="color:#8ec07c;">wait</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">long </span><span style="color:#fdf4c1;">timeout</span><span style="color:#fdf4c1aa;">) </span><span style="color:#fa5c4b;">throws </span><span style="color:#8ec07c;">InterruptedException</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public final void </span><span style="color:#8ec07c;">wait</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">long </span><span style="color:#fdf4c1;">timeout</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">int </span><span style="color:#fdf4c1;">nanos</span><span style="color:#fdf4c1aa;">) </span><span style="color:#fa5c4b;">throws </span><span style="color:#8ec07c;">InterruptedException</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public final void </span><span style="color:#8ec07c;">wait</span><span style="color:#fdf4c1aa;">() </span><span style="color:#fa5c4b;">throws </span><span style="color:#8ec07c;">InterruptedException</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public final native void </span><span style="color:#8ec07c;">notify</span><span style="color:#fdf4c1aa;">();
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public final native void </span><span style="color:#8ec07c;">notifyAll</span><span style="color:#fdf4c1aa;">();
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">...
</span><span style="color:#fdf4c1aa;">}
</span></pre>
<p><code>wait</code>一共有三个函数。调用<code>wait</code>的线程必须已经持有了同一个对象的同步器（使用synchronized）。调用<code>wait</code>的线程会进入等待状态，直到另外的线程调用了同一个对象的<code>notify</code>函数，或者指定的等待时间过期，或者被中断（引发InterruptedException）。调用<code>wait</code>函数之后，当前线程会放弃已经持有的同步器。</p>
<p><code>notify</code>一共是有两个函数。<code>notify()</code>函数会唤醒当前的由于执行<code>wait</code>而进入等待的某个线程；注意，被唤醒的线程是不可预料的，也就是说不同的JVM实现可以用不同的规则算法来决定被唤醒的是哪一个线程。<code>notifyAll()</code>函数会唤醒所有的等待线程，但是只会有一个线程最终进入执行。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-04-06-learning-java-concurrency-wait-notify&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;learning-java-concurrency-synchronized&#x2F;">Learning Java Concurrency - synchronized</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-04-01</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>synchronized，同步控制器，是Java原生提供的多线程同步控制的工具，是Java语法的一部分。</p>
<p>synchronized在语义上等同于一个独占锁。synchronized可以用来修饰一个方法，标识该方法是可同步的；也可以用来修饰语句块，标识该语句块是同步的。在代码经过编译之后，JVM会在方法或者语句块的前后插入<code>monitorenter</code>和<code>monitorexit</code>的虚拟机指令，这两条指令又会隐式地调用<code>lock</code>原语。</p>
<p>synchronized可以使用在普通方法里，也可以使用在静态方法里。</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">class </span><span style="color:#8ec07c;">Synchronized </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public synchronized void </span><span style="color:#8ec07c;">method1</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">val</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.out.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;1: Begin add &quot; </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> val)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.out.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;1: Finish add &quot; </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> val)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public synchronized static void </span><span style="color:#8ec07c;">method2</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">val</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.out.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;2: Begin add &quot; </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> val)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.out.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;2: Finish add &quot; </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> val)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public void </span><span style="color:#8ec07c;">method3</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">val</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">synchronized</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.out.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;3: Begin add &quot; </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> val)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.out.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;3: Finish add &quot; </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> val)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public static void </span><span style="color:#8ec07c;">method4</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">val</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">synchronized</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">Synchronized</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">class</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.out.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;4: Begin add &quot; </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> val)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.out.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;4: Finish add &quot; </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> val)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">}
</span></pre>
                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;learning-java-concurrency-synchronized&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;learning-java-concurrency-content&#x2F;">Learning Java Concurrency - Content&#x2F;目录</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-03-31</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>Java Concurrency是学习Java的过程中绕不过去的一道坎。既然绕不过去，只能一点一点去学习它，然后了解它。本系列是在学习Java Concurrency过程中的记录，鉴于网络上关于原理和实现代码的文章一大堆，所以本系列会尽量以实际应用为主。毕竟原理了解的再深，还是要落地为代码。</p>
<p>本系列主要参考<a href="http://www.blogjava.net/xylz/archive/2010/07/08/325587.html">《深入浅出Java Concurrency》</a>系列。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;learning-java-concurrency-content&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-03-30-learning-java-concurrency-cyclicbarrier&#x2F;">Learning Java Concurrency - CyclicBarrier</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-03-30</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>CyclicBarrier，正如同名字里面表达出来的，是一个可以循环使用的屏障。与CountDownLatch类似，它可以用来表达等待某个状态，比如大家都到齐了，那么开始开会吧。与CountDownLatch不同的是，它可以多次等待，也就是可以等待多个状态。</p>
<p>好吃不过栗子。比如哈利波特的三强争霸赛，要一项一项任务地完成，大家都结束了（不管成功还是失败），才开始计划下一个任务。第一个是去挑战龙；然后是到海里面挑战人鱼群；最后是挑战伏地魔。每一个任务总是要等大家都完成了才开始。</p>
<p>还有一个栗子。大家一起去面试，有的公司为了省事，等凑齐了一波人才开始走流程。HR领着大家一起先笔试，然后安排初面官，然后安排复试官。每一关刷掉一波人，但是只有大家都结束了才进行下一轮。别问我哪里有这样的招聘部门，人家开心就好。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-03-30-learning-java-concurrency-cyclicbarrier&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-03-30-learning-java-concurrency-countdownlatch&#x2F;">Learning Java Concurrency - CountDownLatch</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-03-30</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>CountDownLatch 是一种比较有意思的线程同步方法，主要用于需要同步启动的环境中。</p>
<p>举个栗子，部门进行聚餐要等到大家都到齐了才能开动。这个时候CountDownLatch可以理解为“还有多少人没有到”这个东西，来了一个，这个东西的值就会减1。一直到人都到齐了，这个东西的值变为了0,也就是可以开吃了。</p>
<p>举个栗子，通用的make进行多工程代码编译，必须所有工程编译完了才能结束。</p>
<p>举个栗子，项目上线，各个模块都上线完了，leader说一句OK，大家才能走。</p>
<p>要注意以上几个栗子都是每个线程减1，但是实际中具体减多少不做限制。</p>
<p>比如，猫有9条命，两个人你一下我一下一刀一刀砍上去，然后它就死了。这个也可用CountDownLatch来描述。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-03-30-learning-java-concurrency-countdownlatch&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-03-30-learning-java-concurrent-semaphore&#x2F;">Learning Java Concurrency - Semaphore</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-03-30</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>Semaphore，信号量。信号量可以理解为令牌掌牌使，负责令牌的发放；当线程需要执行任务时，先到信号量处领取令牌，领取到了令牌再去执行任务；如果令牌被领光了，就需要一直等待；如果任务执行完了，需要到信号量处交还令牌。很简单的逻辑！</p>
<p>还是吃个栗子，地铁里面公厕，一般也就3、4个坑位。人有三急，当你有需要的时候，还必须得靠这个解决。这个时候，如果公厕里没有人，或者还剩最后一个坑位，那就啥也别说了，进去吧。但是，如果，满了。就，只有，等，了。不着急可以等一等；实在憋不住的，可以催一催。但是不管急不急，都要等里面随便一个里面出来人了才能进去。这个就是典型的信号量。</p>
<p>还有就是非常典型的生产者/消费者问题了。有一个仓库，里面的仓位是有限的。生产者只有当仓库里面有空仓位时才能进行生产；如果没有空仓位，则需要等待；如果生产了一次，则仓库少了一个空仓位。消费者只有当仓库里有非空仓位时才能消费；如果没有非空仓位，就需要等待；如果消费了一次，仓库里多了一个空仓位。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-03-30-learning-java-concurrent-semaphore&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-annotation-based-configuration&#x2F;">Spring: Annotation based configuration</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2015-06-08</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        
                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;spring-annotation-based-configuration&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                        </div>
                        <nav class="pagination">
                            
                                <a class="previous" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;page&#x2F;4&#x2F;">‹ Previous</a>
                            
                            
                                <a class="next" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;page&#x2F;6&#x2F;">Next ›</a>
                            
                        </nav>
                    
                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;even.js" ></script>
      
    </body>

</html>
