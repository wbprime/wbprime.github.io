

<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>wangbo’s blog</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">WB Prime</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;github.wangbo.im">
                            Github
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.wangbo.im">WB Prime</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;github.wangbo.im">
                                    Github
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    
                        <div class="posts">
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-09-09-ffmpeg-note-record-xorg-video&#x2F;">Record video from Xorg using FFmpeg</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-09-09</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>使用 <a href="https://ffmpeg.org/ffmpeg.html">ffmpeg</a> 在 X 下进行录屏，可以使用如下命令：</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1;">ffmpeg -f x11grab -video_size 1366x768 -framerate 24 -i :0.0+0,0 $(date +%Y%m%dT%H%M%S.%</span><span style="color:#d3869b;">3</span><span style="color:#fdf4c1;">N.avi)
</span></pre>
<p>使用了 <a href="https://ffmpeg.org/ffmpeg-devices.html#x11grab">x11grap</a> 解码器。</p>
<p>参见 <a href="https://trac.ffmpeg.org/wiki/Capture/Desktop">Capturing your Desktop / Screen Recording</a></p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-09-09-ffmpeg-note-record-xorg-video&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-08-31-slow-mysql-query-on-too-many-cas-updating-failure&#x2F;">一次由于线上 MySQL 并发抢占更新冲突引发的 BUG</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-08-31</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>前几天在处理线上问题的时候，发现了一个由于多客户端并发使用 CAS 去更新相同记录而导致的锁冲突，引发了数据库管理系统的慢查询累积报警。慢查询导致连接数增加，并引起插入和更新操作被堵塞，引起少量的业务堆积。</p>
<p>一图胜千言。</p>
<p><img src="https://www.wangbo.im/posts/2019-08-31-slow-mysql-query-on-too-many-cas-updating-failure/mysql.all.png" alt="mysql_stats.all" /></p>
<p>虽然定位并解决了问题，但还是需要事后总结一下，以资后鉴。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-08-31-slow-mysql-query-on-too-many-cas-updating-failure&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-08-28-intro-to-spring-cloud-gateway-slide&#x2F;">Intro to Spring Cloud Gateway</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-08-28</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>本文基于在部门内的一次分享修改而成，主要介绍 <a href="https://spring.io/projects/spring-cloud-gateway">Spring Cloud Gateway</a> 的请求处理流程和装配流程。</p>
<p>演示文档是从 markdown 格式文本通过格式转换工具 <a href="https://pandoc.org/">Pandoc</a> 引用
<a href="https://revealjs.com">Reveal.js</a> 转换得到，可供下载。</p>
<p>| Downloads            |
| ---                  |
| <a href="https://www.wangbo.im/posts/2019-08-28-intro-to-spring-cloud-gateway-slide/slide.md">Markdown</a> |
| <a href="https://www.wangbo.im/posts/2019-08-28-intro-to-spring-cloud-gateway-slide/slide.html">Slide</a>  |</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-08-28-intro-to-spring-cloud-gateway-slide&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-21-ffmpeg-vsync-explained&#x2F;">Ffmpeg -vsync 使用场景辨析</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-07-21</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>在使用 <a href="http://ffmpeg.org">Ffmpeg</a> 进行视频抽帧时，发现 <code>-vsync</code> 参数的意思理解的不是很清楚。本文通过不同的场景
使用结果对比来辨析 <code>-vsync</code> 选项的枚举参数值的区别。</p>
<p>以下是 <a href="http://ffmpeg.org">Ffmpeg</a> 官网上关于 <code>-vsync</code> 的全部说明：</p>
<blockquote>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">-vsync parameter
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">Video sync method. For compatibility reasons old values can be specified as numbers. Newly added values will have to be specified as strings always.
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">0, passthrough
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">Each frame is passed with its timestamp from the demuxer to the muxer.
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">1, cfr
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">Frames will be duplicated and dropped to achieve exactly the requested constant frame rate.
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">2, vfr
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">Frames are passed through with their timestamp or dropped so as to prevent 2 frames from having the same timestamp.
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">drop
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">As passthrough but destroys all timestamps, making the muxer generate fresh timestamps based on frame-rate.
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">-1, auto
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">Chooses between 1 and 2 depending on muxer capabilities. This is the default method.
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">Note that the timestamps may be further modified by the muxer, after this. For example, in the case that the format option avoid_negative_ts is enabled.
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">With -map you can select from which stream the timestamps should be taken. You can leave either video or audio unchanged and sync the remaining stream(s) to the unchanged one.
</span></pre></blockquote>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-21-ffmpeg-vsync-explained&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-21-ffmpeg-snapshot-kuaizhao-thumbnail-concluded&#x2F;">Ffmpeg snapshot&#x2F;thumbnail 快照套路总结</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-07-21</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>使用 <a href="http://ffmpeg.org/">Ffmpeg</a> 对视频进行抽帧操作，即把视频中感兴趣的帧输出为图片；该操作也经常被称之为视频快照、视频截图等。</p>
<p>视频抽帧按照输出文件的格式不同，可以输出为 <code>jpg</code>、<code>png</code>、<code>gif</code>、<code>webp</code> 等格式文件。</p>
<p>视频抽帧按照选取视频帧的条件不同，可以分为按类型、按时间、按场景变化等不同的套路。</p>
<p>本文从以上两个方面汇总使用 <a href="http://ffmpeg.org/">Ffmpeg</a> 抽帧的套路。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-21-ffmpeg-snapshot-kuaizhao-thumbnail-concluded&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-08-general-video-bitrate-recommendation&#x2F;">[Note] General Video Bitrate Recommendation</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-07-08</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>在视频转码的过程中，比较关键的是需要确定目标码率（或最大码率）。</p>
<p>在网上找了一下大型互联网公司的推荐标准，聊为参考。</p>
<ul>
<li><a href="https://www.wangbo.im/posts/2019-07-08-general-video-bitrate-recommendation/#youtube">YouTube</a></li>
<li><a href="https://www.wangbo.im/posts/2019-07-08-general-video-bitrate-recommendation/#apple">Apple</a></li>
<li><a href="https://www.wangbo.im/posts/2019-07-08-general-video-bitrate-recommendation/#a-li-yun-yun-qi-she-qu-mou-bo-ke">阿里云云栖社区博客</a></li>
</ul>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-08-general-video-bitrate-recommendation&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-06-generating-hls-m3u8-using-ffmpeg&#x2F;">Generating HLS&#x2F;M3U8 Using FFmpeg</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-07-06</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p><a href="http://ffmpeg.org/" title="FFmpeg A complete, cross-platform solution to record, convert and stream audio and video.">FFmpeg</a> 是开源的音视频处理项目，以使用灵活、功能丰富著称，被各大互联网公司用来构建多媒体服务的基础。</p>
<p>最近的项目中需要提供音视频多码率转码支持，集中调研了 <a href="http://ffmpeg.org/" title="FFmpeg A complete, cross-platform solution to record, convert and stream audio and video.">FFmpeg</a> 对 <a href="https://developer.apple.com/streaming/">Apple HTTP Live Streaming (HLS)</a> 的支持，总结一下，遂成本文。</p>
<p>说明：本文中使用的命令行 <code>ffmpeg</code> 版本为：</p>
<blockquote>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;"> </span><span style="color:#fdf4c1aa;">~  ffmpeg
</span><span style="color:#fdf4c1aa;">ffmpeg version n4.1.3 Copyright (c) 2000-2019 the FFmpeg developers
</span><span style="color:#fdf4c1aa;">  </span><span style="color:#fdf4c1aa;">built with gcc 8.2.1 (GCC) 20181127
</span><span style="color:#fdf4c1aa;">  </span><span style="color:#fdf4c1aa;">configuration: --prefix=/usr --disable-debug --disable-static --disable-stripping --enable-fontconfig --enable-gmp --enable-gnutls --enable-gpl --enable-ladspa --enable-libaom --enable-libass --enable-libbluray --enable-libdrm --enable-libfreetype --enable-libfribidi --enable-libgsm --enable-libiec61883 --enable-libjack --enable-libmodplug --enable-libmp3lame --enable-libopencore_amrnb --enable-libopencore_amrwb --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora
</span><span style="color:#fdf4c1aa;">--enable-libv4l2 --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx264 --enable-libx265 --enable-libxcb --enable-libxml2 --enable-libxvid --enable-nvdec --enable-nvenc --enable-omx --enable-shared --enable-version3
</span><span style="color:#fdf4c1aa;">  </span><span style="color:#fdf4c1aa;">libavutil      56. 22.100 / 56. 22.100
</span><span style="color:#fdf4c1aa;">  </span><span style="color:#fdf4c1aa;">libavcodec     58. 35.100 / 58. 35.100
</span><span style="color:#fdf4c1aa;">  </span><span style="color:#fdf4c1aa;">libavformat    58. 20.100 / 58. 20.100
</span><span style="color:#fdf4c1aa;">  </span><span style="color:#fdf4c1aa;">libavdevice    58.  5.100 / 58.  5.100
</span><span style="color:#fdf4c1aa;">  </span><span style="color:#fdf4c1aa;">libavfilter     7. 40.101 /  7. 40.101
</span><span style="color:#fdf4c1aa;">  </span><span style="color:#fdf4c1aa;">libswscale      5.  3.100 /  5.  3.100
</span><span style="color:#fdf4c1aa;">  </span><span style="color:#fdf4c1aa;">libswresample   3.  3.100 /  3.  3.100
</span><span style="color:#fdf4c1aa;">  </span><span style="color:#fdf4c1aa;">libpostproc    55.  3.100 / 55.  3.100
</span></pre></blockquote>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-06-generating-hls-m3u8-using-ffmpeg&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-06-understanding-rate-control-modes-x264-x265-vpx&#x2F;">[译] Understanding Rate Control Modes (x264, x265, vpx)</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-07-06</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>最近在做短视频转码的项目，涉及到视频在线传输的码率控制的问题，于网络搜寻资料时发现了一篇介绍基于
<a href="http://ffmpeg.org/" title="FFmpeg A complete, cross-platform solution to record, convert and stream audio and video.">FFmpeg</a> 的码率控制综述文章，获益匪浅，翻译出来作为读书笔记。</p>
<p>原文：<a href="https://slhck.info/video/2017/03/01/rate-control.html">Understanding Rate Control Modes (x264, x265, vpx)</a></p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-07-06-understanding-rate-control-modes-x264-x265-vpx&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-04-19-communication-bridge-between-webrtc-and-wechat-rtmp&#x2F;">WebRTC 与微信小程序的音视频互通</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-04-19</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>本文主要介绍我们打通 <a href="https://en.wikipedia.org/wiki/WebRTC" title="WebRTC (Web Real-Time Communication)">WebRTC</a> 端和微信小程序端的音视频互通方案，实现在尽量不需要改动 <a href="https://en.wikipedia.org/wiki/WebRTC" title="WebRTC (Web Real-Time Communication)">WebRTC</a> 端代码的情况下，添加对主叫和被叫微信小程序端的支持。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-04-19-communication-bridge-between-webrtc-and-wechat-rtmp&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-04-12-java-catch-all-and-assertionerror&#x2F;">Java try-catch and AssertionError</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-04-12</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>Java 的异常处理机制是 try-catch-finally 。被调用的方法或代码块可以抛出异常（Throwable，含 Exception 和 Error）；被调用的方法或代码块被包含在 try 块中；catch 块中会根据具体的异常类型来实现相关的逻辑；finally 块中实现无论是否发生异常都需要的逻辑。</p>
<p>异常处理机制很简单；但是怎么设计异常处理方式是有一些坑的。</p>
<p>有一个线上服务在更新逻辑上线时，触发了一个错误处理异常的 BUG，现简单记录之。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-04-12-java-catch-all-and-assertionerror&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-31-a-bug-introduced-by-optionallong-abuse&#x2F;">一次由于滥用 OptionalLong.orElse 引发的 BUG</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-03-31</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>JDK 8 引入了 Optional 的概念，以解决 <code>null</code> 可能引发的可能的 BUG。新的类型 <code>java.util.Optional&lt;T&gt;</code>,
<code>java.util.OptionalDouble</code>, <code>java.util.OptionalDouble</code> 和 <code>java.util.OptionalDouble</code> 能够有效避免
<code>null</code> 值的使用，强制使用者去处理 <code>absent &amp; present</code> 的不同情况。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-31-a-bug-introduced-by-optionallong-abuse&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-12-combine-vertx-and-guice-dependency-injection&#x2F;">在 Vert.x 项目中集成使用 Guice 依赖注入</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-03-31</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>本文介绍了项目中在基于 <a href="https://vertx.io" title="Eclipse Vert.x">Eclipse Vert.x</a> 的 Verticle 中使用 <a href="https://github.com/google/guice" title="Google Guice">Google Guice</a> 进行依赖注入的实践，主要的思路是在 <code>io.vertx.core.Verticle#start</code> 方法中主动创建 <code>com.google.inject.Injector</code> 注入器实例并实行注入操作，在注入操作成功结束之后再进行后续的操作。</p>
<p>在开发结束后的某一天，通过万能的搜索发现已经有人提供了基于 <a href="https://github.com/google/guice" title="Google Guice">Google Guice</a> 的 <a href="https://vertx.io" title="Eclipse Vert.x">Eclipse Vert.x</a> 扩展: <a href="https://github.com/ef-labs/vertx-guice" title="Google Guice">Vert.x Guice Extension</a>。<a href="https://github.com/ef-labs/vertx-guice" title="Google Guice">Vert.x Guice Extension</a> 扩展了 <a href="https://vertx.io" title="Eclipse Vert.x">Vert.x</a> 内置的 <code>io.vertx.core.spi.VerticleFactory</code> 机制，能够使用 SPI 的方式加载需要的
Guice 依赖。</p>
<p>本文总结一下自己的实现思路，然后分析 <a href="https://github.com/ef-labs/vertx-guice" title="Google Guice">Vert.x Guice Extension</a> 的实现细节，希望能提高自己的代码水平。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-12-combine-vertx-and-guice-dependency-injection&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-21-a-product-env-bug-misused-hashmap-nullability&#x2F;">一次由于误用 HashMap 值的 null 特性的 BUG</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-03-21</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p>最近又经历了一次线上服务的 BUG，原因是服务内部的代码逻辑问题，比较简单。</p>
<p>在此记录下来是为了提醒不要再犯。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-21-a-product-env-bug-misused-hashmap-nullability&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-12-multiple-jwt-auth-handler-in-vertx&#x2F;">Multiple JWT Auth Handlers in Vert.x</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-03-12</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        <p><a href="https://vertx.io">Vert.x</a> 的官方 Web 开发包 <a href="https://vertx.io/docs/vertx-web/java/">Vert.x-Web</a> 中
提供了内置的 Authentication&amp;Authorisation 支持；通过扩展的
<a href="https://vertx.io/docs/vertx-auth-common/java/">Auth Common</a> 模块和 <a href="https://vertx.io/docs/vertx-auth-jdbc/java/">JDBC
auth</a> <a href="https://vertx.io/docs/vertx-auth-mongo/java/">MongoDB
auth</a> <a href="https://vertx.io/docs/vertx-auth-shiro/java/">Shiro
auth</a> <a href="https://vertx.io/docs/vertx-auth-jwt/java/">JWT
auth</a> <a href="https://vertx.io/docs/vertx-auth-oauth2/java/">OAuth 2</a> 等模块，可以覆盖大部分的用户认证与验权的支持。</p>
<p>在实际的项目中，遇到了一个支持多用户提供方的需求：项目的用户是从多个其他项目导入的；项目的逻辑比较简
单，不想维护自己的用户信息数据和外部映射。</p>
<p>比如，项目需要支持主站用户、视频网站等入口登录访问。正常情况下，只需要项目维护一套内部用户表、一个外
部项目表以及内部用户和外部用户的映射表；在用户导入或用户绑定请求时，建立外部项目 ID 和外部项目用户
ID 与内部用户 ID 的对应关系；在登录请求时，根据外部项目 ID 和外部项目用户 ID 调用用户认证回调，通过
后再寻找到内部用户的 ID 即可。</p>
<p>实际在项目的设计和实现过程中，采用了一个比较好玩的方法：在内部用户表的基础上，对用户使用
<a href="https://jwt.io">JWT</a> 的认证模型；用户登录时，根据外部项目 ID 和外部项目用户 ID 调用用户认证回调，发
放 JWT token，在 token 中限定用户的访问权限。</p>

                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-12-multiple-jwt-auth-handler-in-vertx&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                                <article class="post">
                                    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-11-graphviz-note&#x2F;">Graphviz Dot Note</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-03-11</span>
            
        </div>
    </header>

                                    <div class="post__summary">
                                        
                                    </div>
                                    <div class="read-more">
                                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-11-graphviz-note&#x2F;">Read more...</a>
                                    </div>
                                </article>
                            
                        </div>
                        <nav class="pagination">
                            
                                <a class="previous" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;">‹ Previous</a>
                            
                            
                                <a class="next" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;page&#x2F;3&#x2F;">Next ›</a>
                            
                        </nav>
                    
                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;even.js" ></script>
      
    </body>

</html>
