

<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>wangboâ€™s blog - Learning Java Concurrency - wait &amp; notify</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">WB Prime</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;github.wangbo.im">
                            Github
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wangbo.im&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.wangbo.im">WB Prime</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;github.wangbo.im">
                                    Github
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wangbo.im&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    



<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-04-06-learning-java-concurrency-wait-notify&#x2F;">Learning Java Concurrency - wait &amp; notify</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2016-04-06</span>
            
        </div>
    </header>

    <div class="post-content">
      <p>åœ¨synchronizedå…³é”®å­—ä¹‹å¤–ï¼ŒJavaæä¾›äº†å¦å¤–çš„<code>wait</code>å’Œ<code>notify</code>å‡½æ•°æ—ç”¨äºæ”¯æ´å¤šçº¿ç¨‹é€šä¿¡ï¼Œä½¿ç”¨ä¸Šç±»ä¼¼äºJUCçš„Conditionç±»ã€‚</p>
<p><code>wait()</code>ã€<code>notify()</code>å’Œ<code>notifyAll()</code>æ˜¯Objectç±»çš„æ–¹æ³•ï¼Œä¸synchronizedé…å¥—ä½¿ç”¨ã€‚</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">Object </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">...
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public final native void </span><span style="color:#8ec07c;">wait</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">long </span><span style="color:#fdf4c1;">timeout</span><span style="color:#fdf4c1aa;">) </span><span style="color:#fa5c4b;">throws </span><span style="color:#8ec07c;">InterruptedException</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public final void </span><span style="color:#8ec07c;">wait</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">long </span><span style="color:#fdf4c1;">timeout</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">int </span><span style="color:#fdf4c1;">nanos</span><span style="color:#fdf4c1aa;">) </span><span style="color:#fa5c4b;">throws </span><span style="color:#8ec07c;">InterruptedException</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public final void </span><span style="color:#8ec07c;">wait</span><span style="color:#fdf4c1aa;">() </span><span style="color:#fa5c4b;">throws </span><span style="color:#8ec07c;">InterruptedException</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public final native void </span><span style="color:#8ec07c;">notify</span><span style="color:#fdf4c1aa;">();
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public final native void </span><span style="color:#8ec07c;">notifyAll</span><span style="color:#fdf4c1aa;">();
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">...
</span><span style="color:#fdf4c1aa;">}
</span></pre>
<p><code>wait</code>ä¸€å…±æœ‰ä¸‰ä¸ªå‡½æ•°ã€‚è°ƒç”¨<code>wait</code>çš„çº¿ç¨‹å¿…é¡»å·²ç»æŒæœ‰äº†åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥å™¨ï¼ˆä½¿ç”¨synchronizedï¼‰ã€‚è°ƒç”¨<code>wait</code>çš„çº¿ç¨‹ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å¦å¤–çš„çº¿ç¨‹è°ƒç”¨äº†åŒä¸€ä¸ªå¯¹è±¡çš„<code>notify</code>å‡½æ•°ï¼Œæˆ–è€…æŒ‡å®šçš„ç­‰å¾…æ—¶é—´è¿‡æœŸï¼Œæˆ–è€…è¢«ä¸­æ–­ï¼ˆå¼•å‘InterruptedExceptionï¼‰ã€‚è°ƒç”¨<code>wait</code>å‡½æ•°ä¹‹åï¼Œå½“å‰çº¿ç¨‹ä¼šæ”¾å¼ƒå·²ç»æŒæœ‰çš„åŒæ­¥å™¨ã€‚</p>
<p><code>notify</code>ä¸€å…±æ˜¯æœ‰ä¸¤ä¸ªå‡½æ•°ã€‚<code>notify()</code>å‡½æ•°ä¼šå”¤é†’å½“å‰çš„ç”±äºæ‰§è¡Œ<code>wait</code>è€Œè¿›å…¥ç­‰å¾…çš„æŸä¸ªçº¿ç¨‹ï¼›æ³¨æ„ï¼Œè¢«å”¤é†’çš„çº¿ç¨‹æ˜¯ä¸å¯é¢„æ–™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒçš„JVMå®ç°å¯ä»¥ç”¨ä¸åŒçš„è§„åˆ™ç®—æ³•æ¥å†³å®šè¢«å”¤é†’çš„æ˜¯å“ªä¸€ä¸ªçº¿ç¨‹ã€‚<code>notifyAll()</code>å‡½æ•°ä¼šå”¤é†’æ‰€æœ‰çš„ç­‰å¾…çº¿ç¨‹ï¼Œä½†æ˜¯åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æœ€ç»ˆè¿›å…¥æ‰§è¡Œã€‚</p>
<p><a name="continue-reading"></a></p>
<p>ä¸‹é¢ç”¨ä¸¤ä¸ªä¾‹å­æ¥è¯´æ˜<code>wait &amp; notify</code>çš„ä½¿ç”¨åœºæ™¯å’Œä½¿ç”¨æ–¹å¼ã€‚</p>
<h1 id="yin-xing-qu-qian"><a class="zola-anchor" href="#yin-xing-qu-qian" aria-label="Anchor link for: yin-xing-qu-qian">ğŸ”—</a>
é“¶è¡Œå–é’±</h1>
<p>é“¶è¡Œå–é’±æ˜¯ä¼ ç»Ÿçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹çš„ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬ã€‚</p>
<p>å‡è®¾æœ‰ä¸€ä¸ªé“¶è¡Œè´¦æˆ·ï¼Œä¸¤ä¸ªç”¨æˆ·åˆ†åˆ«è¦å¾€é‡Œé¢å­˜é’±å’Œå–é’±ï¼ˆå¯ä»¥æƒ³è±¡ä¸ºä¸€ä¸ªé€šçŸ¥æ±‡æ¬¾ï¼Œå„¿å­åœ¨ä¸Šå¤§å­¦è¦èŠ±é’±ï¼Œæ‰“ç”µè¯è®©çˆ¶äº²ç»™æ‰“é’±ï¼›ä¸¤ä¸ªATMæœºï¼Œçˆ¶äº²æ‰‹å“†å—¦åœ°äº”ç™¾äº”ç™¾åœ°å­˜ï¼Œå„¿å­ä¸è€çƒ¦åœ°åˆ·ï¼Œæœ‰é’±å°±å–å‡ºæ¥ï¼‰ã€‚</p>
<h2 id="dai-ma"><a class="zola-anchor" href="#dai-ma" aria-label="Anchor link for: dai-ma">ğŸ”—</a>
ä»£ç </h2>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">package </span><span style="color:#8ec07c;">me.wbprime.showcase.concurrent</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fa5c4b;">import </span><span style="color:#fabd2f;">java</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fabd2f;">util</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fabd2f;">concurrent</span><span style="color:#fdf4c1aa;">.</span><span style="color:#8ec07c;">ExecutorService</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fa5c4b;">import </span><span style="color:#fabd2f;">java</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fabd2f;">util</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fabd2f;">concurrent</span><span style="color:#fdf4c1aa;">.</span><span style="color:#8ec07c;">Executors</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="font-style:italic;color:#928374;">/**
</span><span style="font-style:italic;color:#928374;"> </span><span style="font-style:italic;color:#928374;">* Class: DepositCase
</span><span style="font-style:italic;color:#928374;"> </span><span style="font-style:italic;color:#928374;">* Date: 2016/04/05 14:42
</span><span style="font-style:italic;color:#928374;"> </span><span style="font-style:italic;color:#928374;">*/
</span><span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">DepositCase </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private static class </span><span style="color:#8ec07c;">DepositAccount </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private int </span><span style="color:#fdf4c1aa;">money;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">DepositAccount</span><span style="color:#fdf4c1aa;">() {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.money </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public synchronized void </span><span style="color:#8ec07c;">withdraw</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">val</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">while </span><span style="color:#fdf4c1aa;">(money </span><span style="color:#fe8019;">&lt;</span><span style="color:#fdf4c1aa;"> val) {
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">                    </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">wait()</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// é’±ä¸å¤Ÿï¼Œç­‰ä¸€ä¼šå„¿
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">catch </span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">InterruptedException </span><span style="color:#fdf4c1;">e</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">                    </span><span style="font-style:italic;color:#928374;">// do nothing here
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">money </span><span style="color:#fe8019;">-=</span><span style="color:#fdf4c1aa;"> val;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public synchronized void </span><span style="color:#8ec07c;">deposite</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">val</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">money </span><span style="color:#fe8019;">+=</span><span style="color:#fdf4c1aa;"> val;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">notifyAll()</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// å­˜å®Œé’±å‘¨çŸ¥ä¸€ä¸‹
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private static class </span><span style="color:#8ec07c;">OldFather </span><span style="color:#fa5c4b;">implements </span><span style="color:#8ec07c;">Runnable </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">DepositAccount </span><span style="color:#fdf4c1aa;">account;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private final int </span><span style="color:#fdf4c1aa;">totalMoney;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private int </span><span style="color:#fdf4c1aa;">depositedMoney;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">OldFather</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">DepositAccount </span><span style="color:#fdf4c1;">account</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">val</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.account </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> account;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.totalMoney </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> val;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.depositedMoney </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public void </span><span style="color:#8ec07c;">run</span><span style="color:#fdf4c1aa;">() {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">MAX_MONEY_EACH_TIME </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">5000</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// æ¯æ¬¡æœ€å¤šå­˜è¿™ä¹ˆå¤šé’±
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">while </span><span style="color:#fdf4c1aa;">(depositedMoney </span><span style="color:#fe8019;">&lt;</span><span style="color:#fdf4c1aa;"> totalMoney) {
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fa5c4b;">final int</span><span style="color:#fdf4c1aa;"> moneyEachTime </span><span style="color:#fe8019;">=
</span><span style="color:#fdf4c1aa;">                    </span><span style="color:#fdf4c1aa;">(totalMoney </span><span style="color:#fe8019;">-</span><span style="color:#fdf4c1aa;"> depositedMoney) </span><span style="color:#fe8019;">&lt; </span><span style="color:#fdf4c1;">MAX_MONEY_EACH_TIME </span><span style="color:#fe8019;">? </span><span style="color:#fdf4c1aa;">(totalMoney </span><span style="color:#fe8019;">-</span><span style="color:#fdf4c1aa;"> depositedMoney) </span><span style="color:#fe8019;">: </span><span style="color:#fdf4c1;">MAX_MONEY_EACH_TIME</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">account.</span><span style="color:#fdf4c1;">deposite(moneyEachTime)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">depositedMoney </span><span style="color:#fe8019;">+=</span><span style="color:#fdf4c1aa;"> moneyEachTime;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.out.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;çˆ¶äº² sent &quot; </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> moneyEachTime </span><span style="color:#fe8019;">+ </span><span style="color:#b8bb26;">&quot; RMB to his son&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">                    </span><span style="color:#8ec07c;">Thread</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">sleep(</span><span style="color:#d3869b;">5000</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// ç¼“å£æ°”
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">catch </span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">InterruptedException </span><span style="color:#fdf4c1;">e</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">                    </span><span style="font-style:italic;color:#928374;">// do nothing
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private static class </span><span style="color:#8ec07c;">Son </span><span style="color:#fa5c4b;">implements </span><span style="color:#8ec07c;">Runnable </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1aa;">name;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">DepositAccount </span><span style="color:#fdf4c1aa;">account;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private final int </span><span style="color:#fdf4c1aa;">neededMoney;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private int </span><span style="color:#fdf4c1aa;">availMoney;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">Son</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">name</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">DepositAccount </span><span style="color:#fdf4c1;">account</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">money</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.name </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> name;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.account </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> account;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.neededMoney </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> money;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.availMoney </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public void </span><span style="color:#8ec07c;">run</span><span style="color:#fdf4c1aa;">() {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">MAX_MONEY_EACH_TIME </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">1000</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// æ¯æ¬¡æœ€å¤šå–è¿™ä¹ˆå¤šé’±
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">while </span><span style="color:#fdf4c1aa;">(availMoney </span><span style="color:#fe8019;">&lt;</span><span style="color:#fdf4c1aa;"> neededMoney) {
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fa5c4b;">final int</span><span style="color:#fdf4c1aa;"> moneyEachTime </span><span style="color:#fe8019;">=
</span><span style="color:#fdf4c1aa;">                    </span><span style="color:#fdf4c1aa;">(neededMoney </span><span style="color:#fe8019;">-</span><span style="color:#fdf4c1aa;"> availMoney) </span><span style="color:#fe8019;">&lt; </span><span style="color:#fdf4c1;">MAX_MONEY_EACH_TIME </span><span style="color:#fe8019;">? </span><span style="color:#fdf4c1aa;">(neededMoney </span><span style="color:#fe8019;">-</span><span style="color:#fdf4c1aa;"> availMoney) </span><span style="color:#fe8019;">: </span><span style="color:#fdf4c1;">MAX_MONEY_EACH_TIME</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">account.</span><span style="color:#fdf4c1;">withdraw(moneyEachTime)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">availMoney </span><span style="color:#fe8019;">+=</span><span style="color:#fdf4c1aa;"> moneyEachTime;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.out.</span><span style="color:#fdf4c1;">println(name </span><span style="color:#fe8019;">+ </span><span style="color:#b8bb26;">&quot; get &quot; </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> moneyEachTime </span><span style="color:#fe8019;">+ </span><span style="color:#b8bb26;">&quot; RMB from his father&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">                    </span><span style="color:#8ec07c;">Thread</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">sleep(</span><span style="color:#d3869b;">1000</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// æŠ½æ ¹çƒŸ
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">catch </span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">InterruptedException </span><span style="color:#fdf4c1;">e</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">                    </span><span style="font-style:italic;color:#928374;">// do nothing
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public static void </span><span style="color:#8ec07c;">main</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String</span><span style="color:#fa5c4b;">[] </span><span style="color:#fdf4c1;">args</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">DepositAccount</span><span style="color:#fdf4c1aa;"> account </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">DepositAccount</span><span style="color:#fdf4c1aa;">();
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">ExecutorService</span><span style="color:#fdf4c1aa;"> executorService </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">Executors</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">newCachedThreadPool()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">final int</span><span style="color:#fdf4c1aa;"> moneyToSon1 </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">10000</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">final int</span><span style="color:#fdf4c1aa;"> moneyToSon2 </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">18600</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">final int</span><span style="color:#fdf4c1aa;"> moneyToSon3 </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">10240</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">executorService.</span><span style="color:#fdf4c1;">execute(
</span><span style="color:#fdf4c1;">            </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">OldFather</span><span style="color:#fdf4c1;">(account, moneyToSon1 </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> moneyToSon2 </span><span style="color:#fe8019;">+</span><span style="color:#fdf4c1;"> moneyToSon3)
</span><span style="color:#fdf4c1;">        </span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">executorService.</span><span style="color:#fdf4c1;">execute(
</span><span style="color:#fdf4c1;">            </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">Son</span><span style="color:#fdf4c1;">(</span><span style="color:#b8bb26;">&quot;èƒ¡å¤§&quot;</span><span style="color:#fdf4c1;">, account, moneyToSon1)
</span><span style="color:#fdf4c1;">        </span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">executorService.</span><span style="color:#fdf4c1;">execute(
</span><span style="color:#fdf4c1;">            </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">Son</span><span style="color:#fdf4c1;">(</span><span style="color:#b8bb26;">&quot;èƒ¡äºŒ&quot;</span><span style="color:#fdf4c1;">, account, moneyToSon2)
</span><span style="color:#fdf4c1;">        </span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">executorService.</span><span style="color:#fdf4c1;">execute(
</span><span style="color:#fdf4c1;">            </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">Son</span><span style="color:#fdf4c1;">(</span><span style="color:#b8bb26;">&quot;èƒ¡ä¸‰&quot;</span><span style="color:#fdf4c1;">, account, moneyToSon3)
</span><span style="color:#fdf4c1;">        </span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">executorService.</span><span style="color:#fdf4c1;">shutdown()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">}
</span></pre><h2 id="dai-ma-shuo-ming"><a class="zola-anchor" href="#dai-ma-shuo-ming" aria-label="Anchor link for: dai-ma-shuo-ming">ğŸ”—</a>
ä»£ç è¯´æ˜</h2>
<ol>
<li><code>DepositAccount</code>ç±»è¡¨å¾é“¶è¡Œå­˜æ¬¾å¸å·ï¼Œä¸»è¦è®°å½•å½“å‰æœ‰å¤šå°‘é’±ï¼Œå¹¶æä¾›åŒæ­¥çš„å­˜æ¬¾ã€å–æ¬¾çš„æ–¹æ³•ã€‚å–é’±çš„é’±ä¸å¤Ÿäº†å°±æ²¡æ³•å–ï¼Œåªèƒ½ç­‰ç€ï¼›å­˜é’±çš„å°±æ²¡å…³ç³»ï¼Œå¯ä»¥ä¸€ç›´å¾€é‡Œé¢å­˜ï¼Œæ¯å­˜ä¸€ç¬”é’±å°±é€šçŸ¥ä¸€éè¦å–é’±çš„äººã€‚</li>
<li><code>OldFather</code>ç±»è¡¨å¾å­˜é’±çš„çˆ¶äº²ï¼Œè¿ç»­å¾€è´¦æˆ·é‡Œé¢å­˜é’±ï¼Œæ¯æ¬¡å­˜é’±éƒ½æœ‰ä¸€ä¸ªé™é¢ã€‚çˆ¶äº²æ¯å­˜ä¸€ç¬”é’±ï¼Œè¦å¹ä¸€å£æ°”ã€‚</li>
<li><code>Son</code>ç±»è¡¨å¾åœ¨å¤–çš„å„¿å­ï¼ˆä»¬ï¼‰ï¼Œç¼ºé’±äº†å»å–é’±ï¼Œæ¯æ¬¡å–é’±æœ‰é™é¢ã€‚å¦‚æœè´¦æˆ·é‡Œé¢æ²¡æœ‰é’±äº†ï¼Œåªèƒ½æŠ½ä¸€æ ¹çƒŸç­‰ç€äº†ã€‚</li>
<li><code>main()</code>å‡½æ•°ï¼Œé¦–å…ˆæ„é€ å¸å·ï¼Œç„¶åæ„é€ çˆ¶äº²å’Œå„¿å­ï¼ˆèƒ¡å¤§ã€èƒ¡äºŒå’Œèƒ¡ä¸‰ï¼‰ï¼Œç„¶åç”¨ä¸€ä¸ªçº¿ç¨‹æ± è·‘èµ·æ¥ã€‚</li>
</ol>
<p>ä»£ç å¾ˆç®€å•ã€‚</p>
<h1 id="ling-hu-chong-bei-kun-xi-hu-di"><a class="zola-anchor" href="#ling-hu-chong-bei-kun-xi-hu-di" aria-label="Anchor link for: ling-hu-chong-bei-kun-xi-hu-di">ğŸ”—</a>
ä»¤ç‹å†²è¢«å›°è¥¿æ¹–åº•</h1>
<p>å¦å¤–ä¸€ä¸ªä¾‹å­å¯ä»¥è€ƒè™‘ä»¤ç‹å†²è¢«å›°åœ¨è¥¿æ¹–åº•ä¸‹é¢çš„æƒ…å½¢ã€‚</p>
<p>å†²å“¥è¢«å›°åœ¨äº†è¥¿æ¹–åº•çš„åœ°ç‰¢é‡Œé¢ï¼Œä¸è§å¤©æ—¥ã€‚æ¢…åº„å››å‹å‘å–„å¿ƒï¼Œæ¯å¤©éƒ½è®©äººé€é¥­ç»™ä»–åƒã€‚</p>
<p>ç°åœ¨æ¥çœ‹ï¼Œå†²å“¥è¦åƒé¥­ï¼Œåªèƒ½ç­‰äººé€é¥­è¿‡æ¥ï¼›é€é¥­çš„äººæ˜¯ä¸ªè‹å“‘äººï¼Œåˆ°ç‚¹äº†è¿‡æ¥çœ‹ä¸€ä¸‹ï¼Œå‘ç°é¥­è¢«åƒäº†ï¼Œå°±ç»™ä¸€ä»½æ–°çš„é¥­ã€‚ä¹Ÿå°±æ˜¯ï¼Œä¸€ä¸ªäººé€ä¸€ä¸ªäººåƒï¼›åƒå®Œäº†æ‰é€ï¼Œæ²¡åƒå®Œä¸é€ï¼›é€æ¥äº†æ‰æœ‰å¾—åƒï¼Œæ²¡é€å°±æ²¡å¾—åƒã€‚</p>
<p>ä»£ç è¯´è¯ã€‚</p>
<h2 id="dai-ma-1"><a class="zola-anchor" href="#dai-ma-1" aria-label="Anchor link for: dai-ma-1">ğŸ”—</a>
ä»£ç </h2>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">package </span><span style="color:#8ec07c;">me.wbprime.showcase.concurrent</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fa5c4b;">import </span><span style="color:#fabd2f;">java</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fabd2f;">util</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fabd2f;">concurrent</span><span style="color:#fdf4c1aa;">.</span><span style="color:#8ec07c;">ExecutorService</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fa5c4b;">import </span><span style="color:#fabd2f;">java</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fabd2f;">util</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fabd2f;">concurrent</span><span style="color:#fdf4c1aa;">.</span><span style="color:#8ec07c;">Executors</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="font-style:italic;color:#928374;">/**
</span><span style="font-style:italic;color:#928374;"> </span><span style="font-style:italic;color:#928374;">* Class: LinghuChongCase
</span><span style="font-style:italic;color:#928374;"> </span><span style="font-style:italic;color:#928374;">* Date: 2016/04/06 12:38
</span><span style="font-style:italic;color:#928374;"> </span><span style="font-style:italic;color:#928374;">*/
</span><span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">LinghuChongCase </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private static class </span><span style="color:#8ec07c;">Bowl </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private boolean </span><span style="color:#fdf4c1aa;">isFull;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public synchronized void </span><span style="color:#8ec07c;">eat</span><span style="color:#fdf4c1aa;">() {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">while </span><span style="color:#fdf4c1aa;">(</span><span style="color:#fe8019;">!</span><span style="color:#fdf4c1aa;"> isFull) {
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">                    </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">wait()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">catch </span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">InterruptedException </span><span style="color:#fdf4c1;">e</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">                    </span><span style="font-style:italic;color:#928374;">// do nothing
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">isFull </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">false</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">notifyAll()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public synchronized void </span><span style="color:#8ec07c;">provide</span><span style="color:#fdf4c1aa;">() {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">while </span><span style="color:#fdf4c1aa;">(isFull) {
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">                    </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">wait()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">catch </span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">InterruptedException </span><span style="color:#fdf4c1;">e</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">                    </span><span style="font-style:italic;color:#928374;">// do nothing
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">isFull </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">true</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">notifyAll()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private static class </span><span style="color:#8ec07c;">LinghuChong </span><span style="color:#fa5c4b;">implements </span><span style="color:#8ec07c;">Runnable</span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">Bowl </span><span style="color:#fdf4c1aa;">bowl;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private final int </span><span style="color:#fdf4c1aa;">days;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">LinghuChong</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">Bowl </span><span style="color:#fdf4c1;">bowl</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">days</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.bowl </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> bowl;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.days </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> days;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public void </span><span style="color:#8ec07c;">run</span><span style="color:#fdf4c1aa;">() {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">int</span><span style="color:#fdf4c1aa;"> existingDays </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">while </span><span style="color:#fdf4c1aa;">(existingDays </span><span style="color:#fe8019;">&lt;</span><span style="color:#fdf4c1aa;"> days) {
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">bowl.</span><span style="color:#fdf4c1;">eat()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.out.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;Linghu Chong enjoys eatingï¼Œ&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">                    </span><span style="color:#8ec07c;">Thread</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">sleep(</span><span style="color:#d3869b;">1000</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// ç»ƒå¸å¿ƒå¤§æ³•
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">catch </span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">InterruptedException </span><span style="color:#fdf4c1;">e</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">                    </span><span style="font-style:italic;color:#928374;">// do nothing
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">existingDays </span><span style="color:#fe8019;">++</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">private static class </span><span style="color:#8ec07c;">SomeBody </span><span style="color:#fa5c4b;">implements </span><span style="color:#8ec07c;">Runnable</span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private final </span><span style="color:#8ec07c;">Bowl </span><span style="color:#fdf4c1aa;">bowl;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">private final int </span><span style="color:#fdf4c1aa;">days;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">SomeBody</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">Bowl </span><span style="color:#fdf4c1;">bowl</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">days</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.bowl </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> bowl;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1;">this</span><span style="color:#fdf4c1aa;">.days </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> days;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">public void </span><span style="color:#8ec07c;">run</span><span style="color:#fdf4c1aa;">() {
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">int</span><span style="color:#fdf4c1aa;"> existingDays </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">0</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fa5c4b;">while </span><span style="color:#fdf4c1aa;">(existingDays </span><span style="color:#fe8019;">&lt;</span><span style="color:#fdf4c1aa;"> days) {
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">bowl.</span><span style="color:#fdf4c1;">provide()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#8ec07c;">System</span><span style="color:#fdf4c1aa;">.out.</span><span style="color:#fdf4c1;">println(</span><span style="color:#b8bb26;">&quot;Prepared a bowl for a prisoner to eat&quot;</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fa5c4b;">try </span><span style="color:#fdf4c1aa;">{
</span><span style="color:#fdf4c1aa;">                    </span><span style="color:#8ec07c;">Thread</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">sleep(</span><span style="color:#d3869b;">2000</span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">; </span><span style="font-style:italic;color:#928374;">// ä¸çŸ¥é“å¹²å˜›
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">} </span><span style="color:#fa5c4b;">catch </span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">InterruptedException </span><span style="color:#fdf4c1;">e</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">                    </span><span style="font-style:italic;color:#928374;">// do nothing
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">                </span><span style="color:#fdf4c1aa;">existingDays</span><span style="color:#fe8019;">++</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">            </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fa5c4b;">public static void </span><span style="color:#8ec07c;">main</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">String</span><span style="color:#fa5c4b;">[] </span><span style="color:#fdf4c1;">args</span><span style="color:#fdf4c1aa;">) {
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">Bowl</span><span style="color:#fdf4c1aa;"> bowl </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">Bowl</span><span style="color:#fdf4c1aa;">();
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">ExecutorService</span><span style="color:#fdf4c1aa;"> executorService </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">Executors</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">newCachedThreadPool()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fa5c4b;">final int</span><span style="color:#fdf4c1aa;"> daysLostFreedom </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">15</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">executorService.</span><span style="color:#fdf4c1;">execute(
</span><span style="color:#fdf4c1;">            </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">LinghuChong</span><span style="color:#fdf4c1;">(bowl, daysLostFreedom)
</span><span style="color:#fdf4c1;">        </span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">executorService.</span><span style="color:#fdf4c1;">execute(
</span><span style="color:#fdf4c1;">            </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">SomeBody</span><span style="color:#fdf4c1;">(bowl, daysLostFreedom)
</span><span style="color:#fdf4c1;">        </span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">
</span><span style="color:#fdf4c1aa;">        </span><span style="color:#fdf4c1aa;">executorService.</span><span style="color:#fdf4c1;">shutdown()</span><span style="color:#fdf4c1aa;">;
</span><span style="color:#fdf4c1aa;">    </span><span style="color:#fdf4c1aa;">}
</span><span style="color:#fdf4c1aa;">}
</span></pre><h2 id="dai-ma-shuo-ming-1"><a class="zola-anchor" href="#dai-ma-shuo-ming-1" aria-label="Anchor link for: dai-ma-shuo-ming-1">ğŸ”—</a>
ä»£ç è¯´æ˜</h2>
<ol>
<li><code>Bowl</code>ç±»è¡¨å¾é¥­ç¢—ï¼Œé‡Œé¢è¿˜æœ‰é¥­ä»¤ç‹å†²æ‰å¯ä»¥åƒï¼Œé€é¥­äººå°±ä¸ä¼šé€ï¼›é‡Œé¢æ²¡é¥­äº†ï¼Œä»¤ç‹å†²å°±æ²¡å¾—åƒï¼Œé€é¥­äººæ‰ä¼šé€ã€‚</li>
<li><code>LinghuChong</code>ç±»è¡¨å¾ä»¤ç‹å†²ï¼Œåƒé¥­ï¼Œæ²¡é¥­åƒçš„æ—¶å€™å°±ç»ƒå¸å¿ƒå¤§æ³•ã€‚</li>
<li><code>SomeBody</code>ç±»è¡¨å¾é€é¥­çš„äººï¼Œä¸çŸ¥é“å¹²å˜›çš„ã€‚å®šæ—¶é€é¥­ã€‚</li>
<li><code>main()</code>å‡½æ•°ï¼Œæ„é€ é¥­ç¢—ï¼Œæ„é€ ä»¤ç‹å†²å’Œé€é¥­äººï¼Œç„¶åè®¾å®šå†²å“¥è¢«å…³äº†åŠä¸ªæœˆã€‚</li>
</ol>
<h1 id="dai-ma-xia-zai"><a class="zola-anchor" href="#dai-ma-xia-zai" aria-label="Anchor link for: dai-ma-xia-zai">ğŸ”—</a>
ä»£ç ä¸‹è½½</h1>
<p><a href="https://www.wangbo.im/posts/2016-04-06-learning-java-concurrency-wait-notify/DepositCase.java">DepositCase.java</a>
<a href="https://www.wangbo.im/posts/2016-04-06-learning-java-concurrency-wait-notify/LinghuChongCase.java">LinghuChongCase.java</a></p>

    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;java&#x2F;">#java</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;concurrency&#x2F;">#concurrency</a>
                    
                </div>
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;learning-java-concurrency-synchronized&#x2F;">â€¹ Learning Java Concurrency - synchronized</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2016-04-07-learning-java-concurrency-reentrantlock-condition&#x2F;">Learning Java Concurrency - ReentrantLock &amp; Condition â€º</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;even.js" ></script>
      
    </body>

</html>
