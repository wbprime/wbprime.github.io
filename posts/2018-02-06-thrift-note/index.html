

<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>Wbprime</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wbprime.me&#x2F;site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Wbprime</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wbprime.me">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wbprime.me&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wbprime.me&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://www.wbprime.me&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.wbprime.me">Wbprime</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https://www.wbprime.me">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wbprime.me&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wbprime.me&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://www.wbprime.me&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#yi-ge-jian-dan-de-thrift-shi-li" class="toc-link">ä¸€ä¸ªç®€å•çš„ Thrift å®ä¾‹</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#thrift-yuan-wen-jian" class="toc-link">thrift æºæ–‡ä»¶</a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#helloserivce-shi-xian-dai-ma" class="toc-link">HelloSerivce å®ç°ä»£ç </a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#fu-wu-qi-duan-dai-ma" class="toc-link">æœåŠ¡å™¨ç«¯ä»£ç </a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#ke-hu-duan-dai-ma" class="toc-link">å®¢æˆ·ç«¯ä»£ç </a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#shu-ju-lei-xing" class="toc-link">æ•°æ®ç±»å‹</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#ji-ben-lei-xing" class="toc-link">åŸºæœ¬ç±»å‹</a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#jie-gou-ti-lei-xing" class="toc-link">ç»“æ„ä½“ç±»å‹</a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#rong-qi-lei-xing" class="toc-link">å®¹å™¨ç±»å‹</a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#yi-chang-lei-xing" class="toc-link">å¼‚å¸¸ç±»å‹ï¼š</a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#fu-wu-lei-xing" class="toc-link">æœåŠ¡ç±»å‹ï¼š</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#xie-yi" class="toc-link">åè®®</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#tbinaryprotocol-er-jin-zhi-bian-ma-ge-shi-jin-xing-shu-ju-chuan-shu" class="toc-link">TBinaryProtocol äºŒè¿›åˆ¶ç¼–ç æ ¼å¼è¿›è¡Œæ•°æ®ä¼ è¾“</a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#tcompactprotocol-gao-xiao-lu-de-mi-ji-de-er-jin-zhi-bian-ma-ge-shi-jin-xing-shu-ju-chuan-shu" class="toc-link">TCompactProtocol é«˜æ•ˆç‡çš„ã€å¯†é›†çš„äºŒè¿›åˆ¶ç¼–ç æ ¼å¼è¿›è¡Œæ•°æ®ä¼ è¾“</a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#tjsonprotocol-shi-yong-json-de-shu-ju-bian-ma-xie-yi-jin-xing-shu-ju-chuan-shu" class="toc-link">TJSONProtocol ä½¿ç”¨ JSON çš„æ•°æ®ç¼–ç åè®®è¿›è¡Œæ•°æ®ä¼ è¾“</a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#tsimplejsonprotocol-zhi-ti-gong-json-zhi-xie-de-xie-yi-gua-yong-yu-tong-guo-jiao-ben-yu-yan-jie-xi" class="toc-link">TSimpleJSONProtocol åªæä¾› JSON åªå†™çš„åè®®ï¼Œé€‚ç”¨äºé€šè¿‡è„šæœ¬è¯­è¨€è§£æ</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#chuan-shu-ceng" class="toc-link">ä¼ è¾“å±‚</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#tsocket-shi-yong-zu-sai-shi-i-o-jin-xing-chuan-shu-shi-zui-chang-jian-de-mo-shi" class="toc-link">TSocket ä½¿ç”¨é˜»å¡å¼ I&#x2F;O è¿›è¡Œä¼ è¾“ï¼Œæ˜¯æœ€å¸¸è§çš„æ¨¡å¼</a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#tframedtransport-shi-yong-fei-zu-sai-fang-shi-an-kuai-de-da-xiao-jin-xing-chuan-shu-lei-si-yu-java-zhong-de-nio" class="toc-link">TFramedTransport ä½¿ç”¨éé˜»å¡æ–¹å¼ï¼ŒæŒ‰å—çš„å¤§å°è¿›è¡Œä¼ è¾“ï¼Œç±»ä¼¼äº Java ä¸­çš„ NIO</a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#tnonblockingtransport-shi-yong-fei-zu-sai-fang-shi-yong-yu-gou-jian-yi-bu-ke-hu-duan" class="toc-link">TNonblockingTransport ä½¿ç”¨éé˜»å¡æ–¹å¼ï¼Œç”¨äºæ„å»ºå¼‚æ­¥å®¢æˆ·ç«¯</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#fu-wu-duan-lei-xing" class="toc-link">æœåŠ¡ç«¯ç±»å‹</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#tsimpleserver-dan-xian-cheng-fu-wu-qi-duan-shi-yong-biao-zhun-de-zu-sai-shi-i-o" class="toc-link">TSimpleServer å•çº¿ç¨‹æœåŠ¡å™¨ç«¯ä½¿ç”¨æ ‡å‡†çš„é˜»å¡å¼ I&#x2F;O</a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#tthreadpoolserver-duo-xian-cheng-fu-wu-qi-duan-shi-yong-biao-zhun-de-zu-sai-shi-i-o" class="toc-link">TThreadPoolServer å¤šçº¿ç¨‹æœåŠ¡å™¨ç«¯ä½¿ç”¨æ ‡å‡†çš„é˜»å¡å¼ I&#x2F;O</a>
                        </li>
                        
                        <li>
                            <a href="https://www.wbprime.me/posts/2018-02-06-thrift-note/#tnonblockingserver-duo-xian-cheng-fu-wu-qi-duan-shi-yong-fei-zu-sai-shi-i-o" class="toc-link">TNonblockingServer å¤šçº¿ç¨‹æœåŠ¡å™¨ç«¯ä½¿ç”¨éé˜»å¡å¼ I&#x2F;O</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wbprime.me&#x2F;posts&#x2F;2018-02-06-thrift-note&#x2F;">Thrift Note</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2018-02-06</span>
            
        </div>
    </header>

    <div class="post-content">
      <p>ç¬”è®°ï¼Œæ¥è‡ªç½‘ç»œï¼Œæ¥æºä¸å¯è€ƒã€‚</p>
<h1 id="yi-ge-jian-dan-de-thrift-shi-li"><a class="zola-anchor" href="#yi-ge-jian-dan-de-thrift-shi-li" aria-label="Anchor link for: yi-ge-jian-dan-de-thrift-shi-li">ğŸ”—</a>
ä¸€ä¸ªç®€å•çš„ Thrift å®ä¾‹</h1>
<h2 id="thrift-yuan-wen-jian"><a class="zola-anchor" href="#thrift-yuan-wen-jian" aria-label="Anchor link for: thrift-yuan-wen-jian">ğŸ”—</a>
thrift æºæ–‡ä»¶</h2>
<p>æ¸…å• 1. Hello.thrift</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">namespace java service.demo 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">service Hello{ 
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">string helloString(1:string para) 
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">i32 helloInt(1:i32 para) 
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">bool helloBoolean(1:bool para) 
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">void helloVoid() 
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">string helloNull() 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">}
</span></pre><h2 id="helloserivce-shi-xian-dai-ma"><a class="zola-anchor" href="#helloserivce-shi-xian-dai-ma" aria-label="Anchor link for: helloserivce-shi-xian-dai-ma">ğŸ”—</a>
HelloSerivce å®ç°ä»£ç </h2>
<p>æ¸…å• 2. HelloServiceImpl.java</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">package service.demo; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.TException; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">public class HelloServiceImpl implements Hello.Iface { 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">@Override 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">public boolean helloBoolean(boolean para) throws TException { 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">return para; 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">} 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">@Override 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">public int helloInt(int para) throws TException { 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">try { 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">Thread.sleep(20000); 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">} catch (InterruptedException e) { 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">e.printStackTrace(); 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">} 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">return para; 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">} 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">@Override 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">public String helloNull() throws TException { 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">return null; 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">} 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">@Override 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">public String helloString(String para) throws TException { 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">return para; 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">} 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">@Override 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">public void helloVoid() throws TException { 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">System.out.println(&quot;Hello World&quot;); 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">} 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">}
</span></pre><h2 id="fu-wu-qi-duan-dai-ma"><a class="zola-anchor" href="#fu-wu-qi-duan-dai-ma" aria-label="Anchor link for: fu-wu-qi-duan-dai-ma">ğŸ”—</a>
æœåŠ¡å™¨ç«¯ä»£ç </h2>
<p>æ¸…å• 3. HelloServiceServer.java</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">package service.server; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.TProcessor; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.protocol.TBinaryProtocol; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.protocol.TBinaryProtocol.Factory; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.server.TServer; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.server.TThreadPoolServer; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.transport.TServerSocket; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.transport.TTransportException; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import service.demo.Hello; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import service.demo.HelloServiceImpl; 
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">public class HelloServiceServer { 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">/** 
</span><span style="color:#c0c5ce;">     </span><span style="color:#c0c5ce;">* å¯åŠ¨ Thrift æœåŠ¡å™¨
</span><span style="color:#c0c5ce;">     </span><span style="color:#c0c5ce;">* @param args 
</span><span style="color:#c0c5ce;">     </span><span style="color:#c0c5ce;">*/ 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">public static void main(String[] args) { 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">try { 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">// è®¾ç½®æœåŠ¡ç«¯å£ä¸º 7911 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">TServerSocket serverTransport = new TServerSocket(7911); 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">// è®¾ç½®åè®®å·¥å‚ä¸º TBinaryProtocol.Factory 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">Factory proFactory = new TBinaryProtocol.Factory(); 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">// å…³è”å¤„ç†å™¨ä¸ Hello æœåŠ¡çš„å®ç°
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">TProcessor processor = new Hello.Processor(new HelloServiceImpl()); 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">TServer server = new TThreadPoolServer(processor, serverTransport, 
</span><span style="color:#c0c5ce;">                    </span><span style="color:#c0c5ce;">proFactory); 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">System.out.println(&quot;Start server on port 7911...&quot;); 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">server.serve(); 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">} catch (TTransportException e) { 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">e.printStackTrace(); 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">} 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">} 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">}
</span></pre>
<p>å‚è§:</p>
<p><img src="https://www.wbprime.me/posts/2018-02-06-thrift-note/uml_thrift_server_side_sequence.png" alt="thrift client" /> ã€‚</p>
<h2 id="ke-hu-duan-dai-ma"><a class="zola-anchor" href="#ke-hu-duan-dai-ma" aria-label="Anchor link for: ke-hu-duan-dai-ma">ğŸ”—</a>
å®¢æˆ·ç«¯ä»£ç </h2>
<p>æ¸…å• 4. HelloServiceClient.java</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">package service.client; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.TException; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.protocol.TBinaryProtocol; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.protocol.TProtocol; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.transport.TSocket; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.transport.TTransport; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import org.apache.thrift.transport.TTransportException; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">import service.demo.Hello; 
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">public class HelloServiceClient { 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">/** 
</span><span style="color:#c0c5ce;">     </span><span style="color:#c0c5ce;">* è°ƒç”¨ Hello æœåŠ¡
</span><span style="color:#c0c5ce;">     </span><span style="color:#c0c5ce;">* @param args 
</span><span style="color:#c0c5ce;">     </span><span style="color:#c0c5ce;">*/ 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">public static void main(String[] args) { 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">try { 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">// è®¾ç½®è°ƒç”¨çš„æœåŠ¡åœ°å€ä¸ºæœ¬åœ°ï¼Œç«¯å£ä¸º 7911 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">TTransport transport = new TSocket(&quot;localhost&quot;, 7911); 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">transport.open(); 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">// è®¾ç½®ä¼ è¾“åè®®ä¸º TBinaryProtocol 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">TProtocol protocol = new TBinaryProtocol(transport); 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">Hello.Client client = new Hello.Client(protocol); 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">// è°ƒç”¨æœåŠ¡çš„ helloVoid æ–¹æ³•
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">client.helloVoid(); 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">transport.close(); 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">} catch (TTransportException e) { 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">e.printStackTrace(); 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">} catch (TException e) { 
</span><span style="color:#c0c5ce;">            </span><span style="color:#c0c5ce;">e.printStackTrace(); 
</span><span style="color:#c0c5ce;">        </span><span style="color:#c0c5ce;">} 
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">} 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">}
</span></pre>
<p>å‚è§ï¼š</p>
<p><img src="https://www.wbprime.me/posts/2018-02-06-thrift-note/uml_thrift_client_side_sequence.png" alt="thrift server" /> ã€‚</p>
<h1 id="shu-ju-lei-xing"><a class="zola-anchor" href="#shu-ju-lei-xing" aria-label="Anchor link for: shu-ju-lei-xing">ğŸ”—</a>
æ•°æ®ç±»å‹</h1>
<ul>
<li>Thrift è„šæœ¬å¯å®šä¹‰çš„æ•°æ®ç±»å‹åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</li>
</ul>
<h2 id="ji-ben-lei-xing"><a class="zola-anchor" href="#ji-ben-lei-xing" aria-label="Anchor link for: ji-ben-lei-xing">ğŸ”—</a>
åŸºæœ¬ç±»å‹</h2>
<ul>
<li>boolï¼šå¸ƒå°”å€¼ï¼Œtrue æˆ– falseï¼Œå¯¹åº” Java çš„ boolean</li>
<li>byteï¼š8 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå¯¹åº” Java çš„ byte</li>
<li>i16ï¼š16 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå¯¹åº” Java çš„ short</li>
<li>i32ï¼š32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå¯¹åº” Java çš„ int</li>
<li>i64ï¼š64 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå¯¹åº” Java çš„ long</li>
<li>doubleï¼š64 ä½æµ®ç‚¹æ•°ï¼Œå¯¹åº” Java çš„ double</li>
<li>stringï¼šæœªçŸ¥ç¼–ç æ–‡æœ¬æˆ–äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå¯¹åº” Java çš„ String</li>
</ul>
<h2 id="jie-gou-ti-lei-xing"><a class="zola-anchor" href="#jie-gou-ti-lei-xing" aria-label="Anchor link for: jie-gou-ti-lei-xing">ğŸ”—</a>
ç»“æ„ä½“ç±»å‹</h2>
<ul>
<li>structï¼šå®šä¹‰å…¬å…±çš„å¯¹è±¡ï¼Œç±»ä¼¼äº C è¯­è¨€ä¸­çš„ç»“æ„ä½“å®šä¹‰ï¼Œåœ¨ Java ä¸­æ˜¯ä¸€ä¸ª JavaBean</li>
</ul>
<h2 id="rong-qi-lei-xing"><a class="zola-anchor" href="#rong-qi-lei-xing" aria-label="Anchor link for: rong-qi-lei-xing">ğŸ”—</a>
å®¹å™¨ç±»å‹</h2>
<ul>
<li>listï¼šå¯¹åº” Java çš„ ArrayList</li>
<li>setï¼šå¯¹åº” Java çš„ HashSet</li>
<li>mapï¼šå¯¹åº” Java çš„ HashMap</li>
</ul>
<h2 id="yi-chang-lei-xing"><a class="zola-anchor" href="#yi-chang-lei-xing" aria-label="Anchor link for: yi-chang-lei-xing">ğŸ”—</a>
å¼‚å¸¸ç±»å‹ï¼š</h2>
<ul>
<li>exceptionï¼šå¯¹åº” Java çš„ Exception</li>
</ul>
<h2 id="fu-wu-lei-xing"><a class="zola-anchor" href="#fu-wu-lei-xing" aria-label="Anchor link for: fu-wu-lei-xing">ğŸ”—</a>
æœåŠ¡ç±»å‹ï¼š</h2>
<ul>
<li>serviceï¼šå¯¹åº”æœåŠ¡çš„ç±»</li>
</ul>
<h1 id="xie-yi"><a class="zola-anchor" href="#xie-yi" aria-label="Anchor link for: xie-yi">ğŸ”—</a>
åè®®</h1>
<p>Thrift å¯ä»¥è®©ç”¨æˆ·é€‰æ‹©å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´ä¼ è¾“é€šä¿¡åè®®çš„ç±»åˆ«ï¼Œåœ¨ä¼ è¾“åè®®ä¸Šæ€»ä½“åˆ’åˆ†ä¸ºæ–‡æœ¬ (text) å’ŒäºŒè¿›åˆ¶ (binary) ä¼ è¾“åè®®ï¼Œä¸ºèŠ‚çº¦å¸¦å®½ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨äºŒè¿›åˆ¶ç±»å‹çš„ä¼ è¾“åè®®ä¸ºå¤šæ•°ï¼Œæœ‰æ—¶è¿˜ä¼šä½¿ç”¨åŸºäºæ–‡æœ¬ç±»å‹çš„åè®®ï¼Œè¿™éœ€è¦æ ¹æ®é¡¹ç›® / äº§å“ä¸­çš„å®é™…éœ€æ±‚ã€‚å¸¸ç”¨åè®®æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<h2 id="tbinaryprotocol-er-jin-zhi-bian-ma-ge-shi-jin-xing-shu-ju-chuan-shu"><a class="zola-anchor" href="#tbinaryprotocol-er-jin-zhi-bian-ma-ge-shi-jin-xing-shu-ju-chuan-shu" aria-label="Anchor link for: tbinaryprotocol-er-jin-zhi-bian-ma-ge-shi-jin-xing-shu-ju-chuan-shu">ğŸ”—</a>
TBinaryProtocol äºŒè¿›åˆ¶ç¼–ç æ ¼å¼è¿›è¡Œæ•°æ®ä¼ è¾“</h2>
<p>ä½¿ç”¨æ–¹æ³•å¦‚æ¸…å• 3 å’Œæ¸…å• 4 æ‰€ç¤ºã€‚</p>
<h2 id="tcompactprotocol-gao-xiao-lu-de-mi-ji-de-er-jin-zhi-bian-ma-ge-shi-jin-xing-shu-ju-chuan-shu"><a class="zola-anchor" href="#tcompactprotocol-gao-xiao-lu-de-mi-ji-de-er-jin-zhi-bian-ma-ge-shi-jin-xing-shu-ju-chuan-shu" aria-label="Anchor link for: tcompactprotocol-gao-xiao-lu-de-mi-ji-de-er-jin-zhi-bian-ma-ge-shi-jin-xing-shu-ju-chuan-shu">ğŸ”—</a>
TCompactProtocol é«˜æ•ˆç‡çš„ã€å¯†é›†çš„äºŒè¿›åˆ¶ç¼–ç æ ¼å¼è¿›è¡Œæ•°æ®ä¼ è¾“</h2>
<p>æ„å»º TCompactProtocol åè®®çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åªéœ€æ›¿æ¢æ¸…å• 3 å’Œæ¸…å• 4 ä¸­ TBinaryProtocol åè®®éƒ¨åˆ†å³å¯ï¼Œæ›¿æ¢æˆå¦‚ä¸‹ä»£ç ï¼š</p>
<p>æ¸…å• 5. ä½¿ç”¨ TCompactProtocol åè®®æ„å»ºçš„ HelloServiceServer.java</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">TCompactProtocol.Factory proFactory = new TCompactProtocol.Factory();
</span></pre>
<p>æ¸…å• 6. ä½¿ç”¨ TCompactProtocol åè®®çš„ HelloServiceClient.java</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">TCompactProtocol protocol = new TCompactProtocol(transport);
</span></pre><h2 id="tjsonprotocol-shi-yong-json-de-shu-ju-bian-ma-xie-yi-jin-xing-shu-ju-chuan-shu"><a class="zola-anchor" href="#tjsonprotocol-shi-yong-json-de-shu-ju-bian-ma-xie-yi-jin-xing-shu-ju-chuan-shu" aria-label="Anchor link for: tjsonprotocol-shi-yong-json-de-shu-ju-bian-ma-xie-yi-jin-xing-shu-ju-chuan-shu">ğŸ”—</a>
TJSONProtocol ä½¿ç”¨ JSON çš„æ•°æ®ç¼–ç åè®®è¿›è¡Œæ•°æ®ä¼ è¾“</h2>
<p>æ„å»º TJSONProtocol åè®®çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åªéœ€æ›¿æ¢æ¸…å• 3 å’Œæ¸…å• 4 ä¸­ TBinaryProtocol åè®®éƒ¨åˆ†å³å¯ï¼Œæ›¿æ¢æˆå¦‚ä¸‹ä»£ç ï¼š</p>
<p>æ¸…å• 7. ä½¿ç”¨ TJSONProtocol åè®®æ„å»ºçš„ HelloServiceServer.java</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">TJSONProtocol.Factory proFactory = new TJSONProtocol.Factory();
</span></pre>
<p>æ¸…å• 8. ä½¿ç”¨ TJSONProtocol åè®®çš„ HelloServiceClient.java</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">TJSONProtocol protocol = new TJSONProtocol(transport);
</span></pre><h2 id="tsimplejsonprotocol-zhi-ti-gong-json-zhi-xie-de-xie-yi-gua-yong-yu-tong-guo-jiao-ben-yu-yan-jie-xi"><a class="zola-anchor" href="#tsimplejsonprotocol-zhi-ti-gong-json-zhi-xie-de-xie-yi-gua-yong-yu-tong-guo-jiao-ben-yu-yan-jie-xi" aria-label="Anchor link for: tsimplejsonprotocol-zhi-ti-gong-json-zhi-xie-de-xie-yi-gua-yong-yu-tong-guo-jiao-ben-yu-yan-jie-xi">ğŸ”—</a>
TSimpleJSONProtocol åªæä¾› JSON åªå†™çš„åè®®ï¼Œé€‚ç”¨äºé€šè¿‡è„šæœ¬è¯­è¨€è§£æ</h2>
<h1 id="chuan-shu-ceng"><a class="zola-anchor" href="#chuan-shu-ceng" aria-label="Anchor link for: chuan-shu-ceng">ğŸ”—</a>
ä¼ è¾“å±‚</h1>
<h2 id="tsocket-shi-yong-zu-sai-shi-i-o-jin-xing-chuan-shu-shi-zui-chang-jian-de-mo-shi"><a class="zola-anchor" href="#tsocket-shi-yong-zu-sai-shi-i-o-jin-xing-chuan-shu-shi-zui-chang-jian-de-mo-shi" aria-label="Anchor link for: tsocket-shi-yong-zu-sai-shi-i-o-jin-xing-chuan-shu-shi-zui-chang-jian-de-mo-shi">ğŸ”—</a>
TSocket ä½¿ç”¨é˜»å¡å¼ I/O è¿›è¡Œä¼ è¾“ï¼Œæ˜¯æœ€å¸¸è§çš„æ¨¡å¼</h2>
<p>ä½¿ç”¨æ–¹æ³•å¦‚æ¸…å• 4 æ‰€ç¤ºã€‚</p>
<h2 id="tframedtransport-shi-yong-fei-zu-sai-fang-shi-an-kuai-de-da-xiao-jin-xing-chuan-shu-lei-si-yu-java-zhong-de-nio"><a class="zola-anchor" href="#tframedtransport-shi-yong-fei-zu-sai-fang-shi-an-kuai-de-da-xiao-jin-xing-chuan-shu-lei-si-yu-java-zhong-de-nio" aria-label="Anchor link for: tframedtransport-shi-yong-fei-zu-sai-fang-shi-an-kuai-de-da-xiao-jin-xing-chuan-shu-lei-si-yu-java-zhong-de-nio">ğŸ”—</a>
TFramedTransport ä½¿ç”¨éé˜»å¡æ–¹å¼ï¼ŒæŒ‰å—çš„å¤§å°è¿›è¡Œä¼ è¾“ï¼Œç±»ä¼¼äº Java ä¸­çš„ NIO</h2>
<p>è‹¥ä½¿ç”¨ TFramedTransport ä¼ è¾“å±‚ï¼Œå…¶æœåŠ¡å™¨å¿…é¡»ä¿®æ”¹ä¸ºéé˜»å¡çš„æœåŠ¡ç±»å‹ï¼Œå®¢æˆ·ç«¯åªéœ€æ›¿æ¢æ¸…å• 4 ä¸­ TTransport éƒ¨åˆ†ï¼Œä»£ç å¦‚ä¸‹ï¼Œæ¸…å• 9 ä¸­ TNonblockingServerTransport ç±»æ˜¯æ„å»ºéé˜»å¡ socket çš„æŠ½è±¡ç±»ï¼ŒTNonblockingServerSocket ç±»ç»§æ‰¿ TNonblockingServerTransport</p>
<p>æ¸…å• 9. ä½¿ç”¨ TFramedTransport ä¼ è¾“å±‚æ„å»ºçš„ HelloServiceServer.java</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">TNonblockingServerTransport serverTransport; 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">serverTransport = new TNonblockingServerSocket(10005); 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">Hello.Processor processor = new Hello.Processor(new HelloServiceImpl()); 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">TServer server = new TNonblockingServer(processor, serverTransport); 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">System.out.println(&quot;Start server on port 10005 ...&quot;); 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">server.serve();
</span></pre>
<p>æ¸…å• 10. ä½¿ç”¨ TFramedTransport ä¼ è¾“å±‚çš„ HelloServiceClient.java</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">TTransport transport = new TFramedTransport(new TSocket(&quot;localhost&quot;, 10005));
</span></pre><h2 id="tnonblockingtransport-shi-yong-fei-zu-sai-fang-shi-yong-yu-gou-jian-yi-bu-ke-hu-duan"><a class="zola-anchor" href="#tnonblockingtransport-shi-yong-fei-zu-sai-fang-shi-yong-yu-gou-jian-yi-bu-ke-hu-duan" aria-label="Anchor link for: tnonblockingtransport-shi-yong-fei-zu-sai-fang-shi-yong-yu-gou-jian-yi-bu-ke-hu-duan">ğŸ”—</a>
TNonblockingTransport ä½¿ç”¨éé˜»å¡æ–¹å¼ï¼Œç”¨äºæ„å»ºå¼‚æ­¥å®¢æˆ·ç«¯</h2>
<p>ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒ Thrift å¼‚æ­¥å®¢æˆ·ç«¯æ„å»º</p>
<h1 id="fu-wu-duan-lei-xing"><a class="zola-anchor" href="#fu-wu-duan-lei-xing" aria-label="Anchor link for: fu-wu-duan-lei-xing">ğŸ”—</a>
æœåŠ¡ç«¯ç±»å‹</h1>
<h2 id="tsimpleserver-dan-xian-cheng-fu-wu-qi-duan-shi-yong-biao-zhun-de-zu-sai-shi-i-o"><a class="zola-anchor" href="#tsimpleserver-dan-xian-cheng-fu-wu-qi-duan-shi-yong-biao-zhun-de-zu-sai-shi-i-o" aria-label="Anchor link for: tsimpleserver-dan-xian-cheng-fu-wu-qi-duan-shi-yong-biao-zhun-de-zu-sai-shi-i-o">ğŸ”—</a>
TSimpleServer å•çº¿ç¨‹æœåŠ¡å™¨ç«¯ä½¿ç”¨æ ‡å‡†çš„é˜»å¡å¼ I/O</h2>
<p>æ¸…å• 11. ä½¿ç”¨ TSimpleServer æœåŠ¡ç«¯æ„å»ºçš„ HelloServiceServer.java</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">TServerSocket serverTransport = new TServerSocket(7911); 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">TProcessor processor = new Hello.Processor(new HelloServiceImpl()); 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">TServer server = new TSimpleServer(processor, serverTransport); 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">System.out.println(&quot;Start server on port 7911...&quot;); 
</span><span style="color:#c0c5ce;"> </span><span style="color:#c0c5ce;">server.serve();
</span></pre>
<p>å®¢æˆ·ç«¯çš„æ„å»ºæ–¹å¼å¯å‚è€ƒæ¸…å• 4ã€‚</p>
<h2 id="tthreadpoolserver-duo-xian-cheng-fu-wu-qi-duan-shi-yong-biao-zhun-de-zu-sai-shi-i-o"><a class="zola-anchor" href="#tthreadpoolserver-duo-xian-cheng-fu-wu-qi-duan-shi-yong-biao-zhun-de-zu-sai-shi-i-o" aria-label="Anchor link for: tthreadpoolserver-duo-xian-cheng-fu-wu-qi-duan-shi-yong-biao-zhun-de-zu-sai-shi-i-o">ğŸ”—</a>
TThreadPoolServer å¤šçº¿ç¨‹æœåŠ¡å™¨ç«¯ä½¿ç”¨æ ‡å‡†çš„é˜»å¡å¼ I/O</h2>
<p>ä½¿ç”¨æ–¹æ³•å¦‚æ¸…å• 3 æ‰€ç¤ºã€‚</p>
<h2 id="tnonblockingserver-duo-xian-cheng-fu-wu-qi-duan-shi-yong-fei-zu-sai-shi-i-o"><a class="zola-anchor" href="#tnonblockingserver-duo-xian-cheng-fu-wu-qi-duan-shi-yong-fei-zu-sai-shi-i-o" aria-label="Anchor link for: tnonblockingserver-duo-xian-cheng-fu-wu-qi-duan-shi-yong-fei-zu-sai-shi-i-o">ğŸ”—</a>
TNonblockingServer å¤šçº¿ç¨‹æœåŠ¡å™¨ç«¯ä½¿ç”¨éé˜»å¡å¼ I/O</h2>
<p>ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒ Thrift å¼‚æ­¥å®¢æˆ·ç«¯æ„å»º</p>

    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https:&#x2F;&#x2F;www.wbprime.me&#x2F;tags&#x2F;thrift&#x2F;">#thrift</a>
                    
                </div>
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.wbprime.me&#x2F;posts&#x2F;2018-02-06-ip-tcp-udp-frames&#x2F;">â€¹ IP TCP UDP Frame Header Structure</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.wbprime.me&#x2F;posts&#x2F;tomcat-note&#x2F;">Tomcat Note â€º</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.wbprime.me&#x2F;even.js" ></script>
      
    </body>

</html>
