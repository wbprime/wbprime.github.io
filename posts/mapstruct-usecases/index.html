<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>wangbo’s blog - Mapper Classes Generated by MapStruct</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">WB Prime</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;github.wangbo.im">
                            Github
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.wangbo.im">WB Prime</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;github.wangbo.im">
                                    Github
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    



<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;mapstruct-usecases&#x2F;">Mapper Classes Generated by MapStruct</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-10-16</span>
            
        </div>
    </header>

    <div class="post-content">
      <p>对象实体转换操作在分层应用中很常见，比如数据库层的对象实体和表现层的实体很可能具有不同的属性集，需要在互操作时进行属性的映射（或拷贝）。</p>
<p><a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 是一个辅助进行 Java 实体类之间相互转换的类库，与其他具有相似功能的工具库之间的最大区别在于其使用了 <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/apt/" title="Annotation Processing Tool (apt)">Java 注解处理器 APT</a> 来实现实体间属性的映射而不是使用反射技术。</p>
<p id="zola-continue-reading"><a name="continue-reading"></a></p>
<h1 id="maven-pei-zhi"><a class="zola-anchor" href="#maven-pei-zhi" aria-label="Anchor link for: maven-pei-zhi">🔗</a>Maven 配置</h1>
<p>类似于 <a href="https://github.com/google/auto/tree/master/value" title="AutoValue - Immutable value-type code generation for Java 1.6+.">Auto Value</a>，<a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 需要引入两个组件：</p>
<ol>
<li><code>org.mapstruct:mapstruct</code> 包含各种定制代码生成行为规则的注解类、接口类和一个辅助构建 Mapper 接口
实现类实例的 <code>org.mapstruct.factory.Mappers</code> 类；需要加入到项目的运行时类路径。</li>
<li><code>org.mapstruct:mapstruct-processor</code> 包含在编译时生成 Mapper 实现类及相关代码的注解处理器实现；只
需要出现在项目的编译时类路径。</li>
</ol>
<p>对于 <a href="http://maven.apache.org/" title="Apache Maven is a software project management and comprehension tool.">Maven</a> 版本大于 <code>3.5</code> 的，可以如下配置使用 <a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 。</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">&lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;
            &lt;artifactId&gt;mapstruct&lt;/artifactId&gt;
            &lt;version&gt;${mapstruct.version}&lt;/version&gt;
        &lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
            &lt;version&gt;${maven_plugin_compiler_version}&lt;/version&gt;
            &lt;configuration&gt;
                &lt;annotationProcessorPaths&gt;
                    &lt;path&gt;
                        &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;
                        &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;
                        &lt;version&gt;${mapstruct.version}&lt;/version&gt;
                    &lt;/path&gt;
                &lt;/annotationProcessorPaths&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</span></pre>
<p>如欲详细了解如何在 <a href="http://maven.apache.org/" title="Apache Maven is a software project management and comprehension tool.">Maven</a> 中配置使用注解处理器类实现，请参见 <a href="https://www.wangbo.im/posts/add-supports-for-apt-in-maven/">在 Maven 中支持 Java 的注解处理器 APT</a>。</p>
<p>截至 2019-10-16，<a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 的最新版本是 <code>1.3.1.Final</code> 。</p>
<h1 id="pojo-mo-shi-shi-ti-dui-xiang-yu-dai-ma-sheng-cheng"><a class="zola-anchor" href="#pojo-mo-shi-shi-ti-dui-xiang-yu-dai-ma-sheng-cheng" aria-label="Anchor link for: pojo-mo-shi-shi-ti-dui-xiang-yu-dai-ma-sheng-cheng">🔗</a>POJO 模式实体对象与代码生成</h1>
<h2 id="ji-ben-cao-zuo"><a class="zola-anchor" href="#ji-ben-cao-zuo" aria-label="Anchor link for: ji-ben-cao-zuo">🔗</a>基本操作</h2>
<p>如果有两个需要相互转换的类 <code>SourceEntity</code> 和 <code>TargetDto</code>：</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">private int </span><span style="color:#fdf4c1aa;">intProperty;
    </span><span style="color:#fa5c4b;">private boolean </span><span style="color:#fdf4c1aa;">boolProperty;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">Long </span><span style="color:#fdf4c1aa;">longProperty;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1aa;">srtProperty;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">OffsetDateTime </span><span style="color:#fdf4c1aa;">dateTime;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">BigDecimal</span><span style="color:#fdf4c1aa;">&gt; numbers;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">Map</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt; types;
}

</span><span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">private int </span><span style="color:#fdf4c1aa;">intProperty;
    </span><span style="color:#fa5c4b;">private boolean </span><span style="color:#fdf4c1aa;">boolProperty;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">Long </span><span style="color:#fdf4c1aa;">longProperty;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1aa;">srtProperty;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">OffsetDateTime </span><span style="color:#fdf4c1aa;">dateTime;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">BigDecimal</span><span style="color:#fdf4c1aa;">&gt; numbers;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">Map</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt; types;
}
</span></pre>
<p>使用 <a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 来生成转换类，需要定义一个转换接口类：</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Mapper
</span><span style="color:#fa5c4b;">public interface </span><span style="color:#8ec07c;">TypeMapper </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#8ec07c;">TargetDto convert</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1;">from</span><span style="color:#fdf4c1aa;">);

    </span><span style="color:#8ec07c;">SourceEntity convert</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1;">from</span><span style="color:#fdf4c1aa;">);
}
</span></pre>
<p>在接口类中声明所需方法，方法的参数是源类型实例，返回值是目标类型；接口类上需要添加 <code>org.mapstruct.Mapper</code> 注解。</p>
<p>运行 <code>mvn clean compile</code> 之后就能看到 <a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 生成的 <code>TypeMapper</code> 实现类 <code>TypeMapperImpl</code>的代码，部分代码如下：</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1;">convert(</span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1;"> from) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1aa;"> targetDto </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1aa;">();

    targetDto.</span><span style="color:#fdf4c1;">setIntProperty( from.getIntProperty() )</span><span style="color:#fdf4c1aa;">;
    targetDto.</span><span style="color:#fdf4c1;">setBoolProperty( from.isBoolProperty() )</span><span style="color:#fdf4c1aa;">;
    targetDto.</span><span style="color:#fdf4c1;">setLongProperty( from.getLongProperty() )</span><span style="color:#fdf4c1aa;">;
    targetDto.</span><span style="color:#fdf4c1;">setSrtProperty( from.getSrtProperty() )</span><span style="color:#fdf4c1aa;">;
    targetDto.</span><span style="color:#fdf4c1;">setDateTime( from.getDateTime() )</span><span style="color:#fdf4c1aa;">;
    </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">BigDecimal</span><span style="color:#fdf4c1aa;">&gt; list </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> from.</span><span style="color:#fdf4c1;">getNumbers()</span><span style="color:#fdf4c1aa;">;
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( list </span><span style="color:#fe8019;">!= </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        targetDto.</span><span style="color:#fdf4c1;">setNumbers( </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">ArrayList</span><span style="color:#fdf4c1;">&lt;</span><span style="color:#8ec07c;">BigDecimal</span><span style="color:#fdf4c1;">&gt;( list ) )</span><span style="color:#fdf4c1aa;">;
    }
    </span><span style="color:#8ec07c;">Map</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt; map </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> from.</span><span style="color:#fdf4c1;">getTypes()</span><span style="color:#fdf4c1aa;">;
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( map </span><span style="color:#fe8019;">!= </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        targetDto.</span><span style="color:#fdf4c1;">setTypes( </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">HashMap</span><span style="color:#fdf4c1;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1;">, </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1;">&gt;( map ) )</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> targetDto;
}

@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1;">convert(</span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1;"> from) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1aa;"> sourceEntity </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1aa;">();

    sourceEntity.</span><span style="color:#fdf4c1;">setIntProperty( from.getIntProperty() )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setBoolProperty( from.isBoolProperty() )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setLongProperty( from.getLongProperty() )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setSrtProperty( from.getSrtProperty() )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setDateTime( from.getDateTime() )</span><span style="color:#fdf4c1aa;">;
    </span><span style="color:#8ec07c;">List</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">BigDecimal</span><span style="color:#fdf4c1aa;">&gt; list </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> from.</span><span style="color:#fdf4c1;">getNumbers()</span><span style="color:#fdf4c1aa;">;
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( list </span><span style="color:#fe8019;">!= </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        sourceEntity.</span><span style="color:#fdf4c1;">setNumbers( </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">ArrayList</span><span style="color:#fdf4c1;">&lt;</span><span style="color:#8ec07c;">BigDecimal</span><span style="color:#fdf4c1;">&gt;( list ) )</span><span style="color:#fdf4c1aa;">;
    }
    </span><span style="color:#8ec07c;">Map</span><span style="color:#fdf4c1aa;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">, </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1aa;">&gt; map </span><span style="color:#fe8019;">=</span><span style="color:#fdf4c1aa;"> from.</span><span style="color:#fdf4c1;">getTypes()</span><span style="color:#fdf4c1aa;">;
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( map </span><span style="color:#fe8019;">!= </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        sourceEntity.</span><span style="color:#fdf4c1;">setTypes( </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">HashMap</span><span style="color:#fdf4c1;">&lt;</span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1;">, </span><span style="color:#8ec07c;">String</span><span style="color:#fdf4c1;">&gt;( map ) )</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> sourceEntity;
}
</span></pre>
<p>注意到生成的代码中对 <code>List</code> 和 <code>Map</code> 类型做了特殊处理，在转换时进行了 <strong>深度拷贝</strong> 以避免不必要的数据共享。</p>
<h2 id="zi-duan-ming-bu-yi-yang"><a class="zola-anchor" href="#zi-duan-ming-bu-yi-yang" aria-label="Anchor link for: zi-duan-ming-bu-yi-yang">🔗</a>字段名不一样</h2>
<p>使用时，<a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 需要源类型和目标类型的属性集合类型和名称保持一致，但这个要求通常很难达到；对于这种需求，<a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 提供了解法。</p>
<p>比如，如果有两个实体类：</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">private int </span><span style="color:#fdf4c1aa;">intProperty;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1aa;">strProperty;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">OffsetDateTime </span><span style="color:#fdf4c1aa;">createdAt;
}

</span><span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">private int </span><span style="color:#fdf4c1aa;">intProperty;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1aa;">strProperty;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">OffsetDateTime </span><span style="color:#fdf4c1aa;">createTime;
}
</span></pre>
<p>两个实体类中的属性名有的相同有的不相同 (<code>createdAt</code> VS <code>createTime</code>) 。</p>
<p>继续使用之前定义的 Mapper，发现生成的代码中忽略了不匹配的属性。</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1;">convert(</span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1;"> from) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1aa;"> targetDto </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1aa;">();

    targetDto.</span><span style="color:#fdf4c1;">setIntProperty( from.getIntProperty() )</span><span style="color:#fdf4c1aa;">;
    targetDto.</span><span style="color:#fdf4c1;">setStrProperty( from.getStrProperty() )</span><span style="color:#fdf4c1aa;">;

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> targetDto;
}

@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1;">convert(</span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1;"> from) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1aa;"> sourceEntity </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1aa;">();

    sourceEntity.</span><span style="color:#fdf4c1;">setIntProperty( from.getIntProperty() )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setStrProperty( from.getStrProperty() )</span><span style="color:#fdf4c1aa;">;

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> sourceEntity;
}
</span></pre>
<p>为了避免这种情况，可以设置 <code>@Mapper</code> 注解的属性，如下：</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Mapper</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">unmappedSourcePolicy </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">ReportingPolicy</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">WARN</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">unmappedTargetPolicy </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">ReportingPolicy</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">ERROR</span><span style="color:#fdf4c1aa;">)
</span><span style="color:#fa5c4b;">public interface </span><span style="color:#8ec07c;">TypeMapper </span><span style="color:#fdf4c1aa;">{
    </span><span style="font-style:italic;color:#928374;">// Omitted
</span><span style="color:#fdf4c1aa;">}
</span></pre>
<p>此时，编译器就会报错，并提示未匹配属性的错误: <code>Unmapped target property: &quot;createTime&quot;</code> 。</p>
<p>然后可以在方法级别添加 <code>org.mapstruct.Mapping</code> 注解，并设置其 <code>source</code> 和 <code>target</code> 属性：</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Mapper</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">unmappedSourcePolicy </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">ReportingPolicy</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">WARN</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">unmappedTargetPolicy </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">ReportingPolicy</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">ERROR</span><span style="color:#fdf4c1aa;">)
</span><span style="color:#fa5c4b;">public interface </span><span style="color:#8ec07c;">TypeMapper </span><span style="color:#fdf4c1aa;">{

    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createdAt&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createTime&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#8ec07c;">TargetDto convert</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1;">from</span><span style="color:#fdf4c1aa;">);

    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createTime&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createdAt&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#8ec07c;">SourceEntity convert</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1;">from</span><span style="color:#fdf4c1aa;">);
}
</span></pre>
<p><code>source</code> 属性的值设置为源类型里面的属性名，<code>target</code> 的值设置为目标类型里面对应的属性名。<code>@Mapping</code>
注解可以应用多次，以指定多个属性的映射规则。</p>
<p>生成的代码中现在已经可以包含预期的代码了：</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1;">convert(</span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1;"> from) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1aa;"> targetDto </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1aa;">();

    targetDto.</span><span style="color:#fdf4c1;">setCreateTime( from.getCreatedAt() )</span><span style="color:#fdf4c1aa;">;
    targetDto.</span><span style="color:#fdf4c1;">setIntProperty( from.getIntProperty() )</span><span style="color:#fdf4c1aa;">;
    targetDto.</span><span style="color:#fdf4c1;">setStrProperty( from.getStrProperty() )</span><span style="color:#fdf4c1aa;">;

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> targetDto;
}

@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1;">convert(</span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1;"> from) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1aa;"> sourceEntity </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1aa;">();

    sourceEntity.</span><span style="color:#fdf4c1;">setCreatedAt( from.getCreateTime() )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setIntProperty( from.getIntProperty() )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setStrProperty( from.getStrProperty() )</span><span style="color:#fdf4c1aa;">;

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> sourceEntity;
}
</span></pre><h2 id="zi-duan-lei-xing-bu-yi-zhi"><a class="zola-anchor" href="#zi-duan-lei-xing-bu-yi-zhi" aria-label="Anchor link for: zi-duan-lei-xing-bu-yi-zhi">🔗</a>字段类型不一致</h2>
<p>如果有属性的类型不匹配（但是可以转换）怎么办呢？</p>
<p>例如，源类型里面有一个 <code>int</code> 类型的属性表示 <code>种类</code> 这个状态，目标类型中对应的属性类型是预定义的枚举值。</p>
<pre style="background-color:#282828;">
<span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">private int </span><span style="color:#fdf4c1aa;">intType;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1aa;">strProperty;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">OffsetDateTime </span><span style="color:#fdf4c1aa;">createdAt;
}

</span><span style="color:#fa5c4b;">public enum </span><span style="color:#8ec07c;">TypeEnum </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fdf4c1;">LARGE</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">MEDIUM</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">SMALL
</span><span style="color:#fdf4c1aa;">}

</span><span style="color:#fa5c4b;">public class </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">TypeEnum </span><span style="color:#fdf4c1aa;">enumType;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1aa;">strProperty;
    </span><span style="color:#fa5c4b;">private </span><span style="color:#8ec07c;">OffsetDateTime </span><span style="color:#fdf4c1aa;">createTime;
}
</span></pre>
<p>此时，编译器可能会报错：<code>Can't map property &quot;int intType&quot; to &quot;TypeEnum enumType&quot;. Consider to declare/implement a mapping method: &quot;TypeEnum map(int value)&quot;</code></p>
<p>按照错误说明中的提示，为 <code>TypeEnum</code> 和 <code>int</code> 添加单独的转换方法。</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Mapper</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">unmappedSourcePolicy </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">ReportingPolicy</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">WARN</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">unmappedTargetPolicy </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">ReportingPolicy</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">ERROR</span><span style="color:#fdf4c1aa;">)
</span><span style="color:#fa5c4b;">public interface </span><span style="color:#8ec07c;">TypeMapper </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createdAt&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createTime&quot;</span><span style="color:#fdf4c1aa;">)
    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;intType&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;enumType&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#8ec07c;">TargetDto convert</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1;">from</span><span style="color:#fdf4c1aa;">);

    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createTime&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createdAt&quot;</span><span style="color:#fdf4c1aa;">)
    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;enumType&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;intType&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#8ec07c;">SourceEntity convert</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1;">from</span><span style="color:#fdf4c1aa;">);

    </span><span style="color:#fa5c4b;">default int </span><span style="color:#8ec07c;">mapType</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">TypeEnum </span><span style="color:#fdf4c1;">v</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">switch </span><span style="color:#fdf4c1aa;">(v) {
            </span><span style="color:#fa5c4b;">case </span><span style="color:#fdf4c1;">LARGE</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">1</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">case </span><span style="color:#fdf4c1;">MEDIUM</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">2</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">default</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">3</span><span style="color:#fdf4c1aa;">;
        }
    }

    </span><span style="color:#fa5c4b;">static </span><span style="color:#8ec07c;">TypeEnum mapType</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">v</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">switch </span><span style="color:#fdf4c1aa;">(v) {
            </span><span style="color:#fa5c4b;">case </span><span style="color:#d3869b;">1</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">TypeEnum</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">LARGE</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">case </span><span style="color:#d3869b;">2</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">TypeEnum</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">MEDIUM</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">default</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">TypeEnum</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">SMALL</span><span style="color:#fdf4c1aa;">;
        }
    }
}
</span></pre>
<p>单独的转换方法可以是 <strong>静态方法</strong> 也可以是 <strong>默认方法</strong>。</p>
<p>在生成的实现类代码中，自定义的转换方法会被调用。</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1;">convert(</span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1;"> from) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1aa;"> targetDto </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1aa;">();

    targetDto.</span><span style="color:#fdf4c1;">setEnumType( </span><span style="color:#8ec07c;">TypeMapper</span><span style="color:#fdf4c1;">.mapType( from.getIntType() ) )</span><span style="color:#fdf4c1aa;">;
    targetDto.</span><span style="color:#fdf4c1;">setCreateTime( from.getCreatedAt() )</span><span style="color:#fdf4c1aa;">;
    targetDto.</span><span style="color:#fdf4c1;">setStrProperty( from.getStrProperty() )</span><span style="color:#fdf4c1aa;">;

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> targetDto;
}

@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1;">convert(</span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1;"> from) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1aa;"> sourceEntity </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1aa;">();

    sourceEntity.</span><span style="color:#fdf4c1;">setCreatedAt( from.getCreateTime() )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setIntType( mapType( from.getEnumType() ) )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setStrProperty( from.getStrProperty() )</span><span style="color:#fdf4c1aa;">;

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> sourceEntity;
}
</span></pre><h2 id="duo-ge-yuan-lei-xing"><a class="zola-anchor" href="#duo-ge-yuan-lei-xing" aria-label="Anchor link for: duo-ge-yuan-lei-xing">🔗</a>多个源类型</h2>
<p>如果遇到以下的这种情况：源数据有两个或多个类型，比如一个用户的数据被存储于两个数据表中，使用 <a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 也可以实现多个源和一个目标类型映射的自动代码生成（像你想的那样实现）。</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">public class AdditionalEntity {
    private OffsetDateTime updatedAt;
    private String updateBy;
    private String content;
}

public class SourceEntity {
    private int intType;
    private String strProperty;
    private OffsetDateTime createdAt;
}

public class TargetDto {
    private TypeEnum enumType;
    private String strProperty;
    private OffsetDateTime createTime;
    private OffsetDateTime lastUpdateTime;
}
</span></pre>
<p>按照下面的用法配置 <code>@Mapper</code> 和 <code>@Mapping</code> 注解：</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Mapper</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">unmappedSourcePolicy </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">ReportingPolicy</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">WARN</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">unmappedTargetPolicy </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">ReportingPolicy</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">ERROR</span><span style="color:#fdf4c1aa;">)
</span><span style="color:#fa5c4b;">public interface </span><span style="color:#8ec07c;">TypeMapper </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;from.intType&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;enumType&quot;</span><span style="color:#fdf4c1aa;">)
    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;from.createdAt&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createTime&quot;</span><span style="color:#fdf4c1aa;">)
    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;additional.updatedAt&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;lastUpdateTime&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#8ec07c;">TargetDto convert</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1;">from</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">AdditionalEntity </span><span style="color:#fdf4c1;">additional</span><span style="color:#fdf4c1aa;">);

    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;enumType&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;intType&quot;</span><span style="color:#fdf4c1aa;">)
    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createTime&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createdAt&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#8ec07c;">SourceEntity convertToSource</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1;">from</span><span style="color:#fdf4c1aa;">);

    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;lastUpdateTime&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;updatedAt&quot;</span><span style="color:#fdf4c1aa;">)
    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;updatedBy&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">constant </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;System&quot;</span><span style="color:#fdf4c1aa;">)
    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;content&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">expression </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;java(\&quot;Created at \&quot; + java.time.OffsetDateTime.now())&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#8ec07c;">AdditionalEntity convertToAdditional</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1;">from</span><span style="color:#fdf4c1aa;">);

    </span><span style="color:#fa5c4b;">default int </span><span style="color:#8ec07c;">mapType</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">TypeEnum </span><span style="color:#fdf4c1;">v</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">switch </span><span style="color:#fdf4c1aa;">(v) {
            </span><span style="color:#fa5c4b;">case </span><span style="color:#fdf4c1;">LARGE</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">1</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">case </span><span style="color:#fdf4c1;">MEDIUM</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">2</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">default</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">3</span><span style="color:#fdf4c1aa;">;
        }
    }

    </span><span style="color:#fa5c4b;">static </span><span style="color:#8ec07c;">TypeEnum mapType</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">v</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">switch </span><span style="color:#fdf4c1aa;">(v) {
            </span><span style="color:#fa5c4b;">case </span><span style="color:#d3869b;">1</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">TypeEnum</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">LARGE</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">case </span><span style="color:#d3869b;">2</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">TypeEnum</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">MEDIUM</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">default</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">TypeEnum</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">SMALL</span><span style="color:#fdf4c1aa;">;
        }
    }
}
</span></pre>
<p><code>@Mapping</code> 注解可以支持为目标属性设置固定值（<code>constant</code>）或设置表达式值(<code>expression</code>)，而且由于 <a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 的编译时代码生成特性，不合法的值会直接在编译时报错。</p>
<p>如你所想，生成的代码正确地设置了目标属性值。</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1;">convert(</span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1;"> from, </span><span style="color:#8ec07c;">AdditionalEntity</span><span style="color:#fdf4c1;"> additional) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fe8019;">&amp;&amp;</span><span style="color:#fdf4c1aa;"> additional </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1aa;"> targetDto </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1aa;">();

    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">!= </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        targetDto.</span><span style="color:#fdf4c1;">setEnumType( </span><span style="color:#8ec07c;">TypeMapper</span><span style="color:#fdf4c1;">.mapType( from.getIntType() ) )</span><span style="color:#fdf4c1aa;">;
        targetDto.</span><span style="color:#fdf4c1;">setCreateTime( from.getCreatedAt() )</span><span style="color:#fdf4c1aa;">;
        targetDto.</span><span style="color:#fdf4c1;">setStrProperty( from.getStrProperty() )</span><span style="color:#fdf4c1aa;">;
    }
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( additional </span><span style="color:#fe8019;">!= </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        targetDto.</span><span style="color:#fdf4c1;">setLastUpdateTime( additional.getUpdatedAt() )</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> targetDto;
}

@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1;">convertToSource(</span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1;"> from) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1aa;"> sourceEntity </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1aa;">();

    sourceEntity.</span><span style="color:#fdf4c1;">setCreatedAt( from.getCreateTime() )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setIntType( mapType( from.getEnumType() ) )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setStrProperty( from.getStrProperty() )</span><span style="color:#fdf4c1aa;">;

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> sourceEntity;
}

@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">AdditionalEntity </span><span style="color:#fdf4c1;">convertToAdditional(</span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1;"> from) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">AdditionalEntity</span><span style="color:#fdf4c1aa;"> additionalEntity </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">new </span><span style="color:#8ec07c;">AdditionalEntity</span><span style="color:#fdf4c1aa;">();

    additionalEntity.</span><span style="color:#fdf4c1;">setUpdatedAt( from.getLastUpdateTime() )</span><span style="color:#fdf4c1aa;">;

    additionalEntity.</span><span style="color:#fdf4c1;">setUpdatedBy( </span><span style="color:#b8bb26;">&quot;System&quot; </span><span style="color:#fdf4c1;">)</span><span style="color:#fdf4c1aa;">;
    additionalEntity.</span><span style="color:#fdf4c1;">setContent( </span><span style="color:#b8bb26;">&quot;Created at &quot; </span><span style="color:#fe8019;">+ </span><span style="color:#fabd2f;">java</span><span style="color:#fdf4c1;">.</span><span style="color:#fabd2f;">time</span><span style="color:#fdf4c1;">.</span><span style="color:#8ec07c;">OffsetDateTime</span><span style="color:#fdf4c1;">.now() )</span><span style="color:#fdf4c1aa;">;

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> additionalEntity;
}
</span></pre><h1 id="builder-mo-shi-shi-ti-dui-xiang-yu-dai-ma-sheng-cheng"><a class="zola-anchor" href="#builder-mo-shi-shi-ti-dui-xiang-yu-dai-ma-sheng-cheng" aria-label="Anchor link for: builder-mo-shi-shi-ti-dui-xiang-yu-dai-ma-sheng-cheng">🔗</a>Builder 模式实体对象与代码生成</h1>
<p><a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 除了对 POJO 的支持外，还提供对基于 Builder 模式的不可变对象的支持，只要满足以下条件：</p>
<ol>
<li>目标类中必须存在一个公共的静态无参方法可以构造一个 Builder 模式对象 (形如 <code>public static Builder builder()</code>)</li>
<li>目标类的 Builder 模式类中必须存在一个公司的无参方法可以生成一个目标类对象 (形如 <code>public UserDto build()</code>)</li>
</ol>
<p>在上述条件中，方法名可以自定义，但一般都约定为 <code>public static Builder builder()</code> 和 <code>public UserDto build()</code> 。</p>
<p><a href="https://github.com/google/auto/tree/master/value" title="AutoValue - Immutable value-type code generation for Java 1.6+.">AutoValue</a> 的 Builder 模式和 <a href="https://freebuilder.inferred.org/" title="Automatic generation of the Builder pattern for Java">FreeBuilder</a> 都能够满足上述要求。</p>
<p>下述实体对象分别使用了 <a href="https://github.com/google/auto/tree/master/value" title="AutoValue - Immutable value-type code generation for Java 1.6+.">AutoValue</a> 和 <a href="https://freebuilder.inferred.org/" title="Automatic generation of the Builder pattern for Java">FreeBuilder</a>。</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">AutoValue
</span><span style="color:#fa5c4b;">public abstract class </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">public abstract int </span><span style="color:#8ec07c;">getIntType</span><span style="color:#fdf4c1aa;">();
    </span><span style="color:#fa5c4b;">public abstract </span><span style="color:#8ec07c;">String getStrProperty</span><span style="color:#fdf4c1aa;">();
    </span><span style="color:#fa5c4b;">public abstract </span><span style="color:#8ec07c;">OffsetDateTime getCreatedAt</span><span style="color:#fdf4c1aa;">();

    </span><span style="color:#fa5c4b;">public static </span><span style="color:#8ec07c;">Builder builder</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fa5c4b;">return new </span><span style="color:#8ec07c;">AutoValue_SourceEntity</span><span style="color:#fdf4c1aa;">.</span><span style="color:#8ec07c;">Builder</span><span style="color:#fdf4c1aa;">();
    }

    @</span><span style="color:#fdf4c1;">AutoValue</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">Builder
    </span><span style="color:#fa5c4b;">public abstract static class </span><span style="color:#8ec07c;">Builder </span><span style="color:#fdf4c1aa;">{
        </span><span style="color:#fa5c4b;">public abstract </span><span style="color:#8ec07c;">Builder setIntType</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">int </span><span style="color:#fdf4c1;">newIntType</span><span style="color:#fdf4c1aa;">);
        </span><span style="color:#fa5c4b;">public abstract </span><span style="color:#8ec07c;">Builder setStrProperty</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">String </span><span style="color:#fdf4c1;">newStrProperty</span><span style="color:#fdf4c1aa;">);
        </span><span style="color:#fa5c4b;">public abstract </span><span style="color:#8ec07c;">Builder setCreatedAt</span><span style="color:#fdf4c1aa;">(</span><span style="color:#8ec07c;">OffsetDateTime </span><span style="color:#fdf4c1;">newCreatedAt</span><span style="color:#fdf4c1aa;">);

        </span><span style="color:#fa5c4b;">public abstract </span><span style="color:#8ec07c;">SourceEntity build</span><span style="color:#fdf4c1aa;">();
    }
}

@</span><span style="color:#fdf4c1;">FreeBuilder
</span><span style="color:#fa5c4b;">public abstract class </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">public abstract </span><span style="color:#8ec07c;">TypeEnum getEnumType</span><span style="color:#fdf4c1aa;">();
    </span><span style="color:#fa5c4b;">public abstract </span><span style="color:#8ec07c;">String getStrProperty</span><span style="color:#fdf4c1aa;">();
    </span><span style="color:#fa5c4b;">public abstract </span><span style="color:#8ec07c;">OffsetDateTime getCreateTime</span><span style="color:#fdf4c1aa;">();

    </span><span style="color:#fa5c4b;">public static </span><span style="color:#8ec07c;">Builder builder</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fa5c4b;">return new </span><span style="color:#8ec07c;">Builder</span><span style="color:#fdf4c1aa;">();
    }

    </span><span style="color:#fa5c4b;">static class </span><span style="color:#8ec07c;">Builder </span><span style="color:#fa5c4b;">extends </span><span style="color:#8ec07c;">TargetDto_Builder </span><span style="color:#fdf4c1aa;">{ }
}
</span></pre>
<p>注意，在 <a href="https://github.com/google/auto/tree/master/value" title="AutoValue - Immutable value-type code generation for Java 1.6+.">AutoValue</a> 和 <a href="https://freebuilder.inferred.org/" title="Automatic generation of the Builder pattern for Java">FreeBuilder</a> 的用例中，声明属性的方法名必须符合 Bean 的规范 (即 Getter 方法必须以 <code>get</code> 或 <code>is</code> 开头，Setter 方法必须以 <code>set</code> 开头)。</p>
<p>Mapper 接口类与 POJO 时一样。</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Mapper</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">unmappedSourcePolicy </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">ReportingPolicy</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">WARN</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">unmappedTargetPolicy </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">ReportingPolicy</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">ERROR</span><span style="color:#fdf4c1aa;">)
</span><span style="color:#fa5c4b;">public interface </span><span style="color:#8ec07c;">TypeMapper </span><span style="color:#fdf4c1aa;">{
    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;intType&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;enumType&quot;</span><span style="color:#fdf4c1aa;">)
    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createdAt&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createTime&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#8ec07c;">TargetDto convert</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1;">from</span><span style="color:#fdf4c1aa;">);

    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;enumType&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;intType&quot;</span><span style="color:#fdf4c1aa;">)
    @</span><span style="color:#fdf4c1;">Mapping</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fdf4c1;">source </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createTime&quot;</span><span style="color:#fdf4c1aa;">, </span><span style="color:#fdf4c1;">target </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;createdAt&quot;</span><span style="color:#fdf4c1aa;">)
    </span><span style="color:#8ec07c;">SourceEntity convert</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1;">from</span><span style="color:#fdf4c1aa;">);

    </span><span style="color:#fa5c4b;">default int </span><span style="color:#8ec07c;">mapType</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final </span><span style="color:#8ec07c;">TypeEnum </span><span style="color:#fdf4c1;">v</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">switch </span><span style="color:#fdf4c1aa;">(v) {
            </span><span style="color:#fa5c4b;">case </span><span style="color:#fdf4c1;">LARGE</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">1</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">case </span><span style="color:#fdf4c1;">MEDIUM</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">2</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">default</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">3</span><span style="color:#fdf4c1aa;">;
        }
    }

    </span><span style="color:#fa5c4b;">static </span><span style="color:#8ec07c;">TypeEnum mapType</span><span style="color:#fdf4c1aa;">(</span><span style="color:#fa5c4b;">final int </span><span style="color:#fdf4c1;">v</span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">switch </span><span style="color:#fdf4c1aa;">(v) {
            </span><span style="color:#fa5c4b;">case </span><span style="color:#d3869b;">1</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">TypeEnum</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">LARGE</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">case </span><span style="color:#d3869b;">2</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">TypeEnum</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">MEDIUM</span><span style="color:#fdf4c1aa;">;
            </span><span style="color:#fa5c4b;">default</span><span style="color:#fe8019;">: </span><span style="color:#fa5c4b;">return </span><span style="color:#8ec07c;">TypeEnum</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">SMALL</span><span style="color:#fdf4c1aa;">;
        }
    }
}
</span></pre>
<p>生成的实现类中使用了各自的 Builder 类。</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">TargetDto </span><span style="color:#fdf4c1;">convert(</span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1;"> from) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1aa;">.</span><span style="color:#8ec07c;">Builder</span><span style="color:#fdf4c1aa;"> targetDto </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">builder()</span><span style="color:#fdf4c1aa;">;

    targetDto.</span><span style="color:#fdf4c1;">setEnumType( </span><span style="color:#8ec07c;">TypeMapper</span><span style="color:#fdf4c1;">.mapType( from.getIntType() ) )</span><span style="color:#fdf4c1aa;">;
    targetDto.</span><span style="color:#fdf4c1;">setCreateTime( from.getCreatedAt() )</span><span style="color:#fdf4c1aa;">;
    targetDto.</span><span style="color:#fdf4c1;">setStrProperty( from.getStrProperty() )</span><span style="color:#fdf4c1aa;">;

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> targetDto.</span><span style="color:#fdf4c1;">build()</span><span style="color:#fdf4c1aa;">;
}

@</span><span style="color:#fdf4c1;">Override
</span><span style="color:#fa5c4b;">public </span><span style="color:#8ec07c;">SourceEntity </span><span style="color:#fdf4c1;">convert(</span><span style="color:#8ec07c;">TargetDto</span><span style="color:#fdf4c1;"> from) </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">if </span><span style="color:#fdf4c1aa;">( from </span><span style="color:#fe8019;">== </span><span style="color:#d3869b;">null </span><span style="color:#fdf4c1aa;">) {
        </span><span style="color:#fa5c4b;">return </span><span style="color:#d3869b;">null</span><span style="color:#fdf4c1aa;">;
    }

    </span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1aa;">.</span><span style="color:#8ec07c;">Builder</span><span style="color:#fdf4c1aa;"> sourceEntity </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">SourceEntity</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">builder()</span><span style="color:#fdf4c1aa;">;

    sourceEntity.</span><span style="color:#fdf4c1;">setCreatedAt( from.getCreateTime() )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setIntType( mapType( from.getEnumType() ) )</span><span style="color:#fdf4c1aa;">;
    sourceEntity.</span><span style="color:#fdf4c1;">setStrProperty( from.getStrProperty() )</span><span style="color:#fdf4c1aa;">;

    </span><span style="color:#fa5c4b;">return</span><span style="color:#fdf4c1aa;"> sourceEntity.</span><span style="color:#fdf4c1;">build()</span><span style="color:#fdf4c1aa;">;
}
</span></pre><h1 id="mapper-shi-xian-lei-shi-li-de-huo-qu"><a class="zola-anchor" href="#mapper-shi-xian-lei-shi-li-de-huo-qu" aria-label="Anchor link for: mapper-shi-xian-lei-shi-li-de-huo-qu">🔗</a>Mapper 实现类实例的获取</h1>
<p><a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 自动生成的 Mapper 接口的实现类的类名默认是接口名后面加上 <code>Impl</code> 后缀，如果有需要也可以自定义。</p>
<p>使用 Mapper 接口的实现时，可以手动调用实现类的 <code>new</code> 表达式。</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Mapper
</span><span style="color:#fa5c4b;">public interface </span><span style="color:#8ec07c;">TypeMapper </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#fa5c4b;">static </span><span style="color:#8ec07c;">TypeMapper instance</span><span style="color:#fdf4c1aa;">() {
        </span><span style="color:#fa5c4b;">return new </span><span style="color:#8ec07c;">TypeMapperImpl</span><span style="color:#fdf4c1aa;">();
    }
}
</span></pre>
<p>或者使用 <a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 提供的 <code>org.mapstruct.factory.Mappers</code> 实用类。</p>
<pre style="background-color:#282828;">
<span style="color:#fdf4c1aa;">@</span><span style="color:#fdf4c1;">Mapper
</span><span style="color:#fa5c4b;">public interface </span><span style="color:#8ec07c;">TypeMapper </span><span style="color:#fdf4c1aa;">{
    </span><span style="color:#8ec07c;">TypeMapper INSTANCE </span><span style="color:#fe8019;">= </span><span style="color:#8ec07c;">Mappers</span><span style="color:#fdf4c1aa;">.</span><span style="color:#fdf4c1;">getMapper(</span><span style="color:#8ec07c;">TypeMapper</span><span style="color:#fdf4c1;">.class)</span><span style="color:#fdf4c1aa;">;
}
</span></pre>
<p>如果使用了依赖注入框架 (如 <a href="https://jcp.org/en/jsr/detail?id=346">Contexts and Dependency Injection for JavaTM EE, CDI</a> <a href="https://projects.spring.io/spring-framework/">Spring</a> <a href="https://github.com/google/guice">Guice</a> 等) 的话，也可以启用 <a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 对其的支持。</p>
<hr />
<p>完整的示例代码可以参见 <a href="https://github.com/wbprime/java-mods/tree/master/mapstruct-usecases">MapStruct Usecases</a> 。</p>
<p>想了解更多的 <a href="https://mapstruct.org/" title="Java bean mappings, the easy way!">MapStruct</a> 用法，可以阅读 <a href="https://mapstruct.org/documentation/stable/reference/html/" title="MapStruct Reference Guide">官方文档</a>，也可以去 [官方仓库][https://github.com/mapstruct/mapstruct-examples] 了解各种用例。</p>
<hr />
<p>以上。</p>

    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;java&#x2F;">#java</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;apt&#x2F;">#apt</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;mapstruct&#x2F;">#mapstruct</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;autovalue&#x2F;">#autovalue</a>
                    
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;freebuilder&#x2F;">#freebuilder</a>
                    
                </div>
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;add-supports-for-apt-in-maven&#x2F;">‹ 在 Maven 中支持 Java 的注解处理器 APT</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;jooq-usecases-sql-builder&#x2F;">JOOQ 的使用 - 拼接 SQL 语句 (SQL Builder) ›</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;even.js" ></script>
      
    </body>

</html>
