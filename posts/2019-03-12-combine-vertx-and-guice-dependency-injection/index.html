<!DOCTYPE html>
<html lang="en">
    <head>
    <title>åœ¨ Vert.x é¡¹ç›®ä¸­é›†æˆä½¿ç”¨ Guice ä¾èµ–æ³¨å…¥ - Elvis Wang</title>
    
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="wangboâ€™s home &amp; blog"/>

    <meta property="og:title" content="
    wangboâ€™s blog -&nbsp;åœ¨ Vert.x é¡¹ç›®ä¸­é›†æˆä½¿ç”¨ Guice ä¾èµ–æ³¨å…¥" />
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-12-combine-vertx-and-guice-dependency-injection&#x2F;"/>
    <meta property="og:description" content="&lt;p&gt;æœ¬æ–‡ä»‹ç»äº†é¡¹ç›®ä¸­åœ¨åŸºäº &lt;a href=&quot;https:&#x2F;&#x2F;vertx.io&quot; title=&quot;Eclipse Vert.x&quot;&gt;Eclipse Vert.x&lt;&#x2F;a&gt; çš„ Verticle ä¸­ä½¿ç”¨ &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#xâ€¦"/>
    <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;style.css">
    <link rel="stylesheet" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;color&#x2F;blue.css">
<link rel="shortcut icon" href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;favicon.ico" type="image/x-icon" /></head>
    <body>
        <div class="container full">
<header class="header">
    <div class="header__inner">
        <div class="header__logo">
            <a href="&#x2F;">
    <div class="logo">
        WB Prime
    </div>
</a>
        </div>
        <div class="menu-trigger">menu</div>
    </div>
    
    <nav class="menu">
        <ul class="menu__inner menu__inner--desktop">
            
            
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">About</a>
                    </li>
                
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">Categories</a>
                    </li>
                
                    <li>
                        <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">Tags</a>
                    </li>
                
            </ul>

        <ul class="menu__inner menu__inner--mobile">
            
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;about">About</a>
        </li>
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories">Categories</a>
        </li>
        <li>
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags">Tags</a>
        </li>
        </ul>
    </nav>

    </header>
<div class="content"><div class="post">
        <h1 class="post-title">
            <a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;posts&#x2F;2019-03-12-combine-vertx-and-guice-dependency-injection&#x2F;">åœ¨ Vert.x é¡¹ç›®ä¸­é›†æˆä½¿ç”¨ Guice ä¾èµ–æ³¨å…¥</a>
        </h1>
        
    <div class="post-meta">
        <span class="post-date">2019.03.31
                </span>

        <span class="post-author"></span>

        

    
    :: {<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;categories&#x2F;vertx&#x2F;">Vertx</a>} 

            
    ::
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;vert-x&#x2F;">vert.x</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;guice&#x2F;">guice</a>
        
    #<a href="https:&#x2F;&#x2F;www.wangbo.im&#x2F;tags&#x2F;jsr303&#x2F;">jsr303</a>
        
    
            
        
    </div>



        

        <div class="post-content">
            <p>æœ¬æ–‡ä»‹ç»äº†é¡¹ç›®ä¸­åœ¨åŸºäº <a href="https://vertx.io" title="Eclipse Vert.x">Eclipse Vert.x</a> çš„ Verticle ä¸­ä½¿ç”¨ <a href="https://github.com/google/guice" title="Google Guice">Google Guice</a> è¿›è¡Œä¾èµ–æ³¨å…¥çš„å®è·µï¼Œä¸»è¦çš„æ€è·¯æ˜¯åœ¨ <code>io.vertx.core.Verticle#start</code> æ–¹æ³•ä¸­ä¸»åŠ¨åˆ›å»º <code>com.google.inject.Injector</code> æ³¨å…¥å™¨å®ä¾‹å¹¶å®è¡Œæ³¨å…¥æ“ä½œï¼Œåœ¨æ³¨å…¥æ“ä½œæˆåŠŸç»“æŸä¹‹åå†è¿›è¡Œåç»­çš„æ“ä½œã€‚</p>
<p>åœ¨å¼€å‘ç»“æŸåçš„æŸä¸€å¤©ï¼Œé€šè¿‡ä¸‡èƒ½çš„æœç´¢å‘ç°å·²ç»æœ‰äººæä¾›äº†åŸºäº <a href="https://github.com/google/guice" title="Google Guice">Google Guice</a> çš„ <a href="https://vertx.io" title="Eclipse Vert.x">Eclipse Vert.x</a> æ‰©å±•: <a href="https://github.com/ef-labs/vertx-guice" title="Google Guice">Vert.x Guice Extension</a>ã€‚<a href="https://github.com/ef-labs/vertx-guice" title="Google Guice">Vert.x Guice Extension</a> æ‰©å±•äº† <a href="https://vertx.io" title="Eclipse Vert.x">Vert.x</a> å†…ç½®çš„ <code>io.vertx.core.spi.VerticleFactory</code> æœºåˆ¶ï¼Œèƒ½å¤Ÿä½¿ç”¨ SPI çš„æ–¹å¼åŠ è½½éœ€è¦çš„
Guice ä¾èµ–ã€‚</p>
<p>æœ¬æ–‡æ€»ç»“ä¸€ä¸‹è‡ªå·±çš„å®ç°æ€è·¯ï¼Œç„¶ååˆ†æ <a href="https://github.com/ef-labs/vertx-guice" title="Google Guice">Vert.x Guice Extension</a> çš„å®ç°ç»†èŠ‚ï¼Œå¸Œæœ›èƒ½æé«˜è‡ªå·±çš„ä»£ç æ°´å¹³ã€‚</p>
<p><a name="continue-reading"></a></p>
<h1 id="wo-de-fang-an"><a class="zola-anchor" href="#wo-de-fang-an" aria-label="Anchor link for: wo-de-fang-an">ğŸ”—</a>
æˆ‘çš„æ–¹æ¡ˆ</h1>
<p>æˆ‘çš„æ–¹æ¡ˆå¾ˆç›´æ¥å¾ˆç²—æš´ï¼šæŠŠ Verticle çš„å¯åŠ¨æ–¹æ³•ä½œä¸ºç¨‹åºçš„å…¥å£ï¼Œåœ¨å…¥å£æ–¹æ³•é‡Œé¢åˆ›å»º Guice Injector å®ä¾‹å¹¶å¯¹å¯åŠ¨çš„ Verticle å®ä¾‹è¿›è¡Œä¸»åŠ¨æ³¨å…¥ã€‚</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">public class MainVerticle extends AbstractVerticle {
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">private static final Logger LOGGER = LoggerFactory.getLogger(MainVerticle.class);
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Inject
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Named(Constants.KEY_HTTP_LISTEN_HOST)
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">private String listenIp;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Inject
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Named(Constants.KEY_HTTP_LISTEN_PORT)
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">private Integer listenPort = 8001;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Inject
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@RegularRouter
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">private Set&lt;Controller&gt; regularControllers;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Inject
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">private Set&lt;Runnable&gt; warmUps;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Override
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">public void start(final Future&lt;Void&gt; future) throws Exception {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">final Injector injector = Guice.createInjector(new MainModule(vertx, config()));
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">injector.injectMembers(this);
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">final Router router = Router.router(vertx);
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">router.exceptionHandler(ex -&gt; LOGGER.warn(&quot;Uncaught exception&quot;, ex));
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">regularControllers.stream().sorted().forEach(c -&gt; {
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">LOGGER.debug(&quot;Registered regular Controller \&quot;{}\&quot;&quot;, c);
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">c.accept(router);
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">});
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">Completable.fromRunnable(() -&gt; warmUps.parallelStream().forEach(Runnable::run))
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">.subscribeOn(RxHelper.blockingScheduler(vertx))
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">.subscribe(
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">() -&gt; {
</span><span style="color:#dcdcdc;">                    </span><span style="color:#dcdcdc;">LOGGER.info(&quot;Warm up finished, try to start HTTP listening on {}:{} ...&quot;, listenIp, listenPort);
</span><span style="color:#dcdcdc;">                    </span><span style="color:#dcdcdc;">vertx.createHttpServer()
</span><span style="color:#dcdcdc;">                        </span><span style="color:#dcdcdc;">.requestHandler(router::accept)
</span><span style="color:#dcdcdc;">                        </span><span style="color:#dcdcdc;">.listen(listenPort, listenIp, e -&gt; {
</span><span style="color:#dcdcdc;">                            </span><span style="color:#dcdcdc;">if (e.succeeded()) {
</span><span style="color:#dcdcdc;">                                </span><span style="color:#dcdcdc;">future.complete();
</span><span style="color:#dcdcdc;">                            </span><span style="color:#dcdcdc;">} else {
</span><span style="color:#dcdcdc;">                                </span><span style="color:#dcdcdc;">future.fail(e.cause());
</span><span style="color:#dcdcdc;">                            </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">                        </span><span style="color:#dcdcdc;">});
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">},
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">ex -&gt; {
</span><span style="color:#dcdcdc;">                    </span><span style="color:#dcdcdc;">LOGGER.error(&quot;Warmup failed, disable HTTP listening&quot;, ex);
</span><span style="color:#dcdcdc;">                    </span><span style="color:#dcdcdc;">future.fail(ex);
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">);
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre>
<p>ä»£ç å¾ˆç®€æ´æ˜äº†ã€‚</p>
<p>æœåŠ¡ä¸­éœ€è¦å¯åŠ¨ä¸€ä¸ª HttpServer ç›‘å¬ï¼Œç›‘å¬çš„ host å’Œç«¯å£éœ€è¦åœ¨æœåŠ¡å¤–éƒ¨é€šè¿‡é…ç½®çš„æ–¹å¼ä¼ è¿›æ¥ã€‚è¿™äº›é…ç½®æ˜¯é€šè¿‡ Guice é…ç½®å¹¶æ³¨å…¥çš„ã€‚</p>
<p>æ„é€ çš„ HttpServer éœ€è¦ä¸ºä¸åŒçš„ Endpoint (path &amp; method) è®¾ç½®ä¸åŒçš„å“åº”ä»£ç  (Handler)ï¼Œæˆ‘å°†å…¶æŠ½è±¡ä¸ºä¸€ç³»åˆ—çš„ Controllerï¼šå…¶å®å°±æ˜¯ JDK8 çš„ Consumer æ¥å£ï¼Œå®ç°äº†æ”¯æŒä¸º Router æ·»åŠ  Handler çš„ <code>accept</code> æ–¹æ³•ä»¥åŠæ·»åŠ äº†èƒ½å¤Ÿå®ç°ä¼˜å…ˆçº§çš„ <code>order</code> æ–¹æ³•ã€‚</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#9b9b9b;">import </span><span style="color:#dcdcdc;">java.util.function.Consumer;
</span><span style="color:#569cd6;">public interface </span><span style="color:#dcdcdc;">Controller </span><span style="color:#569cd6;">extends </span><span style="color:#4ec9b0;">Consumer</span><span style="color:#dcdcdc;">&lt;Router&gt;, Comparable&lt;Controller&gt; {
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">default long </span><span style="color:#dcdcdc;">order() {</span><span style="color:#569cd6;">return </span><span style="color:#b5cea8;">0</span><span style="color:#569cd6;">L</span><span style="color:#dcdcdc;">;}
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Override
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">default int </span><span style="color:#dcdcdc;">compareTo(final Controller o) {
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">return </span><span style="color:#dcdcdc;">Long.compare(order(), o.order());
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Override
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">default</span><span style="color:#dcdcdc;"> void accept(final Router r) {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">r.route(</span><span style="color:#d69d85;">&quot;/&quot;</span><span style="color:#dcdcdc;">).handler(ctx </span><span style="color:#569cd6;">-&gt; </span><span style="color:#dcdcdc;">{
</span><span style="color:#dcdcdc;">            </span><span style="color:#569cd6;">final </span><span style="color:#dcdcdc;">JsonObject msg = </span><span style="color:#569cd6;">new </span><span style="color:#dcdcdc;">JsonObject();
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">msg.put(</span><span style="color:#d69d85;">&quot;Hello&quot;</span><span style="color:#dcdcdc;">, </span><span style="color:#d69d85;">&quot;World&quot;</span><span style="color:#dcdcdc;">);
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">ctx.response().end(msg.encode());
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">});
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre>
<p>æ·»åŠ äº† <code>order</code> æ–¹æ³•çš„ Controller çš„å¤šä¸ªå®ç°ç±»å¯ä»¥é€šè¿‡ <a href="https://github.com/google/guice/wiki/Multibindings" title="Google Guice MultiBindings Extension">com.google.inject.extensions:guice-multibindings</a> æä¾›çš„ <code>com.google.inject.multibindings.Multibinder</code> æ¥æä¾›æ³¨å…¥ä¸º <code>java.util.Set</code> çš„æ”¯æŒã€‚ä¸åŒçš„ Controller å®ç°ç±»å¯ä»¥å¤„äºå¤šä¸ªåŒ…ä¸­ï¼Œåˆ†åˆ«é€šè¿‡ä»¥ä¸‹ä»£ç æä¾›ï¼š</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">{
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">final </span><span style="color:#dcdcdc;">Multibinder&lt;Controller&gt; binder =
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">Multibinder.newSetBinder(binder(), Controller.class, RegularRouter.class);
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">binder.addBinding().to(FastController.class).in(Scopes.</span><span style="color:#b4cea8;">SINGLETON</span><span style="color:#dcdcdc;">);
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">binder.addBinding().to(SlowController.class).in(Scopes.</span><span style="color:#b4cea8;">SINGLETON</span><span style="color:#dcdcdc;">);
</span><span style="color:#dcdcdc;">}
</span></pre>
<p>åŒæ ·ï¼Œå¯ä»¥æ·»åŠ å¯¹å®ç°äº† <code>java.lang.Runnable</code> çš„ç±»å‹æ³¨å…¥æ”¯æŒï¼Œæ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p>
<p>æœ€å…³é”®çš„ä¾èµ–æ³¨å…¥çš„æ‰§è¡Œä»£ç åœ¨ <code>start</code> æ–¹æ³•çš„æœ€å¼€å§‹ï¼š</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#569cd6;">final </span><span style="color:#dcdcdc;">Injector injector = Guice.createInjector(</span><span style="color:#569cd6;">new </span><span style="color:#dcdcdc;">MainModule(vertx, config()));
</span><span style="color:#dcdcdc;">injector.injectMembers(this); </span><span style="color:#608b4e;">// On-demand Injection via injectMembers
</span></pre>
<p>ä»£ç ä»ä¾èµ–æä¾›è€… <code>MainModule</code> åˆ›å»ºæ³¨å…¥å™¨ï¼ŒæˆåŠŸä¹‹åå†å¯¹å½“å‰çš„ <code>MainVerticle</code> æ‰§è¡Œ <a href="https://github.com/google/guice/wiki/Injections" title="Google Guice injectMembers">On-demand Injection</a>ã€‚æ­¤è¡Œä»£ç æ‰§è¡Œä¹‹åï¼Œç±»ä¸­æ‰€éœ€çš„ä¾èµ–å°±åº”è¯¥ä¼šæ³¨å…¥å®Œæ¯•ã€‚</p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæˆ‘å¯¹ Guice å’Œ Vert.x çš„ç»“åˆä½¿ç”¨éœ€è¦ä¿®æ”¹ä¸šåŠ¡ä»£ç ä»¥æ’å…¥æ³¨å…¥ä»£ç ï¼Œå’Œé¡¹ç›®è€¦åˆå¾ˆæ·±ï¼Œä¸èƒ½å¾ˆç®€å•åœ°åº”ç”¨åˆ°åˆ«çš„é¡¹ç›®ä¸­ã€‚ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œåœ¨ Vert.x çš„é¡¹ç›®ä¸­åµŒå…¥ Guiceï¼Œæœ€å¥½èƒ½ï¼š</p>
<ol>
<li>ä¸ä¾µå…¥æ­£å¸¸çš„ Verticle ä»£ç ï¼Œåœ¨æ­£å¸¸çš„ Verticle éƒ¨ç½²æµç¨‹ä¸­è‡ªåŠ¨åˆ›å»ºæ‰€éœ€çš„ä¾èµ–å¹¶å¯¹ç›®æ ‡ Verticle å®è¡Œä¾èµ–æ³¨å…¥</li>
<li>ä¾èµ–çš„æä¾›è€… ï¼ˆGuice <code>com.google.inject.Module</code>) éœ€è¦èƒ½æ¯”è¾ƒæ–¹ä¾¿çš„åˆ‡æ¢</li>
<li>ä¸èƒ½å½±å“ Vert.x çš„å¼‚æ­¥æµç¨‹ï¼Œä¸èƒ½æ‰“ç ´<a href="https://vertx.io/docs/vertx-core/java/#_don_t_block_me">é»„é‡‘æ³•åˆ™</a></li>
</ol>
<h1 id="vert-x-guice-extension"><a class="zola-anchor" href="#vert-x-guice-extension" aria-label="Anchor link for: vert-x-guice-extension">ğŸ”—</a>
Vert.x Guice Extension</h1>
<p><a href="https://github.com/ef-labs/vertx-guice" title="Google Guice">Vert.x Guice Extension</a> æ˜¯åŸºäº <code>io.vertx.core.spi.VerticleFactory</code> çš„æ‰©å±•ï¼Œèƒ½å¤Ÿæ— ç¼åœ°æ¥å…¥ Vert.x éƒ¨ç½² Verticle çš„è¿‡ç¨‹ä¸­ã€‚</p>
<h2 id="usecase"><a class="zola-anchor" href="#usecase" aria-label="Anchor link for: usecase">ğŸ”—</a>
UseCase</h2>
<p>ä½¿ç”¨äº† <a href="https://github.com/ef-labs/vertx-guice" title="Google Guice">Vert.x Guice Extension</a> çš„é¡¹ç›®ä¸­éœ€è¦æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#808080;">&lt;</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">  </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">com.englishtown.vertx</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">groupId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">  </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">vertx-guice</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">artifactId</span><span style="color:#808080;">&gt;
</span><span style="color:#dcdcdc;">  </span><span style="color:#808080;">&lt;</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;</span><span style="color:#dcdcdc;">2.3.1</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">version</span><span style="color:#808080;">&gt;
</span><span style="color:#808080;">&lt;/</span><span style="color:#569cd6;">dependency</span><span style="color:#808080;">&gt;
</span></pre>
<p>ç„¶åæ­£å¸¸å®ç°æ‰€éœ€è¦çš„ Verticleï¼Œä¸éœ€è¦æ·»åŠ  Guice ç›¸å…³ä»£ç ï¼ˆ@Inject ç­‰æ³¨è§£é™¤å¤–ï¼‰ã€‚</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">public class TheVerticle extends AbstractVerticle {
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">private static final Logger LOGGER = LoggerFactory.getLogger(TheVerticle.class);
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Inject
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Named(Constants.KEY_HTTP_LISTEN_HOST)
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">private String listenIp;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Inject
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Named(Constants.KEY_HTTP_LISTEN_PORT)
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">private Integer listenPort = 8001;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Inject
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@RegularRouter
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">private Set&lt;Controller&gt; regularControllers;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Inject
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">private Set&lt;Runnable&gt; warmUps;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Override
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">public void start(final Future&lt;Void&gt; future) throws Exception {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">// Not needed
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">// final Injector injector = Guice.createInjector(new TheModule(vertx, config()));
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">// injector.injectMembers(this);
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">final Router router = Router.router(vertx);
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">router.exceptionHandler(ex -&gt; LOGGER.warn(&quot;Uncaught exception&quot;, ex));
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">regularControllers.stream().sorted().forEach(c -&gt; {
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">LOGGER.debug(&quot;Registered regular Controller \&quot;{}\&quot;&quot;, c);
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">c.accept(router);
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">});
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">Completable.fromRunnable(() -&gt; warmUps.parallelStream().forEach(Runnable::run))
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">.subscribeOn(RxHelper.blockingScheduler(vertx))
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">.subscribe(
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">() -&gt; {
</span><span style="color:#dcdcdc;">                    </span><span style="color:#dcdcdc;">LOGGER.info(&quot;Warm up finished, try to start HTTP listening on {}:{} ...&quot;, listenIp, listenPort);
</span><span style="color:#dcdcdc;">                    </span><span style="color:#dcdcdc;">vertx.createHttpServer()
</span><span style="color:#dcdcdc;">                        </span><span style="color:#dcdcdc;">.requestHandler(router::accept)
</span><span style="color:#dcdcdc;">                        </span><span style="color:#dcdcdc;">.listen(listenPort, listenIp, e -&gt; {
</span><span style="color:#dcdcdc;">                            </span><span style="color:#dcdcdc;">if (e.succeeded()) {
</span><span style="color:#dcdcdc;">                                </span><span style="color:#dcdcdc;">future.complete();
</span><span style="color:#dcdcdc;">                            </span><span style="color:#dcdcdc;">} else {
</span><span style="color:#dcdcdc;">                                </span><span style="color:#dcdcdc;">future.fail(e.cause());
</span><span style="color:#dcdcdc;">                            </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">                        </span><span style="color:#dcdcdc;">});
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">},
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">ex -&gt; {
</span><span style="color:#dcdcdc;">                    </span><span style="color:#dcdcdc;">LOGGER.error(&quot;Warmup failed, disable HTTP listening&quot;, ex);
</span><span style="color:#dcdcdc;">                    </span><span style="color:#dcdcdc;">future.fail(ex);
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">);
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre>
<p>æä¾›æœåŠ¡ä¸­æ‰€éœ€çš„ä¾èµ–ï¼š</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#569cd6;">class </span><span style="color:#dcdcdc;">TheModule </span><span style="color:#569cd6;">extends </span><span style="color:#4ec9b0;">AbstractModule </span><span style="color:#dcdcdc;">{
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Override
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">protected void </span><span style="color:#dcdcdc;">configure() {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">install(</span><span style="color:#569cd6;">new </span><span style="color:#dcdcdc;">RestModule());
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">install(</span><span style="color:#569cd6;">new </span><span style="color:#dcdcdc;">AuthModule());
</span><span style="color:#dcdcdc;">        </span><span style="color:#608b4e;">// And more ...
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">bind(MyService.class).to(MyServiceImpl.class);
</span><span style="color:#dcdcdc;">        </span><span style="color:#608b4e;">// And more ...
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Provides
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Singleton
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">OtherService providesOtherService(</span><span style="color:#569cd6;">final </span><span style="color:#dcdcdc;">MyService s) {
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">return new </span><span style="color:#dcdcdc;">OtherServiceImpl(s);
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre>
<p>TheVerticle å’Œ TheModule çš„ç»“åˆä»£ç ç”± <a href="https://github.com/ef-labs/vertx-guice" title="Google Guice">Vert.x Guice Extension</a> æä¾›ï¼Œä½¿ç”¨è€…åªéœ€è¦ä¿®æ”¹ Verticle çš„éƒ¨ç½²ä»£ç ä¸ºï¼š</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">Vertx.vertx().deployVerticle(
</span><span style="color:#dcdcdc;">    </span><span style="color:#d69d85;">&quot;java-guice:&quot; </span><span style="color:#dcdcdc;">+ TheVerticle.class.getName(),
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">new </span><span style="color:#dcdcdc;">DeploymentOptions()
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">.setConfig(</span><span style="color:#569cd6;">new </span><span style="color:#dcdcdc;">JsonObject().put(</span><span style="color:#d69d85;">&quot;guice_binder&quot;</span><span style="color:#dcdcdc;">, TheModule.class.getName()))
</span><span style="color:#dcdcdc;">);
</span></pre>
<p>ä½œä¸ºå¯¹æ¯”ï¼Œä¹‹å‰çš„éƒ¨ç½²ä»£ç ä¸ºï¼š</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">Vertx.vertx().deployVerticle(TheVerticle.class.getName());
</span></pre>
<p>å˜åŒ–ä¹‹å¤„æœ‰ä¸¤ç‚¹ï¼š</p>
<ol>
<li>Verticle çš„åç§°ç”±åŸæ¥çš„ Verticle ç±»åå˜ä¸ºç±»ååŠ å‰ç¼€ &quot;java-guice:&quot;</li>
<li>éƒ¨ç½²æ—¶éœ€è¦é™„å¸¦ä¸Šä¸€ä¸ªæŒ‡å‘ Module çš„ä¾èµ–æä¾›è€…å®ç°çš„é…ç½®é¡¹ï¼Œé…ç½®é¡¹çš„é”®åä¸º &quot;guice_binder&quot;ï¼Œå€¼ä¸ºä¾èµ–æä¾›è€…çš„ç±»åï¼ˆå¦‚æœä¸æƒ³æ·»åŠ æ­¤é…ç½®é¡¹ï¼Œåˆ™éœ€è¦å°†ä¾èµ–æä¾›è€…çš„ç±»åè®¾ç½®ä¸ºå›ºå®šçš„ â€com.englishtown.vertx.guice.BootstrapBinder&quot;ï¼‰</li>
</ol>
<h2 id="verticlefactory"><a class="zola-anchor" href="#verticlefactory" aria-label="Anchor link for: verticlefactory">ğŸ”—</a>
VerticleFactory</h2>
<p><a href="https://github.com/ef-labs/vertx-guice" title="Google Guice">Vert.x Guice Extension</a> åŸºäºå‰ç¼€ &quot;java-guice:&quot; çš„åŠŸèƒ½æ‰©å±•ä¾èµ–äº Vert.x çš„ <code>io.vertx.core.spi.VerticleFactory</code> SPI æœºåˆ¶ã€‚</p>
<p>Vert.x æ˜¯æ ¹æ® Verticle çš„åç§°æ¥è¿›è¡Œéƒ¨ç½²çš„ã€‚ç”±äºéœ€è¦æ”¯æŒä¸åŒè¯­è¨€çš„ Verticle å®ç°ï¼ˆJava, JavaScript, Ruby ç­‰)ï¼ŒVert.x å¯¹äº Verticle çš„åˆ›å»ºæä¾›äº†æ‰©å±•ç‚¹ <code>io.vertx.core.spi.VerticleFactory</code>ã€‚Vert.x ç®¡ç†ä¸åŒç±»å‹çš„ VerticleFactory å®ç°ï¼Œä½¿ç”¨ç±» scheme çš„å‰ç¼€ï¼ˆprefixï¼‰è§„åˆ™åŒºåˆ† Verticle åç§°ï¼›ä¸åŒçš„ VerticleFactory å®ç°æ ¹æ® Verticle åç§°çš„å‰ç¼€æ¥ç¡®å®šæ˜¯å¦èƒ½åˆ›å»ºè¯¥ Verticleã€‚</p>
<p>ç›¸å…³å†…å®¹å¯å‚è§ <a href="https://vertx.io/docs/vertx-core/java/#_deploying_verticles_programmatically" title="Deploying verticles programmatically">Vert.x Vertivle Deployment</a>ã€‚</p>
<p>Vert.x å®˜æ–¹æ”¯æŒçš„ Verticle åç§°å‰ç¼€æœ‰ï¼š</p>
<ul>
<li>&quot;js:&quot; ç”¨äºåˆ›å»ºä½¿ç”¨ JavaScript ç¼–å†™çš„ Verticle</li>
<li>&quot;groovy:&quot; ç”¨äºåˆ›å»ºä½¿ç”¨ Groovy ç¼–å†™çš„ Verticle</li>
<li>&quot;service:&quot; ç”¨äºåˆ›å»º <a href="http://vertx.io/docs/vertx-service-factory/java/" title="Eclipse Vert.x Service Factory">Vert.x Service</a> æœåŠ¡</li>
<li>ç­‰</li>
</ul>
<p>å¦‚æœæä¾›çš„ Verticle åç§°æ²¡æœ‰å‰ç¼€ï¼ŒVert.x ä¼šæ ¹æ®åç¼€åæ¥ç¡®å®šå¯¹åº”çš„ VerticleFactoryï¼›å¦‚æœæ²¡æœ‰åç¼€åï¼Œåˆ™ä¼šé»˜è®¤ä½œä¸º Java å®ç°æ¥åˆ›å»ºã€‚</p>
<h2 id="guiceverticlefactory"><a class="zola-anchor" href="#guiceverticlefactory" aria-label="Anchor link for: guiceverticlefactory">ğŸ”—</a>
GuiceVerticleFactory</h2>
<p>åœ¨ <a href="https://github.com/ef-labs/vertx-guice" title="Google Guice">Vert.x Guice Extension</a> ä¸­ï¼Œæä¾›äº†ä¸€ä¸ª <code>io.vertx.core.spi.VerticleFactory</code> çš„å®ç°ç±» <code>com.englishtown.vertx.guice.GuiceVerticleFactory</code>ï¼Œæä¾›å¯¹äº &quot;java-guice:&quot; å‰ç¼€åç§°çš„åˆ›å»ºæ”¯æŒã€‚</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">GuiceVerticleFactory </span><span style="color:#569cd6;">implements </span><span style="color:#4ec9b0;">VerticleFactory </span><span style="color:#dcdcdc;">{
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public static final </span><span style="color:#dcdcdc;">String PREFIX = </span><span style="color:#d69d85;">&quot;java-guice&quot;</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Override
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public </span><span style="color:#dcdcdc;">String prefix() {
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">return </span><span style="color:#b4cea8;">PREFIX</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Override
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public </span><span style="color:#dcdcdc;">Verticle createVerticle(String verticleName, ClassLoader classLoader) </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">Exception {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">verticleName = VerticleFactory.removePrefix(verticleName);
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#608b4e;">// Use the provided class loader to create an instance of GuiceVerticleLoader.  This is necessary when working with vert.x IsolatingClassLoader
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">@SuppressWarnings(</span><span style="color:#d69d85;">&quot;unchecked&quot;</span><span style="color:#dcdcdc;">)
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">Class&lt;Verticle&gt; loader = (Class&lt;Verticle&gt;) classLoader.loadClass(GuiceVerticleLoader.class.getName());
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">Constructor&lt;Verticle&gt; ctor = loader.getConstructor(String.class, ClassLoader.class, Injector.class);
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">if </span><span style="color:#dcdcdc;">(ctor == </span><span style="color:#569cd6;">null</span><span style="color:#dcdcdc;">) {
</span><span style="color:#dcdcdc;">            </span><span style="color:#569cd6;">throw new </span><span style="color:#dcdcdc;">IllegalStateException(</span><span style="color:#d69d85;">&quot;Could not find GuiceVerticleLoader constructor&quot;</span><span style="color:#dcdcdc;">);
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">return</span><span style="color:#dcdcdc;"> ctor.newInstance(verticleName, classLoader, getInjector());
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre>
<p>åœ¨ GuiceVerticleFactory çš„ <code>createVerticle</code> å®ç°ä¸­ï¼Œä½¿ç”¨äº† <code>com.englishtown.vertx.guice.GuiceVertileLoader</code> ç±»ã€‚è¯¥ç±»æ˜¯ Verticle çš„ä¸€ä¸ªå®ç°ï¼Œç”¨æ¥è¾…åŠ©åˆ›å»ºç›®æ ‡ Verticle å¹¶ä»£ç†ç›®æ ‡ Verticle çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#569cd6;">public class </span><span style="color:#dcdcdc;">GuiceVerticleLoader </span><span style="color:#569cd6;">extends </span><span style="color:#4ec9b0;">AbstractVerticle </span><span style="color:#dcdcdc;">{
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public static final </span><span style="color:#dcdcdc;">String CONFIG_BOOTSTRAP_BINDER_NAME = </span><span style="color:#d69d85;">&quot;guice_binder&quot;</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public static final </span><span style="color:#dcdcdc;">String BOOTSTRAP_BINDER_NAME = </span><span style="color:#d69d85;">&quot;com.englishtown.vertx.guice.BootstrapBinder&quot;</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">Verticle realVerticle;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Override
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public void </span><span style="color:#dcdcdc;">init(Vertx vertx, Context context) {
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">super.init(vertx, context);
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#608b4e;">// Create the real verticle and init
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">realVerticle = createRealVerticle();
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">realVerticle.init(vertx, context);
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Override
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public void </span><span style="color:#dcdcdc;">start(Future&lt;Void&gt; startedResult) </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">Exception {
</span><span style="color:#dcdcdc;">        </span><span style="color:#608b4e;">// Start the real verticle
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">realVerticle.start(startedResult);
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">@Override
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">public void </span><span style="color:#dcdcdc;">stop(Future&lt;Void&gt; stopFuture) </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">Exception {
</span><span style="color:#dcdcdc;">        </span><span style="color:#608b4e;">// Stop the real verticle
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">if </span><span style="color:#dcdcdc;">(realVerticle != </span><span style="color:#569cd6;">null</span><span style="color:#dcdcdc;">) {
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">realVerticle.stop(stopFuture);
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">realVerticle = </span><span style="color:#569cd6;">null</span><span style="color:#dcdcdc;">;
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">    </span><span style="color:#569cd6;">private </span><span style="color:#dcdcdc;">Verticle createRealVerticle(Class&lt;</span><span style="color:#569cd6;">?</span><span style="color:#dcdcdc;">&gt; clazz) </span><span style="color:#569cd6;">throws </span><span style="color:#dcdcdc;">Exception {
</span><span style="color:#dcdcdc;">        </span><span style="color:#608b4e;">// i.e., &quot;guice_binder&quot;
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">Object field = config.getValue(</span><span style="color:#b4cea8;">CONFIG_BOOTSTRAP_BINDER_NAME</span><span style="color:#dcdcdc;">);
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">jsonArray bootstrapNames;
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">if </span><span style="color:#dcdcdc;">(field </span><span style="color:#569cd6;">instanceof </span><span style="color:#dcdcdc;">JsonArray) {
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">bootstrapNames = (JsonArray) field;
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">} </span><span style="color:#569cd6;">else </span><span style="color:#dcdcdc;">{
</span><span style="color:#dcdcdc;">            </span><span style="color:#608b4e;">// i.e., &quot;com.englishtown.vertx.guice.BootstrapBinder&quot;
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">bootstrapNames = </span><span style="color:#569cd6;">new </span><span style="color:#dcdcdc;">JsonArray().add((field == </span><span style="color:#569cd6;">null ? </span><span style="color:#b4cea8;">BOOTSTRAP_BINDER_NAME </span><span style="color:#569cd6;">:</span><span style="color:#dcdcdc;"> field));
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">List&lt;Module&gt; bootstraps = </span><span style="color:#569cd6;">new </span><span style="color:#dcdcdc;">ArrayList&lt;&gt;();
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">for </span><span style="color:#dcdcdc;">(</span><span style="color:#569cd6;">int</span><span style="color:#dcdcdc;"> i = </span><span style="color:#b5cea8;">0</span><span style="color:#dcdcdc;">; i &lt; bootstrapNames.size(); i</span><span style="color:#569cd6;">++</span><span style="color:#dcdcdc;">) {
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">String bootstrapName = bootstrapNames.getString(i);
</span><span style="color:#dcdcdc;">            </span><span style="color:#569cd6;">try </span><span style="color:#dcdcdc;">{
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">Class bootstrapClass = classLoader.loadClass(bootstrapName);
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">Object obj = bootstrapClass.newInstance();
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">                </span><span style="color:#569cd6;">if </span><span style="color:#dcdcdc;">(obj </span><span style="color:#569cd6;">instanceof </span><span style="color:#dcdcdc;">Module) {
</span><span style="color:#dcdcdc;">                    </span><span style="color:#dcdcdc;">bootstraps.add((Module) obj);
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">} </span><span style="color:#569cd6;">else </span><span style="color:#dcdcdc;">{
</span><span style="color:#dcdcdc;">                    </span><span style="color:#dcdcdc;">logger.error(</span><span style="color:#d69d85;">&quot;Class &quot; </span><span style="color:#dcdcdc;">+ bootstrapName
</span><span style="color:#dcdcdc;">                            </span><span style="color:#dcdcdc;">+ </span><span style="color:#d69d85;">&quot; does not implement Module.&quot;</span><span style="color:#dcdcdc;">);
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">} </span><span style="color:#569cd6;">catch </span><span style="color:#dcdcdc;">(ClassNotFoundException e) {
</span><span style="color:#dcdcdc;">                </span><span style="color:#569cd6;">if </span><span style="color:#dcdcdc;">(parent == </span><span style="color:#569cd6;">null</span><span style="color:#dcdcdc;">) {
</span><span style="color:#dcdcdc;">                    </span><span style="color:#dcdcdc;">logger.warn(</span><span style="color:#d69d85;">&quot;Guice bootstrap binder class &quot; </span><span style="color:#dcdcdc;">+ bootstrapName
</span><span style="color:#dcdcdc;">                            </span><span style="color:#dcdcdc;">+ </span><span style="color:#d69d85;">&quot; was not found.  Are you missing injection bindings?&quot;</span><span style="color:#dcdcdc;">);
</span><span style="color:#dcdcdc;">                </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">            </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">        </span><span style="color:#dcdcdc;">Injector injector = parent == </span><span style="color:#569cd6;">null ? </span><span style="color:#dcdcdc;">Guice.createInjector(bootstraps) </span><span style="color:#569cd6;">:</span><span style="color:#dcdcdc;"> parent.createChildInjector(bootstraps);
</span><span style="color:#dcdcdc;">        </span><span style="color:#569cd6;">return </span><span style="color:#dcdcdc;">(Verticle) injector.getInstance(clazz);
</span><span style="color:#dcdcdc;">    </span><span style="color:#dcdcdc;">}
</span><span style="color:#dcdcdc;">}
</span></pre>
<p>åœ¨ Verticle çš„åˆ›å»ºé€»è¾‘ä¸­ï¼Œä¼šé¦–å…ˆå°è¯•è·å–é”® &quot;guice_binder&quot; å¯¹åº”çš„é…ç½®é¡¹å€¼ï¼Œè¯¥é…ç½®é¡¹çš„å€¼å¯ä»¥æ˜¯å…¨ç±»åå­—ç¬¦ä¸²æˆ–è€…å…¨ç±»åå­—ç¬¦ä¸²æ•°ç»„ï¼›å¦‚æœä¸é…ç½®çš„è¯ï¼Œåˆ™ä¼šé»˜è®¤ä½¿ç”¨ &quot;com.englishtown.vertx.guice.BootstrapBinder&quot; ä½œä¸ºé…ç½®é¡¹çš„å€¼ã€‚ä¹‹åä½¿ç”¨è¯¥å€¼ä½¿ç”¨åå°„åˆ›å»ºç±»å®ä¾‹ï¼›å†ç„¶åä½¿ç”¨è¯¥å®ä¾‹åˆ›å»ºæ³¨å…¥å™¨ï¼›å†ç„¶åä»æ³¨å…¥å™¨ä¸­è¯·æ±‚ç›®æ ‡ç±»åçš„ Verticle æ³¨å…¥ç»“æœå®ä¾‹å¹¶è¿”å›ã€‚</p>
<p>æ‰€ä»¥åªéœ€è¦æŠŠæ‰€æœ‰çš„ä¾èµ–ä»¥åŠæŒ‡å®šåç§°çš„ Verticle å®ç°çš„æä¾›è€…ï¼ˆ<code>com.google.inject.Module</code> å®ç°ç±»ï¼‰çš„å…¨ç±»åä½œä¸ºå€¼ï¼Œä»¥ &quot;guice_binder&quot; ä¸ºé”®æ”¾å…¥åˆ°éƒ¨ç½²å‚æ•°é…ç½®é‡Œé¢ï¼Œå°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ³¨å…¥å™¨äº†ã€‚æˆ–è€…ï¼Œåœ¨ä¸æä¾›è¯¥é”®å€¼å¯¹çš„æƒ…å†µä¸‹ï¼Œå°†ä¾èµ–æä¾›è€…å®ç°å‘½åä¸º &quot;com.englishtown.vertx.guice.BootstrapBinder&quot; ä¹Ÿå¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœã€‚</p>
<h1 id="zong-jie"><a class="zola-anchor" href="#zong-jie" aria-label="Anchor link for: zong-jie">ğŸ”—</a>
æ€»ç»“</h1>
<p><a href="https://github.com/ef-labs/vertx-guice" title="Google Guice">Vert.x Guice Extension</a> çš„å®ç°å……åˆ†åˆ©ç”¨äº† Vert.x çš„æ‰©å±•æœºåˆ¶ï¼Œè§£è€¦åˆäº† Verticle çš„å®ç°å’Œä¾èµ–æ³¨å…¥ï¼Œæ€è·¯éå¸¸æ¼‚äº®ã€‚å¯¹äºåŠŸèƒ½çš„æ·»åŠ åˆå¾ˆå…‹åˆ¶ï¼Œæ²¡æœ‰å°è¯•å»å®ç°å…¶ä»–æ²¡æœ‰å¿…è¦çš„ auto-wiredã€package scanning ç­‰åŠŸèƒ½ï¼ˆå¦‚æœéœ€è¦è¿™äº›åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ <a href="https://spring.io">Spring Framework</a> å‘¢ï¼Ÿï¼‰ã€‚</p>
<p>ä»¥ä¸Š</p>

        </div>
        
    
</div></div>
            
    <div class="pagination">
        <div class="pagination__buttons">
            </div>
    </div>
<footer class="footer">
                    <div class="footer__inner"><div class="copyright copyright--user"><span>Â© 2019 <a href="https://www.wangbo.im">wangbo&apos; blog</a> :: <a href="https://github.wangbo.im">Github</a> :: Powered by <a href="https://www.getzola.org/">Zola</a></span></div>
    <script type="text/javascript" src="https:&#x2F;&#x2F;www.wangbo.im&#x2F;assets&#x2F;js&#x2F;main.js"></script>
</div>
                    

                </footer></div>
    </body>
</html>
