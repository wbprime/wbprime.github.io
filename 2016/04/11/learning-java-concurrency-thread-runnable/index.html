<!DOCTYPE html>
<html lang="zh">
    <head>
    <!-- 
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.0 -->

    <!-- Title -->
    
    <title>
        
            Learning Java Concurrency - Thread &amp; Runnable | 
        
        wbprime
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/images/favicon.png">
    <link rel="icon" sizes="192x192" href="/images/favicon.png">
    <link rel="apple-touch-icon" href="/images/favicon.png">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Elvis Wang">
    <meta name="description" content="Why bloging ?">
    <meta name="keywords" content="wbprime,Java,Concurrency">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="wbprime">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://www.wbprime.me">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Learning Java Concurrency - Thread &amp; Runnable | wbprime">
    <meta property="og:description" content="Why bloging ?">
    <meta property="og:article:tag" content="Java"> <meta property="og:article:tag" content="Concurrency"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }
</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>



    <script src="/js/jquery.min.js"></script>
    <script src="/js/queue.js"></script>

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    

    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Thread"><span class="post-toc-number">1.</span> <span class="post-toc-text">Thread</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#API-列表"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">API 列表</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建线程类对象"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">创建线程类对象</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#启动线程"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">启动线程</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#线程的生命周期"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">线程的生命周期</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#自定义线程行为"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">自定义线程行为</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#线程等待"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">线程等待</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#后台线程"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">后台线程</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#异常处理"><span class="post-toc-number">1.8.</span> <span class="post-toc-text">异常处理</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ThreadGroup"><span class="post-toc-number">2.</span> <span class="post-toc-text">ThreadGroup</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Runnable"><span class="post-toc-number">3.</span> <span class="post-toc-text">Runnable</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#代码下载"><span class="post-toc-number">4.</span> <span class="post-toc-text">代码下载</span></a></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').css('background-image', 'url(' + '/img/random/material-' + randomNum + '.png' + ')');
</script>

        
    
            <p class="article-headline-p">
                Learning Java Concurrency - Thread & Runnable
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/images/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Elvis Wang</strong>
        <span>4月 11, 2016</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
            <i class="material-icons" role="presentation">devices other</i>
            <span class="visuallyhidden">devices other</span>
        </button>
        <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
            <li class="mdl-menu__item">在其它设备中阅读本文章</li>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAADkUlEQVR42u3aS27jMBAFQN//0pltgJlR3usmDQcorgJHpsTyotWf15f1bb0Q4MCBAwcOHDhw4MDxwRyveP1jo8drvn+S7Py/65PdNmfBgQMHDhw3OH4IRY/XPGPl1zwfqb1j/rQ4cODAgeMeRxsCn8PwLJy3e27OggMHDhw4PpMjT9KSAPycyLWhHQcOHDhw/BaOWUKVULZhdfaz4cCBAweO93Akj7JJ52ZlxM1/r9dKceDAgQPHeqDh8/9+63wHDhw4cOD4i6NdSVLUNp9OjU0MT4QDBw4cOI5yzFpHeaNoM37dtqCGz48DBw4cOI5y5A+Ul+qeHyKBmN2rJcaBAwcOHDc48kA4Y8q/lbPO7lW8d+DAgQMHjqMcSWDLr2lTvrzwNwvqdaDFgQMHDhwlR94uyts8bWBO0G+khThw4MCB4wbHbMggT/AODBzE4fb5W6viIA4cOHDgGOUs9fhyOaywL0rOfpKiOIgDBw4cOA71WfJ0KC8F5sFvs/+muIkDBw4cOG5wzI7Rft42kDZhuC4s4sCBAweOCxz51sWgwCIl25DVRUMcOHDgwHGUIw9ReZCbjR3kEHloj8qUOHDgwIHjKMcscOatqc34wuYuB947cODAgQPHgmOTjOW7zfbJ4WZX4sCBAweOsxz74bZZurUZdzjVoMKBAwcOHPc4ZsW7tiQ3a0HlydssmcSBAwcOHGc56oRnVDTMA/Zs0GGW2uHAgQMHjnscswGFNvTmA3kzyryFhgMHDhw47nFsglxb7Ms/nyV1eYkQBw4cOHDc40geq0U5VcjbBOniZ8CBAwcOHBc4ooAUNJnycl7O0Q40JA0wHDhw4MBxj2PTWJodOB+DaMNqm9ThwIEDB47bHG0K1AbLPEi3IXPzEoADBw4cOG5ztC2ceoAgThc3qd1XvHDgwIEDx/s58oGDNmErSniL0YoD8x04cODAgeMoR4IyC43toEOOWzwbDhw4cOA4ytGus2lbHshb3IQJBw4cOHDc4HjFaz8G0bad8mtWLwE4cODAgeMCRxJc2yGGpIk1G4mblQKHk4M4cODAgWPBsUmuZkE6aXQlO8xaWThw4MCB43M4NseYHWAzPPfDawQOHDhw4PgAjk0qld8rP2oS4HHgwIEDx/s5kuJg/sms1JgffpYQ4sCBAweO93C0yVUb0vJrkvu2IxR1cRAHDhw4cCw4LBw4cODAgQMHDhw4cHzY+gMcp+0GWYef4gAAAABJRU5ErkJggg==">
        </ul>
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/concurrency/">Concurrency</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/java/">Java</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Learning Java Concurrency - Thread &amp; Runnable&url=http://www.wbprime.me//2016/04/11/learning-java-concurrency-thread-runnable/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Learning Java Concurrency - Thread &amp; Runnable&url=http://www.wbprime.me//2016/04/11/learning-java-concurrency-thread-runnable/index.html&via=Elvis Wang" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://www.wbprime.me//2016/04/11/learning-java-concurrency-thread-runnable/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://www.wbprime.me//2016/04/11/learning-java-concurrency-thread-runnable/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>Java并发多线程的第一课，应该就是<code>Thread</code>了。顾名思义，<code>Thread</code>就是一个线程。线程是很底层的一个概念，在不同的操作系统上实现的模型和细节并不相同，甚至于可以说天差地别；但是总体来说，线程是比进程更细粒度的操作系统调度的单位，线程有自己的运行栈，但是同一个进程的线程共享方法区和堆区数据。</p>
<p>对于进程和线程的差别，有一种说法是：线程是操作系统调度的基本单位，而进程是操作系统分配运行资源的基本单位。</p>
<p>Java中对线程作了很好的封装：<code>Thread</code>类。<code>Thread</code>类的使用非常简单。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadCase</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String word;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">EchoThread</span><span class="params">(<span class="keyword">final</span> String word)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.word = word;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</div><div class="line">                System.out.println(<span class="keyword">this</span>.getName() + <span class="string">" echos "</span> + word);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] _args)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> Thread echo1 = <span class="keyword">new</span> EchoThread(<span class="string">"First"</span>);</div><div class="line">        <span class="keyword">final</span> Thread echo2 = <span class="keyword">new</span> EchoThread(<span class="string">"Second"</span>);</div><div class="line"></div><div class="line">        System.out.println(<span class="string">"Main thread started!"</span>);</div><div class="line"></div><div class="line">        echo1.start();</div><div class="line">        echo2.start();</div><div class="line"></div><div class="line">        joinThread(echo1);</div><div class="line">        joinThread(echo2);</div><div class="line"></div><div class="line">        System.out.println(<span class="string">"Main thread finished!"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">joinThread</span><span class="params">(<span class="keyword">final</span> Thread th)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            th.join();</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            System.out.println(th.getName() + <span class="string">" interrupted!"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以很明显地发现：</p>
<ul>
<li>main负责启动其他线程，main本身也是一个线程</li>
<li>线程的调度是难以预料的，<code>echo1</code>和<code>echo2</code>的输出结果相互交错可以看出这一点</li>
<li>线程之间可以进行同步控制，使用<code>Thread.join()</code>方法可以强制等待另一个线程结束</li>
<li>自定义线程行为只需要重新实现<code>Thread.run()</code>方法即可</li>
<li>线程的启动入口是<code>Thread.start()</code>方法，不要直接运行<code>Thread.run()</code>方法</li>
<li><code>Thread</code>类是一个<code>class</code>（与<code>interface</code>相对应），意味着自定义线程类不能继承别的父类</li>
</ul>
<a id="more"></a>
<h1 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h1><h2 id="API-列表"><a href="#API-列表" class="headerlink" title="API 列表"></a>API 列表</h2><ol>
<li>Thread()</li>
<li>Thread(Runnable target)</li>
<li>Thread(Runnable target, AccessControlContext acc)</li>
<li>Thread(ThreadGroup group, Runnable target) </li>
<li>Thread(String name)</li>
<li>Thread(ThreadGroup group, String name)</li>
<li>Thread(Runnable target, String name)</li>
<li>Thread(ThreadGroup group, Runnable target, String name) </li>
<li>Thread(ThreadGroup group, Runnable target, String name, long stackSize)</li>
<li>void start()</li>
<li>void interrupt() </li>
<li>boolean isInterrupted() </li>
<li>boolean isAlive()</li>
<li>State getState()</li>
<li>void run()</li>
<li>void join(long millis)</li>
<li>void join(long millis, int nanos)</li>
<li>void join() throws InterruptedException</li>
<li>static native void sleep(long millis) throws InterruptedException</li>
<li>static void sleep(long millis, int nanos)</li>
<li>void setDaemon(boolean on) </li>
<li>boolean isDaemon()</li>
<li>static UncaughtExceptionHandler getDefaultUncaughtExceptionHandler()</li>
<li>static void setDefaultUncaughtExceptionHandler(UncaughtExceptionHandler eh)</li>
<li>UncaughtExceptionHandler getUncaughtExceptionHandler()</li>
<li>void setUncaughtExceptionHandler(UncaughtExceptionHandler eh)</li>
<li>static native Thread currentThread()</li>
</ol>
<h2 id="创建线程类对象"><a href="#创建线程类对象" class="headerlink" title="创建线程类对象"></a>创建线程类对象</h2><p><code>Thread</code>类一共有9个公开的构造函数，咋一看很杂乱无章的，但是其实是有规律的。</p>
<p>考虑以下事实：</p>
<ul>
<li>每个线程应该有一个名字，用来标识自己</li>
<li>每个线程可以有自己的行为，应该有一个用于自定义行为的类<code>Runnable</code></li>
<li>线程应该可以分组，属于某个特定的<code>ThreadGroup</code>实例</li>
<li>线程应该有权限控制，用<code>AccessControlContext</code>来设置</li>
<li>每个线程有自己的栈，应该可以自定义栈的大小</li>
</ul>
<p>这些线程相关的属性相互组合，并添加一些默认值，能够得到的构造函数绝对不止9个，哈！</p>
<p>实际上，以上所有的构造函数都是调用了内部私有的<code>init()</code>方法。</p>
<p>注意：<code>Thread</code>类是一个普通的Java类，所以构造器创建的对象引用是分配在当前的线程。该实例对应的线程还没有被创建。</p>
<h2 id="启动线程"><a href="#启动线程" class="headerlink" title="启动线程"></a>启动线程</h2><p>构造了一个线程对象之后，就可以启动该线程对象代表的线程开始执行任务。</p>
<p><code>run()</code>方法里面是需要执行的任务。想要在该线程对象代表的线程中运行该任务，需要调用<code>start()</code>方法。</p>
<p>需要再次澄清一下，<code>Thread</code>对象是存在于创建它的线程中，调用<code>start()</code>方法会启动一个新的线程来运行<code>run()</code>里面的代码。如果直接调用<code>run()</code>方法，只是让当前线程去执行该任务，达不到预期的效果。</p>
<p>由于线程的运行需要操作系统进行调度，所以执行<code>start()</code>方法之后，什么时候执行线程是不可预期的。如果对线程运行的先后顺序有要求，请主动对线程进行同步控制。</p>
<h2 id="线程的生命周期"><a href="#线程的生命周期" class="headerlink" title="线程的生命周期"></a>线程的生命周期</h2><p>当前线程创建了<code>Thread</code>对象，实际的线程还没有被创建，线程对象处于<code>NEW</code>状态。</p>
<p>根据<code>Thread</code>的api说明，一个<code>Thread</code>对象会有6种状态，同一时间该对象只可能处于一种状态。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> State &#123;</div><div class="line">    NEW,			<span class="comment">// 新建状态</span></div><div class="line">    RUNNABLE, 		<span class="comment">// 运行状态</span></div><div class="line">    BLOCKED,		<span class="comment">// 阻塞状态</span></div><div class="line">    WAITING,		<span class="comment">// 无条件的等待状态</span></div><div class="line">    TIMED_WAITING, 	<span class="comment">// 有条件的等待状态</span></div><div class="line">    TERMINATED; 	<span class="comment">// 终止状态</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>新建状态表明线程对象还未运行；运行状态表明线程对象正在运行一个线程；阻塞状态表明本线程对象在等待一个锁或同步器；无条件等待状态表明本线程对象在无限期地等待一个条件，比如调用了无过期时间的<code>Object.wait()</code>、<code>Thread.join()</code>等方法；有条件等待状态表明本线程对象在有条件地等待一个条件，是无条件等待状态的过期时间版本（timeout）；终止状态表明本线程对象代表的线程已经结束运行。</p>
<h2 id="自定义线程行为"><a href="#自定义线程行为" class="headerlink" title="自定义线程行为"></a>自定义线程行为</h2><p>前面已经说到，线程执行的任务在<code>run()</code>方法里面。所以，自定义线程就需要自定义该方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (target != <span class="keyword">null</span>) &#123;</div><div class="line">        target.run();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>run()</code>方法的默认实现是去执行构造器里面提供的<code>Runnable</code>对象的<code>run()</code>方法。</p>
<p>所以，有两种方法可以自定义线程。</p>
<ul>
<li>继承<code>Thread</code>类，覆盖<code>run()</code>方法</li>
<li>创建一个<code>Runnable</code>对象并用之构造一个<code>Thread</code>对象</li>
</ul>
<p>这两种方式没有本质上的区别，选择哪一种需要看具体的场合。</p>
<p>值得一提的是，<code>Thread</code>类实现了<code>Runnable</code>接口。</p>
<h2 id="线程等待"><a href="#线程等待" class="headerlink" title="线程等待"></a>线程等待</h2><p>线程的操作系统调度是不可预期的，所以在需要显式地控制线程运行的场合，需要使用额外的方法来达到目的。</p>
<p>比较高级的工具有<code>ReentrantLock</code>、<code>CountDownLatch</code>和<code>Semaphore</code>等，最简单的方法是调用<code>Thread.join()</code>方法。</p>
<p>假如有一个线程对象A，它创建了一个新的线程对象B，然后调用<code>B.start()</code>启动B线程。这时候A线程可以紧接着调用<code>B.join()</code>进入等待状态，知道B线程执行完毕才开始执行A线程。</p>
<p><code>join()</code>方法有多个变体，区别在于是否提供超时时间。如果对线程对象的生命周期还有映像的话，提供了超时时间的<code>join()</code>方法会导致当前线程进入有条件等待状态，反之进入无条件等待状态。</p>
<h2 id="后台线程"><a href="#后台线程" class="headerlink" title="后台线程"></a>后台线程</h2><p>正常情况下，JVM会等待所有的线程都运行结束之后才会退出。通过设置线程为后台线程可以使得JVM不用等待。</p>
<p>当所有运行的线程都是后台线程时，JVM会结束运行。</p>
<p><code>setDaemon()</code>方法用来设置线程为后台线程，<code>isDaemon()</code>方法可以用来检测是否为后台线程。</p>
<p>需要注意的是，<code>setDaemon()</code>方法需要在<code>start()</code>方法被调用之前调用才能生效。</p>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>线程执行<code>run()</code>方法的过程中，有可能会遇到未捕获的异常。Java规范规定，JVM在执行线程过程中遇到了未捕获的异常，会主动去寻找该线程对象的未捕获异常处理器，如果没找到就去该线程对象的<code>ThreadGroup</code>对象里找，如果还是没有找到就去找<code>Thread</code>类的静态的未捕获异常处理器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UncaughtExceptionHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">uncaughtException</span><span class="params">(Thread t, Throwable e)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> UncaughtExceptionHandler uncaughtExceptionHandler;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> UncaughtExceptionHandler defaultUncaughtExceptionHandler;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setDefaultUncaughtExceptionHandler</span><span class="params">(UncaughtExceptionHandler eh)</span> </span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UncaughtExceptionHandler <span class="title">getDefaultUncaughtExceptionHandler</span><span class="params">()</span></span></div><div class="line"></div><div class="line"><span class="keyword">public</span> UncaughtExceptionHandler <span class="title">getUncaughtExceptionHandler</span><span class="params">()</span>;</div></pre></td></tr></table></figure>
<p>可以通过上面的方法自定义未捕获异常的处理行为。</p>
<h1 id="ThreadGroup"><a href="#ThreadGroup" class="headerlink" title="ThreadGroup"></a>ThreadGroup</h1><p>顾名思义，<code>ThreadGroup</code>类表征了一个线程组。</p>
<p>可以在创建线程对象的时候指定所属的线程组。可以通过线程组对象控制组内的线程。</p>
<p><code>ThreadGroup</code>类比较有用的方法如下：</p>
<ul>
<li>void setDaemon(boolean daemon)</li>
<li>boolean isDaemon()</li>
<li>void setMaxPriority(int pri)</li>
<li>int getMaxPriority() </li>
<li>void interrupt()</li>
<li>void uncaughtException(Thread t, Throwable e) </li>
</ul>
<p>各个方法的含义不言自明，比较有意思的是<code>uncaughtException(Thread, Throwable)</code>方法。如果还记得线程对象的异常处理流程的话，就能明白为什么线程对象本身没有设置未捕获异常处理器时，会到所属的线程组对象里找。</p>
<p>因为<code>ThreadGroup</code>类实现了<code>Thread.UncaughtExceptionHandler</code>接口。<code>ThreadGroup</code>类的<code>uncaughtException(Thread, Throwable)</code>方法实现中，首先委托父线程组对象处理未捕获异常，如果没有父线程组，则跳到<code>Thread</code>类的静态的默认未捕获异常处理器进行处理。</p>
<h1 id="Runnable"><a href="#Runnable" class="headerlink" title="Runnable"></a>Runnable</h1><p><code>Runnable</code>接口很简单。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实际使用中使用<code>Runnable</code>的方式经常是使用匿名内部类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RunnableCase</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] _args)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> Thread echo1 =  <span class="keyword">new</span> Thread(</div><div class="line">            <span class="keyword">new</span> Runnable() &#123;</div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</div><div class="line">                        System.out.println(Thread.currentThread().getName() + <span class="string">" echos first"</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        );</div><div class="line"></div><div class="line">        <span class="keyword">final</span> Thread echo2 =  <span class="keyword">new</span> Thread(</div><div class="line">            <span class="keyword">new</span> Runnable() &#123;</div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</div><div class="line">                        System.out.println(Thread.currentThread().getName() + <span class="string">" echos second"</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        );</div><div class="line"></div><div class="line">        System.out.println(<span class="string">"Main thread started!"</span>);</div><div class="line"></div><div class="line">        echo1.start();</div><div class="line">        echo2.start();</div><div class="line"></div><div class="line">        joinThread(echo1);</div><div class="line">        joinThread(echo2);</div><div class="line"></div><div class="line">        System.out.println(<span class="string">"Main thread finished!"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">joinThread</span><span class="params">(<span class="keyword">final</span> Thread th)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            th.join();</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            System.out.println(th.getName() + <span class="string">" interrupted!"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="代码下载"><a href="#代码下载" class="headerlink" title="代码下载"></a>代码下载</h1><p><a href="RunnableCase.java">RunnableCase.java</a><br><a href="ThreadCase.java">ThreadCase.java</a></p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    




                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2016/04/13/learning-java-concurrency-futuretask-callable/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/04/09/spring-mvc-testing-integration-testing-jsonpath/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/images/avatar.png" alt="Elvis Wang's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        mail@wbprime.me
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">17</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">六月 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">五月 2015<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/05/">五月 2014<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/05/">五月 2013<span class="sidebar_archives-count">18</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/c-c/">C/C++<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/learning-java-concurrency/">Learning Java Concurrency<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/categories/life/">Life<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/categories/mayday/">Mayday<span class="sidebar_archives-count">19</span></a></li><li><a class="sidebar_archives-link" href="/categories/spring-di/">Spring DI<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/spring-mvc-testing/">Spring MVC Testing<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/categories/tech/">Tech<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">59</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/wbprime" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;wbprime
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->
<script src="/js/lazyload.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- Swiftye -->


<!-- Local Search-->

    <script>
    var searchFunc = function(path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: 'xml',
            success: function( xmlResponse ) {
                // get the contents from search data
                var datas = $( 'entry', xmlResponse ).map(function() {
                    return {
                        title: $( 'title', this ).text(),
                        content: $('content',this).text(),
                        url: $( 'url' , this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function() {
                    var str='<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = '';
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function(data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g,'').toLowerCase();
                        var data_url = data.url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if(data_title !== '' && data_content !== '') {
                            keywords.forEach(function(keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if( index_title < 0 && index_content < 0 ) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += '<li><a href="'+ data_url +'" class="search-result-title" target="_blank">'+ data_title;
                            var content = data.content.trim().replace(/<[^>]+>/g, '');
                            if (first_occur >= 0) {
                                // cut out characters
                                var start = first_occur - 6;
                                var end = first_occur + 6;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 10;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, 'gi');
                                    match_content = match_content.replace(regS, '<em class="search-keyword">'+keyword+'</em>');
                                })
                                str += '<p class="search-result">' + match_content + '...</p>' +'</a>';
                            }
                        }
                    });
                    $resultContent.innerHTML = str;
                });
            }
        });
    }
</script>


    <script>
        var inputArea = document.querySelector('#search');
        var getSearchFile = function() {
            var path = 'search.xml';
            searchFunc(path, 'search', 'local-search-result');
        }

        if(inputArea) {
            inputArea.onfocus = function() {
                getSearchFile();
            }
        }
    </script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
