<!DOCTYPE html>
<html lang="zh">
    <head>
    <!-- 
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.0 -->

    <!-- Title -->
    
    <title>
        
            Spring MVC Integration Testing - Forms | 
        
        wbprime
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Elvis Wang">
    <meta name="description" content="Why bloging ?">
    <meta name="keywords" content="wbprime,Java,Spring MVC,Test">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="wbprime">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://www.wbprime.me">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Spring MVC Integration Testing - Forms | wbprime">
    <meta property="og:description" content="Why bloging ?">
    <meta property="og:article:tag" content="Java"> <meta property="og:article:tag" content="Spring MVC"> <meta property="og:article:tag" content="Test"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }
</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>



    <script src="/js/jquery.min.js"></script>
    <script src="/js/queue.js"></script>

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    

    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#通过Maven获取依赖"><span class="post-toc-number">1.</span> <span class="post-toc-text">通过Maven获取依赖</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#示例web应用结构"><span class="post-toc-number">2.</span> <span class="post-toc-text">示例web应用结构</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#DTO"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">DTO</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Service-层"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">Service 层</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Controller-层"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">Controller 层</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#添加测试用例"><span class="post-toc-number">3.</span> <span class="post-toc-text">添加测试用例</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#GET-添加Todo项表单页面接口"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">GET 添加Todo项表单页面接口</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#POST-添加Todo项表单处理接口"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">POST 添加Todo项表单处理接口</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#提交空表单"><span class="post-toc-number">3.2.1.</span> <span class="post-toc-text">提交空表单</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#表单验证失败"><span class="post-toc-number">3.2.2.</span> <span class="post-toc-text">表单验证失败</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#表单被正确处理"><span class="post-toc-number">3.2.3.</span> <span class="post-toc-text">表单被正确处理</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#GET-修改Todo项表单页面接口"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">GET 修改Todo项表单页面接口</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#指定Todo项被找到"><span class="post-toc-number">3.3.1.</span> <span class="post-toc-text">指定Todo项被找到</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#指定Todo项未找到"><span class="post-toc-number">3.3.2.</span> <span class="post-toc-text">指定Todo项未找到</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#POST-修改Todo项表单处理接口"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">POST 修改Todo项表单处理接口</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#提交空表单-1"><span class="post-toc-number">3.4.1.</span> <span class="post-toc-text">提交空表单</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#表单验证失败-1"><span class="post-toc-number">3.4.2.</span> <span class="post-toc-text">表单验证失败</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#表单被正确处理-1"><span class="post-toc-number">3.4.3.</span> <span class="post-toc-text">表单被正确处理</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#指定Todo项未找到-1"><span class="post-toc-number">3.4.4.</span> <span class="post-toc-text">指定Todo项未找到</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#总结"><span class="post-toc-number">4.</span> <span class="post-toc-text">总结</span></a></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').css('background-image', 'url(' + '/img/random/material-' + randomNum + '.png' + ')');
</script>

        
    
            <p class="article-headline-p">
                Spring MVC Integration Testing - Forms
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/logo.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Elvis Wang</strong>
        <span>4月 09, 2016</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
            <i class="material-icons" role="presentation">devices other</i>
            <span class="visuallyhidden">devices other</span>
        </button>
        <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
            <li class="mdl-menu__item">在其它设备中阅读本文章</li>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAADjElEQVR42u3aS27cMBAFQN//0snWgDHye92UIgTFlWFrKLJm0e7P1x/r2/pCgAMHDhw4cODAgQPHizm+4vXpU99/kzzz88nrHZJzru6CAwcOHDhu4PglFF0+c/2y6+vt98/3+YiOAwcOHDhu47gOYNevTI6yfzIJtPldcODAgQPHmzmSC7fXS3bDgQMHDhz/N0eSzuXX3lwVBw4cOHC8gaMt6m0Kefn+s+LjQ7VSHDhw4MDxgSMfAnj/z4/Od+DAgQMHjh8c7UqC4nXxLg+c1ynfqYUDBw4cOM5ytIPOSeltNjzd7rw5Pw4cOHDguI8jucYmrOahOifLE7aoZIkDBw4cOG7jyIPl/jJJejYL5AcyWhw4cODAcag42I4gnAq0yZNJiE1OiAMHDhw47ubYN35OBdS8+Ng2xoa1Uhw4cODAMeLYXztPw06lhfsvBgcOHDhwPMPRJj/tYMEsUdyklKviIA4cOHDgWHPMxhfyBCz/6yzM5wMQOHDgwIHjGY7Z69sWVJu2tcG7HvjDgQMHDhxHOfJRs1mD6tio9PorwYEDBw4cT3LMCnyzkbVZs+pUClfMd+DAgQMHjhFHWxxMEqT2s23Kl6egdaDFgQMHDhxrjvageYK3GWjLcdvkEwcOHDhwPMnRJkJ5Gpa3lGahdFUuxIEDBw4cN3CcKs/loXfTZGqLjL+w4sCBAweOoxzt+EJ+uDy5eiZFrNtOOHDgwIFjxJGHugSlHYDIk7HrtDAP0nWtFAcOHDhwjDiKsLQYrZu9MSFr0XHgwIEDx30c+0bOLDGbXT7/J6BoX+HAgQMHjhs42vZSXgTcFxDvSCNx4MCBA8d9HJtiXJuAXe95NswXxUQcOHDgwHEDx2xQIBlrSJK6vOm1b1DhwIEDB45/xdGGvbZst8HNw2pdHMSBAwcOHEc5ZgW7HCgvSs7aVzhw4MCB450c7WtmQbcN7afSuSKFw4EDBw4cI452JQfK20ttQG1LmcP5Dhw4cODAse6znBqD2/9+VlKcjTLgwIEDB477OGbBdXaIdqxh81UdGGjAgQMHDhwLjrwk115g9vy+sBjtgAMHDhw4XsMxS8zy5lA7TteeEAcOHDhwvIejHYNohyE2IxftwBwOHDhw4LiPIzlQm1zNCn+bUF3/Q4ADBw4cOG7gyFs7ycU2wa8dvMs/WwRaHDhw4MCx4LBw4MCBAwcOHDhw4MDxsvUXvOvOFye0QHsAAAAASUVORK5CYII=">
        </ul>
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/java/">Java</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/spring-mvc/">Spring MVC</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/test/">Test</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Spring MVC Integration Testing - Forms&url=http://www.wbprime.me//2016/04/09/spring-mvc-testing-integration-testing-forms/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Spring MVC Integration Testing - Forms&url=http://www.wbprime.me//2016/04/09/spring-mvc-testing-integration-testing-forms/index.html&via=Elvis Wang" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://www.wbprime.me//2016/04/09/spring-mvc-testing-integration-testing-forms/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://www.wbprime.me//2016/04/09/spring-mvc-testing-integration-testing-forms/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>本文是 <a href="/2016/04/09/spring-mvc-testing-content/">Spring MVC Testing</a> 集成测试系列的第3篇，原文链接：<a href="http://www.petrikainulainen.net/programming/spring-framework/integration-testing-of-spring-mvc-applications-forms/" target="_blank" rel="external">Integration Testing of Spring MVC Applications: Forms</a>。</p>
<p>本文主要介绍为处理Form表单请求的接口编写集成测试用例。</p>
<p>本文紧接着上一篇 <a href="/2016/04/09/spring-mvc-testing-integration-testing-controllers/">Spring MVC Integration Testing - Controllers</a> 的内容，主要涉及到两个接口：创建新的Todo项和更新指定的Todo项。</p>
<a id="more"></a>
<h1 id="通过Maven获取依赖"><a href="#通过Maven获取依赖" class="headerlink" title="通过Maven获取依赖"></a>通过Maven获取依赖</h1><p>除了上一篇中介绍的依赖之外，本文添加了新的依赖：</p>
<ul>
<li>jackson-core-asl 1.9.9 </li>
<li>jackson-mapper-asl 1.9.9</li>
</ul>
<p>对应的pom.xml文件片段如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.jackson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core-asl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.jackson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-mapper-asl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="示例web应用结构"><a href="#示例web应用结构" class="headerlink" title="示例web应用结构"></a>示例web应用结构</h1><h2 id="DTO"><a href="#DTO" class="headerlink" title="DTO"></a>DTO</h2><p>本文主要处理Form表单，对应的类为<code>TodoDTO</code>。<code>TodoDTO</code>类是一个简单的Java Bean类，除了setter和getter方法外，还是用到了validator规则：</p>
<ul>
<li>title项不能为空</li>
<li>title项的最大长度为100</li>
<li>description项的最大长度为500</li>
</ul>
<p>对应的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.Length;</div><div class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.NotEmpty;</div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoDTO</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> Long id;</div><div class="line"> </div><div class="line">    <span class="meta">@Length</span>(max = <span class="number">500</span>)</div><div class="line">    <span class="keyword">private</span> String description;</div><div class="line"> </div><div class="line">    <span class="meta">@NotEmpty</span></div><div class="line">    <span class="meta">@Length</span>(max = <span class="number">100</span>)</div><div class="line">    <span class="keyword">private</span> String title;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TodoDTO</span><span class="params">()</span> </span>&#123;</div><div class="line"> </div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="comment">//Getters and setters</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Service-层"><a href="#Service-层" class="headerlink" title="Service 层"></a>Service 层</h2><p>对应地，<code>TodoService</code>接口也添加了两个方法：</p>
<ul>
<li><code>Todo add(TodoDTO added)</code> 创建并返回Todo项</li>
<li><code>Todo update(TodoDTO updated)</code> 更新指定的Todo项；如果指定的Todo项不存在，则抛出<code>TodoNotFoundException</code>异常</li>
</ul>
<p>新增代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TodoService</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> Todo <span class="title">add</span><span class="params">(TodoDTO added)</span></span>;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> Todo <span class="title">update</span><span class="params">(TodoDTO updated)</span> <span class="keyword">throws</span> TodoNotFoundException</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Controller-层"><a href="#Controller-层" class="headerlink" title="Controller 层"></a>Controller 层</h2><p>对应地，<code>TodoController</code>类也增加了4个接口方法：</p>
<ul>
<li><code>showAddTodoForm()</code> GET 返回添加Todo项的表单页面</li>
<li><code>add()</code> POST 处理添加Todo项的表单请求</li>
<li><code>showUpdateTodoForm()</code> GET 返回修改Todo项的表单页面</li>
<li><code>update()</code> POST 处理修改Todo项的表单请求</li>
</ul>
<p>对应的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.springframework.context.MessageSource;</div><div class="line"><span class="keyword">import</span> org.springframework.context.i18n.LocaleContextHolder;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</div><div class="line"><span class="keyword">import</span> org.springframework.ui.Model;</div><div class="line"><span class="keyword">import</span> org.springframework.validation.BindingResult;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</div><div class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.support.RedirectAttributes;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> javax.annotation.Resource;</div><div class="line"><span class="keyword">import</span> javax.validation.Valid;</div><div class="line"> </div><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="meta">@SessionAttributes</span>(<span class="string">"todo"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoController</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@Resource</span></div><div class="line">    <span class="keyword">private</span> TodoService service;</div><div class="line"> </div><div class="line">    <span class="meta">@Resource</span></div><div class="line">    <span class="keyword">private</span> MessageSource messageSource;</div><div class="line"> </div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/todo/add"</span>, method = RequestMethod.GET)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showAddTodoForm</span><span class="params">(Model model)</span> </span>&#123;</div><div class="line">        TodoDTO formObject = <span class="keyword">new</span> TodoDTO();</div><div class="line">        model.addAttribute(<span class="string">"todo"</span>, formObject);</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> <span class="string">"todo/add"</span>;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/todo/add"</span>, method = RequestMethod.POST)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">(@Valid @ModelAttribute(<span class="string">"todo"</span>)</span> TodoDTO dto, BindingResult result, RedirectAttributes attributes) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (result.hasErrors()) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"todo/add"</span>;</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        Todo added = service.add(dto);</div><div class="line"> </div><div class="line">        addFeedbackMessage(attributes, <span class="string">"feedback.message.todo.added"</span>, added.getTitle());</div><div class="line">        attributes.addAttribute(<span class="string">"id"</span>, added.getId());</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> createRedirectViewPath(<span class="string">"/todo/&#123;id&#125;"</span>);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/todo/update/&#123;id&#125;"</span>, method = RequestMethod.GET)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showUpdateTodoForm</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Long id, Model model) <span class="keyword">throws</span> TodoNotFoundException </span>&#123;</div><div class="line">        Todo updated = service.findById(id);</div><div class="line"> </div><div class="line">        TodoDTO formObject = constructFormObjectForUpdateForm(updated);</div><div class="line">        model.addAttribute(<span class="string">"todo"</span>, formObject);</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> <span class="string">"todo/update"</span>;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/todo/update"</span>, method = RequestMethod.POST)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(@Valid @ModelAttribute(<span class="string">"todo"</span>)</span> TodoDTO dto, BindingResult result, RedirectAttributes attributes) <span class="keyword">throws</span> TodoNotFoundException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (result.hasErrors()) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"todo/update"</span>;</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        Todo updated = service.update(dto);</div><div class="line"> </div><div class="line">        addFeedbackMessage(attributes, <span class="string">"feedback.message.todo.updated"</span>, updated.getTitle());</div><div class="line">        attributes.addAttribute(<span class="string">"id"</span>, updated.getId());</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> createRedirectViewPath(<span class="string">"/todo/&#123;id&#125;"</span>);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">private</span> TodoDTO <span class="title">constructFormObjectForUpdateForm</span><span class="params">(Todo updated)</span> </span>&#123;</div><div class="line">        TodoDTO dto = <span class="keyword">new</span> TodoDTO();</div><div class="line"> </div><div class="line">        dto.setId(updated.getId());</div><div class="line">        dto.setDescription(updated.getDescription());</div><div class="line">        dto.setTitle(updated.getTitle());</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> dto;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addFeedbackMessage</span><span class="params">(RedirectAttributes attributes, String messageCode, Object... messageParameters)</span> </span>&#123;</div><div class="line">        String localizedFeedbackMessage = getMessage(messageCode, messageParameters);</div><div class="line">        attributes.addFlashAttribute(<span class="string">"feedbackMessage"</span>, localizedFeedbackMessage);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getMessage</span><span class="params">(String messageCode, Object... messageParameters)</span> </span>&#123;</div><div class="line">        Locale current = LocaleContextHolder.getLocale();</div><div class="line">        <span class="keyword">return</span> messageSource.getMessage(messageCode, messageParameters, current);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">createRedirectViewPath</span><span class="params">(String requestMapping)</span> </span>&#123;</div><div class="line">        StringBuilder redirectViewPath = <span class="keyword">new</span> StringBuilder();</div><div class="line">        redirectViewPath.append(<span class="string">"redirect:"</span>);</div><div class="line">        redirectViewPath.append(requestMapping);</div><div class="line">        <span class="keyword">return</span> redirectViewPath.toString();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="添加测试用例"><a href="#添加测试用例" class="headerlink" title="添加测试用例"></a>添加测试用例</h1><h2 id="GET-添加Todo项表单页面接口"><a href="#GET-添加Todo项表单页面接口" class="headerlink" title="GET 添加Todo项表单页面接口"></a>GET 添加Todo项表单页面接口</h2><p>添加测试用例的思路如下：</p>
<ol>
<li>使用@ExpectedDatabase注解来验证接口没有对数据库表状态产生变化</li>
<li>模拟执行”/todo/add”的GET请求，并取得返回的响应结果</li>
<li>对返回的响应结果作断言：HTTP状态码为200</li>
<li>对返回的响应结果作断言：view的名字是’todo/add’</li>
<li>对返回的响应结果作断言：view的路径为”/WEB-INF/jsp/todo/add.jsp”</li>
<li>对返回的响应结果作断言：model中Todo项各个字段均为空</li>
</ol>
<p>最终代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.DbUnitTestExecutionListener;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.DatabaseSetup;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.ExpectedDatabase;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.TestExecutionListeners;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DependencyInjectionTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DirtiesContextTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.transaction.TransactionalTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.MockMvc;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.samples.context.WebContextLoader;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.Matchers.*;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.request.MockMvcRequestBuilders.get;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.result.MockMvcResultMatchers.*;</div><div class="line"> </div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@ContextConfiguration</span>(loader = WebContextLoader.class, classes = &#123;ExampleApplicationContext.class&#125;)</div><div class="line"><span class="meta">@TestExecutionListeners</span>(&#123; DependencyInjectionTestExecutionListener.class,</div><div class="line">        DirtiesContextTestExecutionListener.class,</div><div class="line">        TransactionalTestExecutionListener.class,</div><div class="line">        DbUnitTestExecutionListener.class &#125;)</div><div class="line"><span class="meta">@DatabaseSetup</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ITTodoControllerTest</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">//Add web application context here</span></div><div class="line"> </div><div class="line">    <span class="keyword">private</span> MockMvc mockMvc;</div><div class="line"> </div><div class="line">    <span class="comment">//Add setUp() method here</span></div><div class="line"> </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@ExpectedDatabase</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showAddTodoForm</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        mockMvc.perform(get(<span class="string">"/todo/add"</span>))</div><div class="line">                .andExpect(status().isOk())</div><div class="line">                .andExpect(view().name(<span class="string">"todo/add"</span>))</div><div class="line">                .andExpect(forwardedUrl(<span class="string">"/WEB-INF/jsp/todo/add.jsp"</span>))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"id"</span>, nullValue())))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"description"</span>, isEmptyOrNullString())))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"title"</span>, isEmptyOrNullString())));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码中使用到的<code>todoData.xml</code>文件内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dataset</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">todos</span> <span class="attr">id</span>=<span class="string">"1"</span> <span class="attr">creation_time</span>=<span class="string">"2012-10-21 11:13:28"</span> <span class="attr">description</span>=<span class="string">"Lorem ipsum"</span> <span class="attr">modification_time</span>=<span class="string">"2012-10-21 11:13:28"</span> <span class="attr">title</span>=<span class="string">"Foo"</span> <span class="attr">version</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">todos</span> <span class="attr">id</span>=<span class="string">"2"</span> <span class="attr">creation_time</span>=<span class="string">"2012-10-21 11:13:28"</span> <span class="attr">description</span>=<span class="string">"Lorem ipsum"</span> <span class="attr">modification_time</span>=<span class="string">"2012-10-21 11:13:28"</span> <span class="attr">title</span>=<span class="string">"Bar"</span> <span class="attr">version</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dataset</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="POST-添加Todo项表单处理接口"><a href="#POST-添加Todo项表单处理接口" class="headerlink" title="POST 添加Todo项表单处理接口"></a>POST 添加Todo项表单处理接口</h2><p>处理一个添加Todo项的表单请求，可能会有3种处理结果：</p>
<ul>
<li>表单提交的Todo项为空，添加失败，返回错误提示</li>
<li>表单提交的Todo项的title/description字段值长度不合法，添加失败，返回错误提示</li>
<li>表单提交的Todo项各个字段合法，添加成功</li>
</ul>
<p>下面来分别编写测试用例。</p>
<h3 id="提交空表单"><a href="#提交空表单" class="headerlink" title="提交空表单"></a>提交空表单</h3><p>添加测试用例的思路如下：</p>
<ol>
<li>使用@ExpectedDatabase注解来验证接口没有对数据库表状态产生变化</li>
<li>模拟执行”/todo/add”的POST请求，并取得返回的响应结果：Content-type 设置为”application/x-www-form-urlencoded”</li>
<li>对返回的响应结果作断言：HTTP状态码为200</li>
<li>对返回的响应结果作断言：view的名字是’todo/add’</li>
<li>对返回的响应结果作断言：view的路径为”/WEB-INF/jsp/todo/add.jsp”</li>
<li>对返回的响应结果作断言：model中存在预期的错误提示信息</li>
</ol>
<p>最终代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.DbUnitTestExecutionListener;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.DatabaseSetup;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.ExpectedDatabase;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</div><div class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.TestExecutionListeners;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DependencyInjectionTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DirtiesContextTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.transaction.TransactionalTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.MockMvc;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.samples.context.WebContextLoader;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.Matchers.*;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.request.MockMvcRequestBuilders.post;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.result.MockMvcResultMatchers.*;</div><div class="line"> </div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@ContextConfiguration</span>(loader = WebContextLoader.class, classes = &#123;ExampleApplicationContext.class&#125;)</div><div class="line"><span class="meta">@TestExecutionListeners</span>(&#123; DependencyInjectionTestExecutionListener.class,</div><div class="line">        DirtiesContextTestExecutionListener.class,</div><div class="line">        TransactionalTestExecutionListener.class,</div><div class="line">        DbUnitTestExecutionListener.class &#125;)</div><div class="line"><span class="meta">@DatabaseSetup</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ITTodoControllerTest</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">//Add web application context here</span></div><div class="line"> </div><div class="line">    <span class="keyword">private</span> MockMvc mockMvc;</div><div class="line"> </div><div class="line">    <span class="comment">//Add setUp() method here</span></div><div class="line"> </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@ExpectedDatabase</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addEmptyTodo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        mockMvc.perform(post(<span class="string">"/todo/add"</span>)</div><div class="line">                .contentType(MediaType.APPLICATION_FORM_URLENCODED)</div><div class="line">                .sessionAttr(<span class="string">"todo"</span>, <span class="keyword">new</span> TodoDTO())</div><div class="line">        )</div><div class="line">                .andExpect(status().isOk())</div><div class="line">                .andExpect(view().name(<span class="string">"todo/add"</span>))</div><div class="line">                .andExpect(forwardedUrl(<span class="string">"/WEB-INF/jsp/todo/add.jsp"</span>))</div><div class="line">                .andExpect(model().attributeHasFieldErrors(<span class="string">"todo"</span>, <span class="string">"title"</span>))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"id"</span>, nullValue())))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"description"</span>, isEmptyOrNullString())))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"title"</span>, isEmptyOrNullString())));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="表单验证失败"><a href="#表单验证失败" class="headerlink" title="表单验证失败"></a>表单验证失败</h3><p>添加测试用例的思路如下：</p>
<ol>
<li>使用@ExpectedDatabase注解来验证接口没有对数据库表状态产生变化</li>
<li>模拟执行”/todo/add”的POST请求，并取得返回的响应结果：Content-type 设置为”application/x-www-form-urlencoded”</li>
<li>对返回的响应结果作断言：HTTP状态码为200</li>
<li>对返回的响应结果作断言：view的名字是’todo/add’</li>
<li>对返回的响应结果作断言：view的路径为”/WEB-INF/jsp/todo/add.jsp”</li>
<li>对返回的响应结果作断言：model中存在预期的错误提示信息</li>
</ol>
<p>最终代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.DbUnitTestExecutionListener;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.DatabaseSetup;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.ExpectedDatabase;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</div><div class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.TestExecutionListeners;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DependencyInjectionTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DirtiesContextTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.transaction.TransactionalTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.MockMvc;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.samples.context.WebContextLoader;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.Matchers.*;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.request.MockMvcRequestBuilders.post;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.result.MockMvcResultMatchers.*;</div><div class="line"> </div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@ContextConfiguration</span>(loader = WebContextLoader.class, classes = &#123;ExampleApplicationContext.class&#125;)</div><div class="line"><span class="meta">@TestExecutionListeners</span>(&#123; DependencyInjectionTestExecutionListener.class,</div><div class="line">        DirtiesContextTestExecutionListener.class,</div><div class="line">        TransactionalTestExecutionListener.class,</div><div class="line">        DbUnitTestExecutionListener.class &#125;)</div><div class="line"><span class="meta">@DatabaseSetup</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ITTodoControllerTest</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">//Add web application context here</span></div><div class="line"> </div><div class="line">    <span class="keyword">private</span> MockMvc mockMvc;</div><div class="line"> </div><div class="line">    <span class="comment">//Add setUp() method here</span></div><div class="line"> </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@ExpectedDatabase</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTodoWhenTitleAndDescriptionAreTooLong</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        String title = TodoTestUtil.createStringWithLength(<span class="number">101</span>);</div><div class="line">        String description = TodoTestUtil.createStringWithLength(<span class="number">501</span>);</div><div class="line"> </div><div class="line">        mockMvc.perform(post(<span class="string">"/todo/add"</span>)</div><div class="line">                .contentType(MediaType.APPLICATION_FORM_URLENCODED)</div><div class="line">                .param(<span class="string">"description"</span>, description)</div><div class="line">                .param(<span class="string">"title"</span>, title)</div><div class="line">                .sessionAttr(<span class="string">"todo"</span>, <span class="keyword">new</span> TodoDTO())</div><div class="line">        )</div><div class="line">                .andExpect(status().isOk())</div><div class="line">                .andExpect(view().name(<span class="string">"todo/add"</span>))</div><div class="line">                .andExpect(forwardedUrl(<span class="string">"/WEB-INF/jsp/todo/add.jsp"</span>))</div><div class="line">                .andExpect(model().attributeHasFieldErrors(<span class="string">"todo"</span>, <span class="string">"title"</span>))</div><div class="line">                .andExpect(model().attributeHasFieldErrors(<span class="string">"todo"</span>, <span class="string">"description"</span>))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"id"</span>, nullValue())))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"description"</span>, is(description))))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"title"</span>, is(title))));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="表单被正确处理"><a href="#表单被正确处理" class="headerlink" title="表单被正确处理"></a>表单被正确处理</h3><p>添加测试用例的思路如下：</p>
<ol>
<li>使用@ExpectedDatabase注解来验证接口往数据库中写入了一条记录</li>
<li>模拟执行”/todo/add”的POST请求，并取得返回的响应结果：Content-type 设置为”application/x-www-form-urlencoded”</li>
<li>对返回的响应结果作断言：HTTP状态码为200</li>
<li>对返回的响应结果作断言：view的名字是’redirect:/todo/view/{id}’</li>
<li>对返回的响应结果作断言：model中返回的Todo项的id值为3</li>
</ol>
<p>最终代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.DbUnitTestExecutionListener;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.DatabaseSetup;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.ExpectedDatabase;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.assertion.DatabaseAssertionMode;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</div><div class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.TestExecutionListeners;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DependencyInjectionTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DirtiesContextTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.transaction.TransactionalTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.MockMvc;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.samples.context.WebContextLoader;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.Matchers.is;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.request.MockMvcRequestBuilders.post;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.result.MockMvcResultMatchers.*;</div><div class="line"> </div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@ContextConfiguration</span>(loader = WebContextLoader.class, classes = &#123;ExampleApplicationContext.class&#125;)</div><div class="line"><span class="meta">@TestExecutionListeners</span>(&#123; DependencyInjectionTestExecutionListener.class,</div><div class="line">        DirtiesContextTestExecutionListener.class,</div><div class="line">        TransactionalTestExecutionListener.class,</div><div class="line">        DbUnitTestExecutionListener.class &#125;)</div><div class="line"><span class="meta">@DatabaseSetup</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ITTodoControllerTest</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">//Add web application context here</span></div><div class="line"> </div><div class="line">    <span class="keyword">private</span> MockMvc mockMvc;</div><div class="line"> </div><div class="line">    <span class="comment">//Add setUp() method here</span></div><div class="line"> </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@ExpectedDatabase</span>(value=<span class="string">"toDoData-add-expected.xml"</span>, assertionMode = DatabaseAssertionMode.NON_STRICT)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTodo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        mockMvc.perform(post(<span class="string">"/todo/add"</span>)</div><div class="line">                .contentType(MediaType.APPLICATION_FORM_URLENCODED)</div><div class="line">                .param(<span class="string">"description"</span>, <span class="string">"description"</span>)</div><div class="line">                .param(<span class="string">"title"</span>, <span class="string">"title"</span>)</div><div class="line">                .sessionAttr(<span class="string">"todo"</span>, <span class="keyword">new</span> TodoDTO())</div><div class="line">        )</div><div class="line">                .andExpect(status().isOk())</div><div class="line">                .andExpect(view().name(<span class="string">"redirect:/todo/view/&#123;id&#125;"</span>))</div><div class="line">                .andExpect(model().attribute(<span class="string">"id"</span>, is(<span class="string">"3"</span>)))</div><div class="line">                .andExpect(flash().attribute(<span class="string">"feedbackMessage"</span>, is(<span class="string">"Todo entry: title was added."</span>)));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="GET-修改Todo项表单页面接口"><a href="#GET-修改Todo项表单页面接口" class="headerlink" title="GET 修改Todo项表单页面接口"></a>GET 修改Todo项表单页面接口</h2><p>根据参数的不同，该请求会返回不同的结果：</p>
<ul>
<li>如果指定的Todo项被找到，返回修改页面</li>
<li>如果指定的Todo项未找到，返回404页面</li>
</ul>
<p>下面来分别编写测试用例。</p>
<h3 id="指定Todo项被找到"><a href="#指定Todo项被找到" class="headerlink" title="指定Todo项被找到"></a>指定Todo项被找到</h3><p>添加测试用例的思路如下：</p>
<ol>
<li>使用@ExpectedDatabase注解来验证接口没有对数据库表状态产生变化</li>
<li>模拟执行”/todo/update/1”的GET请求，并取得返回的响应结果</li>
<li>对返回的响应结果作断言：HTTP状态码为200</li>
<li>对返回的响应结果作断言：view的名字是’todo/update’</li>
<li>对返回的响应结果作断言：view的路径为”/WEB-INF/jsp/todo/update.jsp”</li>
<li>对返回的响应结果作断言：model中存在预期的错误提示信息</li>
</ol>
<p>最终代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.DbUnitTestExecutionListener;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.DatabaseSetup;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.ExpectedDatabase;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.TestExecutionListeners;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DependencyInjectionTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DirtiesContextTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.transaction.TransactionalTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.MockMvc;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.samples.context.WebContextLoader;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.Matchers.*;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.request.MockMvcRequestBuilders.get;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.result.MockMvcResultMatchers.*;</div><div class="line"> </div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@ContextConfiguration</span>(loader = WebContextLoader.class, classes = &#123;ExampleApplicationContext.class&#125;)</div><div class="line"><span class="meta">@TestExecutionListeners</span>(&#123; DependencyInjectionTestExecutionListener.class,</div><div class="line">        DirtiesContextTestExecutionListener.class,</div><div class="line">        TransactionalTestExecutionListener.class,</div><div class="line">        DbUnitTestExecutionListener.class &#125;)</div><div class="line"><span class="meta">@DatabaseSetup</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ITTodoControllerTest</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">//Add web application context here</span></div><div class="line"> </div><div class="line">    <span class="keyword">private</span> MockMvc mockMvc;</div><div class="line"> </div><div class="line">    <span class="comment">//Add setUp() method here</span></div><div class="line"> </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@ExpectedDatabase</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showUpdateTodoForm</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        mockMvc.perform(get(<span class="string">"/todo/update/&#123;id&#125;"</span>, <span class="number">1L</span>))</div><div class="line">                .andExpect(status().isOk())</div><div class="line">                .andExpect(view().name(<span class="string">"todo/update"</span>))</div><div class="line">                .andExpect(forwardedUrl(<span class="string">"/WEB-INF/jsp/todo/update.jsp"</span>))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"id"</span>, is(<span class="number">1L</span>))))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"description"</span>, is(<span class="string">"Lorem ipsum"</span>))))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"title"</span>, is(<span class="string">"Foo"</span>))));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="指定Todo项未找到"><a href="#指定Todo项未找到" class="headerlink" title="指定Todo项未找到"></a>指定Todo项未找到</h3><p>添加测试用例的思路如下：</p>
<ol>
<li>使用@ExpectedDatabase注解来验证接口没有对数据库表状态产生变化</li>
<li>模拟执行”/todo/update/3”的GET请求，并取得返回的响应结果</li>
<li>对返回的响应结果作断言：HTTP状态码为404</li>
<li>对返回的响应结果作断言：view的名字是’error/404’</li>
<li>对返回的响应结果作断言：view的路径为”/WEB-INF/jsp/error/404.jsp”</li>
</ol>
<p>最终代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.DbUnitTestExecutionListener;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.DatabaseSetup;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.ExpectedDatabase;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.TestExecutionListeners;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DependencyInjectionTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DirtiesContextTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.transaction.TransactionalTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.MockMvc;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.samples.context.WebContextLoader;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.request.MockMvcRequestBuilders.get;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.result.MockMvcResultMatchers.*;</div><div class="line"> </div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@ContextConfiguration</span>(loader = WebContextLoader.class, classes = &#123;ExampleApplicationContext.class&#125;)</div><div class="line"><span class="meta">@TestExecutionListeners</span>(&#123; DependencyInjectionTestExecutionListener.class,</div><div class="line">        DirtiesContextTestExecutionListener.class,</div><div class="line">        TransactionalTestExecutionListener.class,</div><div class="line">        DbUnitTestExecutionListener.class &#125;)</div><div class="line"><span class="meta">@DatabaseSetup</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ITTodoControllerTest</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">//Add web application context here</span></div><div class="line"> </div><div class="line">    <span class="keyword">private</span> MockMvc mockMvc;</div><div class="line"> </div><div class="line">    <span class="comment">//Add setUp() method here</span></div><div class="line"> </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@ExpectedDatabase</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showUpdateTodoFormWhenTodoIsNotFound</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        mockMvc.perform(get(<span class="string">"/todo/update/&#123;id&#125;"</span>, <span class="number">3L</span>))</div><div class="line">                .andExpect(status().isNotFound())</div><div class="line">                .andExpect(view().name(<span class="string">"error/404"</span>))</div><div class="line">                .andExpect(forwardedUrl(<span class="string">"/WEB-INF/jsp/error/404.jsp"</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="POST-修改Todo项表单处理接口"><a href="#POST-修改Todo项表单处理接口" class="headerlink" title="POST 修改Todo项表单处理接口"></a>POST 修改Todo项表单处理接口</h2><p>处理一个修改Todo项的表单请求，可能会有以下4个结果：</p>
<ul>
<li>表单里的Todo项为空，修改失败，返回错误信息</li>
<li>表单里的Todo项参数不合法，修改失败，返回错误信息</li>
<li>表单里指定的Todo项被正确修改</li>
<li>表单里指定的Todo项不存在，修改失败</li>
</ul>
<p>下面来分别编写测试用例。</p>
<h3 id="提交空表单-1"><a href="#提交空表单-1" class="headerlink" title="提交空表单"></a>提交空表单</h3><p>添加测试用例的思路如下：</p>
<ol>
<li>使用@ExpectedDatabase注解来验证接口没有对数据库表状态产生变化</li>
<li>模拟执行”/todo/update”的POST请求，并取得返回的响应结果：Content-type 设置为”application/x-www-form-urlencoded”</li>
<li>对返回的响应结果作断言：HTTP状态码为200</li>
<li>对返回的响应结果作断言：view的名字是’todo/update’</li>
<li>对返回的响应结果作断言：view的路径为”/WEB-INF/jsp/todo/update.jsp”</li>
<li>对返回的响应结果作断言：model中存在预期的错误提示信息</li>
</ol>
<p>最终代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.DbUnitTestExecutionListener;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.DatabaseSetup;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.ExpectedDatabase;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</div><div class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.TestExecutionListeners;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DependencyInjectionTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DirtiesContextTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.transaction.TransactionalTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.MockMvc;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.samples.context.WebContextLoader;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.Matchers.*;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.request.MockMvcRequestBuilders.post;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.result.MockMvcResultMatchers.*;</div><div class="line"> </div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@ContextConfiguration</span>(loader = WebContextLoader.class, classes = &#123;ExampleApplicationContext.class&#125;)</div><div class="line"><span class="meta">@TestExecutionListeners</span>(&#123; DependencyInjectionTestExecutionListener.class,</div><div class="line">        DirtiesContextTestExecutionListener.class,</div><div class="line">        TransactionalTestExecutionListener.class,</div><div class="line">        DbUnitTestExecutionListener.class &#125;)</div><div class="line"><span class="meta">@DatabaseSetup</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ITTodoControllerTest</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">//Add web application context here</span></div><div class="line"> </div><div class="line">    <span class="keyword">private</span> MockMvc mockMvc;</div><div class="line"> </div><div class="line">    <span class="comment">//Add setUp() method here</span></div><div class="line"> </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@ExpectedDatabase</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateEmptyTodo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        mockMvc.perform(post(<span class="string">"/todo/update"</span>)</div><div class="line">                .contentType(MediaType.APPLICATION_FORM_URLENCODED)</div><div class="line">                .param(<span class="string">"id"</span>, <span class="string">"1"</span>)</div><div class="line">                .sessionAttr(<span class="string">"todo"</span>, <span class="keyword">new</span> TodoDTO())</div><div class="line">        )</div><div class="line">                .andExpect(status().isOk())</div><div class="line">                .andExpect(view().name(<span class="string">"todo/update"</span>))</div><div class="line">                .andExpect(forwardedUrl(<span class="string">"/WEB-INF/jsp/todo/update.jsp"</span>))</div><div class="line">                .andExpect(model().attributeHasFieldErrors(<span class="string">"todo"</span>, <span class="string">"title"</span>))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"id"</span>, is(<span class="number">1L</span>))))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"description"</span>, isEmptyOrNullString())))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"title"</span>, isEmptyOrNullString())));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="表单验证失败-1"><a href="#表单验证失败-1" class="headerlink" title="表单验证失败"></a>表单验证失败</h3><p>添加测试用例的思路如下：</p>
<ol>
<li>使用@ExpectedDatabase注解来验证接口没有对数据库表状态产生变化</li>
<li>模拟执行”/todo/update”的POST请求，并取得返回的响应结果：Content-type 设置为”application/x-www-form-urlencoded”</li>
<li>对返回的响应结果作断言：HTTP状态码为200</li>
<li>对返回的响应结果作断言：view的名字是’todo/update’</li>
<li>对返回的响应结果作断言：view的路径为”/WEB-INF/jsp/todo/update.jsp”</li>
<li>对返回的响应结果作断言：model中存在预期的错误提示信息</li>
</ol>
<p>最终代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.DbUnitTestExecutionListener;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.DatabaseSetup;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.ExpectedDatabase;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</div><div class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.TestExecutionListeners;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DependencyInjectionTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DirtiesContextTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.transaction.TransactionalTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.MockMvc;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.samples.context.WebContextLoader;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.Matchers.*;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.request.MockMvcRequestBuilders.post;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.result.MockMvcResultMatchers.*;</div><div class="line"> </div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@ContextConfiguration</span>(loader = WebContextLoader.class, classes = &#123;ExampleApplicationContext.class&#125;)</div><div class="line"><span class="meta">@TestExecutionListeners</span>(&#123; DependencyInjectionTestExecutionListener.class,</div><div class="line">        DirtiesContextTestExecutionListener.class,</div><div class="line">        TransactionalTestExecutionListener.class,</div><div class="line">        DbUnitTestExecutionListener.class &#125;)</div><div class="line"><span class="meta">@DatabaseSetup</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ITTodoControllerTest</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">//Add web application context here</span></div><div class="line"> </div><div class="line">    <span class="keyword">private</span> MockMvc mockMvc;</div><div class="line"> </div><div class="line">    <span class="comment">//Add setUp() method here</span></div><div class="line"> </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@ExpectedDatabase</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateTodoWhenTitleAndDescriptionAreTooLong</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        String title = TodoTestUtil.createStringWithLength(<span class="number">101</span>);</div><div class="line">        String description = TodoTestUtil.createStringWithLength(<span class="number">501</span>);</div><div class="line"> </div><div class="line">        mockMvc.perform(post(<span class="string">"/todo/update"</span>)</div><div class="line">                .contentType(MediaType.APPLICATION_FORM_URLENCODED)</div><div class="line">                .param(<span class="string">"description"</span>, description)</div><div class="line">                .param(<span class="string">"id"</span>, <span class="string">"1"</span>)</div><div class="line">                .param(<span class="string">"title"</span>, title)</div><div class="line">                .sessionAttr(<span class="string">"todo"</span>, <span class="keyword">new</span> TodoDTO())</div><div class="line">        )</div><div class="line">                .andExpect(status().isOk())</div><div class="line">                .andExpect(view().name(<span class="string">"todo/update"</span>))</div><div class="line">                .andExpect(forwardedUrl(<span class="string">"/WEB-INF/jsp/todo/update.jsp"</span>))</div><div class="line">                .andExpect(model().attributeHasFieldErrors(<span class="string">"todo"</span>, <span class="string">"title"</span>))</div><div class="line">                .andExpect(model().attributeHasFieldErrors(<span class="string">"todo"</span>, <span class="string">"description"</span>))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"id"</span>, is(<span class="number">1L</span>))))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"description"</span>, is(description))))</div><div class="line">                .andExpect(model().attribute(<span class="string">"todo"</span>, hasProperty(<span class="string">"title"</span>, is(title))));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="表单被正确处理-1"><a href="#表单被正确处理-1" class="headerlink" title="表单被正确处理"></a>表单被正确处理</h3><p>添加测试用例的思路如下：</p>
<ol>
<li>使用@ExpectedDatabase注解来验证接口修改了数据库的一条数据</li>
<li>模拟执行”/todo/update”的POST请求，并取得返回的响应结果：Content-type 设置为”application/x-www-form-urlencoded”</li>
<li>对返回的响应结果作断言：HTTP状态码为200</li>
<li>对返回的响应结果作断言：view的名字是’redirect:/todo/view/{id}’</li>
<li>对返回的响应结果作断言：model中返回的Todo项的id值为1</li>
</ol>
<p>最终代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.DbUnitTestExecutionListener;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.DatabaseSetup;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.ExpectedDatabase;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.assertion.DatabaseAssertionMode;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</div><div class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.TestExecutionListeners;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DependencyInjectionTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DirtiesContextTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.transaction.TransactionalTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.MockMvc;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.samples.context.WebContextLoader;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.Matchers.is;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.request.MockMvcRequestBuilders.post;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.result.MockMvcResultMatchers.*;</div><div class="line"> </div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@ContextConfiguration</span>(loader = WebContextLoader.class, classes = &#123;ExampleApplicationContext.class&#125;)</div><div class="line"><span class="meta">@TestExecutionListeners</span>(&#123; DependencyInjectionTestExecutionListener.class,</div><div class="line">        DirtiesContextTestExecutionListener.class,</div><div class="line">        TransactionalTestExecutionListener.class,</div><div class="line">        DbUnitTestExecutionListener.class &#125;)</div><div class="line"><span class="meta">@DatabaseSetup</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ITTodoControllerTest</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">//Add web application context here</span></div><div class="line"> </div><div class="line">    <span class="keyword">private</span> MockMvc mockMvc;</div><div class="line"> </div><div class="line">    <span class="comment">//Add setUp() method here</span></div><div class="line"> </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@ExpectedDatabase</span>(value=<span class="string">"toDoData-update-expected.xml"</span>, assertionMode = DatabaseAssertionMode.NON_STRICT)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateTodo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        mockMvc.perform(post(<span class="string">"/todo/update"</span>)</div><div class="line">                .contentType(MediaType.APPLICATION_FORM_URLENCODED)</div><div class="line">                .param(<span class="string">"description"</span>, <span class="string">"description"</span>)</div><div class="line">                .param(<span class="string">"id"</span>, <span class="string">"1"</span>)</div><div class="line">                .param(<span class="string">"title"</span>, <span class="string">"title"</span>)</div><div class="line">                .sessionAttr(<span class="string">"todo"</span>, <span class="keyword">new</span> TodoDTO())</div><div class="line">        )</div><div class="line">                .andExpect(status().isOk())</div><div class="line">                .andExpect(view().name(<span class="string">"redirect:/todo/view/&#123;id&#125;"</span>))</div><div class="line">                .andExpect(model().attribute(<span class="string">"id"</span>, is(<span class="string">"1"</span>)))</div><div class="line">                .andExpect(flash().attribute(<span class="string">"feedbackMessage"</span>, is(<span class="string">"Todo entry: title was updated."</span>)));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>进行数据库验证的<code>toDoData-update-expected.xml</code>文件的内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dataset</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">todos</span> <span class="attr">id</span>=<span class="string">"1"</span> <span class="attr">description</span>=<span class="string">"description"</span> <span class="attr">title</span>=<span class="string">"title"</span> <span class="attr">version</span>=<span class="string">"1"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">todos</span> <span class="attr">id</span>=<span class="string">"2"</span> <span class="attr">description</span>=<span class="string">"Lorem ipsum"</span> <span class="attr">title</span>=<span class="string">"Bar"</span> <span class="attr">version</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dataset</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="指定Todo项未找到-1"><a href="#指定Todo项未找到-1" class="headerlink" title="指定Todo项未找到"></a>指定Todo项未找到</h3><p>添加测试用例的思路如下：</p>
<ol>
<li>使用@ExpectedDatabase注解来验证接口没有对数据库表状态产生变化</li>
<li>模拟执行”/todo/update”的POST请求，并取得返回的响应结果：Content-type 设置为”application/x-www-form-urlencoded”</li>
<li>对返回的响应结果作断言：HTTP状态码为404</li>
<li>对返回的响应结果作断言：view的名字是’error/404’</li>
<li>对返回的响应结果作断言：view的路径为”/WEB-INF/jsp/error/404.jsp”</li>
</ol>
<p>最终代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.DbUnitTestExecutionListener;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.DatabaseSetup;</div><div class="line"><span class="keyword">import</span> com.github.springtestdbunit.annotation.ExpectedDatabase;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</div><div class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.TestExecutionListeners;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DependencyInjectionTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.support.DirtiesContextTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.transaction.TransactionalTestExecutionListener;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.MockMvc;</div><div class="line"><span class="keyword">import</span> org.springframework.test.web.server.samples.context.WebContextLoader;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.request.MockMvcRequestBuilders.post;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.server.result.MockMvcResultMatchers.*;</div><div class="line"> </div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@ContextConfiguration</span>(loader = WebContextLoader.class, classes = &#123;ExampleApplicationContext.class&#125;)</div><div class="line"><span class="meta">@TestExecutionListeners</span>(&#123; DependencyInjectionTestExecutionListener.class,</div><div class="line">        DirtiesContextTestExecutionListener.class,</div><div class="line">        TransactionalTestExecutionListener.class,</div><div class="line">        DbUnitTestExecutionListener.class &#125;)</div><div class="line"><span class="meta">@DatabaseSetup</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ITTodoControllerTest</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">//Add web application context here</span></div><div class="line"> </div><div class="line">    <span class="keyword">private</span> MockMvc mockMvc;</div><div class="line"> </div><div class="line">    <span class="comment">//Add setUp() method here</span></div><div class="line"> </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@ExpectedDatabase</span>(<span class="string">"toDoData.xml"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateTodoWhenTodoIsNotFound</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        mockMvc.perform(post(<span class="string">"/todo/update"</span>)</div><div class="line">                .contentType(MediaType.APPLICATION_FORM_URLENCODED)</div><div class="line">                .param(<span class="string">"description"</span>, <span class="string">"description"</span>)</div><div class="line">                .param(<span class="string">"id"</span>, <span class="string">"3"</span>)</div><div class="line">                .param(<span class="string">"title"</span>, <span class="string">"title"</span>)</div><div class="line">                .sessionAttr(<span class="string">"todo"</span>, <span class="keyword">new</span> TodoDTO())</div><div class="line">        )</div><div class="line">                .andExpect(status().isNotFound())</div><div class="line">                .andExpect(view().name(<span class="string">"error/404"</span>))</div><div class="line">                .andExpect(forwardedUrl(<span class="string">"/WEB-INF/jsp/error/404.jsp"</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>本文主要介绍了如何编写集成测试用例测试表单处理接口，要点如下：</p>
<ul>
<li>如何指定请求的content type</li>
<li>如何模拟表单请求</li>
<li>如何在Session中添加数据</li>
<li>如何检测响应数据中包含了错误提示信息</li>
</ul>
<p>下一篇是 <a href="/2016/04/09/spring-mvc-testing-integration-testing-rest-api/">Spring MVC Integration Testing - REST API</a>。</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    




                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2016/04/09/spring-mvc-testing-integration-testing-rest-api/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/04/09/spring-mvc-testing-integration-testing-controllers/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/logo.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/logo.png" alt="Elvis Wang's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        mail@wbprime.me
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">17</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">六月 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">五月 2015<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/05/">五月 2014<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/05/">五月 2013<span class="sidebar_archives-count">18</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/c-c/">C/C++<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/learning-java-concurrency/">Learning Java Concurrency<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/categories/life/">Life<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/categories/mayday/">Mayday<span class="sidebar_archives-count">19</span></a></li><li><a class="sidebar_archives-link" href="/categories/spring-di/">Spring DI<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/spring-mvc-testing/">Spring MVC Testing<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/categories/tech/">Tech<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">59</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/wbprime" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;wbprime
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->
<script src="/js/lazyload.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- Swiftye -->


<!-- Local Search-->


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
